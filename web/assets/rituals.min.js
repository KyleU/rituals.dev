var action;(function(b){b.loadActions=function(){socket.send({svc:services.system.key,cmd:command.client.getActions,param:null})};b.viewActions=function(e){dom.setContent("#action-list",b.renderActions(e))}})(action||(action={}));var collection;
(function(b){var e=function(){return function(b){this.members=[];this.key=b}}();b.Group=e;b.groupBy=function(b,c){var a=[],f=null;b.forEach(function(b){var d=c(b);null===f&&(f=new e(d));d!=f.key&&(a.push(f),f=new e(d));f.members.push(b)});null!=f&&a.push(f);return a}})(collection||(collection={}));var date;
(function(b){function e(c){return c.toLocaleDateString()}function d(c){return c.toLocaleTimeString().slice(0,8)}b.dateToYMD=function(c){var a=c.getDate(),f=c.getMonth()+1;return""+c.getFullYear()+"-"+(9>=f?"0"+f:f)+"-"+(9>=a?"0"+a:a)};b.dateFromYMD=function(c){c=new Date(c);return c=new Date(c.getTime()+6E4*c.getTimezoneOffset())};b.dow=function(c){switch(c){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat";default:return"???"}};
b.toDateString=e;b.toTimeString=d;b.toDateTimeString=function(c){return e(c)+" "+d(c)}})(date||(date={}));var dom;
(function(b){function e(a,c){return UIkit.util.$$(a,c)}function d(a,c){a=e(a,c);return 0===a.length?null:a[0]}function c(a,c){c=d(a,c);null===c&&console.warn("no element found for selector ["+a+"]");return c}b.els=e;b.opt=d;b.req=c;b.setHTML=function(a,f){"string"===typeof a&&(a=c(a));a.innerHTML=f;return a};b.setContent=function(a,f){"string"===typeof a&&(a=c(a));a.innerHTML="";a.appendChild(f);return a};b.setText=function(a,f){"string"===typeof a&&(a=c(a));a.innerText=f;return a};b.setValue=function(a,
f){"string"===typeof a&&(a=c(a));a.value=f;return a};b.wireTextarea=function(a){function c(){a.style.height="auto";a.style.height=(64>a.scrollHeight?64:a.scrollHeight+6)+"px"}function b(){window.setTimeout(c,0)}void 0===a.dataset.autoresize&&(a.dataset.autoresize="true",a.addEventListener("change",c,!1),a.addEventListener("cut",b,!1),a.addEventListener("paste",b,!1),a.addEventListener("drop",b,!1),a.addEventListener("keydown",b,!1),a.focus(),a.select());c()};b.setOptions=function(a,c){a.innerHTML=
"";for(var f=0;f<c.length;f++){var b=c[f],d=document.createElement("option");d.value=b;d.innerText=b;a.appendChild(d)}};b.setSelectOption=function(a,c){for(var f=0;f<a.children.length;f++){var b=a.children.item(f);b.selected=b.value===c}}})(dom||(dom={}));var estimate;
(function(b){function e(a){b.cache.detail=a;dom.setValue("#model-choices-input",a.choices.join(", "));story.viewActiveStory();rituals.setDetail(a)}function d(c){var f=a(c.id);f.push(c);c.id===b.cache.activeStory&&dom.setText("#story-title",c.title);story.setStories(f)}function c(c){var f=a(c);story.setStories(f);c===b.cache.activeStory&&UIkit.modal("#modal-story").hide();UIkit.notification("story has been deleted",{status:"success",pos:"top-right"})}function a(a){return b.cache.stories.filter(function(c){return c.id!==
a})}var f=function(){function a(){this.stories=[];this.votes=[]}a.prototype.activeVotes=function(){var a=this;return void 0===this.activeStory?[]:this.votes.filter(function(c){return c.storyID===a.activeStory})};return a}();b.cache=new f;b.onEstimateMessage=function(a,f){switch(a){case command.server.error:rituals.onError(services.estimate.key,f);break;case command.server.sessionJoined:rituals.onSessionJoin(f);rituals.setTeam(f.team);rituals.setSprint(f.sprint);e(f.session);story.setStories(f.stories);
vote.setVotes(f.votes);rituals.showWelcomeMessage(f.members.length);break;case command.server.sessionUpdate:e(f);break;case command.server.teamUpdate:b.cache.detail&&(b.cache.detail.teamID=null===f||void 0===f?void 0:f.id);rituals.setTeam(f);break;case command.server.sprintUpdate:b.cache.detail&&(b.cache.detail.sprintID=null===f||void 0===f?void 0:f.id);rituals.setSprint(f);break;case command.server.storyUpdate:d(f);break;case command.server.storyRemove:c(f);break;case command.server.storyStatusChange:story.onStoryStatusChange(f);
break;case command.server.voteUpdate:vote.onVoteUpdate(f);break;default:console.warn("unhandled command ["+a+"] for estimate")}};b.onSubmitEstimateSession=function(){var a=dom.req("#model-title-input").value,c=dom.req("#model-choices-input").value,f=dom.req("#model-team-select select").value,b=dom.req("#model-sprint-select select").value;socket.send({svc:services.estimate.key,cmd:command.client.updateSession,param:{title:a,choices:c,teamID:f,sprintID:b}})};b.onStoryUpdate=d;b.onStoryRemove=c})(estimate||
(estimate={}));var events;
(function(b){b.openModal=function(b,d){switch(b){case "session":var c=dom.setValue("#model-title-input",dom.req("#model-title").innerText);setTimeout(function(){return c.focus()},250);team.refreshTeams();sprint.refreshSprints();break;case "self":var a=dom.setValue("#self-name-input",dom.req("#member-self .member-name").innerText);setTimeout(function(){return a.focus()},250);break;case "invitation":break;case "member":system.cache.activeMember=d;member.viewActiveMember();break;case "welcome":break;
case "actions":action.loadActions();break;case "add-story":var f=dom.setValue("#story-title-input","");setTimeout(function(){return f.focus()},250);break;case "story":estimate.cache.activeStory=d;story.viewActiveStory();break;case "add-report":dom.setValue("#standup-report-date",date.dateToYMD(new Date));var e=dom.setValue("#standup-report-content","");dom.wireTextarea(e);setTimeout(function(){return e.focus()},250);break;case "report":standup.cache.activeReport=d;report.viewActiveReport();var h=
dom.req("#standup-report-edit-content");setTimeout(function(){dom.wireTextarea(h);h.focus()},250);break;case "add-feedback":dom.setSelectOption(dom.req("#retro-feedback-category"),d);var k=dom.setValue("#retro-feedback-content","");dom.wireTextarea(k);setTimeout(function(){return k.focus()},250);break;case "feedback":retro.cache.activeFeedback=d;feedback.viewActiveFeedback();var g=dom.req("#retro-feedback-edit-content");setTimeout(function(){dom.wireTextarea(g);g.focus()},250);break;default:console.warn("unhandled modal ["+
b+"]")}UIkit.modal("#modal-"+b).show();return!1}})(events||(events={}));var feedback;
(function(b){function e(){if(void 0!==retro.cache.activeFeedback){var a=retro.cache.feedback.filter(function(a){return a.id===retro.cache.activeFeedback});if(1!==a.length)console.warn("cannot load active Feedback ["+retro.cache.activeFeedback+"]");else return a[0]}}function d(a){return retro.cache.feedback.filter(function(c){return c.id!==a})}function c(a,c){feedback.setFeedback(a);c===retro.cache.activeFeedback&&UIkit.modal("#modal-feedback").hide()}b.setFeedback=function(a){retro.cache.feedback=
a;dom.setContent("#feedback-detail",b.renderFeedbackArray(a));UIkit.modal("#modal-add-feedback").hide()};b.onSubmitFeedback=function(){var a=dom.req("#retro-feedback-category").value,c=dom.req("#retro-feedback-content").value;socket.send({svc:services.retro.key,cmd:command.client.addFeedback,param:{category:a,content:c}});return!1};b.onEditFeedback=function(){var a=retro.cache.activeFeedback,c=dom.req("#retro-feedback-edit-category").value,b=dom.req("#retro-feedback-edit-content").value;socket.send({svc:services.retro.key,
cmd:command.client.updateFeedback,param:{id:a,category:c,content:b}});return!1};b.onRemoveFeedback=function(){var a=retro.cache.activeFeedback;a&&UIkit.modal.confirm("Delete this feedback?").then(function(){socket.send({svc:services.retro.key,cmd:command.client.removeFeedback,param:a});UIkit.modal("#modal-feedback").hide()});return!1};b.getActiveFeedback=e;b.viewActiveFeedback=function(){var a=system.cache.getProfile(),c=e();if(void 0===c)console.warn("no active feedback");else{dom.setText("#feedback-title",
c.category+" / "+system.getMemberName(c.authorID));var b=dom.req("#modal-feedback .content-edit"),d=dom.req("#retro-feedback-edit-category",b),k=dom.req("#retro-feedback-edit-content",b),g=dom.req("#modal-feedback .content-view"),m=dom.req("#modal-feedback .buttons-edit"),n=dom.req("#modal-feedback .buttons-view");c.authorID===a.userID?(b.style.display="block",dom.setSelectOption(d,c.category),dom.setValue(k,c.content),dom.wireTextarea(k),g.style.display="none",dom.setHTML(g,""),m.style.display="block",
n.style.display="none"):(b.style.display="none",dom.setSelectOption(d,void 0),dom.setValue(k,""),g.style.display="block",dom.setHTML(g,c.html),m.style.display="none",n.style.display="block")}};b.onFeedbackUpdate=function(a){var f=d(a.id);f.push(a);c(f,a.id)};b.onFeedbackRemoved=function(a){var f=d(a);c(f,a);UIkit.notification("feedback has been deleted",{status:"success",pos:"top-right"})};b.getFeedbackCategories=function(a,c){var b=c.map(function(c){var b=a.filter(function(a){return a.category===
c}).sort(function(a,c){return a.created>c.created?-1:1});return{category:c,feedback:b}}),f=a.filter(function(a){return-1===c.indexOf(a.category)});0<f.length&&b.push({category:"unknown",feedback:f});return b}})(feedback||(feedback={}));var debug=!0,system;
(function(b){var e=function(){function b(){this.currentID=this.currentService="";this.connectTime=0;this.permissions=[];this.members=[];this.online=[]}b.prototype.getProfile=function(){if(void 0===this.profile)throw"no active profile";return this.profile};return b}();b.getMemberName=function(d){var c=b.cache.members.filter(function(a){return a.userID===d});return 0===c.length?d:c[0].name};b.cache=new e})(system||(system={}));var services;
(function(b){b.system={key:"system",title:"System",plural:"systems",icon:"close"};b.team={key:"team",title:"Team",plural:"teams",icon:"users"};b.sprint={key:"sprint",title:"Sprint",plural:"sprints",icon:"git-fork"};b.estimate={key:"estimate",title:"Estimate Session",plural:"estimates",icon:"settings"};b.standup={key:"standup",title:"Daily Standup",plural:"standups",icon:"future"};b.retro={key:"retro",title:"Retrospective",plural:"retros",icon:"history"}})(services||(services={}));var command;
(function(b){b.client={error:"error",ping:"ping",connect:"connect",updateSession:"update-session",getActions:"get-actions",getTeams:"get-teams",getSprints:"get-sprints",updateProfile:"update-profile",addStory:"add-story",updateStory:"update-story",removeStory:"remove-story",setStoryStatus:"set-story-status",submitVote:"submit-vote",addReport:"add-report",updateReport:"update-report",removeReport:"remove-report",addFeedback:"add-feedback",updateFeedback:"update-feedback",removeFeedback:"remove-feedback"};
b.server={error:"error",pong:"pong",sessionJoined:"session-joined",sessionUpdate:"session-update",teamUpdate:"team-update",sprintUpdate:"sprint-update",contentUpdate:"content-update",actions:"actions",teams:"teams",sprints:"sprints",memberUpdate:"member-update",onlineUpdate:"online-update",storyUpdate:"story-update",storyRemove:"story-remove",storyStatusChange:"story-status-change",voteUpdate:"vote-update",reportUpdate:"report-update",reportRemove:"report-remove",feedbackUpdate:"feedback-update",
feedbackRemove:"feedback-remove"}})(command||(command={}));function JSX(b,e){var d=document.createElement(b),c;for(c in e)if(c&&e.hasOwnProperty(c)){var a=e[c];!0===a?d.setAttribute(c,c):!1!==a&&null!==a&&void 0!==a&&d.setAttribute(c,a.toString())}for(c=2;c<arguments.length;c++)if(a=arguments[c],Array.isArray(a))a.forEach(function(a){d.appendChild(a)});else{if(null===a.nodeType||void 0===a.nodeType)a=document.createTextNode(a.toString());d.appendChild(a)}return d}var member;
(function(b){function e(a){return void 0===system.cache.profile?!1:a.userID===system.cache.profile.userID}function d(){var a=system.cache.members.filter(e);1===a.length?(dom.setText("#member-self .member-name",a[0].name),dom.setValue("#self-name-input",a[0].name),dom.setText("#member-self .member-role",a[0].role)):0===a.length?console.warn("self not found among members"):console.warn("multiple self entries found among members");a=system.cache.members.filter(function(a){return!e(a)});dom.setContent("#member-detail",
b.renderMembers(a));c()}function c(){for(var a=0,c=system.cache.members;a<c.length;a++){var b=c[a],d=dom.opt("#member-"+b.userID+" .online-indicator");d&&(-1===system.cache.online.indexOf(b.userID)?d.classList.add("offline"):d.classList.remove("offline"))}}function a(){if(void 0===system.cache.activeMember)console.warn("no active member");else{var a=system.cache.members.filter(function(a){return a.userID===system.cache.activeMember});if(1!==a.length)console.warn("cannot load active member ["+system.cache.activeMember+
"]");else return a[0]}}b.setMembers=d;b.onMemberUpdate=function(a){e(a)&&UIkit.modal("#modal-self").hide();var c=system.cache.members,b=c.filter(function(c){return c.userID===a.userID});b=1===b.length&&b[0].name!==a.name;c=c.filter(function(c){return c.userID!==a.userID});c.length===system.cache.members.length&&UIkit.notification(a.name+" has joined",{status:"success",pos:"top-right"});c.push(a);c=c.sort(function(a,c){return a.name>c.name?1:-1});system.cache.members=c;d();if(b)switch(system.cache.currentService){case services.estimate.key:estimate.cache.activeStory&&
vote.viewVotes();break;case services.standup.key:dom.setContent("#report-detail",report.renderReports(standup.cache.reports));standup.cache.activeReport&&report.viewActiveReport();break;case services.retro.key:dom.setContent("#feedback-detail",feedback.renderFeedbackArray(retro.cache.feedback)),retro.cache.activeFeedback&&feedback.viewActiveFeedback()}};b.onOnlineUpdate=function(a){a.connected?-1===system.cache.online.indexOf(a.userID)&&system.cache.online.push(a.userID):system.cache.online=system.cache.online.filter(function(c){return c!==
a.userID});c()};b.onSubmitSelf=function(){var a=dom.req("#self-name-input").value,c=dom.req("#self-name-choice-global").checked?"global":"local";socket.send({svc:services.system.key,cmd:command.client.updateProfile,param:{name:a,choice:c}})};b.viewActiveMember=function(){var c=a();void 0!==c&&(dom.setText("#member-modal-name",c.name),dom.setText("#member-modal-role",c.role))}})(member||(member={}));var permission;
(function(b){b.setPermissions=function(){dom.setContent("#model-perm-form",b.renderPermissions(system.cache.permissions))}})(permission||(permission={}));var profile;
(function(b){b.setNavColor=function(b,d){dom.setValue("#navbar-color",d);dom.req("#navbar").className=d+"-bg uk-navbar-container uk-navbar";document.querySelectorAll(".navbar_swatch").forEach(function(c){c.classList.remove("active")});b.classList.add("active")};b.setLinkColor=function(b,d){dom.setValue("#link-color",d);dom.els(".profile-link").forEach(function(c){c.classList.forEach(function(a){-1<a.indexOf("-fg")&&c.classList.remove(a);c.classList.add(d+"-fg")})});document.querySelectorAll(".link_swatch").forEach(function(c){c.classList.remove("active")});
b.classList.add("active")};b.selectTheme=function(b){var d=dom.els(".uk-card");switch(b){case "light":document.documentElement.classList.remove("uk-light");document.body.classList.remove("uk-light");document.documentElement.classList.add("uk-dark");document.body.classList.add("uk-dark");d.forEach(function(c){c.classList.add("uk-card-default");c.classList.remove("uk-card-secondary")});break;case "dark":document.documentElement.classList.add("uk-light");document.body.classList.add("uk-light");document.documentElement.classList.remove("uk-dark");
document.body.classList.remove("uk-dark");d.forEach(function(c){c.classList.remove("uk-card-default");c.classList.add("uk-card-secondary")});break;default:console.warn("invalid theme")}}})(profile||(profile={}));var report;
(function(b){function e(){if(void 0===standup.cache.activeReport)console.warn("no active report");else{var b=standup.cache.reports.filter(function(c){return c.id===standup.cache.activeReport});if(1!==b.length)console.warn("cannot load active report ["+standup.cache.activeReport+"]");else return b[0]}}b.onSubmitReport=function(){var b=dom.req("#standup-report-date").value,c=dom.req("#standup-report-content").value;socket.send({svc:services.standup.key,cmd:command.client.addReport,param:{d:b,content:c}});
return!1};b.onEditReport=function(){var b=dom.req("#standup-report-edit-date").value,c=dom.req("#standup-report-edit-content").value;socket.send({svc:services.standup.key,cmd:command.client.updateReport,param:{id:standup.cache.activeReport,d:b,content:c}});return!1};b.onRemoveReport=function(){var b=standup.cache.activeReport;b&&UIkit.modal.confirm("Delete this report?").then(function(){socket.send({svc:services.standup.key,cmd:command.client.removeReport,param:b});UIkit.modal("#modal-report").hide()});
return!1};b.viewActiveReport=function(){var b=system.cache.getProfile(),c=e();if(void 0===c)console.warn("no active report");else{dom.setText("#report-title",c.d+" / "+system.getMemberName(c.authorID));var a=dom.req("#modal-report .content-edit"),f=dom.req("#standup-report-edit-date",a),l=dom.req("#standup-report-edit-content",a),h=dom.req("#modal-report .content-view"),k=dom.req("#modal-report .buttons-edit"),g=dom.req("#modal-report .buttons-view");c.authorID===b.userID?(a.style.display="block",
dom.setValue(f,c.d),dom.setValue(l,c.content),dom.wireTextarea(l),h.style.display="none",dom.setHTML(h,""),k.style.display="block",g.style.display="none"):(a.style.display="none",dom.setValue(f,""),dom.setValue(l,""),h.style.display="block",dom.setHTML(h,c.html),k.style.display="none",g.style.display="block")}};b.setReports=function(d){standup.cache.reports=d;dom.setContent("#report-detail",b.renderReports(d));UIkit.modal("#modal-add-report").hide()};b.getReportDates=function(b){return b.map(function(c){return c.d}).filter(function(c,
a,b){return b.indexOf(c)===a}).sort().reverse().map(function(c){return{d:c,reports:b.filter(function(a){return a.d===c}).sort(function(a,c){return a.created>c.created?-1:1})}})}})(report||(report={}));var retro;
(function(b){function e(c){b.cache.detail=c;dom.setValue("#model-categories-input",c.categories.join(", "));dom.setOptions(dom.req("#retro-feedback-category"),c.categories);dom.setOptions(dom.req("#retro-feedback-edit-category"),c.categories);feedback.setFeedback(b.cache.feedback);rituals.setDetail(c)}var d=function(){return function(){this.feedback=[]}}();b.cache=new d;b.onRetroMessage=function(c,a){switch(c){case command.server.error:rituals.onError(services.retro.key,a);break;case command.server.sessionJoined:rituals.onSessionJoin(a);
rituals.setTeam(a.team);rituals.setSprint(a.sprint);e(a.session);feedback.setFeedback(a.feedback);rituals.showWelcomeMessage(a.members.length);break;case command.server.sessionUpdate:e(a);break;case command.server.teamUpdate:b.cache.detail&&(b.cache.detail.teamID=null===a||void 0===a?void 0:a.id);rituals.setTeam(a);break;case command.server.sprintUpdate:b.cache.detail&&(b.cache.detail.sprintID=null===a||void 0===a?void 0:a.id);rituals.setSprint(a);break;case command.server.feedbackUpdate:feedback.onFeedbackUpdate(a);
break;case command.server.feedbackRemove:feedback.onFeedbackRemoved(a);break;default:console.warn("unhandled command ["+c+"] for retro")}};b.onSubmitRetroSession=function(){var c=dom.req("#model-title-input").value,a=dom.req("#model-categories-input").value,b=dom.req("#model-team-select select").value,d=dom.req("#model-sprint-select select").value;socket.send({svc:services.retro.key,cmd:command.client.updateSession,param:{title:c,categories:a,teamID:b,sprintID:d}})}})(retro||(retro={}));var rituals;
(function(b){function e(b,c){console.warn(b+": "+c);var a=c.lastIndexOf(":");-1<a&&(c=c.substr(a+1));UIkit.notification(b+" error: "+c,{status:"danger",pos:"top-right"})}b.onSocketMessage=function(b){debug&&(console.debug("message received"),console.debug(b));switch(b.svc){case services.system.key:var c=b.cmd;b=b.param;switch(c){case command.server.error:e("system",b);break;case command.server.actions:action.viewActions(b);break;case command.server.teams:team.viewTeams(b);break;case command.server.sprints:sprint.viewSprints(b);
break;case command.server.memberUpdate:member.onMemberUpdate(b);break;case command.server.onlineUpdate:member.onOnlineUpdate(b);break;default:console.warn("unhandled system message for command ["+c+"]")}break;case services.team.key:team.onTeamMessage(b.cmd,b.param);break;case services.sprint.key:sprint.onSprintMessage(b.cmd,b.param);break;case services.estimate.key:estimate.onEstimateMessage(b.cmd,b.param);break;case services.standup.key:standup.onStandupMessage(b.cmd,b.param);break;case services.retro.key:retro.onRetroMessage(b.cmd,
b.param);break;default:console.warn("unhandled message for service ["+b.svc+"]")}};b.setDetail=function(b){system.cache.session=b;dom.setText("#model-title",b.title);dom.setValue("#model-title-input",b.title);var c=dom.els("#navbar .uk-navbar-item");0<c.length&&(c[c.length-1].innerText=b.title);UIkit.modal("#modal-session").hide()};b.onError=e;b.onSessionJoin=function(b){system.cache.session=b.session;system.cache.profile=b.profile;system.cache.permissions=b.permissions;permission.setPermissions();
system.cache.members=b.members;system.cache.online=b.online;member.setMembers()};b.init=function(b,c){window.onbeforeunload=function(){socket.setAppUnloading()};socket.socketConnect(b,c)};b.setSprint=function(b){UIkit.modal("#modal-session").hide();var c=dom.req("#sprint-link-container"),a=dom.req("#sprint-warning-container");c.innerHTML="";b?(c.appendChild(sprint.renderSprintLink(b)),a.style.display="block",dom.req("#sprint-warning-name").innerText=b.title):a.style.display="none"};b.setTeam=function(b){UIkit.modal("#modal-session").hide();
var c=dom.req("#team-link-container");c.innerHTML="";b&&c.appendChild(team.renderTeamLink(b))};b.showWelcomeMessage=function(b){1==b&&setTimeout(function(){return events.openModal("welcome")},300)}})(rituals||(rituals={}));var socket;
(function(b){function e(){var a=document.location,c="ws";"https:"===a.protocol&&(c="wss");return c+("://"+a.host+"/s")}function d(b,d){system.cache.currentService=b;system.cache.currentID=d;system.cache.connectTime=Date.now();f=new WebSocket(e());f.onopen=function(){debug&&console.debug("socket connected");c({svc:b,cmd:command.client.connect,param:d})};f.onmessage=function(a){a=JSON.parse(a.data);rituals.onSocketMessage(a)};f.onerror=function(a){rituals.onError("socket",a.type)};f.onclose=function(){a()}}
function c(a){debug&&(console.debug("sending message"),console.debug(a));f.send(JSON.stringify(a))}function a(){function a(a){debug&&console.info("socket closed, reconnecting in "+a+" seconds");setTimeout(function(){d(system.cache.currentService,system.cache.currentID)},1E3*a)}l||a(10)}var f,l=!1;b.setAppUnloading=function(){l=!0};b.socketConnect=d;b.send=c})(socket||(socket={}));var sprint;
(function(b){function e(c){var a,f;b.cache.detail=c;var d=0==(null===(a=c.startDate)||void 0===a?void 0:a.length)?void 0:new Date(c.startDate);a=0==(null===(f=c.endDate)||void 0===f?void 0:f.length)?void 0:new Date(c.endDate);dom.setContent("#sprint-date-display",b.renderSprintDates(d,a));dom.setValue("#sprint-start-date-input",d?date.dateToYMD(d):"");dom.setValue("#sprint-end-date-input",a?date.dateToYMD(a):"");rituals.setDetail(c)}var d=function(){return function(){}}();b.cache=new d;b.onSprintMessage=
function(c,a){switch(c){case command.server.error:rituals.onError(services.sprint.key,a);break;case command.server.sessionJoined:rituals.onSessionJoin(a);e(a.session);rituals.setTeam(a.team);dom.setContent("#sprint-estimate-list",contents.renderContents(services.estimate,a.estimates));dom.setContent("#sprint-standup-list",contents.renderContents(services.standup,a.standups));dom.setContent("#sprint-retro-list",contents.renderContents(services.retro,a.retros));rituals.showWelcomeMessage(a.members.length);
break;case command.server.teamUpdate:b.cache.detail&&(b.cache.detail.teamID=null===a||void 0===a?void 0:a.id);rituals.setTeam(a);break;case command.server.sessionUpdate:e(a);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService,system.cache.currentID);break;default:console.warn("unhandled command ["+c+"] for sprint")}};b.onSubmitSprintSession=function(){var c,a,b=dom.req("#model-title-input").value,d=dom.req("#model-team-select select").value,e=null===(c=dom.opt("#model-start-date-input"))||
void 0===c?void 0:c.value;c=null===(a=dom.opt("#model-end-date-input"))||void 0===a?void 0:a.value;socket.send({svc:services.sprint.key,cmd:command.client.updateSession,param:{title:b,startDate:e,endDate:c,teamID:d}})};b.refreshSprints=function(){dom.opt("#model-sprint-select")&&socket.send({svc:services.system.key,cmd:command.client.getSprints,param:null})};b.viewSprints=function(c){var a,f=dom.opt("#model-sprint-container");f&&(f.style.display=0<c.length?"block":"none",dom.setContent("#model-sprint-select",
b.renderSprintSelect(c,null===(a=system.cache.session)||void 0===a?void 0:a.sprintID)))}})(sprint||(sprint={}));var standup;
(function(b){function e(a){return b.cache.reports.filter(function(c){return c.id!==a})}function d(a,c){report.setReports(a);c===b.cache.activeReport&&UIkit.modal("#modal-report").hide()}var c=function(){return function(){this.reports=[]}}();b.cache=new c;b.onStandupMessage=function(a,c){switch(a){case command.server.error:rituals.onError(services.standup.key,c);break;case command.server.sessionJoined:rituals.onSessionJoin(c);rituals.setTeam(c.team);rituals.setSprint(c.sprint);a=c.session;b.cache.detail=
a;rituals.setDetail(a);report.setReports(c.reports);rituals.showWelcomeMessage(c.members.length);break;case command.server.sessionUpdate:b.cache.detail=c;rituals.setDetail(c);break;case command.server.teamUpdate:b.cache.detail&&(b.cache.detail.teamID=null===c||void 0===c?void 0:c.id);rituals.setTeam(c);break;case command.server.sprintUpdate:b.cache.detail&&(b.cache.detail.sprintID=null===c||void 0===c?void 0:c.id);rituals.setSprint(c);break;case command.server.reportUpdate:a=e(c.id);a.push(c);d(a,
c.id);break;case command.server.reportRemove:a=e(c);d(a,c);UIkit.notification("report has been deleted",{status:"success",pos:"top-right"});break;default:console.warn("unhandled command ["+a+"] for standup")}};b.onSubmitStandupSession=function(){var a=dom.req("#model-title-input").value,c=dom.req("#model-team-select select").value,b=dom.req("#model-sprint-select select").value;socket.send({svc:services.standup.key,cmd:command.client.updateSession,param:{title:a,teamID:c,sprintID:b}})}})(standup||
(standup={}));var story;
(function(b){function e(c){function a(a,c){a.id.substr(a.id.lastIndexOf("-")+1)===c?a.classList.add("active"):a.classList.remove("active")}for(var b=0,d=dom.els(".story-status-body");b<d.length;b++){var e=d[b];a(e,c)}b=0;for(d=dom.els(".story-status-actions");b<d.length;b++)e=d[b],a(e,c);e="";switch(c){case "pending":e="Story";break;case "active":e="Voting";break;case "complete":e="Results"}dom.setText("#story-status",e);vote.viewVotes()}function d(c,a,f,d){null!==f&&"complete"===f.status&&0<f.finalVote.length&&
(a=f.finalVote);dom.setContent("#story-"+c+" .story-status",b.renderStatus(a));d&&b.showTotalIfNeeded()}b.viewStoryStatus=e;b.requestStoryStatus=function(c){var a=b.getActiveStory();void 0!==a&&socket.send({svc:services.estimate.key,cmd:command.client.setStoryStatus,param:{storyID:a.id,status:c}})};b.setStoryStatus=d;b.onStoryStatusChange=function(c){var a=null;estimate.cache.stories.forEach(function(b){b.id===c.storyID&&(a=b,b.finalVote=c.finalVote,b.status=c.status)});d(c.storyID,c.status,a,!0);
c.storyID===estimate.cache.activeStory&&e(c.status)}})(story||(story={}));
(function(b){function e(){if(void 0!==estimate.cache.activeStory){var c=estimate.cache.stories.filter(function(a){return a.id===estimate.cache.activeStory});if(1!==c.length)console.warn("cannot load active story ["+estimate.cache.activeStory+"]");else return c[0]}}function d(){var c=0;estimate.cache.stories.filter(function(a){return"complete"===a.status}).map(function(a){return a.finalVote}).filter(function(a){return 0<a.length}).map(function(a){return parseFloat(a)}).filter(function(a){return!isNaN(a)}).forEach(function(a){return c+=a});
var a=dom.opt("#story-total"),d=dom.req("#story-list");null!==a&&d.removeChild(a);0<c&&d.appendChild(b.renderTotal(c))}b.setStories=function(c){estimate.cache.stories=c;dom.setContent("#story-detail",b.renderStories(c));c.forEach(function(a){return b.setStoryStatus(a.id,a.status,a,!1)});d();UIkit.modal("#modal-add-story").hide()};b.onSubmitStory=function(){var c=dom.req("#story-title-input").value;socket.send({svc:services.estimate.key,cmd:command.client.addStory,param:{title:c}});return!1};b.beginEditStory=
function(){var c=e(),a=prompt("Edit your story",c.title);null!==a&&a!==c.title&&socket.send({svc:services.estimate.key,cmd:command.client.updateStory,param:{id:c.id,title:a}});return!1};b.onRemoveStory=function(){var c=estimate.cache.activeStory;c&&UIkit.modal.confirm("Delete this story?").then(function(){socket.send({svc:services.estimate.key,cmd:command.client.removeStory,param:c});UIkit.modal("#modal-story").hide()});return!1};b.getActiveStory=e;b.viewActiveStory=function(){var c=e();void 0!==
c&&(dom.setText("#story-title",c.title),b.viewStoryStatus(c.status))};b.showTotalIfNeeded=d})(story||(story={}));var team;
(function(b){var e=function(){return function(){}}();b.cache=new e;b.onTeamMessage=function(d,c){switch(d){case command.server.error:rituals.onError(services.team.key,c);break;case command.server.sessionJoined:rituals.onSessionJoin(c);d=c.session;b.cache.detail=d;rituals.setDetail(d);dom.setContent("#team-sprint-list",contents.renderContents(services.sprint,c.sprints));dom.setContent("#team-estimate-list",contents.renderContents(services.estimate,c.estimates));dom.setContent("#team-standup-list",
contents.renderContents(services.standup,c.standups));dom.setContent("#team-retro-list",contents.renderContents(services.retro,c.retros));rituals.showWelcomeMessage(c.members.length);break;case command.server.sessionUpdate:b.cache.detail=c;rituals.setDetail(c);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService,system.cache.currentID);break;default:console.warn("unhandled command ["+d+"] for team")}};b.onSubmitTeamSession=function(){var b=dom.req("#model-title-input").value;
socket.send({svc:services.team.key,cmd:command.client.updateSession,param:{title:b}})};b.refreshTeams=function(){dom.opt("#model-team-select")&&socket.send({svc:services.system.key,cmd:command.client.getTeams,param:null})};b.viewTeams=function(d){var c,a=dom.opt("#model-team-container");a&&(a.style.display=0<d.length?"block":"none",dom.setContent("#model-team-select",b.renderTeamSelect(d,null===(c=system.cache.session)||void 0===c?void 0:c.teamID)))}})(team||(team={}));var vote;
(function(b){function e(){var a=story.getActiveStory();if(void 0!==a){var b=estimate.cache.activeVotes(),e=b.filter(function(a){return a.userID===system.cache.getProfile().userID}).pop();switch(a.status){case "pending":b=system.cache.getProfile().userID;e=dom.req("#story-edit-section");var h=dom.req("#story-view-section");b===a.authorID?(e.style.display="block",h.style.display="none"):(e.style.display="none",h.style.display="block");break;case "active":d(b,e);break;case "complete":c(b);break;default:console.warn("invalid story status ["+
a.status+"]")}}}function d(a,c){dom.setContent("#story-vote-members",b.renderVoteMembers(system.cache.members,a));dom.setContent("#story-vote-choices",b.renderVoteChoices(estimate.cache.detail.choices,null===c||void 0===c?void 0:c.choice))}function c(a){dom.setContent("#story-vote-results",b.renderVoteResults(system.cache.members,a));dom.setContent("#story-vote-summary",b.renderVoteSummary(a))}b.setVotes=function(a){estimate.cache.votes=a;e()};b.onVoteUpdate=function(a){var c=estimate.cache.votes;
c=c.filter(function(a){return a.userID!==a.userID||a.storyID!==a.storyID});c.push(a);estimate.cache.votes=c;a.storyID===estimate.cache.activeStory&&e()};b.viewVotes=e;b.onSubmitVote=function(a){socket.send({svc:services.estimate.key,cmd:command.client.submitVote,param:{storyID:estimate.cache.activeStory,choice:a}})};b.getVoteResults=function(a){a=a.map(function(a){a=parseFloat(a.choice);return isNaN(a)?-1:a}).filter(function(a){return-1!==a}).sort();var c=a.length,b=Math.min.apply(Math,a),d=Math.max.apply(Math,
a),e=a.reduce(function(a,c){return a+c},0),g=a.reduce(function(a,c){var b=a.numMapping[c]=(a.numMapping[c]||0)+1;b>a.greatestFreq&&(a.greatestFreq=b,a.mode=c);return a},{mode:null,greatestFreq:-Infinity,numMapping:{}}).mode;return{count:c,min:b,max:d,sum:e,mean:0===c?0:e/c,median:0===c?0:a[Math.floor(a.length/2)],mode:0===c?0:g}}})(vote||(vote={}));
(function(b){b.renderActions=function(b){return 0===b.length?JSX("div",null,"No actions available"):JSX("table",{"class":"uk-table uk-table-divider uk-text-left"},JSX("thead",null,JSX("tr",null,JSX("th",null,"Author"),JSX("th",null,"Act"),JSX("th",null,"Content"),JSX("th",null,"Note"),JSX("th",null,"Occurred"))),JSX("tbody",null,b.map(function(b){var c=JSON.stringify(b.content,null,2);return JSX("tr",null,JSX("td",null,system.getMemberName(b.authorID)),JSX("td",null,b.act),JSX("td",null,"null"===
c?"":JSX("pre",null,c)),JSX("td",null,b.note),JSX("td",{"class":"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(b.occurred))))})))}})(action||(action={}));var contents;
(function(b){function e(b,c){return c.map(function(a){return{svc:b,session:a}})}b.renderContents=function(b,c){c=e(b,c);c.sort(function(a,c){return a.session.created>c.session.created?-1:1});return 0===c.length?JSX("div",null,"No "+b.plural+" in this sprint"):JSX("table",{"class":"uk-table uk-table-divider uk-text-left"},JSX("tbody",null,c.map(function(a){var c=a.svc;a=a.session;var b=system.cache.getProfile();return JSX("tr",null,JSX("td",null,JSX("a",{"class":b.linkColor+"-fg",href:"/"+c.key+"/"+
a.slug},a.title)),JSX("td",{"class":"uk-table-shrink uk-text-nowrap"},system.getMemberName(a.owner)),JSX("td",{"class":"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(a.created))))})))}})(contents||(contents={}));
(function(b){b.renderFeedbackArray=function(e){var d;if(0===e.length)return JSX("div",null,JSX("button",{"class":"uk-button uk-button-default",onclick:"events.openModal('add-feedback');",type:"button"},"Add Feedback"));e=b.getFeedbackCategories(e,(null===(d=retro.cache.detail)||void 0===d?void 0:d.categories)||[]);var c=system.cache.getProfile();return JSX("div",{"class":"uk-grid-small uk-grid-match uk-child-width-expand@m uk-grid-divider","data-uk-grid":!0},e.map(function(a){return JSX("div",{"class":"feedback-list uk-transition-toggle"},
JSX("div",{"class":"feedback-category-header"},JSX("span",{"class":"right"},JSX("a",{"class":c.linkColor+"-fg uk-icon-button uk-transition-fade","data-uk-icon":"plus",onclick:"events.openModal('add-feedback', '"+a.category+"');",title:"edit session"})),JSX("span",{"class":"feedback-category-title",onclick:"events.openModal('add-feedback', '"+a.category+"');"},a.category)),JSX("div",null,a.feedback.map(function(a){var c=system.cache.getProfile();c=JSX("div",{id:"feedback-"+a.id,"class":"feedback-detail uk-border-rounded section",
onclick:"events.openModal('feedback', '"+a.id+"');"},JSX("a",{"class":c.linkColor+"-fg section-link"},system.getMemberName(a.authorID)),JSX("div",{"class":"feedback-content"},"loading..."));0<a.html.length&&(dom.setHTML(dom.req(".feedback-content",c),a.html).style.display="block");return JSX("div",null,c)})))}))}})(feedback||(feedback={}));
(function(b){b.renderMembers=function(b){return 0===b.length?JSX("div",null,JSX("button",{"class":"uk-button uk-button-default",onclick:"events.openModal('invitation');",type:"button"},"Invite Members")):JSX("ul",{"class":"uk-list uk-list-divider"},b.map(function(b){var c={id:"member-"+b.userID},a=system.cache.getProfile();b=JSX("div",{"class":"section",onclick:"events.openModal('member', '"+b.userID+"');"},JSX("div",{title:"user is offline","class":"right uk-article-meta online-indicator"},"offline"),
JSX("div",{"class":a.linkColor+"-fg section-link"},b.name));return JSX("li",c,b)}))}})(member||(member={}));
(function(b){function e(a){return JSX("div",null,a.k,":",a.v)}function d(a,c){return JSX("div",null,JSX("div",null,a),c.map(e))}function c(a,c){for(var b=[],d=0;d<c.length;d++){var e=c[d];if(e.key==a){b=e.members;break}}return b}b.renderPermissions=function(a){a=collection.groupBy(a,function(a){return a.k});return JSX("ul",{"class":"uk-list uk-list-divider"},d("Team",c("team",a)),d("Sprint",c("sprint",a)),d("Invitation",c("invitation",a)),d("Google",c("google",a)),d("GitHub",c("github",a)),d("Slack",
c("slack",a)))}})(permission||(permission={}));
(function(b){b.renderReports=function(e){if(0===e.length)return JSX("div",null,JSX("button",{"class":"uk-button uk-button-default",onclick:"events.openModal('add-report');",type:"button"},"Add Report"));e=b.getReportDates(e);return JSX("ul",{"class":"uk-list"},e.map(function(b){return JSX("li",{id:"report-date-"+b.d},JSX("h5",null,JSX("div",{"class":"right uk-article-meta"},date.dow(date.dateFromYMD(b.d).getDay())),date.toDateString(date.dateFromYMD(b.d))),JSX("ul",null,b.reports.map(function(c){var a=
system.cache.getProfile();a=JSX("div",{id:"report-"+c.id,"class":"report-detail uk-border-rounded section",onclick:"events.openModal('report', '"+c.id+"');"},JSX("a",{"class":a.linkColor+"-fg section-link"},system.getMemberName(c.authorID)),JSX("div",{"class":"report-content"},"loading..."));0<c.html.length&&(dom.setHTML(dom.req(".report-content",a),c.html).style.display="block");return JSX("li",null,a)})))}))}})(report||(report={}));
(function(b){b.renderSprintDates=function(b,d){function c(a,c){return JSX("span",null,a," ",JSX("span",{"class":"sprint-date",onclick:"events.openModal('session');"},c?date.toDateString(c):""))}var a=c("starts",b),e=c("ends",d);return b?d?JSX("span",null,a,", ",e):a:d?e:JSX("span",null,"Sprint")};b.renderSprintLink=function(b){var d=system.cache.getProfile();return JSX("span",null,JSX("a",{"class":d.linkColor+"-fg",href:"/sprint/"+b.slug},b.title),"\u00a0")};b.renderSprintSelect=function(b,d){return JSX("select",
{"class":"uk-select"},JSX("option",{value:""},"- no sprint -"),b.map(function(c){return c.id===d?JSX("option",{selected:"selected",value:c.id},c.title):JSX("option",{value:c.id},c.title)}))}})(sprint||(sprint={}));
(function(b){b.renderStories=function(b){return 0===b.length?JSX("div",{id:"story-list"},JSX("button",{"class":"uk-button uk-button-default",onclick:"events.openModal('add-story');",type:"button"},"Add Story")):JSX("ul",{id:"story-list","class":"uk-list uk-list-divider"},b.map(function(b){var c=system.cache.getProfile();return JSX("li",{id:"story-"+b.id,"class":"section",onclick:"events.openModal('story', '"+b.id+"');"},JSX("div",{"class":"right uk-article-meta story-status"},b.status),JSX("div",
{"class":c.linkColor+"-fg section-link"},b.title))}))};b.renderStatus=function(b){switch(b){case "pending":return JSX("span",null,b);case "active":return JSX("span",null,b);default:return JSX("span",{"class":"vote-badge uk-border-rounded"},b)}};b.renderTotal=function(b){return JSX("li",{id:"story-total"},JSX("div",{"class":"right uk-article-meta"},JSX("span",{"class":"vote-badge uk-border-rounded"},b))," Total")}})(story||(story={}));
(function(b){b.renderTeamLink=function(b){var d=system.cache.getProfile();return JSX("span",null," in ",JSX("a",{"class":d.linkColor+"-fg",href:"/team/"+b.slug},b.title))};b.renderTeamSelect=function(b,d){return JSX("select",{"class":"uk-select"},JSX("option",{value:""},"- no team -"),b.map(function(b){return b.id===d?JSX("option",{selected:"selected",value:b.id},b.title):JSX("option",{value:b.id},b.title)}))}})(team||(team={}));
(function(b){function e(b,a){return JSX("div",{"class":"vote-member",title:b.name+" has "+(a?"voted":"not voted")},JSX("div",null,JSX("span",{"data-uk-icon":"icon: "+(a?"check":"minus")+"; ratio: 1.6"})),b.name)}function d(b,a){return void 0===a?JSX("div",{"class":"vote-result"},JSX("div",null,JSX("span",{"class":"uk-border-circle"},JSX("span",{"data-uk-icon":"icon: minus; ratio: 1.6"})))," ",b.name):JSX("div",{"class":"vote-result"},JSX("div",null,JSX("span",{"class":"uk-border-circle"},a))," ",
b.name)}b.renderVoteMembers=function(b,a){return JSX("div",{"class":"uk-flex uk-flex-wrap uk-flex-around"},b.map(function(b){return e(b,0<a.filter(function(a){return a.userID===b.userID}).length)}))};b.renderVoteChoices=function(b,a){return JSX("div",{"class":"uk-flex uk-flex-wrap uk-flex-center"},b.map(function(b){return JSX("div",{"class":"vote-choice uk-border-circle uk-box-shadow-hover-medium"+(b===a?" active "+system.cache.getProfile().linkColor+"-border":""),onclick:"vote.onSubmitVote('"+b+
"');"},b)}))};b.renderVoteResults=function(b,a){return JSX("div",{"class":"uk-flex uk-flex-wrap uk-flex-around"},b.map(function(b){var c=a.filter(function(a){return a.userID===b.userID});return d(b,0<c.length?c[0].choice:void 0)}))};b.renderVoteSummary=function(c){function a(a){return a.toString().substr(0,4)}var d=b.getVoteResults(c);return JSX("div",{"class":"uk-flex uk-flex-wrap uk-flex-center result-container"},JSX("div",{"class":"result"},JSX("div",{"class":"secondary uk-border-circle"},a(d.count),
" / ",a(c.length))," ",JSX("div",null,"votes counted")),JSX("div",{"class":"result"},JSX("div",{"class":"secondary uk-border-circle"},a(d.min),"-",a(d.max))," ",JSX("div",null,"vote range")),JSX("div",{"class":"result mean-result"},JSX("div",{"class":"mean uk-border-circle "+system.cache.getProfile().linkColor+"-border"},a(d.mean))," ",JSX("div",null,"average")),JSX("div",{"class":"result"},JSX("div",{"class":"secondary uk-border-circle"},a(d.median))," ",JSX("div",null,"median")),JSX("div",{"class":"result"},
JSX("div",{"class":"secondary uk-border-circle"},a(d.mode))," ",JSX("div",null,"mode")))}})(vote||(vote={}));
