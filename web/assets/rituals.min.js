var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,e){c.raw=e;return c};$jscomp.arrayIteratorImpl=function(c){var e=0;return function(){return e<c.length?{done:!1,value:c[e++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var e="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return e?e.call(c):$jscomp.arrayIterator(c)};
$jscomp.arrayFromIterator=function(c){for(var e,b=[];!(e=c.next()).done;)b.push(e.value);return b};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<c.length;++e){var b=c[e];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.checkEs6ConformanceViaProxy=function(){try{var c={},e=Object.create(new $jscomp.global.Proxy(c,{get:function(b,a,d){return b==c&&"q"==a&&d==e}}));return!0===e.q}catch(b){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,b){if(c==Array.prototype||c==Object.prototype)return c;c[e]=b.value;return c};$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};
$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,e){var b=$jscomp.propertyToPolyfillSymbol[e];if(null==b)return c[e];b=c[b];return void 0!==b?b:c[e]};$jscomp.polyfill=function(c,e,b,a){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,e,b,a):$jscomp.polyfillUnisolated(c,e,b,a))};
$jscomp.polyfillUnisolated=function(c,e,b,a){b=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var d=c[a];if(!(d in b))return;b=b[d]}c=c[c.length-1];a=b[c];e=e(a);e!=a&&null!=e&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(c,e,b,a){var d=c.split(".");c=1===d.length;a=d[0];a=!c&&a in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in a))return;a=a[g]}d=d[d.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?a[d]:null;e=e(b);null!=e&&(c?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:e}):e!==b&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+d,d=
$jscomp.propertyToPolyfillSymbol[d],$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:e})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(c){if(c)return c;var e=function(d,f){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};e.prototype.toString=function(){return this.$jscomp$symbol$id_};var b=0,a=function(d){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new e("jscomp_symbol_"+(d||"")+"_"+b++,d)};return a},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(c){if(c)return c;c=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),b=0;b<e.length;b++){var a=$jscomp.global[e[b]];"function"===typeof a&&"function"!=typeof a.prototype[c]&&$jscomp.defineProperty(a.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return c},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(c){c={next:c};c[Symbol.iterator]=function(){return this};return c};$jscomp.owns=function(c,e){return Object.prototype.hasOwnProperty.call(c,e)};
$jscomp.polyfill("WeakMap",function(c){function e(){if(!c||!Object.seal)return!1;try{var l=Object.seal({}),m=Object.seal({}),n=new c([[l,2],[m,3]]);if(2!=n.get(l)||3!=n.get(m))return!1;n.delete(l);n.set(m,4);return!n.has(l)&&4==n.get(m)}catch(p){return!1}}function b(){}function a(l){var m=typeof l;return"object"===m&&null!==l||"function"===m}function d(l){if(!$jscomp.owns(l,g)){var m=new b;$jscomp.defineProperty(l,g,{value:m})}}function f(l){if(!$jscomp.ISOLATE_POLYFILLS){var m=Object[l];m&&(Object[l]=
function(n){if(n instanceof b)return n;Object.isExtensible(n)&&d(n);return m(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(e())return c;var g="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var k=0,h=function(l){this.id_=(k+=Math.random()+1).toString();if(l){l=$jscomp.makeIterator(l);for(var m;!(m=l.next()).done;)m=m.value,this.set(m[0],m[1])}};h.prototype.set=function(l,m){if(!a(l))throw Error("Invalid WeakMap key");
d(l);if(!$jscomp.owns(l,g))throw Error("WeakMap key fail: "+l);l[g][this.id_]=m;return this};h.prototype.get=function(l){return a(l)&&$jscomp.owns(l,g)?l[g][this.id_]:void 0};h.prototype.has=function(l){return a(l)&&$jscomp.owns(l,g)&&$jscomp.owns(l[g],this.id_)};h.prototype.delete=function(l){return a(l)&&$jscomp.owns(l,g)&&$jscomp.owns(l[g],this.id_)?delete l[g][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(c){function e(){if($jscomp.ASSUME_NO_NATIVE_MAP||!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),l=new c($jscomp.makeIterator([[h,"s"]]));if("s"!=l.get(h)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;var m=l.entries(),n=m.next();if(n.done||n.value[0]!=h||"s"!=n.value[1])return!1;n=m.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!m.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(e())return c;var b=new WeakMap,a=function(h){this.data_={};this.head_=g();this.size=0;if(h){h=$jscomp.makeIterator(h);for(var l;!(l=h.next()).done;)l=l.value,this.set(l[0],l[1])}};a.prototype.set=function(h,l){h=0===h?0:h;var m=d(this,h);m.list||(m.list=this.data_[m.id]=[]);m.entry?m.entry.value=l:(m.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:l},m.list.push(m.entry),
this.head_.previous.next=m.entry,this.head_.previous=m.entry,this.size++);return this};a.prototype.delete=function(h){h=d(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};a.prototype.has=function(h){return!!d(this,h).entry};a.prototype.get=function(h){return(h=
d(this,h).entry)&&h.value};a.prototype.entries=function(){return f(this,function(h){return[h.key,h.value]})};a.prototype.keys=function(){return f(this,function(h){return h.key})};a.prototype.values=function(){return f(this,function(h){return h.value})};a.prototype.forEach=function(h,l){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,h.call(l,n[1],n[0],this)};a.prototype[Symbol.iterator]=a.prototype.entries;var d=function(h,l){var m=l&&typeof l;"object"==m||"function"==m?b.has(l)?m=b.get(l):
(m=""+ ++k,b.set(l,m)):m="p_"+l;var n=h.data_[m];if(n&&$jscomp.owns(h.data_,m))for(h=0;h<n.length;h++){var p=n[h];if(l!==l&&p.key!==p.key||l===p.key)return{id:m,list:n,index:h,entry:p}}return{id:m,list:n,index:-1,entry:void 0}},f=function(h,l){var m=h.head_;return $jscomp.iteratorPrototype(function(){if(m){for(;m.head!=h.head_;)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:l(m)};m=null}return{done:!0,value:void 0}})},g=function(){var h={};return h.previous=h.next=h.head=h},k=0;
return a},"es6","es3");$jscomp.findInternal=function(c,e,b){c instanceof String&&(c=String(c));for(var a=c.length,d=0;d<a;d++){var f=c[d];if(e.call(b,f,d,c))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(e,b){return $jscomp.findInternal(this,e,b).v}},"es6","es3");
$jscomp.checkStringArgs=function(c,e,b){if(null==c)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.endsWith",function(c){return c?c:function(e,b){var a=$jscomp.checkStringArgs(this,e,"endsWith");e+="";void 0===b&&(b=a.length);b=Math.max(0,Math.min(b|0,a.length));for(var d=e.length;0<d&&0<b;)if(a[--b]!=e[--d])return!1;return 0>=d}},"es6","es3");var rituals;
(function(c){c.onError=function(e,b){console.error(e.key+": "+b);var a=b.lastIndexOf(":");-1<a&&(b=b.substr(a+1));notify.notify(e.key+" error: "+b,!1)};c.init=function(e,b){window.onbeforeunload=function(){socket.setAppUnloading()};socket.socketConnect(services.fromKey(e),b)}})(rituals||(rituals={}));var action;
(function(c){c.loadActions=function(){socket.send({svc:services.system.key,cmd:command.client.getActions,param:null})};c.viewActions=function(e){dom.setContent("#action-list",c.renderActions(e))}})(action||(action={}));
(function(c){c.renderActions=function(e){return 0===e.length?JSX("div",null,"No actions available"):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("thead",null,JSX("tr",null,JSX("th",null,"User"),JSX("th",null,"Act"),JSX("th",null,"Content"),JSX("th",null,"Note"),JSX("th",null,"Created"))),JSX("tbody",null,e.map(function(b){var a=JSON.stringify(b.content,null,2);return JSX("tr",null,JSX("td",null,member.renderTitle(member.getMember(b.userID))),JSX("td",null,b.act),JSX("td",null,
"null"===a?"":JSX("pre",null,a)),JSX("td",null,b.note),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(b.created))))})))}})(action||(action={}));var auth;(function(c){c.allProviders=[{key:"github",title:"GitHub"},{key:"google",title:"Google"},{key:"slack",title:"Slack"},{key:"facebook",title:"Facebook"},{key:"amazon",title:"Amazon"},{key:"microsoft",title:"Microsoft"}];var e=[];c.applyAuths=function(b){e=b};c.active=function(){return e?e:[]}})(auth||(auth={}));var comment;
(function(c){function e(h,l){h&&"modal"!==h||(h=g,l||(l=k));"root"===h&&(h="");return l?f.filter(function(m){return m.targetType===h&&m.targetID==l}):f.filter(function(m){return m.targetType===h})}function b(h,l){h&&"modal"!==h||(h=g,l||(l=k));if(h){if(g=h,k=l,l=e(h,l),"root"!==h&&(h="modal"),dom.setContent("#drop-comment-"+h+" .uk-card-body",c.renderComments(l,system.cache.getProfile())),h=dom.opt("#drop-comment-"+h+" .uk-comment-list"))h.scrollTop=h.scrollHeight}else console.warn("invalid comment type ["+
h+"]")}function a(){var h=dom.els(".comment-count-container"),l=!1,m=dom.opt("#comment-count-modal");h.forEach(function(n){var p=n.dataset.commentType,q=n.dataset.commentId;if(!p)throw"invalid comment type ["+p+"] with id ["+q+"]";q=e(p,q);d(p,q,n);g===p&&m&&(d(p,q,m),l=!0)});!l&&m&&d("modal",[],m,!0)}function d(h,l,m,n){dom.setText(dom.req(".text",m),l.length.toString());"root"!==h&&"modal"!==h&&0!==h.length&&dom.setDisplay(m,0!==l.length||!0===n)}var f=[],g,k;c.applyComments=function(h){f=h};c.setActive=
function(h,l){g=h;k=l};c.show=function(h){modal.open("comment",h)};c.add=function(h){h=dom.req("#comment-add-content-"+h);var l=h.value.trim();0===l.length?notify.notify("enter some content",!0):(h.value="",socket.send({svc:services.system.key,cmd:command.client.addComment,param:{targetType:g,targetID:k,content:l}}))};c.onCommentUpdate=function(h){f.push(h);a();b()};c.load=b;c.setCounts=a;c.closeDrop=function(){"story"===g?modal.openSoon("story"):"report"===g?modal.openSoon("report"):"feedback"===
g&&modal.openSoon("feedback");g=void 0};c.remove=function(h){confirm("remove this comment?")&&socket.send({svc:services.system.key,cmd:command.client.removeComment,param:h});return!1};c.onCommentRemoved=function(h){f=f.filter(function(l){return l.id!==h});a();b()}})(comment||(comment={}));
(function(c){c.renderComments=function(e,b){return 0===e.length?JSX("p",{class:"uk-margin-bottom"},"No comments yet, why not add one?"):JSX("ul",{class:"uk-comment-list"},e.map(function(a){var d=a.userID===b.userID?JSX("div",{class:"right"},JSX("a",{class:b.linkColor+"-fg uk-margin-small-right","data-uk-icon":"close",href:"",onclick:"return comment.remove('"+a.id+"');",title:"remove your comment"})):JSX("span",null);return JSX("li",null,JSX("article",{class:"uk-comment uk-visible-toggle uk-transition-toggle",
tabindex:"-1"},member.renderHeader(member.getMember(a.userID),a.created,d),JSX("div",{class:"uk-comment-body"},JSX("div",{dangerouslySetInnerHTML:{__html:a.html}})),JSX("hr",null)))}))};c.renderCount=function(e,b){var a=system.cache.getProfile();return JSX("div",{class:"comment-count-container uk-margin-small-left left hidden","data-comment-type":e,"data-comment-id":b},JSX("a",{class:a.linkColor+"-fg",title:"view comments"},JSX("div",{class:"comment-count"},JSX("span",{class:"uk-icon","data-uk-icon":"comment"}),
JSX("span",{class:"text"}))))}})(comment||(comment={}));var contents;(function(c){c.onContentDisplay=function(e,b,a,d){dom.setDisplay("#modal-"+e+" .content-edit",b);dom.setDisplay("#modal-"+e+" .buttons-edit",b);var f=dom.setDisplay("#modal-"+e+" .content-view",!b);dom.setHTML(f,b?"":d);dom.setDisplay("#modal-"+e+" .buttons-view",!b);e=dom.req("#"+e+"-edit-content");dom.setValue(e,b?a:"");b&&dom.wireTextarea(e)}})(contents||(contents={}));
(function(c){function e(b,a){return a.map(function(d){return{svc:b,session:d}})}c.renderContents=function(b,a,d){d=e(a,d);d.sort(function(f,g){return f.session.created>g.session.created?-1:1});return 0===d.length?JSX("div",null,"No "+a.plural+" in this "+b.key):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("tbody",null,d.map(function(f){var g=f.svc;f=f.session;var k=system.cache.getProfile();return JSX("tr",null,JSX("td",null,JSX("a",{class:k.linkColor+"-fg",href:"/"+g.key+"/"+
f.slug},f.title)),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(f.created))))})))}})(contents||(contents={}));var dom;
(function(c){function e(f,g){var k=[];(g?g.querySelectorAll(f):document.querySelectorAll(f)).forEach(function(h){k.push(h)});return k}function b(f,g){g=e(f,g);switch(g.length){case 0:break;case 1:return g[0];default:console.warn("found ["+g.length+"] elements with selector ["+f+"], wanted zero or one")}}function a(f,g){(g=b(f,g))||console.warn("no element found for selector ["+f+"]");return g}function d(f,g){"string"===typeof f&&(f=a(f));f.innerHTML=g;return f}c.initDom=function(f,g){try{style.themeLinks(g),
style.setTheme(f)}catch(k){console.warn("error setting style",k)}try{modal.wire()}catch(k){console.warn("error wiring modals",k)}try{drop.wire()}catch(k){console.warn("error wiring drops",k)}try{tags.wire()}catch(k){console.warn("error wiring tag editors",k)}};c.els=e;c.opt=b;c.req=a;c.setHTML=d;c.setDisplay=function(f,g,k){k=void 0===k?"block":k;"string"===typeof f&&(f=a(f));f.style.display=g?k:"none";return f};c.setContent=function(f,g){"string"===typeof f&&(f=a(f));c.clear(f);f.appendChild(g);
return f};c.setText=function(f,g){"string"===typeof f&&(f=a(f));f.innerText=g;return f};c.clear=function(f){return d(f,"")}})(dom||(dom={}));
(function(c){c.setValue=function(e,b){"string"===typeof e&&(e=c.req(e));e.value=b;return e};c.wireTextarea=function(e){function b(){e.style.height="auto";e.style.height=(64>e.scrollHeight?64:e.scrollHeight+6)+"px"}function a(){window.setTimeout(b,0)}e.dataset.autoresize||(e.dataset.autoresize="true",e.addEventListener("change",b,!1),e.addEventListener("cut",a,!1),e.addEventListener("paste",a,!1),e.addEventListener("drop",a,!1),e.addEventListener("keydown",a,!1),e.focus(),e.select());b()};c.setOptions=
function(e,b){"string"===typeof e&&(e=c.req(e));c.clear(e);b.forEach(function(a){var d=document.createElement("option");d.value=a;c.setText(d,a);e.appendChild(d)})};c.setSelectOption=function(e,b){"string"===typeof e&&(e=c.req(e));for(var a=0;a<e.children.length;a++){var d=e.children.item(a);d.selected=d.value===b}};c.insertAtCaret=function(e,b){if(e.selectionStart||0===e.selectionStart){var a=e.selectionStart,d=e.selectionEnd;e.value=e.value.substring(0,a)+b+e.value.substring(d,e.value.length);e.selectionStart=
a+b.length;e.selectionEnd=a+b.length}else e.value+=b}})(dom||(dom={}));
function JSX(c,e){var b=document.createElement(c),a;for(a in e)if(a&&e.hasOwnProperty(a)){var d=e[a];"dangerouslySetInnerHTML"===a?dom.setHTML(b,d.__html):!0===d?b.setAttribute(a,a):!1!==d&&null!==d&&void 0!==d&&b.setAttribute(a,d.toString())}for(a=2;a<arguments.length;a++)if(d=arguments[a],Array.isArray(d))d.forEach(function(f){b.appendChild(f)});else{if(void 0===d||null===d)throw"child for tag ["+c+"] is "+d;d.nodeType||(d=document.createTextNode(d.toString()));b.appendChild(d)}return b}var style;
(function(c){function e(a){b(a);var d=dom.els(".uk-card");switch(a){case "auto":a="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(a="dark");e(a);fetch("/profile/theme/"+a).then(function(f){return f.text()}).then(function(){});break;case "light":document.documentElement.classList.remove("uk-light");document.body.classList.remove("uk-light");document.documentElement.classList.add("uk-dark");document.body.classList.add("uk-dark");d.forEach(function(f){f.classList.add("uk-card-default");
f.classList.remove("uk-card-secondary")});break;case "dark":document.documentElement.classList.add("uk-light");document.body.classList.add("uk-light");document.documentElement.classList.remove("uk-dark");document.body.classList.remove("uk-dark");d.forEach(function(f){f.classList.remove("uk-card-default");f.classList.add("uk-card-secondary")});break;default:console.warn("invalid theme")}}function b(a){if("undefined"===typeof EmojiButton)dom.els(".picker-toggle").forEach(function(f){return dom.setDisplay(f,
!1)});else{var d={position:"bottom-end",theme:a,zIndex:1021};dom.els(".textarea-emoji").forEach(function(f){var g=dom.req(".picker-toggle",f);g.addEventListener("click",function(){var k=dom.req(".uk-textarea",f),h=new EmojiButton(d);h.on("emoji",function(l){drop.onEmojiPicked();dom.insertAtCaret(k,l)});h.togglePicker(g)},!1)})}}c.setTheme=e;c.themeLinks=function(a){dom.els(".theme").forEach(function(d){d.classList.add(a+"-fg")})}})(style||(style={}));var estimate;
(function(c){function e(g){c.cache.detail=g;var k=g.choices.join(", ");dom.setValue("#model-choices-input",k);dom.setContent("#session-view-section .choices",tags.renderTagsView(g.choices));story.viewActiveStory();session.setDetail(g)}function b(g){var k=d(g.id);k.push(g);k.sort(function(h){return h.idx});g.id===c.cache.activeStory&&dom.setText("#story-title",g.title);story.setStories(k)}function a(g){var k=d(g);story.setStories(k);g===c.cache.activeStory&&modal.hide("story");notify.notify("story has been deleted",
!0)}function d(g){return c.cache.stories.filter(function(k){return k.id!==g})}var f=function(){this.stories=[];this.votes=[]};f.prototype.activeVotes=function(){var g=this;return this.activeStory?this.votes.filter(function(k){return k.storyID===g.activeStory}):[]};c.cache=new f;c.onEstimateMessage=function(g,k){switch(g){case command.server.error:rituals.onError(services.estimate,k);break;case command.server.sessionJoined:session.onSessionJoin(k);e(k.session);story.setStories(k.stories);vote.setVotes(k.votes);
session.showWelcomeMessage(k.session.status,k.members.length);break;case command.server.sessionUpdate:e(k);break;case command.server.sessionRemove:system.onSessionRemove(services.estimate);break;case command.server.permissionsUpdate:system.setPermissions(k);break;case command.server.teamUpdate:c.cache.detail&&(c.cache.detail.teamID=null===k||void 0===k?void 0:k.id);session.setTeam(k);break;case command.server.sprintUpdate:c.cache.detail&&(c.cache.detail.sprintID=null===k||void 0===k?void 0:k.id);
session.setSprint(k);break;case command.server.storyUpdate:b(k);break;case command.server.storyRemove:a(k);break;case command.server.storyStatusChange:story.onStoryStatusChange(k);break;case command.server.voteUpdate:vote.onVoteUpdate(k);break;default:console.warn("unhandled command ["+g+"] for estimate")}};c.onSubmitEstimateSession=function(){var g=dom.req("#model-title-input").value,k=dom.req("#model-choices-input").value,h=dom.req("#model-team-select select").value,l=dom.req("#model-sprint-select select").value,
m=permission.readPermissions();socket.send({svc:services.estimate.key,cmd:command.client.updateSession,param:{title:g,choices:k,teamID:h,sprintID:l,permissions:m}})};c.onStoryUpdate=b;c.onStoryRemove=a})(estimate||(estimate={}));var drop;
(function(c){function e(f){if(f.target){var g=f.target;f=g.dataset.key||"";g=g.dataset.t||"";var k=events.getOpenEvent(f);k?k(g):console.warn("no drop open handler registered for ["+f+"]")}}function b(f){if(f.target){var g=f.target;g.classList.contains("uk-open")&&(f=g.dataset.t||"",(g=events.getCloseEvent(g.dataset.key||""))&&g(f))}}function a(f){d&&f.preventDefault()}c.wire=function(){dom.els(".drop").forEach(function(f){f.addEventListener("show",e);f.addEventListener("beforehide",a);f.addEventListener("hide",
b)});events.register("comment",comment.load,comment.closeDrop);events.register("export")};var d=!1;c.onEmojiPicked=function(){d=!0;setTimeout(function(){return d=!1},200)}})(drop||(drop={}));var events;(function(c){var e=new Map,b=new Map;c.register=function(a,d,f){d||(d=function(){});e.set(a,d);f&&b.set(a,f)};c.getOpenEvent=function(a){return e.get(a)};c.getCloseEvent=function(a){return b.get(a)}})(events||(events={}));var modal;
(function(c){function e(f,g){d=g;notify.modal("#modal-"+f).show();return!1}function b(f){if(f.target&&(f=f.target,0===f.id.indexOf("modal"))){f=f.id.substr(6);var g=events.getOpenEvent(f);g?g(d):console.warn("no modal open handler registered for ["+f+"]");d=void 0}}function a(f){f.target&&(f=f.target,f.classList.contains("uk-open")&&(f=f.id.substr(6),(f=events.getCloseEvent(f))&&f(d),d=void 0))}var d;c.wire=function(){dom.els(".modal").forEach(function(f){f.addEventListener("show",b);f.addEventListener("hide",
a)});events.register("welcome");events.register("session",session.onModalOpen);events.register("action",action.loadActions);events.register("self",member.viewSelf);events.register("invitation",member.loadQR);events.register("member",member.viewActiveMember);events.register("add-story",story.viewAddStory);events.register("story",story.viewActiveStory);events.register("add-report",report.viewAddReport);events.register("report",report.viewReport);events.register("add-feedback",feedback.viewAddFeedback);
events.register("feedback",feedback.viewFeedback)};c.open=e;c.openSoon=function(f){setTimeout(function(){return e(f)},0)};c.hide=function(f){f=notify.modal("#modal-"+f);f.$el.classList.contains("uk-open")&&f.hide()}})(modal||(modal={}));var tags;
(function(c){function e(d){var f=dom.req(".value",d),g=dom.req(".editor",d);dom.setDisplay(f,!1);dom.setDisplay(g,!0);var k=c.renderInput(f.innerText);k.onblur=function(){f.innerText=k.value;dom.setDisplay(f,!0);dom.setDisplay(g,!1);a(d.parentElement)};k.onkeypress=function(h){return"Enter"===h.key?(k.blur(),!1):!0};dom.setContent(g,k);k.focus()}function b(d){d.target?a(d.target):console.warn("no event target")}function a(d){var f=d.dataset.key||"",g=events.getOpenEvent(f);g?g():console.warn("no tag open handler registered for ["+
f+"]");d=dom.els(".item",d).map(function(k){return k.innerText});dom.setValue("#model-"+f+"-input",d.join(","))}c.wire=function(){dom.els(".tag-editor").forEach(function(d){d.addEventListener("moved",b);d.addEventListener("added",b);d.addEventListener("removed",b)});events.register("choices");events.register("categories")};c.removeTag=function(d){d=d.parentElement;var f=d.parentElement;d.remove();a(f)};c.addTag=function(d){if(d=d.parentElement){var f=c.renderItem();d.insertBefore(f,dom.req(".add-item",
d));e(f)}};c.editTag=e})(tags||(tags={}));
(function(c){c.renderInput=function(e){return JSX("input",{type:"text",class:"uk-input",value:e})};c.renderItem=function(){return JSX("span",{class:"item"},JSX("span",{class:"value",onclick:"tags.editTag(this.parentElement);"}),JSX("span",{class:"editor"}),JSX("span",{class:"close","data-uk-icon":"icon: close; ratio: 0.6;",onclick:"tags.removeTag(this);"}))};c.renderTagsView=function(e){return JSX("div",{class:"tag-view"},e.map(function(b){return JSX("span",{class:"item"},b)}),JSX("div",{class:"clear"}))}})(tags||
(tags={}));var feedback;
(function(c){function e(){if(retro.cache.activeFeedback){var d=retro.cache.feedback.filter(function(f){return f.id===retro.cache.activeFeedback}).shift();d||console.warn("cannot load active Feedback ["+retro.cache.activeFeedback+"]");return d}}function b(d){return retro.cache.feedback.filter(function(f){return f.id!==d})}function a(d,f){feedback.setFeedback(d);f===retro.cache.activeFeedback&&modal.hide("feedback")}c.setFeedback=function(d){retro.cache.feedback=d;dom.setContent("#feedback-detail",c.renderFeedbackArray(d));
comment.setCounts();modal.hide("add-feedback")};c.onSubmitFeedback=function(){var d=dom.req("#feedback-category").value,f=dom.req("#feedback-content").value;socket.send({svc:services.retro.key,cmd:command.client.addFeedback,param:{category:d,content:f}});return!1};c.onEditFeedback=function(){var d=retro.cache.activeFeedback,f=dom.req("#feedback-edit-category").value,g=dom.req("#feedback-edit-content").value;socket.send({svc:services.retro.key,cmd:command.client.updateFeedback,param:{id:d,category:f,
content:g}});return!1};c.onRemoveFeedback=function(){var d=retro.cache.activeFeedback;d&&notify.confirm("Delete this feedback?",function(){socket.send({svc:services.retro.key,cmd:command.client.removeFeedback,param:d});modal.hide("feedback")});return!1};c.getActiveFeedback=e;c.viewActiveFeedback=function(d){var f,g=system.cache.getProfile();d&&(retro.cache.activeFeedback=d);(d=e())?(g=d.userID===g.userID,dom.setText("#feedback-title",d.category+" / "+(null===(f=member.getMember(d.userID))||void 0===
f?void 0:f.name)),dom.setSelectOption("#feedback-edit-category",g?d.category:void 0),contents.onContentDisplay("feedback",g,d.content,d.html),comment.setActive("feedback",d.id),comment.setCounts()):console.warn("no active feedback")};c.onFeedbackUpdate=function(d){var f=b(d.id);f.push(d);a(f,d.id)};c.onFeedbackRemoved=function(d){var f=b(d);a(f,d);notify.notify("feedback has been deleted",!0)};c.getFeedbackCategories=function(d,f){var g=f.map(function(h){var l=d.filter(function(m){return m.category===
h}).sort(function(m,n){return m.created>n.created?-1:1});return{category:h,feedback:l}}),k=d.filter(function(h){return!f.find(function(l){return l===h.category})});0<k.length&&g.push({category:"unknown",feedback:k});return g};c.viewAddFeedback=function(d){dom.setSelectOption("#feedback-category",d);var f=dom.setValue("#feedback-content","");dom.wireTextarea(f);setTimeout(function(){return f.focus()},250)};c.viewFeedback=function(d){feedback.viewActiveFeedback(d);var f=dom.req("#feedback-edit-content");
setTimeout(function(){dom.wireTextarea(f);f.focus()},250)}})(feedback||(feedback={}));
(function(c){c.renderFeedbackArray=function(e){var b;if(0===e.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-feedback');",type:"button"},"Add Feedback"));e=c.getFeedbackCategories(e,(null===(b=retro.cache.detail)||void 0===b?void 0:b.categories)||[]);var a=system.cache.getProfile();return JSX("div",{class:"uk-grid-small uk-grid-match uk-child-width-expand@m uk-grid-divider","data-uk-grid":!0},e.map(function(d){return JSX("div",{class:"feedback-list uk-transition-toggle"},
JSX("div",{class:"feedback-category-header"},JSX("span",{class:"right"},JSX("a",{class:a.linkColor+"-fg uk-icon-button uk-transition-fade","data-uk-icon":"plus",onclick:"modal.open('add-feedback', '"+d.category+"');",title:"add feedback"})),JSX("span",{class:"feedback-category-title",onclick:"modal.open('add-feedback', '"+d.category+"');"},d.category)),JSX("div",null,d.feedback.map(function(f){var g=system.cache.getProfile();g=JSX("div",{id:"feedback-"+f.id,class:"feedback-detail section",onclick:"modal.open('feedback', '"+
f.id+"');"},JSX("div",{class:"feedback-comments right"},comment.renderCount("feedback",f.id)),JSX("div",{class:"left"},JSX("a",{class:g.linkColor+"-fg section-link"},member.renderTitle(member.getMember(f.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"feedback-content"},"loading..."));0<f.html.length&&(dom.setHTML(dom.req(".feedback-content",g),f.html).style.display="block");return JSX("div",null,g)})))}))}})(feedback||(feedback={}));var member;
(function(c){c.memberUpdateDom=function(e){if(e)switch(system.cache.currentService){case services.estimate:estimate.cache.activeStory&&vote.viewVotes();break;case services.standup:dom.setContent("#report-detail",report.renderReports(standup.cache.reports));standup.cache.activeReport&&report.viewActiveReport();break;case services.retro:dom.setContent("#feedback-detail",feedback.renderFeedbackArray(retro.cache.feedback)),retro.cache.activeFeedback&&feedback.viewActiveFeedback()}};c.activeMemberDom=
function(e){var b=c.selfCanEdit();dom.setDisplay("#modal-member .owner-form",b);dom.setDisplay("#modal-member .member-form",!b);dom.setDisplay("#modal-member .owner-actions",b);dom.setDisplay("#modal-member .member-actions",!b);dom.setSelectOption("#member-modal-role-select",e.role);dom.setText("#member-modal-name",e.name);dom.setText("#member-modal-role",e.role)}})(member||(member={}));
(function(c){function e(){c.updateSelf(a.filter(c.isSelf).shift());var f=a.filter(function(g){return!c.isSelf(g)});dom.setContent("#member-detail",c.renderMembers(f));0<f.length&&modal.hide("welcome");c.renderOnline()}function b(){if(d){var f=a.filter(function(g){return g.userID===d}).shift();f||console.warn("cannot load active member ["+d+"]");return f}console.warn("no active member")}var a=[],d;c.getMember=function(f){return a.filter(function(g){return g.userID===f}).shift()};c.getMembers=function(){return a};
c.setMembers=e;c.onMemberUpdate=function(f){c.isSelf(f)?modal.hide("self"):modal.hide("member");var g=a,k=g.filter(function(h){return h.userID===f.userID}).shift();k=(null===k||void 0===k?void 0:k.name)!==f.name;g=g.filter(function(h){return h.userID!==f.userID});g.length===a.length&&notify.notify(f.name+" has joined",!0);g.push(f);g.sort(function(h,l){return h.name>l.name?1:-1});a=g;e();c.memberUpdateDom(k)};c.onMemberRemove=function(f){var g;f===system.cache.getProfile().userID?(notify.notify("you have left this "+
(null===(g=system.cache.currentService)||void 0===g?void 0:g.key),!0),document.location.href="/"):(modal.hide("member"),g=a.filter(function(k){return k.userID!==f}),g.sort(function(k,h){return k.name>h.name?1:-1}),a=g,e())};c.viewActiveMember=function(f){f&&(d=f);(f=b())&&c.activeMemberDom(f)};c.removeMember=function(f){(f=void 0===f?d:f)||console.warn("cannot load active member ["+d+"]");"self"===f&&(f=system.cache.getProfile().userID);var g=system.cache.currentService;confirm("Are you sure you wish to leave this "+
g.key+"?")&&socket.send({svc:g.key,cmd:command.client.removeMember,param:f})};c.saveRole=function(){var f=b();if(f){var g=f.role,k=dom.req("#member-modal-role-select").value;g===k?modal.hide("member"):socket.send({svc:system.cache.currentService.key,cmd:command.client.updateMember,param:{id:f.userID,role:k}})}else console.warn("no active member")};c.applyMembers=function(f){a=f};c.loadQR=function(){var f=dom.req("#qrcode");f.src=f.dataset.src}})(member||(member={}));
(function(c){function e(b){return b?b.picture&&0<b.picture.length&&"none"!=b.picture?JSX("div",null,JSX("div",{class:"profile-image"},JSX("img",{class:"uk-border-circle",src:b.picture,alt:b.name})),JSX("div",{class:"left"},b.name),JSX("div",{class:"clear"})):JSX("div",null,JSX("div",{class:"profile-image"},JSX("span",{class:"profile-icon","data-uk-icon":"user"})),JSX("div",{class:"left"},b.name)):JSX("span",null,"{former member}")}c.renderMembers=function(b){return 0===b.length?JSX("div",null,JSX("button",
{class:"uk-button uk-button-default",onclick:"modal.open('invitation');",type:"button"},"Invite Members")):JSX("ul",{class:"uk-list uk-list-divider"},b.map(function(a){var d={id:"member-"+a.userID},f=system.cache.getProfile();a=JSX("div",{class:"section",onclick:"modal.open('member', '"+a.userID+"');"},JSX("div",{title:"user is offline",class:"right uk-article-meta online-indicator"},"offline"),JSX("div",{class:f.linkColor+"-fg section-link"},e(a)));return JSX("li",d,a)}))};c.renderTitle=e;c.renderHeader=
function(b,a,d){return JSX("header",{class:"uk-comment-header uk-position-relative"},d?d:JSX("span",null),JSX("div",{class:"uk-grid-collapse uk-flex-middle","uk-grid":!0},JSX("div",{class:"uk-width-auto"},b&&b.picture&&0<b.picture.length?JSX("div",null,JSX("div",{class:"profile-image"},JSX("img",{class:"uk-border-circle",src:b.picture,alt:b.name}))):JSX("div",null,JSX("div",{class:"profile-image"},JSX("span",{class:"profile-icon","data-uk-icon":"user"})))),JSX("div",{class:"uk-width-expand"},JSX("h4",
{class:"uk-comment-title uk-margin-remove"},null===b||void 0===b?void 0:b.name),JSX("p",{class:"uk-comment-meta uk-margin-remove-top"},date.toDateTimeString(new Date(a))))))};c.viewSelf=function(){var b=dom.setValue("#self-name-input",dom.req("#member-self .member-name").innerText);setTimeout(function(){return b.focus()},250)};c.setPicture=function(b){return b&&0<b.length&&"none"!=b?JSX("div",{class:"model-icon profile-image"},JSX("img",{class:"uk-border-circle",src:b,alt:"your picture"})):JSX("span",
{class:"model-icon h3-icon",onclick:"modal.open('self');","data-uk-icon":"icon: user;"})}})(member||(member={}));
(function(c){function e(){c.getMembers().forEach(function(a){var d=dom.opt("#member-"+a.userID+" .online-indicator");d&&(b.find(function(f){return f===a.userID})?d.classList.remove("offline"):d.classList.add("offline"))})}var b=[];c.onOnlineUpdate=function(a){a.connected?b.find(function(d){return d===a.userID})||b.push(a.userID):b=b.filter(function(d){return d!==a.userID});e()};c.applyOnline=function(a){b=a};c.renderOnline=e})(member||(member={}));
(function(c){var e;c.isSelf=function(b){return b.userID===system.cache.getProfile().userID};c.selfCanEdit=function(){return void 0!==e&&"owner"==e.role};c.updateSelf=function(b){b&&(e=b,dom.setContent("#self-picture",c.setPicture(b.picture)),dom.setText("#member-self .member-name",b.name),dom.setValue("#self-name-input",b.name),dom.setText("#member-self .member-role",b.role),b="owner"==b.role,dom.setDisplay("#history-container",b),dom.setDisplay("#session-edit-section",b),dom.setDisplay("#session-view-section",
!b))};c.onSubmitSelf=function(){var b=dom.req("#self-name-input").value,a=dom.req("#self-name-choice-global").checked?"global":"local",d=dom.req("#self-picture-input").value;socket.send({svc:services.system.key,cmd:command.client.updateProfile,param:{name:b,choice:a,picture:d}})}})(member||(member={}));var command;
(function(c){c.client={ping:"ping",connect:"connect",setActive:"set-active",getActions:"get-actions",getTeams:"get-teams",getSprints:"get-sprints",updateSession:"update-session",addComment:"add-comment",updateComment:"update-comment",removeComment:"remove-comment",updateProfile:"update-profile",updateMember:"update-member",removeMember:"remove-member",addStory:"add-story",updateStory:"update-story",removeStory:"remove-story",setStoryStatus:"set-story-status",submitVote:"submit-vote",addReport:"add-report",
updateReport:"update-report",removeReport:"remove-report",addFeedback:"add-feedback",updateFeedback:"update-feedback",removeFeedback:"remove-feedback"};c.server={error:"error",pong:"pong",sessionJoined:"session-joined",sessionUpdate:"session-update",sessionRemove:"session-remove",commentUpdate:"comment-update",commentRemove:"comment-remove",permissionsUpdate:"permissions-update",teamUpdate:"team-update",sprintUpdate:"sprint-update",contentUpdate:"content-update",actions:"actions",teams:"teams",sprints:"sprints",
memberUpdate:"member-update",memberRemove:"member-remove",onlineUpdate:"online-update",storyUpdate:"story-update",storyRemove:"story-remove",storyStatusChange:"story-status-change",voteUpdate:"vote-update",reportUpdate:"report-update",reportRemove:"report-remove",feedbackUpdate:"feedback-update",feedbackRemove:"feedback-remove"}})(command||(command={}));var services;
(function(c){c.system={key:"system",title:"System",plural:"systems",icon:"close"};c.team={key:"team",title:"Team",plural:"teams",icon:"users"};c.sprint={key:"sprint",title:"Sprint",plural:"sprints",icon:"git-fork"};c.estimate={key:"estimate",title:"Estimate Session",plural:"estimates",icon:"settings"};c.standup={key:"standup",title:"Daily Standup",plural:"standups",icon:"future"};c.retro={key:"retro",title:"Retrospective",plural:"retros",icon:"history"};var e=[c.system,c.team,c.sprint,c.estimate,
c.standup,c.retro];c.fromKey=function(b){var a=e.find(function(d){return d.key===b});if(!a)throw"invalid service ["+b+"]";return a}})(services||(services={}));var permission;
(function(c){function e(a){var d=dom.opt("#model-"+a+"-select select");if(d){var f=collection.findGroup(c.permissions,a),g=dom.opt("#perm-"+a+"-section");g&&(dom.req("#perm-"+a+"-checkbox").checked=0<f.length,dom.setDisplay(g,0!==d.value.length));collection.findGroup(c.permissions,a)}}function b(a){var d=dom.opt("#perm-"+a+"-checkbox");if(!d||!d.checked)return[];d=dom.els(".perm-"+a+"-email").filter(function(f){return f.checked}).map(function(f){return f.value}).join(",");return[{k:a,v:d,access:"member"}]}
c.permissions=[];c.applyPermissions=function(a){a=collection.groupBy(a,function(d){return d.k}).groups;c.permissions=a};c.setPerms=function(){var a=null===c.permissions||0===c.permissions.length;dom.setDisplay("#public-link-container",a);dom.setDisplay("#private-link-container",!a);c.updateView();["team","sprint"].forEach(e);auth.allProviders.forEach(c.setProviderPerms)};c.setModelPerms=e;c.readPermissions=function(){var a=[];a.push.apply(a,$jscomp.arrayFromIterable(b("team")));a.push.apply(a,$jscomp.arrayFromIterable(b("sprint")));
a.push.apply(a,$jscomp.arrayFromIterable(b("github")));a.push.apply(a,$jscomp.arrayFromIterable(b("google")));a.push.apply(a,$jscomp.arrayFromIterable(b("slack")));a.push.apply(a,$jscomp.arrayFromIterable(b("facebook")));a.push.apply(a,$jscomp.arrayFromIterable(b("amazon")));a.push.apply(a,$jscomp.arrayFromIterable(b("microsoft")));return a}})(permission||(permission={}));
(function(c){function e(b){switch(b.key){case services.team.key:return JSX("li",null,"Must be a member of this session's team");case services.sprint.key:return JSX("li",null,"Must be a member of this session's sprint");default:var a=collection.flatten(b.members.map(function(d){return d.k.split(",").map(function(f){return f.trim()}).filter(function(f){return 0<f.length})}));return 0===a.length?JSX("li",null,"Must sign in with ",b.key):JSX("li",null,"Must sign in with ",b.key," using an email address from ",
a.join(" or "))}}c.renderEmails=function(b,a){var d="uk-checkbox uk-margin-small-right perm-"+b+"-email",f="permission.onChanged('email', '"+b+"', this.checked)";return JSX("ul",null,a.map(function(g){return JSX("li",null,JSX("label",null,g.matched?JSX("input",{class:d,type:"checkbox",value:g.domain,checked:"checked",onchange:f}):JSX("input",{class:d,type:"checkbox",value:g.domain,onchange:f}),"Using email address ",g.domain))}))};c.renderView=function(b){return 0===b.length?JSX("div",null,"public"):
JSX("ul",null,b.map(function(a){return e(a)}))}})(permission||(permission={}));
(function(c){function e(b,a){dom.els(".perm-"+b+"-email").forEach(function(d){d.disabled=!a;a||(d.checked=!1)})}c.setProviderPerms=function(b){var a=collection.findGroup(c.permissions,b.key),d=auth.active().filter(function(k){return k.provider===b.key});if(dom.opt("#perm-"+b.key+"-section")){dom.req("#perm-"+b.key+"-checkbox").checked=0<a.length;var f=dom.req("#perm-"+b.key+"-email-container"),g=collection.flatten(a.map(function(k){return k.v.split(",").filter(function(h){return 0<h.length})})).map(function(k){return{matched:!0,
domain:k}});a=d.filter(function(k){return 0===g.filter(function(h){return k.email.endsWith(h.domain)}).length}).map(function(k){k=k.email;var h=k.lastIndexOf("@");k=-1===h?k:k.substr(h);return{matched:!1,domain:k}});g.push.apply(g,$jscomp.arrayFromIterable(a));g.sort();dom.setDisplay(f,0<g.length);dom.setContent(f,0===g.length?document.createElement("span"):c.renderEmails(b.key,g))}};c.onChanged=function(b,a,d){switch(b){case "email":(b=dom.opt("#perm-"+a+"-checkbox"))&&d&&!b.checked&&(b.checked=
!0);break;case "provider":return e(a,d)}}})(permission||(permission={}));(function(c){c.updateView=function(){var e=dom.req("#session-view-section .perms");dom.clear(e);e.appendChild(c.renderView(c.permissions))}})(permission||(permission={}));var report;
(function(c){function e(){if(standup.cache.activeReport){var b=standup.cache.reports.filter(function(a){return a.id===standup.cache.activeReport}).shift();b||console.warn("cannot load active report ["+standup.cache.activeReport+"]");return b}console.warn("no active report")}c.onSubmitReport=function(){var b=dom.req("#report-date").value,a=dom.req("#report-content").value;socket.send({svc:services.standup.key,cmd:command.client.addReport,param:{d:b,content:a}});return!1};c.onEditReport=function(){var b=
dom.req("#report-edit-date").value,a=dom.req("#report-edit-content").value;socket.send({svc:services.standup.key,cmd:command.client.updateReport,param:{id:standup.cache.activeReport,d:b,content:a}});return!1};c.onRemoveReport=function(){var b=standup.cache.activeReport;b&&notify.confirm("Delete this report?",function(){socket.send({svc:services.standup.key,cmd:command.client.removeReport,param:b});modal.hide("report")});return!1};c.viewActiveReport=function(b){var a,d=system.cache.getProfile();b&&
(standup.cache.activeReport=b);(b=e())?(dom.setText("#report-title",date.toDateString(date.dateFromYMD(b.d))+" - "+(null===(a=member.getMember(b.userID))||void 0===a?void 0:a.name)),a=b.userID===d.userID,dom.setValue(dom.req("#report-edit-date"),a?b.d:""),contents.onContentDisplay("report",a,b.content,b.html),comment.setActive("report",b.id),comment.setCounts()):console.warn("no active report")};c.setReports=function(b){standup.cache.reports=b;dom.setContent("#report-detail",c.renderReports(b));comment.setCounts();
modal.hide("add-report")};c.getReportDates=function(b){return b.map(function(a){return a.d}).filter(function(a,d,f){return f.indexOf(a)===d}).sort().reverse().map(function(a){var d=b.filter(function(f){return f.d===a}).sort(function(f,g){return f.created>g.created?-1:1});return{d:a,reports:d}})};c.viewAddReport=function(){dom.setValue("#report-date",date.dateToYMD(new Date));var b=dom.setValue("#report-content","");dom.wireTextarea(b);setTimeout(function(){return b.focus()},250)};c.viewReport=function(b){report.viewActiveReport(b);
var a=dom.req("#report-edit-content");setTimeout(function(){dom.wireTextarea(a);a.focus()},250)}})(report||(report={}));
(function(c){c.renderReports=function(e){if(0===e.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-report');",type:"button"},"Add Report"));e=c.getReportDates(e);return JSX("ul",{class:"uk-list"},e.map(function(b){return JSX("li",{id:"report-date-"+b.d},JSX("h5",null,JSX("div",{class:"right uk-article-meta"},date.dow(date.dateFromYMD(b.d).getDay())),date.toDateString(date.dateFromYMD(b.d))),JSX("ul",null,b.reports.map(function(a){var d=system.cache.getProfile();
d=JSX("div",{id:"report-"+a.id,class:"report-detail section",onclick:"modal.open('report', '"+a.id+"');"},JSX("div",{class:"report-comments right"},comment.renderCount("report",a.id)),JSX("div",{class:"left"},JSX("a",{class:d.linkColor+"-fg section-link"},member.renderTitle(member.getMember(a.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"report-content"},"loading..."));0<a.html.length&&(dom.setHTML(dom.req(".report-content",d),a.html).style.display="block");return JSX("li",null,d)})))}))}})(report||
(report={}));var retro;
(function(c){function e(b){c.cache.detail=b;var a=b.categories.join(", ");dom.setValue("#model-categories-input",a);dom.setContent("#session-view-section .categories",tags.renderTagsView(b.categories));dom.setOptions("#feedback-category",b.categories);dom.setOptions("#feedback-edit-category",b.categories);feedback.setFeedback(c.cache.feedback);session.setDetail(b)}c.cache=new function(){this.feedback=[]};c.onRetroMessage=function(b,a){switch(b){case command.server.error:rituals.onError(services.retro,a);
break;case command.server.sessionJoined:session.onSessionJoin(a);e(a.session);feedback.setFeedback(a.feedback);session.showWelcomeMessage(a.session.status,a.members.length);break;case command.server.sessionUpdate:e(a);break;case command.server.sessionRemove:system.onSessionRemove(services.retro);break;case command.server.permissionsUpdate:system.setPermissions(a);break;case command.server.teamUpdate:c.cache.detail&&(c.cache.detail.teamID=null===a||void 0===a?void 0:a.id);session.setTeam(a);break;
case command.server.sprintUpdate:c.cache.detail&&(c.cache.detail.sprintID=null===a||void 0===a?void 0:a.id);session.setSprint(a);break;case command.server.feedbackUpdate:feedback.onFeedbackUpdate(a);break;case command.server.feedbackRemove:feedback.onFeedbackRemoved(a);break;default:console.warn("unhandled command ["+b+"] for retro")}};c.onSubmitRetroSession=function(){var b=dom.req("#model-title-input").value,a=dom.req("#model-categories-input").value,d=dom.req("#model-team-select select").value,
f=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.retro.key,cmd:command.client.updateSession,param:{title:b,categories:a,teamID:d,sprintID:f,permissions:g}})}})(retro||(retro={}));var session;
(function(c){c.setDetail=function(e){var b,a=(null===(b=system.cache.session)||void 0===b?void 0:b.slug)||"invalid";system.cache.session=e;document.title=e.title;dom.setText("#model-title",e.title);dom.setText("#session-view-section .uk-modal-title",e.title);dom.setValue("#model-title-input",e.title);b=dom.els("#navbar .uk-navbar-item");0<b.length&&dom.setText(b[b.length-1],e.title);a!==e.slug&&window.history.replaceState(null,"",document.location.href.replace(a,e.slug));member.selfCanEdit()&&modal.hide("session")};
c.onSessionJoin=function(e){system.cache.apply(e);permission.setPerms();member.setMembers();comment.setCounts()};c.showWelcomeMessage=function(e,b){"new"===e&&1===b&&(socket.send({svc:services.system.key,cmd:command.client.setActive,param:null}),setTimeout(function(){return modal.open("welcome")},300))};c.setTeam=function(e){var b=dom.req("#team-link-container"),a=dom.req("#session-view-section .team");dom.clear(b);dom.setDisplay("#team-warning-container",void 0!==e);e?(b.appendChild(team.renderTeamLink(e)),
dom.setContent(a,team.renderTeamLink(e,!0)),dom.setText("#team-warning-name",e.title)):dom.setHTML(a,"-none-")};c.setSprint=function(e){var b=dom.req("#sprint-link-container"),a=dom.req("#session-view-section .sprint");dom.clear(b);dom.setDisplay("#sprint-warning-container",void 0!==e);e?(b.appendChild(sprint.renderSprintLink(e)),dom.setContent(a,sprint.renderSprintLink(e,!0)),dom.setText("#sprint-warning-name",e.title)):dom.setHTML(a,"-none-")};c.onModalOpen=function(e){var b=dom.setValue("#model-title-input",
dom.req("#model-title").innerText);setTimeout(function(){return b.focus()},250);team.refreshTeams();sprint.refreshSprints()}})(session||(session={}));var socket;
(function(c){function e(){var h=document.location,l="ws";"https:"===h.protocol&&(l="wss");return l+("://"+h.host+"/s")}function b(h,l){system.cache.currentService=h;system.cache.currentID=l;system.cache.connectTime=Date.now();g=new WebSocket(e());g.onopen=function(){a({svc:h.key,cmd:command.client.connect,param:l})};g.onmessage=function(m){m=JSON.parse(m.data);d(m)};g.onerror=function(m){};g.onclose=function(){f()}}function a(h){debug&&console.debug("out",h);g.send(JSON.stringify(h))}function d(h){debug&&
console.debug("in",h);switch(h.svc){case services.system.key:system.onSystemMessage(h.cmd,h.param);break;case services.team.key:team.onTeamMessage(h.cmd,h.param);break;case services.sprint.key:sprint.onSprintMessage(h.cmd,h.param);break;case services.estimate.key:estimate.onEstimateMessage(h.cmd,h.param);break;case services.standup.key:standup.onStandupMessage(h.cmd,h.param);break;case services.retro.key:retro.onRetroMessage(h.cmd,h.param);break;default:console.warn("unhandled message for service ["+
h.svc+"]")}}function f(){function h(l){debug&&console.info("socket closed, reconnecting in "+l+" seconds");setTimeout(function(){b(system.cache.currentService,system.cache.currentID)},1E3*l)}k||h(10)}var g,k=!1;c.setAppUnloading=function(){k=!0};c.socketConnect=b;c.send=a;c.onSocketMessage=d})(socket||(socket={}));var sprint;
(function(c){function e(b){c.cache.detail=b;var a=b.startDate?date.utcDate(b.startDate):void 0,d=b.endDate?date.utcDate(b.endDate):void 0;dom.setContent("#sprint-date-display",c.renderSprintDates(a,d));dom.setValue("#sprint-start-date-input",a?date.dateToYMD(a):"");dom.setValue("#sprint-end-date-input",d?date.dateToYMD(d):"");session.setDetail(b)}c.cache=new function(){};c.onSprintMessage=function(b,a){switch(b){case command.server.error:rituals.onError(services.sprint,a);break;case command.server.sessionJoined:session.onSessionJoin(a);
e(a.session);dom.setContent("#sprint-estimate-list",contents.renderContents(services.sprint,services.estimate,a.estimates));dom.setContent("#sprint-standup-list",contents.renderContents(services.sprint,services.standup,a.standups));dom.setContent("#sprint-retro-list",contents.renderContents(services.sprint,services.retro,a.retros));session.showWelcomeMessage(a.session.status,a.members.length);break;case command.server.teamUpdate:c.cache.detail&&(c.cache.detail.teamID=null===a||void 0===a?void 0:a.id);
session.setTeam(a);break;case command.server.sessionUpdate:e(a);break;case command.server.sessionRemove:system.onSessionRemove(services.sprint);break;case command.server.permissionsUpdate:system.setPermissions(a);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService,system.cache.currentID);break;default:console.warn("unhandled command ["+b+"] for sprint")}};c.onSubmitSprintSession=function(){var b,a,d=dom.req("#model-title-input").value,f=dom.req("#model-team-select select").value,
g=null===(b=dom.opt("#sprint-start-date-input"))||void 0===b?void 0:b.value;b=null===(a=dom.opt("#sprint-end-date-input"))||void 0===a?void 0:a.value;a=permission.readPermissions();socket.send({svc:services.sprint.key,cmd:command.client.updateSession,param:{title:d,startDate:g,endDate:b,teamID:f,permissions:a}})};c.refreshSprints=function(){dom.opt("#model-sprint-select")&&socket.send({svc:services.system.key,cmd:command.client.getSprints,param:null})};c.viewSprints=function(b){var a;dom.opt("#model-sprint-container")&&
(dom.setContent("#model-sprint-select",c.renderSprintSelect(b,null===(a=system.cache.session)||void 0===a?void 0:a.sprintID)),permission.setModelPerms("sprint"))}})(sprint||(sprint={}));
(function(c){c.renderSprintDates=function(e,b){function a(g,k){return JSX("span",null,g," ",JSX("span",{class:"sprint-date",onclick:"modal.open('session');"},k?date.toDateString(k):""))}var d=a("starts",e),f=a("ends",b);return e?b?JSX("span",null,d,", ",f):d:b?f:JSX("span",null,"Sprint")};c.renderSprintLink=function(e,b){var a=system.cache.getProfile();e=JSX("a",{class:a.linkColor+"-fg",href:"/sprint/"+e.slug},e.title);return b?e:JSX("span",null,e," ")};c.renderSprintSelect=function(e,b){return JSX("select",
{class:"uk-select",onchange:"permission.setModelPerms('sprint')"},JSX("option",{value:""},"- no sprint -"),e.map(function(a){return a.id===b?JSX("option",{selected:"selected",value:a.id},a.title):JSX("option",{value:a.id},a.title)}))}})(sprint||(sprint={}));var standup;
(function(c){function e(a){return c.cache.reports.filter(function(d){return d.id!==a})}function b(a,d){report.setReports(a);d===c.cache.activeReport&&modal.hide("report")}c.cache=new function(){this.reports=[]};c.onStandupMessage=function(a,d){switch(a){case command.server.error:rituals.onError(services.standup,d);break;case command.server.sessionJoined:session.onSessionJoin(d);a=d.session;c.cache.detail=a;session.setDetail(a);report.setReports(d.reports);session.showWelcomeMessage(d.session.status,
d.members.length);break;case command.server.sessionUpdate:c.cache.detail=d;session.setDetail(d);break;case command.server.sessionRemove:system.onSessionRemove(services.standup);break;case command.server.permissionsUpdate:system.setPermissions(d);break;case command.server.teamUpdate:c.cache.detail&&(c.cache.detail.teamID=null===d||void 0===d?void 0:d.id);session.setTeam(d);break;case command.server.sprintUpdate:c.cache.detail&&(c.cache.detail.sprintID=null===d||void 0===d?void 0:d.id);session.setSprint(d);
break;case command.server.reportUpdate:a=e(d.id);a.push(d);b(a,d.id);break;case command.server.reportRemove:a=e(d);b(a,d);notify.notify("report has been deleted",!0);break;default:console.warn("unhandled command ["+a+"] for standup")}};c.onSubmitStandupSession=function(){var a=dom.req("#model-title-input").value,d=dom.req("#model-team-select select").value,f=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.standup.key,cmd:command.client.updateSession,
param:{title:a,teamID:d,sprintID:f,permissions:g}})}})(standup||(standup={}));var story;
(function(c){function e(a){function d(g,k){g.id.substr(g.id.lastIndexOf("-")+1)===k?g.classList.add("active"):g.classList.remove("active")}dom.els(".story-status-body").forEach(function(g){d(g,a)});dom.els(".story-status-actions").forEach(function(g){d(g,a)});var f="";switch(a){case "pending":f="Story";break;case "active":f="Voting";break;case "complete":f="Results"}dom.setText("#story-status",f);vote.viewVotes()}function b(a,d,f,g){f&&"complete"===f.status&&0<f.finalVote.length&&(d=f.finalVote);
dom.setContent("#story-"+a+" .story-status",c.renderStatus(d));g&&c.showTotalIfNeeded()}c.viewStoryStatus=e;c.requestStoryStatus=function(a){var d=c.getActiveStory();d&&socket.send({svc:services.estimate.key,cmd:command.client.setStoryStatus,param:{storyID:d.id,status:a}})};c.setStoryStatus=b;c.onStoryStatusChange=function(a){var d=void 0;estimate.cache.stories.forEach(function(f){f.id===a.storyID&&(d=f,f.finalVote=a.finalVote,f.status=a.status)});b(a.storyID,a.status,d,!0);a.storyID===estimate.cache.activeStory&&
e(a.status)}})(story||(story={}));
(function(c){function e(){if(estimate.cache.activeStory){var a=estimate.cache.stories.filter(function(d){return d.id===estimate.cache.activeStory}).shift();a||console.warn("cannot load active story ["+estimate.cache.activeStory+"]");return a}}function b(){var a=0;estimate.cache.stories.filter(function(g){return"complete"===g.status}).map(function(g){return g.finalVote}).filter(function(g){return 0<g.length}).map(function(g){return parseFloat(g)}).filter(function(g){return!isNaN(g)}).forEach(function(g){return a+=g});
var d=dom.opt("#story-total"),f=dom.req("#story-list");void 0!==d&&f.removeChild(d);0<a&&f.appendChild(c.renderTotal(a))}c.setStories=function(a){estimate.cache.stories=a;dom.setContent("#story-detail",c.renderStories(a));a.forEach(function(d){return c.setStoryStatus(d.id,d.status,d,!1)});b();comment.setCounts();modal.hide("add-story")};c.onSubmitStory=function(){var a=dom.req("#story-title-input").value;socket.send({svc:services.estimate.key,cmd:command.client.addStory,param:{title:a}});return!1};
c.beginEditStory=function(){var a=e(),d=prompt("Edit your story",a.title);if(null===d)return!1;d&&d!==a.title&&socket.send({svc:services.estimate.key,cmd:command.client.updateStory,param:{storyID:a.id,title:d}});return!1};c.onRemoveStory=function(){var a=estimate.cache.activeStory;a&&notify.confirm("Delete this story?",function(){socket.send({svc:services.estimate.key,cmd:command.client.removeStory,param:a});modal.hide("story")});return!1};c.getActiveStory=e;c.viewActiveStory=function(a){a&&(estimate.cache.activeStory=
a);if(a=e())dom.setText("#story-title",a.title),c.viewStoryStatus(a.status),comment.setActive("story",a.id),comment.setCounts()};c.showTotalIfNeeded=b})(story||(story={}));
(function(c){c.renderStories=function(e){return 0===e.length?JSX("div",{id:"story-list"},JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-story');",type:"button"},"Add Story")):JSX("table",{class:"uk-table uk-table-divider uk-table-small"},JSX("ul",{id:"story-list",class:"uk-list uk-list-divider"},e.map(function(b){var a=system.cache.getProfile();return JSX("li",{id:"story-"+b.id,class:"section",onclick:"modal.open('story', '"+b.id+"');"},JSX("div",{class:"right uk-article-meta story-status"},
b.status),JSX("div",{class:a.linkColor+"-fg section-link left"},b.title),JSX("div",{class:"left",style:"margin-top: 4px;"},comment.renderCount("story",b.id)))})))};c.renderStatus=function(e){switch(e){case "pending":return JSX("span",null,e);case "active":return JSX("span",null,e);default:return JSX("span",{class:"vote-badge"},e)}};c.renderTotal=function(e){return JSX("li",{id:"story-total"},JSX("div",{class:"right uk-article-meta"},JSX("span",{class:"vote-badge"},e))," ","Total")};c.viewAddStory=
function(){var e=dom.setValue("#story-title-input","");setTimeout(function(){return e.focus()},250)}})(story||(story={}));var debug=!0,system;
(function(c){var e=function(){this.currentID="";this.connectTime=0};e.prototype.getProfile=function(){if(!this.profile)throw"no active profile";return this.profile};e.prototype.apply=function(b){c.cache.session=b.session;c.cache.profile=b.profile;auth.applyAuths(b.auths);permission.applyPermissions(b.permissions);member.applyMembers(b.members);member.applyOnline(b.online);comment.applyComments(b.comments);void 0!==b.team&&session.setTeam(b.team);void 0!==b.sprint&&session.setSprint(b.sprint)};c.cache=
new e;c.setPermissions=function(b){permission.applyPermissions(b);permission.setPerms()};c.setAuths=function(b){auth.applyAuths(b);permission.setPerms()};c.onSystemMessage=function(b,a){switch(b){case command.server.error:rituals.onError(services.system,a);break;case command.server.actions:action.viewActions(a);break;case command.server.teams:team.viewTeams(a);break;case command.server.sprints:sprint.viewSprints(a);break;case command.server.memberUpdate:member.onMemberUpdate(a);break;case command.server.memberRemove:member.onMemberRemove(a);
break;case command.server.onlineUpdate:member.onOnlineUpdate(a);break;case command.server.commentUpdate:comment.onCommentUpdate(a);break;case command.server.commentRemove:comment.onCommentRemoved(a);break;default:console.warn("unhandled system message for command ["+b+"]")}};c.onSessionRemove=function(b){document.location.reload()}})(system||(system={}));var team;
(function(c){c.cache=new function(){};c.onTeamMessage=function(e,b){switch(e){case command.server.error:rituals.onError(services.team,b);break;case command.server.sessionJoined:session.onSessionJoin(b);e=b.session;c.cache.detail=e;session.setDetail(e);dom.setContent("#team-sprint-list",contents.renderContents(services.team,services.sprint,b.sprints));dom.setContent("#team-estimate-list",contents.renderContents(services.team,services.estimate,b.estimates));dom.setContent("#team-standup-list",contents.renderContents(services.team,
services.standup,b.standups));dom.setContent("#team-retro-list",contents.renderContents(services.team,services.retro,b.retros));session.showWelcomeMessage(b.session.status,b.members.length);break;case command.server.sessionUpdate:c.cache.detail=b;session.setDetail(b);break;case command.server.sessionRemove:system.onSessionRemove(services.team);break;case command.server.permissionsUpdate:system.setPermissions(b);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService,
system.cache.currentID);break;default:console.warn("unhandled command ["+e+"] for team")}};c.onSubmitTeamSession=function(){var e=dom.req("#model-title-input").value,b=permission.readPermissions();socket.send({svc:services.team.key,cmd:command.client.updateSession,param:{title:e,permissions:b}})};c.refreshTeams=function(){dom.opt("#model-team-select")&&socket.send({svc:services.system.key,cmd:command.client.getTeams,param:null})};c.viewTeams=function(e){var b;dom.opt("#model-team-container")&&(dom.setContent("#model-team-select",
c.renderTeamSelect(e,null===(b=system.cache.session)||void 0===b?void 0:b.teamID)),permission.setModelPerms("team"))}})(team||(team={}));
(function(c){c.renderTeamLink=function(e,b){var a=system.cache.getProfile();e=JSX("a",{class:a.linkColor+"-fg",href:"/team/"+e.slug},e.title);return b?e:JSX("span",null,"in ",e)};c.renderTeamSelect=function(e,b){return JSX("select",{class:"uk-select",onchange:"permission.setModelPerms('team')"},JSX("option",{value:""},"- no team -"),e.map(function(a){return a.id===b?JSX("option",{selected:"selected",value:a.id},a.title):JSX("option",{value:a.id},a.title)}))}})(team||(team={}));var profile;
(function(c){c.setNavColor=function(e,b){dom.setValue("#nav-color",b);dom.req("#navbar").className=b+"-bg uk-navbar-container uk-navbar";document.querySelectorAll(".nav_swatch").forEach(function(a){a.classList.remove("active")});e.classList.add("active")};c.setLinkColor=function(e,b){dom.setValue("#link-color",b);dom.els(".profile-link").forEach(function(a){a.classList.forEach(function(d){-1<d.indexOf("-fg")&&a.classList.remove(d);a.classList.add(b+"-fg")})});document.querySelectorAll(".link_swatch").forEach(function(a){a.classList.remove("active")});
e.classList.add("active")};c.setPicture=function(e){dom.setValue("#self-picture-input",e);return!1}})(profile||(profile={}));var collection;
(function(c){var e=function(a){this.members=[];this.key=a};c.Group=e;var b=function(){this.groups=[]};b.prototype.findOrInsert=function(a){var d=this.groups.find(function(f){return f.key===a});if(d)return d;d=new e(a);this.groups.push(d);return d};c.GroupSet=b;c.groupBy=function(a,d){var f=new b;a&&a.forEach(function(g){f.findOrInsert(d(g)).members.push(g)});return f};c.findGroup=function(a,d){a=$jscomp.makeIterator(a);for(var f=a.next();!f.done;f=a.next())if(f=f.value,f.key===d)return f.members;
return[]};c.flatten=function(a){var d=[];a.forEach(function(f){return d.push.apply(d,$jscomp.arrayFromIterable(f))});return d}})(collection||(collection={}));var date;
(function(c){function e(d){return d.toLocaleDateString()}function b(d){return d.toLocaleTimeString().slice(0,8)}c.dateToYMD=function(d){var f=d.getDate(),g=d.getMonth()+1;return d.getFullYear()+"-"+(9>=g?"0"+g:g)+"-"+(9>=f?"0"+f:f)};c.dateFromYMD=function(d){d=new Date(d);return new Date(d.getTime()+6E4*d.getTimezoneOffset())};c.dow=function(d){switch(d){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat";default:return"???"}};
c.toDateString=e;c.toTimeString=b;c.toDateTimeString=function(d){return e(d)+" "+b(d)};var a=6E4*(new Date).getTimezoneOffset();c.utcDate=function(d){return new Date(Date.parse(d)+a)}})(date||(date={}));var notify;(function(c){c.notify=function(e,b){UIkit.notification(e,{status:b?"success":"danger",pos:"top-right"})};c.confirm=function(e,b){UIkit.modal.confirm(e).then(b)};c.modal=function(e){var b=UIkit.modal(e);b||console.warn("no modal available with key ["+e+"]");return b}})(notify||(notify={}));
var vote;
(function(c){function e(){var b=story.getActiveStory();if(b){var a=estimate.cache.activeVotes(),d=a.filter(function(f){return f.userID===system.cache.getProfile().userID}).pop();switch(b.status){case "pending":b=system.cache.getProfile().userID===b.userID;dom.setDisplay("#story-edit-section",b);dom.setDisplay("#story-view-section",!b);break;case "active":dom.setContent("#story-vote-members",c.renderVoteMembers(member.getMembers(),a));dom.setContent("#story-vote-choices",c.renderVoteChoices(estimate.cache.detail.choices,null===
d||void 0===d?void 0:d.choice));break;case "complete":dom.setContent("#story-vote-results",c.renderVoteResults(member.getMembers(),a));dom.setContent("#story-vote-summary",c.renderVoteSummary(a));break;default:console.warn("invalid story status ["+b.status+"]")}}}c.setVotes=function(b){estimate.cache.votes=b;e()};c.onVoteUpdate=function(b){var a=estimate.cache.votes;a=a.filter(function(d){return d.userID!==b.userID||d.storyID!==b.storyID});a.push(b);estimate.cache.votes=a;b.storyID===estimate.cache.activeStory&&
e()};c.viewVotes=e;c.onSubmitVote=function(b){socket.send({svc:services.estimate.key,cmd:command.client.submitVote,param:{storyID:estimate.cache.activeStory,choice:b}})};c.getVoteResults=function(b){b=b.map(function(h){h=parseFloat(h.choice);return isNaN(h)?-1:h}).filter(function(h){return-1!==h}).sort();var a=b.length,d=Math.min.apply(Math,$jscomp.arrayFromIterable(b)),f=Math.max.apply(Math,$jscomp.arrayFromIterable(b)),g=b.reduce(function(h,l){return h+l},0),k=b.reduce(function(h,l){var m=h.numMapping[l]=
(h.numMapping[l]||0)+1;m>h.greatestFreq&&(h.greatestFreq=m,h.mode=l);return h},{mode:null,greatestFreq:-Infinity,numMapping:{}}).mode;return{count:a,min:d,max:f,sum:g,mean:0===a?0:g/a,median:0===a?0:b[Math.floor(b.length/2)],mode:0===a?0:k}}})(vote||(vote={}));
(function(c){function e(a,d){return JSX("div",{class:"vote-member",title:a.name+" has "+(d?"voted":"not voted")},JSX("div",null,JSX("span",{"data-uk-icon":"icon: "+(d?"check":"minus")+"; ratio: 1.6"})),a.name)}function b(a,d){return d?JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},d))," ",a.name):JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},JSX("span",{"data-uk-icon":"icon: minus; ratio: 1.6"})))," ",a.name)}c.renderVoteMembers=
function(a,d){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},a.map(function(f){return e(f,0<d.filter(function(g){return g.userID===f.userID}).length)}))};c.renderVoteChoices=function(a,d){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center"},a.map(function(f){return JSX("div",{class:"vote-choice uk-border-circle uk-box-shadow-hover-medium"+(f===d?" active "+system.cache.getProfile().linkColor+"-border":""),onclick:"vote.onSubmitVote('"+f+"');"},f)}))};c.renderVoteResults=
function(a,d){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},a.map(function(f){var g=d.filter(function(k){return k.userID===f.userID});return b(f,0<g.length?g[0].choice:void 0)}))};c.renderVoteSummary=function(a){function d(g){return g.toString().substr(0,4)}var f=c.getVoteResults(a);return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center result-container"},JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},d(f.count)," / ",d(a.length))," ",JSX("div",null,
"votes counted")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},d(f.min),"-",d(f.max))," ",JSX("div",null,"vote range")),JSX("div",{class:"result mean-result"},JSX("div",{class:"mean uk-border-circle "+system.cache.getProfile().linkColor+"-border"},d(f.mean))," ",JSX("div",null,"average")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},d(f.median))," ",JSX("div",null,"median")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},
d(f.mode))," ",JSX("div",null,"mode")))}})(vote||(vote={}));
