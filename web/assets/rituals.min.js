var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,d){a.raw=d;return a};$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var d,b=[];!(d=a.next()).done;)b.push(d.value);return b};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,d,b){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var f=a[e];if(d.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var d=0;d<a.length;++d){var b=a[d];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,b,c){if(d){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in b||(b[e]={});b=b[e]}a=a[a.length-1];c=b[a];d=d(c);d!=c&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");
$jscomp.checkStringArgs=function(a,d,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,b){var c=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===b&&(b=c.length);b=Math.max(0,Math.min(b|0,c.length));for(var e=a.length;0<e&&0<b;)if(c[--b]!=a[--e])return!1;return 0>=e}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},d=Object.create(new $jscomp.global.Proxy(a,{get:function(b,c,e){return b==a&&"q"==c&&e==d}}));return!0===d.q}catch(b){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,d){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+d++,b)}var d=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};
$jscomp.polyfill("WeakMap",function(a){function d(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),e=new a([[b,2],[c,3]]);if(2!=e.get(b)||3!=e.get(c))return!1;e.delete(b);e.set(c,4);return!e.has(b)&&4==e.get(c)}catch(m){return!1}}function b(){}function c(a){var b=typeof a;return"object"===b&&null!==a||"function"===b}function e(a){if(!$jscomp.owns(a,g)){var c=new b;$jscomp.defineProperty(a,g,{value:c})}}function f(a){var c=Object[a];c&&(Object[a]=function(a){if(a instanceof
b)return a;e(a);return c(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(d())return a;var g="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var h=0,k=function(a){this.id_=(h+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};k.prototype.set=function(a,b){if(!c(a))throw Error("Invalid WeakMap key");e(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+
a);a[g][this.id_]=b;return this};k.prototype.get=function(a){return c(a)&&$jscomp.owns(a,g)?a[g][this.id_]:void 0};k.prototype.has=function(a){return c(a)&&$jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)};k.prototype.delete=function(a){return c(a)&&$jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)?delete a[g][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function d(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var e=c.entries(),d=e.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=e.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!e.next().done?!1:!0}catch(m){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(d())return a;$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,b){a=0===a?0:a;var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};c.prototype.delete=function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};c.prototype.has=function(a){return!!e(this,a).entry};
c.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};c.prototype.entries=function(){return f(this,function(a){return[a.key,a.value]})};c.prototype.keys=function(){return f(this,function(a){return a.key})};c.prototype.values=function(){return f(this,function(a){return a.value})};c.prototype.forEach=function(a,b){for(var c=this.entries(),e;!(e=c.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var e=function(a,c){var e=c&&typeof c;"object"==
e||"function"==e?b.has(c)?e=b.get(c):(e=""+ ++h,b.set(c,e)):e="p_"+c;var d=a.data_[e];if(d&&$jscomp.owns(a.data_,e))for(a=0;a<d.length;a++){var f=d[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:e,list:d,index:a,entry:f}}return{id:e,list:d,index:-1,entry:void 0}},f=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},h=0;return c},"es6","es3");var rituals;(function(a){a.onError=function(a,b){console.error(a.key+": "+b);var c=b.lastIndexOf(":");-1<c&&(b=b.substr(c+1));notify.notify(a.key+" error: "+b,!1)};a.init=function(a,b){window.onbeforeunload=function(){socket.setAppUnloading()};socket.socketConnect(services.fromKey(a),b)}})(rituals||(rituals={}));var action;
(function(a){a.loadActions=function(){socket.send({svc:services.system.key,cmd:command.client.getActions,param:null})};a.viewActions=function(d){dom.setContent("#action-list",a.renderActions(d))}})(action||(action={}));
(function(a){a.renderActions=function(a){return 0===a.length?JSX("div",null,"No actions available"):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("thead",null,JSX("tr",null,JSX("th",null,"User"),JSX("th",null,"Act"),JSX("th",null,"Content"),JSX("th",null,"Note"),JSX("th",null,"Created"))),JSX("tbody",null,a.map(function(a){var b=JSON.stringify(a.content,null,2);return JSX("tr",null,JSX("td",null,member.renderTitle(member.getMember(a.userID))),JSX("td",null,a.act),JSX("td",null,
"null"===b?"":JSX("pre",null,b)),JSX("td",null,a.note),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(a.created))))})))}})(action||(action={}));var auth;(function(a){a.allProviders=[{key:"github",title:"GitHub"},{key:"google",title:"Google"},{key:"slack",title:"Slack"},{key:"facebook",title:"Facebook"},{key:"amazon",title:"Amazon"},{key:"microsoft",title:"Microsoft"}];var d=[];a.applyAuths=function(a){d=a};a.active=function(){return d}})(auth||(auth={}));var comment;
(function(a){function d(a,b){a&&"modal"!==a||(a=g,b||(b=h));"root"===a&&(a="");return b?f.filter(function(c){return c.targetType===a&&c.targetID==b}):f.filter(function(b){return b.targetType===a})}function b(b,c){b&&"modal"!==b||(b=g,c||(c=h));b?(g=b,h=c,dom.setContent("#modal-comment-content",a.renderComments(d(b,c)))):console.warn("invalid comment type ["+b+"]")}function c(){var a=dom.els(".comment-count-container"),b=!1,c=dom.opt("#comment-count-modal");a.forEach(function(a){var f=a.dataset.commentType,
k=a.dataset.commentId;if(!f)throw"invalid comment type ["+f+"] with id ["+k+"]";k=d(f,k);e(f,k,a);g===f&&c&&(e(f,k,c),b=!0)});!b&&c&&e("modal",[],c,!0)}function e(a,b,c,e){dom.req(".text",c).innerText=b.length.toString();"root"!==a&&"modal"!==a&&""!==a&&dom.setDisplay(c,0!==b.length||!0===e)}var f=[],g,h;a.applyComments=function(a){f=a};a.setActive=function(a,b){g=a;h=b};a.show=function(a){modal.open("comment",a)};a.add=function(){var a=dom.req("#comment-add-content"),b=a.value;a.value="";socket.send({svc:services.system.key,
cmd:command.client.addComment,param:{targetType:g,targetID:h,content:b}})};a.onCommentUpdate=function(a){f.push(a);c();b()};a.load=b;a.setCounts=c;a.closeModal=function(){"story"===g?modal.openSoon("story"):"report"===g?modal.openSoon("report"):"feedback"===g&&modal.openSoon("feedback");g=void 0}})(comment||(comment={}));
(function(a){a.renderComments=function(a){return 0===a.length?JSX("div",null,"No comments available"):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("thead",null,JSX("tr",null,JSX("th",null,"User"),JSX("th",null,"Content"),JSX("th",null,"Created"))),JSX("tbody",null,a.map(function(a){return JSX("tr",null,JSX("td",null,member.renderTitle(member.getMember(a.userID))),JSX("td",{dangerouslySetInnerHTML:{__html:a.html}}),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(a.created))))})))};
a.renderCount=function(a,b){var c=system.cache.getProfile();return JSX("div",{class:"comment-count-container uk-margin-small-left left hidden","data-comment-type":a,"data-comment-id":b},JSX("a",{class:c.linkColor+"-fg",title:"view comments"},JSX("div",{class:"comment-count"},JSX("span",{class:"uk-icon","data-uk-icon":"comments"}),JSX("span",{class:"text"}))))}})(comment||(comment={}));var contents;
(function(a){a.onContentDisplay=function(a,b,c,e){dom.setDisplay("#modal-"+a+" .content-edit",b);dom.setDisplay("#modal-"+a+" .buttons-edit",b);var d=dom.setDisplay("#modal-"+a+" .content-view",!b);dom.setHTML(d,b?"":e);dom.setDisplay("#modal-"+a+" .buttons-view",!b);a=dom.req("#"+a+"-edit-content");dom.setValue(a,b?c:"");b&&dom.wireTextarea(a)}})(contents||(contents={}));
(function(a){function d(a,c){return c.map(function(b){return{svc:a,session:b}})}a.renderContents=function(a,c,e){e=d(c,e);e.sort(function(a,b){return a.session.created>b.session.created?-1:1});return 0===e.length?JSX("div",null,"No "+c.plural+" in this "+a.key):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("tbody",null,e.map(function(a){var b=a.svc;a=a.session;var c=system.cache.getProfile();return JSX("tr",null,JSX("td",null,JSX("a",{class:c.linkColor+"-fg",href:"/"+b.key+"/"+
a.slug},a.title)),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},member.renderTitle(member.getMember(a.owner))),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(a.created))))})))}})(contents||(contents={}));var estimate;
(function(a){function d(b){a.cache.detail=b;dom.setValue("#model-choices-input",b.choices.join(", "));story.viewActiveStory();session.setDetail(b)}function b(b){var c=e(b.id);c.push(b);c.sort(function(a){return a.idx});b.id===a.cache.activeStory&&dom.setText("#story-title",b.title);story.setStories(c)}function c(b){var c=e(b);story.setStories(c);b===a.cache.activeStory&&modal.hide("story");notify.notify("story has been deleted",!0)}function e(b){return a.cache.stories.filter(function(a){return a.id!==
b})}var f=function(){this.stories=[];this.votes=[]};f.prototype.activeVotes=function(){var a=this;return this.activeStory?this.votes.filter(function(b){return b.storyID===a.activeStory}):[]};a.cache=new f;a.onEstimateMessage=function(e,f){switch(e){case command.server.error:rituals.onError(services.estimate,f);break;case command.server.sessionJoined:session.onSessionJoin(f);d(f.session);story.setStories(f.stories);vote.setVotes(f.votes);session.showWelcomeMessage(f.members.length);break;case command.server.sessionUpdate:d(f);
break;case command.server.permissionsUpdate:system.setPermissions(f);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===f||void 0===f?void 0:f.id);session.setTeam(f);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===f||void 0===f?void 0:f.id);session.setSprint(f);break;case command.server.storyUpdate:b(f);break;case command.server.storyRemove:c(f);break;case command.server.storyStatusChange:story.onStoryStatusChange(f);break;case command.server.voteUpdate:vote.onVoteUpdate(f);
break;default:console.warn("unhandled command ["+e+"] for estimate")}};a.onSubmitEstimateSession=function(){var a=dom.req("#model-title-input").value,b=dom.req("#model-choices-input").value,c=dom.req("#model-team-select select").value,e=dom.req("#model-sprint-select select").value,d=permission.readPermissions();socket.send({svc:services.estimate.key,cmd:command.client.updateSession,param:{title:a,choices:b,teamID:c,sprintID:e,permissions:d}})};a.onStoryUpdate=b;a.onStoryRemove=c})(estimate||(estimate=
{}));var feedback;
(function(a){function d(){if(retro.cache.activeFeedback){var a=retro.cache.feedback.filter(function(a){return a.id===retro.cache.activeFeedback}).shift();a||console.warn("cannot load active Feedback ["+retro.cache.activeFeedback+"]");return a}}function b(a){return retro.cache.feedback.filter(function(b){return b.id!==a})}function c(a,b){feedback.setFeedback(a);b===retro.cache.activeFeedback&&modal.hide("feedback")}a.setFeedback=function(b){retro.cache.feedback=b;dom.setContent("#feedback-detail",a.renderFeedbackArray(b));
comment.setCounts();modal.hide("add-feedback")};a.onSubmitFeedback=function(){var a=dom.req("#feedback-category").value,b=dom.req("#feedback-content").value;socket.send({svc:services.retro.key,cmd:command.client.addFeedback,param:{category:a,content:b}});return!1};a.onEditFeedback=function(){var a=retro.cache.activeFeedback,b=dom.req("#feedback-edit-category").value,c=dom.req("#feedback-edit-content").value;socket.send({svc:services.retro.key,cmd:command.client.updateFeedback,param:{id:a,category:b,
content:c}});return!1};a.onRemoveFeedback=function(){var a=retro.cache.activeFeedback;a&&UIkit.modal.confirm("Delete this feedback?").then(function(){socket.send({svc:services.retro.key,cmd:command.client.removeFeedback,param:a});modal.hide("feedback")});return!1};a.getActiveFeedback=d;a.viewActiveFeedback=function(a){var b,c=system.cache.getProfile();a&&(retro.cache.activeFeedback=a);(a=d())?(c=a.userID===c.userID,dom.setText("#feedback-title",a.category+" / "+(null===(b=member.getMember(a.userID))||
void 0===b?void 0:b.name)),dom.setSelectOption("#feedback-edit-category",c?a.category:void 0),contents.onContentDisplay("feedback",c,a.content,a.html),comment.setActive("feedback",a.id),comment.setCounts()):console.warn("no active feedback")};a.onFeedbackUpdate=function(a){var e=b(a.id);e.push(a);c(e,a.id)};a.onFeedbackRemoved=function(a){var e=b(a);c(e,a);notify.notify("feedback has been deleted",!0)};a.getFeedbackCategories=function(a,b){var c=b.map(function(b){var c=a.filter(function(a){return a.category===
b}).sort(function(a,b){return a.created>b.created?-1:1});return{category:b,feedback:c}}),e=a.filter(function(a){return!b.find(function(b){return b===a.category})});0<e.length&&c.push({category:"unknown",feedback:e});return c};a.viewAddFeedback=function(a){dom.setSelectOption("#feedback-category",a);var b=dom.setValue("#feedback-content","");dom.wireTextarea(b);setTimeout(function(){return b.focus()},250)};a.viewFeedback=function(a){feedback.viewActiveFeedback(a);var b=dom.req("#feedback-edit-content");
setTimeout(function(){dom.wireTextarea(b);b.focus()},250)}})(feedback||(feedback={}));
(function(a){a.renderFeedbackArray=function(d){var b;if(0===d.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-feedback');",type:"button"},"Add Feedback"));d=a.getFeedbackCategories(d,(null===(b=retro.cache.detail)||void 0===b?void 0:b.categories)||[]);var c=system.cache.getProfile();return JSX("div",{class:"uk-grid-small uk-grid-match uk-child-width-expand@m uk-grid-divider","data-uk-grid":!0},d.map(function(a){return JSX("div",{class:"feedback-list uk-transition-toggle"},
JSX("div",{class:"feedback-category-header"},JSX("span",{class:"right"},JSX("a",{class:c.linkColor+"-fg uk-icon-button uk-transition-fade","data-uk-icon":"plus",onclick:"modal.open('add-feedback', '"+a.category+"');",title:"add feedback"})),JSX("span",{class:"feedback-category-title",onclick:"modal.open('add-feedback', '"+a.category+"');"},a.category)),JSX("div",null,a.feedback.map(function(a){var b=system.cache.getProfile();b=JSX("div",{id:"feedback-"+a.id,class:"feedback-detail section",onclick:"modal.open('feedback', '"+
a.id+"');"},JSX("div",{class:"feedback-comments right"},comment.renderCount("feedback",a.id)),JSX("div",{class:"left"},JSX("a",{class:b.linkColor+"-fg section-link"},member.renderTitle(member.getMember(a.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"feedback-content"},"loading..."));0<a.html.length&&(dom.setHTML(dom.req(".feedback-content",b),a.html).style.display="block");return JSX("div",null,b)})))}))}})(feedback||(feedback={}));var member;
(function(a){function d(a){return a.userID===system.cache.getProfile().userID}function b(){var b=g.filter(d).shift();b&&(dom.setContent("#self-picture",a.setPicture(b.picture)),dom.setText("#member-self .member-name",b.name),dom.setValue("#self-name-input",b.name),dom.setText("#member-self .member-role",b.role));b=g.filter(function(a){return!d(a)});dom.setContent("#member-detail",a.renderMembers(b));c()}function c(){for(var a={},b=$jscomp.makeIterator(g),c=b.next();!c.done;a={$jscomp$loop$prop$member$6$10:a.$jscomp$loop$prop$member$6$10},
c=b.next())a.$jscomp$loop$prop$member$6$10=c.value,(c=dom.opt("#member-"+a.$jscomp$loop$prop$member$6$10.userID+" .online-indicator"))&&(f.find(function(a){return function(b){return b===a.$jscomp$loop$prop$member$6$10.userID}}(a))?c.classList.remove("offline"):c.classList.add("offline"))}function e(){if(h){var a=g.filter(function(a){return a.userID===h}).shift();a&&console.warn("cannot load active member ["+h+"]");return a}console.warn("no active member")}var f=[],g=[];a.getMembers=function(){return g};
a.getMember=function(a){return g.filter(function(b){return b.userID===a}).shift()};a.setMembers=b;a.onMemberUpdate=function(a){var c;d(a)&&modal.hide("self");var e=g,f=e.filter(function(b){return b.userID===a.userID}).shift();f=(null===f||void 0===f?void 0:f.name)!==a.name;e=e.filter(function(b){return b.userID!==a.userID});e.length===g.length&&notify.notify(a.name+" has joined",!0);"::delete"===a.name?a.userID===system.cache.getProfile().userID?(modal.hide("self"),notify.notify("you have left this "+
(null===(c=system.cache.currentService)||void 0===c?void 0:c.key),!0),document.location.href="/"):modal.hide("member"):e.push(a);e.sort(function(a,b){return a.name>b.name?1:-1});g=e;b();if(f)switch(system.cache.currentService){case services.estimate:estimate.cache.activeStory&&vote.viewVotes();break;case services.standup:dom.setContent("#report-detail",report.renderReports(standup.cache.reports));standup.cache.activeReport&&report.viewActiveReport();break;case services.retro:dom.setContent("#feedback-detail",
feedback.renderFeedbackArray(retro.cache.feedback)),retro.cache.activeFeedback&&feedback.viewActiveFeedback()}};a.onOnlineUpdate=function(a){a.connected?f.find(function(b){return b===a.userID})||f.push(a.userID):f=f.filter(function(b){return b!==a.userID});c()};a.onSubmitSelf=function(){var a=dom.req("#self-name-input").value,b=dom.req("#self-name-choice-global").checked?"global":"local",c=dom.req("#self-picture-input").value;socket.send({svc:services.system.key,cmd:command.client.updateProfile,param:{name:a,
choice:b,picture:c}})};var h;a.viewActiveMember=function(a){a&&(h=a);if(a=e())dom.setText("#member-modal-name",a.name),dom.setText("#member-modal-role",a.role)};a.removeMember=function(a){(a=void 0===a?h:a)||console.warn("cannot load active member ["+h+"]");"self"===a&&(a=system.cache.getProfile().userID);var b=system.cache.currentService;confirm("Are you sure you wish to leave this "+b.key+"?")&&socket.send({svc:b.key,cmd:command.client.removeMember,param:a})};a.applyMembers=function(a){g=a};a.applyOnline=
function(a){f=a}})(member||(member={}));
(function(a){function d(a){return a?a.picture&&0<a.picture.length?JSX("div",null,JSX("div",{class:"profile-image uk-margin-small-right"},JSX("img",{class:"uk-border-circle",src:a.picture,alt:a.name})),JSX("div",{class:"profile-name"},a.name)):JSX("div",null,JSX("div",{class:"profile-image uk-margin-small-right"},JSX("span",{class:"profile-icon uk-icon","data-uk-icon":"user"})),JSX("div",{class:"profile-name"},a.name)):JSX("span",null,"{former member}")}a.renderMembers=function(a){return 0===a.length?
JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('invitation');",type:"button"},"Invite Members")):JSX("ul",{class:"uk-list uk-list-divider"},a.map(function(a){var b={id:"member-"+a.userID},c=system.cache.getProfile();a=JSX("div",{class:"section",onclick:"modal.open('member', '"+a.userID+"');"},JSX("div",{title:"user is offline",class:"right uk-article-meta online-indicator"},"offline"),JSX("div",{class:c.linkColor+"-fg section-link"},d(a)));return JSX("li",b,a)}))};
a.renderTitle=d;a.viewSelf=function(){var a=dom.setValue("#self-name-input",dom.req("#member-self .member-name").innerText);setTimeout(function(){return a.focus()},250)};a.setPicture=function(a){return a&&0<a.length?JSX("div",{class:"model-icon profile-image uk-margin-small-right"},JSX("img",{class:"uk-border-circle",src:a,alt:"your picture"})):JSX("span",{class:"model-icon h3-icon",onclick:"modal.open('self');","data-uk-icon":"icon: user;"})}})(member||(member={}));var command;
(function(a){a.client={ping:"ping",connect:"connect",getActions:"get-actions",getTeams:"get-teams",getSprints:"get-sprints",updateSession:"update-session",addComment:"add-comment",updateComment:"update-comment",updateProfile:"update-profile",removeMember:"remove-member",addStory:"add-story",updateStory:"update-story",removeStory:"remove-story",setStoryStatus:"set-story-status",submitVote:"submit-vote",addReport:"add-report",updateReport:"update-report",removeReport:"remove-report",addFeedback:"add-feedback",
updateFeedback:"update-feedback",removeFeedback:"remove-feedback"};a.server={error:"error",pong:"pong",sessionJoined:"session-joined",sessionUpdate:"session-update",commentUpdate:"comment-update",permissionsUpdate:"permissions-update",teamUpdate:"team-update",sprintUpdate:"sprint-update",contentUpdate:"content-update",actions:"actions",teams:"teams",sprints:"sprints",memberUpdate:"member-update",onlineUpdate:"online-update",storyUpdate:"story-update",storyRemove:"story-remove",storyStatusChange:"story-status-change",
voteUpdate:"vote-update",reportUpdate:"report-update",reportRemove:"report-remove",feedbackUpdate:"feedback-update",feedbackRemove:"feedback-remove"}})(command||(command={}));var services;
(function(a){a.system={key:"system",title:"System",plural:"systems",icon:"close"};a.team={key:"team",title:"Team",plural:"teams",icon:"users"};a.sprint={key:"sprint",title:"Sprint",plural:"sprints",icon:"git-fork"};a.estimate={key:"estimate",title:"Estimate Session",plural:"estimates",icon:"settings"};a.standup={key:"standup",title:"Daily Standup",plural:"standups",icon:"future"};a.retro={key:"retro",title:"Retrospective",plural:"retros",icon:"history"};var d=[a.system,a.team,a.sprint,a.estimate,
a.standup,a.retro];a.fromKey=function(a){var b=d.find(function(b){return b.key===a});if(!b)throw"invalid service ["+a+"]";return b}})(services||(services={}));var permission;
(function(a){function d(a){var b=dom.opt("#model-"+a+"-select select");if(b){var c=collection.findGroup(e,a),d=dom.opt("#perm-"+a+"-section");d&&(dom.req("#perm-"+a+"-checkbox").checked=0<c.length,dom.setDisplay(d,""!==b.value));collection.findGroup(e,a)}}function b(a,b){dom.els(".perm-"+a+"-email").forEach(function(a){a.disabled=!b;b||(a.checked=!1)})}function c(b){var c=collection.findGroup(e,b.key),d=auth.active().filter(function(a){return a.provider===b.key});if(dom.opt("#perm-"+b.key+"-section")){dom.req("#perm-"+
b.key+"-checkbox").checked=0<c.length;var f=dom.req("#perm-"+b.key+"-email-container"),l=collection.flatten(c.map(function(a){return a.v.split(",").filter(function(a){return 0<a.length})})).map(function(a){return{matched:!0,domain:a}});c=d.filter(function(a){return 0===l.filter(function(b){return a.email.endsWith(b.domain)}).length}).map(function(a){a=a.email;var b=a.lastIndexOf("@");a=-1===b?a:a.substr(b);return{matched:!1,domain:a}});l.push.apply(l,$jscomp.arrayFromIterable(c));l.sort();dom.setDisplay(f,
0<l.length);dom.setContent(f,0===l.length?document.createElement("span"):a.renderEmails(b.key,l))}}var e=[];a.setPerms=function(){dom.setDisplay("#public-link-container",null===e||0===e.length);dom.setDisplay("#private-link-container",null!==e&&0<e.length);["team","sprint"].forEach(d);auth.allProviders.forEach(c)};a.setModelPerms=d;a.onChanged=function(a,c,e){switch(a){case "email":(a=dom.opt("#perm-"+c+"-checkbox"))&&e&&!a.checked&&(a.checked=!0);break;case "provider":return b(c,e)}};a.applyPermissions=
function(a){e=collection.groupBy(a,function(a){return a.k}).groups}})(permission||(permission={}));
(function(a){function d(a){var b=dom.opt("#perm-"+a+"-checkbox");if(!b||!b.checked)return[];b=dom.els(".perm-"+a+"-email").filter(function(a){return a.checked}).map(function(a){return a.value}).join(",");return[{k:a,v:b,access:"member"}]}a.renderEmails=function(a,c){var b="uk-checkbox uk-margin-small-right perm-"+a+"-email",d="permission.onChanged('email', '"+a+"', this.checked)";return JSX("ul",null,c.map(function(a){return JSX("li",null,JSX("label",null,a.matched?JSX("input",{class:b,type:"checkbox",
value:a.domain,checked:"checked",onchange:d}):JSX("input",{class:b,type:"checkbox",value:a.domain,onchange:d}),"Using email address ",a.domain))}))};a.readPermissions=function(){var a=[];a.push.apply(a,$jscomp.arrayFromIterable(d("team")));a.push.apply(a,$jscomp.arrayFromIterable(d("sprint")));a.push.apply(a,$jscomp.arrayFromIterable(d("github")));a.push.apply(a,$jscomp.arrayFromIterable(d("google")));a.push.apply(a,$jscomp.arrayFromIterable(d("slack")));a.push.apply(a,$jscomp.arrayFromIterable(d("facebook")));
a.push.apply(a,$jscomp.arrayFromIterable(d("amazon")));a.push.apply(a,$jscomp.arrayFromIterable(d("microsoft")));return a}})(permission||(permission={}));var report;
(function(a){function d(){if(standup.cache.activeReport){var a=standup.cache.reports.filter(function(a){return a.id===standup.cache.activeReport}).shift();a||console.warn("cannot load active report ["+standup.cache.activeReport+"]");return a}console.warn("no active report")}a.onSubmitReport=function(){var a=dom.req("#report-date").value,c=dom.req("#report-content").value;socket.send({svc:services.standup.key,cmd:command.client.addReport,param:{d:a,content:c}});return!1};a.onEditReport=function(){var a=
dom.req("#report-edit-date").value,c=dom.req("#report-edit-content").value;socket.send({svc:services.standup.key,cmd:command.client.updateReport,param:{id:standup.cache.activeReport,d:a,content:c}});return!1};a.onRemoveReport=function(){var a=standup.cache.activeReport;a&&UIkit.modal.confirm("Delete this report?").then(function(){socket.send({svc:services.standup.key,cmd:command.client.removeReport,param:a});modal.hide("report")});return!1};a.viewActiveReport=function(a){var b,e=system.cache.getProfile();
a&&(standup.cache.activeReport=a);(a=d())?(dom.setText("#report-title",date.toDateString(date.dateFromYMD(a.d))+" - "+(null===(b=member.getMember(a.userID))||void 0===b?void 0:b.name)),b=a.userID===e.userID,dom.setValue(dom.req("#report-edit-date"),b?a.d:""),contents.onContentDisplay("report",b,a.content,a.html),comment.setActive("report",a.id),comment.setCounts()):console.warn("no active report")};a.setReports=function(b){standup.cache.reports=b;dom.setContent("#report-detail",a.renderReports(b));
comment.setCounts();modal.hide("add-report")};a.getReportDates=function(a){return a.map(function(a){return a.d}).filter(function(a,b,d){return d.indexOf(a)===b}).sort().reverse().map(function(b){var c=a.filter(function(a){return a.d===b}).sort(function(a,b){return a.created>b.created?-1:1});return{d:b,reports:c}})};a.viewAddReport=function(){dom.setValue("#report-date",date.dateToYMD(new Date));var a=dom.setValue("#report-content","");dom.wireTextarea(a);setTimeout(function(){return a.focus()},250)};
a.viewReport=function(a){report.viewActiveReport(a);var b=dom.req("#report-edit-content");setTimeout(function(){dom.wireTextarea(b);b.focus()},250)}})(report||(report={}));
(function(a){a.renderReports=function(d){if(0===d.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-report');",type:"button"},"Add Report"));d=a.getReportDates(d);return JSX("ul",{class:"uk-list"},d.map(function(a){return JSX("li",{id:"report-date-"+a.d},JSX("h5",null,JSX("div",{class:"right uk-article-meta"},date.dow(date.dateFromYMD(a.d).getDay())),date.toDateString(date.dateFromYMD(a.d))),JSX("ul",null,a.reports.map(function(a){var b=system.cache.getProfile();
b=JSX("div",{id:"report-"+a.id,class:"report-detail section",onclick:"modal.open('report', '"+a.id+"');"},JSX("div",{class:"report-comments right"},comment.renderCount("report",a.id)),JSX("div",{class:"left"},JSX("a",{class:b.linkColor+"-fg section-link"},member.renderTitle(member.getMember(a.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"report-content"},"loading..."));0<a.html.length&&(dom.setHTML(dom.req(".report-content",b),a.html).style.display="block");return JSX("li",null,b)})))}))}})(report||
(report={}));var retro;
(function(a){function d(b){a.cache.detail=b;dom.setValue("#model-categories-input",b.categories.join(", "));dom.setOptions("#feedback-category",b.categories);dom.setOptions("#feedback-edit-category",b.categories);feedback.setFeedback(a.cache.feedback);session.setDetail(b)}a.cache=new function(){this.feedback=[]};a.onRetroMessage=function(b,c){switch(b){case command.server.error:rituals.onError(services.retro,c);break;case command.server.sessionJoined:session.onSessionJoin(c);d(c.session);feedback.setFeedback(c.feedback);
session.showWelcomeMessage(c.members.length);break;case command.server.sessionUpdate:d(c);break;case command.server.permissionsUpdate:system.setPermissions(c);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===c||void 0===c?void 0:c.id);session.setTeam(c);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===c||void 0===c?void 0:c.id);session.setSprint(c);break;case command.server.feedbackUpdate:feedback.onFeedbackUpdate(c);break;case command.server.feedbackRemove:feedback.onFeedbackRemoved(c);
break;default:console.warn("unhandled command ["+b+"] for retro")}};a.onSubmitRetroSession=function(){var a=dom.req("#model-title-input").value,c=dom.req("#model-categories-input").value,e=dom.req("#model-team-select select").value,d=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.retro.key,cmd:command.client.updateSession,param:{title:a,categories:c,teamID:e,sprintID:d,permissions:g}})}})(retro||(retro={}));var session;
(function(a){a.setDetail=function(a){var b,c=(null===(b=system.cache.session)||void 0===b?void 0:b.slug)||"invalid";system.cache.session=a;document.title=a.title;dom.setText("#model-title",a.title);dom.setValue("#model-title-input",a.title);b=dom.els("#navbar .uk-navbar-item");0<b.length&&(b[b.length-1].innerText=a.title);c!==a.slug&&(window.history.replaceState(null,"",document.location.href.replace(c,a.slug)),console.log("slugChanged!!!!!"));modal.hide("session")};a.onSessionJoin=function(a){system.cache.apply(a);
permission.setPerms();member.setMembers();comment.setCounts()};a.showWelcomeMessage=function(a){1===a&&setTimeout(function(){return modal.open("welcome")},300)};a.setSprint=function(a){modal.hide("session");var b=dom.req("#sprint-link-container");b.innerHTML="";a&&(b.appendChild(sprint.renderSprintLink(a)),dom.req("#sprint-warning-name").innerText=a.title)};a.setTeam=function(a){modal.hide("session");var b=dom.req("#team-link-container");b.innerHTML="";a&&b.appendChild(team.renderTeamLink(a))};a.onModalOpen=
function(a){var b=dom.setValue("#model-title-input",dom.req("#model-title").innerText);setTimeout(function(){return b.focus()},250);team.refreshTeams();sprint.refreshSprints()}})(session||(session={}));var socket;
(function(a){function d(){var a=document.location,b="ws";"https:"===a.protocol&&(b="wss");return b+("://"+a.host+"/s")}function b(a,b){system.cache.currentService=a;system.cache.currentID=b;system.cache.connectTime=Date.now();g=new WebSocket(d());g.onopen=function(){c({svc:a.key,cmd:command.client.connect,param:b})};g.onmessage=function(a){a=JSON.parse(a.data);e(a)};g.onerror=function(a){rituals.onError(services.system,a.type)};g.onclose=function(){f()}}function c(a){debug&&console.debug("out",a);
g.send(JSON.stringify(a))}function e(a){debug&&console.debug("in",a);switch(a.svc){case services.system.key:system.onSystemMessage(a.cmd,a.param);break;case services.team.key:team.onTeamMessage(a.cmd,a.param);break;case services.sprint.key:sprint.onSprintMessage(a.cmd,a.param);break;case services.estimate.key:estimate.onEstimateMessage(a.cmd,a.param);break;case services.standup.key:standup.onStandupMessage(a.cmd,a.param);break;case services.retro.key:retro.onRetroMessage(a.cmd,a.param);break;default:console.warn("unhandled message for service ["+
a.svc+"]")}}function f(){function a(a){debug&&console.info("socket closed, reconnecting in "+a+" seconds");setTimeout(function(){b(system.cache.currentService,system.cache.currentID)},1E3*a)}h||a(10)}var g,h=!1;a.setAppUnloading=function(){h=!0};a.socketConnect=b;a.send=c;a.onSocketMessage=e})(socket||(socket={}));var sprint;
(function(a){function d(b){a.cache.detail=b;var c=b.startDate?date.utcDate(b.startDate):void 0,e=b.endDate?date.utcDate(b.endDate):void 0;dom.setContent("#sprint-date-display",a.renderSprintDates(c,e));dom.setValue("#sprint-start-date-input",c?date.dateToYMD(c):"");dom.setValue("#sprint-end-date-input",e?date.dateToYMD(e):"");session.setDetail(b)}a.cache=new function(){};a.onSprintMessage=function(b,c){switch(b){case command.server.error:rituals.onError(services.sprint,c);break;case command.server.sessionJoined:session.onSessionJoin(c);
d(c.session);dom.setContent("#sprint-estimate-list",contents.renderContents(services.sprint,services.estimate,c.estimates));dom.setContent("#sprint-standup-list",contents.renderContents(services.sprint,services.standup,c.standups));dom.setContent("#sprint-retro-list",contents.renderContents(services.sprint,services.retro,c.retros));session.showWelcomeMessage(c.members.length);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===c||void 0===c?void 0:c.id);session.setTeam(c);
break;case command.server.sessionUpdate:d(c);break;case command.server.permissionsUpdate:system.setPermissions(c);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService,system.cache.currentID);break;default:console.warn("unhandled command ["+b+"] for sprint")}};a.onSubmitSprintSession=function(){var a,c,e=dom.req("#model-title-input").value,d=dom.req("#model-team-select select").value,g=null===(a=dom.opt("#sprint-start-date-input"))||void 0===a?void 0:a.value;a=null===
(c=dom.opt("#sprint-end-date-input"))||void 0===c?void 0:c.value;c=permission.readPermissions();socket.send({svc:services.sprint.key,cmd:command.client.updateSession,param:{title:e,startDate:g,endDate:a,teamID:d,permissions:c}})};a.refreshSprints=function(){dom.opt("#model-sprint-select")&&socket.send({svc:services.system.key,cmd:command.client.getSprints,param:null})};a.viewSprints=function(b){var c,e=dom.opt("#model-sprint-container");e&&(dom.setDisplay(e,0<b.length),dom.setContent("#model-sprint-select",
a.renderSprintSelect(b,null===(c=system.cache.session)||void 0===c?void 0:c.sprintID)),permission.setModelPerms("sprint"))}})(sprint||(sprint={}));
(function(a){a.renderSprintDates=function(a,b){function c(a,b){return JSX("span",null,a," ",JSX("span",{class:"sprint-date",onclick:"modal.open('session');"},b?date.toDateString(b):""))}var e=c("starts",a),d=c("ends",b);return a?b?JSX("span",null,e,", ",d):e:b?d:JSX("span",null,"Sprint")};a.renderSprintLink=function(a){var b=system.cache.getProfile();return JSX("span",null,JSX("a",{class:b.linkColor+"-fg",href:"/sprint/"+a.slug},a.title),"\u00a0")};a.renderSprintSelect=function(a,b){return JSX("select",
{class:"uk-select",onchange:"permission.setModelPerms('sprint')"},JSX("option",{value:""},"- no sprint -"),a.map(function(a){return a.id===b?JSX("option",{selected:"selected",value:a.id},a.title):JSX("option",{value:a.id},a.title)}))}})(sprint||(sprint={}));var standup;
(function(a){function d(b){return a.cache.reports.filter(function(a){return a.id!==b})}function b(b,e){report.setReports(b);e===a.cache.activeReport&&modal.hide("report")}a.cache=new function(){this.reports=[]};a.onStandupMessage=function(c,e){switch(c){case command.server.error:rituals.onError(services.standup,e);break;case command.server.sessionJoined:session.onSessionJoin(e);c=e.session;a.cache.detail=c;session.setDetail(c);report.setReports(e.reports);session.showWelcomeMessage(e.members.length);
break;case command.server.sessionUpdate:a.cache.detail=e;session.setDetail(e);break;case command.server.permissionsUpdate:system.setPermissions(e);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===e||void 0===e?void 0:e.id);session.setTeam(e);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===e||void 0===e?void 0:e.id);session.setSprint(e);break;case command.server.reportUpdate:c=d(e.id);c.push(e);b(c,e.id);break;case command.server.reportRemove:c=
d(e);b(c,e);notify.notify("report has been deleted",!0);break;default:console.warn("unhandled command ["+c+"] for standup")}};a.onSubmitStandupSession=function(){var a=dom.req("#model-title-input").value,b=dom.req("#model-team-select select").value,d=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.standup.key,cmd:command.client.updateSession,param:{title:a,teamID:b,sprintID:d,permissions:g}})}})(standup||(standup={}));var story;
(function(a){function d(a){function b(a,b){a.id.substr(a.id.lastIndexOf("-")+1)===b?a.classList.add("active"):a.classList.remove("active")}for(var c=$jscomp.makeIterator(dom.els(".story-status-body")),d=c.next();!d.done;d=c.next())b(d.value,a);c=$jscomp.makeIterator(dom.els(".story-status-actions"));for(d=c.next();!d.done;d=c.next())b(d.value,a);d="";switch(a){case "pending":d="Story";break;case "active":d="Voting";break;case "complete":d="Results"}dom.setText("#story-status",d);vote.viewVotes()}
function b(b,e,d,g){d&&"complete"===d.status&&0<d.finalVote.length&&(e=d.finalVote);dom.setContent("#story-"+b+" .story-status",a.renderStatus(e));g&&a.showTotalIfNeeded()}a.viewStoryStatus=d;a.requestStoryStatus=function(b){var c=a.getActiveStory();c&&socket.send({svc:services.estimate.key,cmd:command.client.setStoryStatus,param:{storyID:c.id,status:b}})};a.setStoryStatus=b;a.onStoryStatusChange=function(a){var c;estimate.cache.stories.forEach(function(b){b.id===a.storyID&&(c=b,b.finalVote=a.finalVote,
b.status=a.status)});b(a.storyID,a.status,c,!0);a.storyID===estimate.cache.activeStory&&d(a.status)}})(story||(story={}));
(function(a){function d(){if(estimate.cache.activeStory){var a=estimate.cache.stories.filter(function(a){return a.id===estimate.cache.activeStory}).shift();a||console.warn("cannot load active story ["+estimate.cache.activeStory+"]");return a}}function b(){var b=0;estimate.cache.stories.filter(function(a){return"complete"===a.status}).map(function(a){return a.finalVote}).filter(function(a){return 0<a.length}).map(function(a){return parseFloat(a)}).filter(function(a){return!isNaN(a)}).forEach(function(a){return b+=
a});var e=dom.opt("#story-total"),d=dom.req("#story-list");void 0!==e&&d.removeChild(e);0<b&&d.appendChild(a.renderTotal(b))}a.setStories=function(c){estimate.cache.stories=c;dom.setContent("#story-detail",a.renderStories(c));c.forEach(function(b){return a.setStoryStatus(b.id,b.status,b,!1)});b();comment.setCounts();modal.hide("add-story")};a.onSubmitStory=function(){var a=dom.req("#story-title-input").value;socket.send({svc:services.estimate.key,cmd:command.client.addStory,param:{title:a}});return!1};
a.beginEditStory=function(){var a=d(),b=prompt("Edit your story",a.title);if(null===b)return!1;b&&b!==a.title&&socket.send({svc:services.estimate.key,cmd:command.client.updateStory,param:{storyID:a.id,title:b}});return!1};a.onRemoveStory=function(){var a=estimate.cache.activeStory;a&&UIkit.modal.confirm("Delete this story?").then(function(){socket.send({svc:services.estimate.key,cmd:command.client.removeStory,param:a});modal.hide("story")});return!1};a.getActiveStory=d;a.viewActiveStory=function(b){b&&
(estimate.cache.activeStory=b);if(b=d())dom.setText("#story-title",b.title),a.viewStoryStatus(b.status),comment.setActive("story",b.id),comment.setCounts()};a.showTotalIfNeeded=b})(story||(story={}));
(function(a){a.renderStories=function(a){return 0===a.length?JSX("div",{id:"story-list"},JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-story');",type:"button"},"Add Story")):JSX("table",{class:"uk-table uk-table-divider uk-table-small"},JSX("ul",{id:"story-list",class:"uk-list uk-list-divider"},a.map(function(a){var b=system.cache.getProfile();return JSX("li",{id:"story-"+a.id,class:"section",onclick:"modal.open('story', '"+a.id+"');"},JSX("div",{class:"right uk-article-meta story-status"},
a.status),JSX("div",{class:b.linkColor+"-fg section-link left"},a.title),JSX("div",{class:"left",style:"margin-top: 4px;"},comment.renderCount("story",a.id)))})))};a.renderStatus=function(a){switch(a){case "pending":return JSX("span",null,a);case "active":return JSX("span",null,a);default:return JSX("span",{class:"vote-badge"},a)}};a.renderTotal=function(a){return JSX("li",{id:"story-total"},JSX("div",{class:"right uk-article-meta"},JSX("span",{class:"vote-badge"},a))," Total")};a.viewAddStory=function(){var a=
dom.setValue("#story-title-input","");setTimeout(function(){return a.focus()},250)}})(story||(story={}));var debug=!0,system;
(function(a){var d=function(){this.currentID="";this.connectTime=0};d.prototype.getProfile=function(){if(!this.profile)throw"no active profile";return this.profile};d.prototype.apply=function(b){a.cache.session=b.session;a.cache.profile=b.profile;auth.applyAuths(b.auths);permission.applyPermissions(b.permissions);member.applyMembers(b.members);member.applyOnline(b.online);comment.applyComments(b.comments);b.team&&session.setTeam(b.team);b.sprint&&session.setSprint(b.sprint)};a.cache=new d;a.setPermissions=
function(a){permission.applyPermissions(a);permission.setPerms()};a.setAuths=function(a){auth.applyAuths(a);permission.setPerms()};a.onSystemMessage=function(a,c){switch(a){case command.server.error:rituals.onError(services.system,c);break;case command.server.actions:action.viewActions(c);break;case command.server.teams:team.viewTeams(c);break;case command.server.sprints:sprint.viewSprints(c);break;case command.server.memberUpdate:member.onMemberUpdate(c);break;case command.server.onlineUpdate:member.onOnlineUpdate(c);
break;case command.server.commentUpdate:comment.onCommentUpdate(c);break;default:console.warn("unhandled system message for command ["+a+"]")}}})(system||(system={}));var team;
(function(a){a.cache=new function(){};a.onTeamMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.team,b);break;case command.server.sessionJoined:session.onSessionJoin(b);d=b.session;a.cache.detail=d;session.setDetail(d);dom.setContent("#team-sprint-list",contents.renderContents(services.team,services.sprint,b.sprints));dom.setContent("#team-estimate-list",contents.renderContents(services.team,services.estimate,b.estimates));dom.setContent("#team-standup-list",contents.renderContents(services.team,
services.standup,b.standups));dom.setContent("#team-retro-list",contents.renderContents(services.team,services.retro,b.retros));session.showWelcomeMessage(b.members.length);break;case command.server.sessionUpdate:a.cache.detail=b;session.setDetail(b);break;case command.server.permissionsUpdate:system.setPermissions(b);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService,system.cache.currentID);break;default:console.warn("unhandled command ["+d+"] for team")}};a.onSubmitTeamSession=
function(){var a=dom.req("#model-title-input").value,b=permission.readPermissions();socket.send({svc:services.team.key,cmd:command.client.updateSession,param:{title:a,permissions:b}})};a.refreshTeams=function(){dom.opt("#model-team-select")&&socket.send({svc:services.system.key,cmd:command.client.getTeams,param:null})};a.viewTeams=function(d){var b,c=dom.opt("#model-team-container");c&&(dom.setDisplay(c,0<d.length),dom.setContent("#model-team-select",a.renderTeamSelect(d,null===(b=system.cache.session)||
void 0===b?void 0:b.teamID)),permission.setModelPerms("team"))}})(team||(team={}));
(function(a){a.renderTeamLink=function(a){var b=system.cache.getProfile();return JSX("span",null," in ",JSX("a",{class:b.linkColor+"-fg",href:"/team/"+a.slug},a.title))};a.renderTeamSelect=function(a,b){return JSX("select",{class:"uk-select",onchange:"permission.setModelPerms('team')"},JSX("option",{value:""},"- no team -"),a.map(function(a){return a.id===b?JSX("option",{selected:"selected",value:a.id},a.title):JSX("option",{value:a.id},a.title)}))}})(team||(team={}));var profile;
(function(a){a.setNavColor=function(a,b){dom.setValue("#nav-color",b);dom.req("#navbar").className=b+"-bg uk-navbar-container uk-navbar";document.querySelectorAll(".nav_swatch").forEach(function(a){a.classList.remove("active")});a.classList.add("active")};a.setLinkColor=function(a,b){dom.setValue("#link-color",b);dom.els(".profile-link").forEach(function(a){a.classList.forEach(function(c){-1<c.indexOf("-fg")&&a.classList.remove(c);a.classList.add(b+"-fg")})});document.querySelectorAll(".link_swatch").forEach(function(a){a.classList.remove("active")});
a.classList.add("active")};a.setPicture=function(a){dom.setValue("#self-picture-input",a);return!1}})(profile||(profile={}));var collection;
(function(a){var d=function(a){this.members=[];this.key=a};a.Group=d;var b=function(){this.groups=[]};b.prototype.findOrInsert=function(a){var b=this.groups.find(function(b){return b.key===a});if(b)return b;b=new d(a);this.groups.push(b);return b};a.GroupSet=b;a.groupBy=function(a,e){var c=new b;a&&a.forEach(function(a){c.findOrInsert(e(a)).members.push(a)});return c};a.findGroup=function(a,b){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())if(c=c.value,c.key===b)return c.members;
return[]};a.flatten=function(a){var b=[];a.forEach(function(a){return b.push.apply(b,$jscomp.arrayFromIterable(a))});return b}})(collection||(collection={}));var date;
(function(a){function d(a){return a.toLocaleDateString()}function b(a){return a.toLocaleTimeString().slice(0,8)}a.dateToYMD=function(a){var b=a.getDate(),c=a.getMonth()+1;return a.getFullYear()+"-"+(9>=c?"0"+c:c)+"-"+(9>=b?"0"+b:b)};a.dateFromYMD=function(a){a=new Date(a);return new Date(a.getTime()+6E4*a.getTimezoneOffset())};a.dow=function(a){switch(a){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat";default:return"???"}};
a.toDateString=d;a.toTimeString=b;a.toDateTimeString=function(a){return d(a)+" "+b(a)};var c=6E4*(new Date).getTimezoneOffset();a.utcDate=function(a){return new Date(Date.parse(a)+c)}})(date||(date={}));var dom;
(function(a){function d(a,b){return UIkit.util.$$(a,b)}function b(a,b){b=d(a,b);switch(b.length){case 0:break;case 1:return b[0];default:console.warn("found ["+b.length+"] elements with selector ["+a+"], wanted zero or one")}}function c(a,c){(c=b(a,c))||console.warn("no element found for selector ["+a+"]");return c}a.initDom=function(a,b){try{style.themeLinks(b),style.setTheme(a)}catch(g){console.warn("error setting style",g)}document.body.style.visibility="visible";try{modal.wire()}catch(g){console.warn("error wiring modals",
g)}};a.els=d;a.opt=b;a.req=c;a.setHTML=function(a,b){"string"===typeof a&&(a=c(a));a.innerHTML=b;return a};a.setDisplay=function(a,b,d){d=void 0===d?"block":d;"string"===typeof a&&(a=c(a));a.style.display=b?d:"none";return a};a.setContent=function(a,b){"string"===typeof a&&(a=c(a));a.innerHTML="";a.appendChild(b);return a};a.setText=function(a,b){"string"===typeof a&&(a=c(a));a.innerText=b;return a}})(dom||(dom={}));
(function(a){a.setValue=function(d,b){"string"===typeof d&&(d=a.req(d));d.value=b;return d};a.wireTextarea=function(a){function b(){a.style.height="auto";a.style.height=(64>a.scrollHeight?64:a.scrollHeight+6)+"px"}function c(){window.setTimeout(b,0)}a.dataset.autoresize||(a.dataset.autoresize="true",a.addEventListener("change",b,!1),a.addEventListener("cut",c,!1),a.addEventListener("paste",c,!1),a.addEventListener("drop",c,!1),a.addEventListener("keydown",c,!1),a.focus(),a.select());b()};a.setOptions=
function(d,b){"string"===typeof d&&(d=a.req(d));d.innerHTML="";b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=c.value;var e=document.createElement("option");e.value=c;e.innerText=c;d.appendChild(e)}};a.setSelectOption=function(d,b){"string"===typeof d&&(d=a.req(d));for(var c=0;c<d.children.length;c++){var e=d.children.item(c);e.selected=e.value===b}};a.insertAtCaret=function(a,b){if(a.selectionStart||0===a.selectionStart){var c=a.selectionStart,d=a.selectionEnd;a.value=a.value.substring(0,
c)+b+a.value.substring(d,a.value.length);a.selectionStart=c+b.length;a.selectionEnd=c+b.length}else a.value+=b}})(dom||(dom={}));
function JSX(a,d){var b=document.createElement(a),c;for(c in d)if(c&&d.hasOwnProperty(c)){var e=d[c];"dangerouslySetInnerHTML"===c?b.innerHTML=e.__html:!0===e?b.setAttribute(c,c):!1!==e&&null!==e&&void 0!==e&&b.setAttribute(c,e.toString())}for(c=2;c<arguments.length;c++)if(e=arguments[c],Array.isArray(e))e.forEach(function(a){b.appendChild(a)});else{if(void 0===e||null===e)throw"child for tag ["+a+"] is "+e;e.nodeType||(e=document.createTextNode(e.toString()));b.appendChild(e)}return b}var modal;
(function(a){function d(a,b,c){b||(b=function(){});f.set(a,b);c&&g.set(a,c)}function b(a,b){h=b;(b=UIkit.modal("#modal-"+a))||console.warn("no modal available with key ["+a+"]");b.show();return!1}function c(a){if(a.target){a=a.target.id.substr(6);var b=f.get(a);b?b(h):console.warn("no modal open handler registered for ["+a+"]");h=void 0}}function e(a){a.target&&(a=a.target,a.classList.contains("uk-open")&&(a=a.id.substr(6),(a=g.get(a))&&a(h),h=void 0))}var f=new Map,g=new Map,h;a.register=d;a.wire=
function(){UIkit.util.on(".modal","show",c);UIkit.util.on(".modal","hide",e);d("welcome");d("session",session.onModalOpen);d("action",action.loadActions);d("comment",comment.load,comment.closeModal);d("self",member.viewSelf);d("invitation");d("member",member.viewActiveMember);d("add-story",story.viewAddStory);d("story",story.viewActiveStory);d("add-report",report.viewAddReport);d("report",report.viewReport);d("add-feedback",feedback.viewAddFeedback);d("feedback",feedback.viewFeedback)};a.open=b;a.openSoon=
function(a){setTimeout(function(){return b(a)},0)};a.hide=function(a){a=UIkit.modal("#modal-"+a);a.$el.classList.contains("uk-open")&&a.hide()}})(modal||(modal={}));var notify;(function(a){a.notify=function(a,b){UIkit.notification(a,{status:b?"success":"danger",pos:"top-right"})}})(notify||(notify={}));var style;
(function(a){function d(a){b(a);var c=dom.els(".uk-card");switch(a){case "default":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?d("dark"):d("light");break;case "light":document.documentElement.classList.remove("uk-light");document.body.classList.remove("uk-light");document.documentElement.classList.add("uk-dark");document.body.classList.add("uk-dark");c.forEach(function(a){a.classList.add("uk-card-default");a.classList.remove("uk-card-secondary")});break;case "dark":document.documentElement.classList.add("uk-light");
document.body.classList.add("uk-light");document.documentElement.classList.remove("uk-dark");document.body.classList.remove("uk-dark");c.forEach(function(a){a.classList.remove("uk-card-default");a.classList.add("uk-card-secondary")});break;default:console.warn("invalid theme")}}function b(a){if("undefined"===typeof EmojiButton)dom.els(".picker-toggle").forEach(function(a){return dom.setDisplay(a,!1)});else{"default"===a&&(a="auto");var b={position:"bottom-end",theme:a,zIndex:1011};dom.els(".textarea-emoji").forEach(function(a){var c=
dom.req(".picker-toggle",a);c.addEventListener("click",function(){var d=dom.req(".uk-textarea",a),e=new EmojiButton(b);e.on("emoji",function(a){dom.insertAtCaret(d,a)});e.togglePicker(c)},!1)})}}a.setTheme=d;a.themeLinks=function(a){dom.els(".theme").forEach(function(b){b.classList.add(a+"-fg")})}})(style||(style={}));var vote;
(function(a){function d(){var b=story.getActiveStory();if(b){var c=estimate.cache.activeVotes(),d=c.filter(function(a){return a.userID===system.cache.getProfile().userID}).pop();switch(b.status){case "pending":b=system.cache.getProfile().userID===b.userID;dom.setDisplay("#story-edit-section",b);dom.setDisplay("#story-view-section",!b);break;case "active":dom.setContent("#story-vote-members",a.renderVoteMembers(member.getMembers(),c));dom.setContent("#story-vote-choices",a.renderVoteChoices(estimate.cache.detail.choices,
null===d||void 0===d?void 0:d.choice));break;case "complete":dom.setContent("#story-vote-results",a.renderVoteResults(member.getMembers(),c));dom.setContent("#story-vote-summary",a.renderVoteSummary(c));break;default:console.warn("invalid story status ["+b.status+"]")}}}a.setVotes=function(a){estimate.cache.votes=a;d()};a.onVoteUpdate=function(a){var b=estimate.cache.votes;b=b.filter(function(a){return a.userID!==a.userID||a.storyID!==a.storyID});b.push(a);estimate.cache.votes=b;a.storyID===estimate.cache.activeStory&&
d()};a.viewVotes=d;a.onSubmitVote=function(a){socket.send({svc:services.estimate.key,cmd:command.client.submitVote,param:{storyID:estimate.cache.activeStory,choice:a}})};a.getVoteResults=function(a){a=a.map(function(a){a=parseFloat(a.choice);return isNaN(a)?-1:a}).filter(function(a){return-1!==a}).sort();var b=a.length,d=Math.min.apply(Math,$jscomp.arrayFromIterable(a)),f=Math.max.apply(Math,$jscomp.arrayFromIterable(a)),g=a.reduce(function(a,b){return a+b},0),h=a.reduce(function(a,b){var c=a.numMapping[b]=
(a.numMapping[b]||0)+1;c>a.greatestFreq&&(a.greatestFreq=c,a.mode=b);return a},{mode:null,greatestFreq:-Infinity,numMapping:{}}).mode;return{count:b,min:d,max:f,sum:g,mean:0===b?0:g/b,median:0===b?0:a[Math.floor(a.length/2)],mode:0===b?0:h}}})(vote||(vote={}));
(function(a){function d(a,b){return JSX("div",{class:"vote-member",title:a.name+" has "+(b?"voted":"not voted")},JSX("div",null,JSX("span",{"data-uk-icon":"icon: "+(b?"check":"minus")+"; ratio: 1.6"})),a.name)}function b(a,b){return b?JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},b))," ",a.name):JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},JSX("span",{"data-uk-icon":"icon: minus; ratio: 1.6"})))," ",a.name)}a.renderVoteMembers=
function(a,b){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},a.map(function(a){return d(a,0<b.filter(function(b){return b.userID===a.userID}).length)}))};a.renderVoteChoices=function(a,b){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center"},a.map(function(a){return JSX("div",{class:"vote-choice uk-border-circle uk-box-shadow-hover-medium"+(a===b?" active "+system.cache.getProfile().linkColor+"-border":""),onclick:"vote.onSubmitVote('"+a+"');"},a)}))};a.renderVoteResults=
function(a,d){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},a.map(function(a){var c=d.filter(function(b){return b.userID===a.userID});return b(a,0<c.length?c[0].choice:void 0)}))};a.renderVoteSummary=function(b){function c(a){return a.toString().substr(0,4)}var d=a.getVoteResults(b);return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center result-container"},JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(d.count)," / ",c(b.length))," ",JSX("div",null,
"votes counted")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(d.min),"-",c(d.max))," ",JSX("div",null,"vote range")),JSX("div",{class:"result mean-result"},JSX("div",{class:"mean uk-border-circle "+system.cache.getProfile().linkColor+"-border"},c(d.mean))," ",JSX("div",null,"average")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(d.median))," ",JSX("div",null,"median")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},
c(d.mode))," ",JSX("div",null,"mode")))}})(vote||(vote={}));
