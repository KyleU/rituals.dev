var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,f){a.raw=f;return a};$jscomp.arrayIteratorImpl=function(a){var f=0;return function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var f="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return f?f.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var f,d=[];!(f=a.next()).done;)d.push(f.value);return d};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,f,d){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var e=a[c];if(f.call(d,e,c,a))return{i:c,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,d){if(a==Array.prototype||a==Object.prototype)return a;a[f]=d.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<a.length;++f){var d=a[f];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,f){var d=$jscomp.propertyToPolyfillSymbol[f];if(null==d)return a[f];d=a[d];return void 0!==d?d:a[f]};$jscomp.polyfill=function(a,f,d,b){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,f,d,b):$jscomp.polyfillUnisolated(a,f,d,b))};
$jscomp.polyfillUnisolated=function(a,f,d,b){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];if(!(c in d))return;d=d[c]}a=a[a.length-1];b=d[a];f=f(b);f!=b&&null!=f&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(a,f,d,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<c.length-1;e++){var g=c[e];if(!(g in b))return;b=b[g]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?b[c]:null;f=f(d);null!=f&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:f}):f!==d&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=
$jscomp.propertyToPolyfillSymbol[c],$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(f,d){return $jscomp.findInternal(this,f,d).v}},"es6","es3");
$jscomp.checkStringArgs=function(a,f,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(f,d){var b=$jscomp.checkStringArgs(this,f,"endsWith");f+="";void 0===d&&(d=b.length);d=Math.max(0,Math.min(d|0,b.length));for(var c=f.length;0<c&&0<d;)if(b[--d]!=f[--c])return!1;return 0>=c}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(f,d){var b=$jscomp.checkStringArgs(this,f,"startsWith");f+="";var c=b.length,e=f.length;d=Math.max(0,Math.min(d|0,b.length));for(var g=0;g<e&&d<c;)if(b[d++]!=f[g++])return!1;return g>=e}},"es6","es3");var rituals;
(function(a){function f(c,e){console.error(c+": "+e);var g=e.lastIndexOf(":");-1<g&&(e=e.substr(g+1));notify.notify(c+" error: "+e,!1)}function d(c){debug&&console.debug("in",c);switch(c.svc){case services.system.key:system.onSystemMessage(c.cmd,c.param);break;case services.team.key:team.onTeamMessage(c.cmd,c.param);break;case services.sprint.key:sprint.onSprintMessage(c.cmd,c.param);break;case services.estimate.key:estimate.onEstimateMessage(c.cmd,c.param);break;case services.standup.key:standup.onStandupMessage(c.cmd,
c.param);break;case services.retro.key:retro.onRetroMessage(c.cmd,c.param);break;default:console.warn("unhandled message for service ["+c.svc+"]")}}function b(c){system.cache.currentID=c;socket.send({svc:socket.currentService,cmd:command.client.connect,param:system.cache.currentID})}a.onError=f;a.init=function(c,e){window.onbeforeunload=function(){socket.setAppUnloading()};log.init();socket.init(b,d,f);socket.socketConnect(c,e)}})(rituals||(rituals={}));var action;
(function(a){a.loadActions=function(){socket.send({svc:services.system.key,cmd:command.client.getActions,param:null})};a.viewActions=function(f){dom.setContent("#action-list",a.renderActions(f))}})(action||(action={}));
(function(a){a.renderActions=function(f){return 0===f.length?JSX("div",null,"No actions available"):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("thead",null,JSX("tr",null,JSX("th",null,"User"),JSX("th",null,"Act"),JSX("th",null,"Content"),JSX("th",null,"Note"),JSX("th",null,"Created"))),JSX("tbody",null,f.map(function(d){var b=JSON.stringify(d.content,null,2);return JSX("tr",null,JSX("td",null,member.renderTitle(member.getMember(d.userID))),JSX("td",null,d.act),JSX("td",null,
"null"===b?"":JSX("pre",null,b)),JSX("td",null,d.note),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(d.created))))})))}})(action||(action={}));var auth;(function(a){a.allProviders=[{key:"github",title:"GitHub"},{key:"google",title:"Google"},{key:"slack",title:"Slack"},{key:"facebook",title:"Facebook"},{key:"amazon",title:"Amazon"},{key:"microsoft",title:"Microsoft"}];var f=[];a.applyAuths=function(d){f=d};a.active=function(){return f?f:[]}})(auth||(auth={}));var comment;
(function(a){function f(k,l){k&&"modal"!==k||(k=g,l||(l=h));"root"===k&&(k="");return l?e.filter(function(m){return m.targetType===k&&m.targetID==l}):e.filter(function(m){return m.targetType===k})}function d(k,l){k&&"modal"!==k||(k=g,l||(l=h));if(k){if(g=k,h=l,l=f(k,l),"root"!==k&&(k="modal"),dom.setContent("#drop-comment-"+k+" .uk-card-body",a.renderComments(l,system.cache.getProfile())),k=dom.opt("#drop-comment-"+k+" .uk-comment-list"))k.scrollTop=k.scrollHeight}else console.warn("invalid comment type ["+
k+"]")}function b(){var k=dom.els(".comment-count-container"),l=!1,m=dom.opt("#comment-count-modal");k.forEach(function(q){var p=q.dataset.commentType,n=q.dataset.commentId;if(!p)throw"invalid comment type ["+p+"] with id ["+n+"]";n=f(p,n);c(p,n,q);g===p&&m&&(c(p,n,m),l=!0)});!l&&m&&c("modal",[],m,!0)}function c(k,l,m,q){dom.setText(dom.req(".text",m),l.length.toString());"root"!==k&&"modal"!==k&&0!==k.length&&dom.setDisplay(m,0!==l.length||!0===q)}var e=[],g,h;a.applyComments=function(k){e=k};a.setActive=
function(k,l){g=k;h=l};a.show=function(k){modal.open("comment",k)};a.add=function(k){k=dom.req("#comment-add-content-"+k);var l=k.value.trim();0===l.length?notify.notify("enter some content",!0):(k.value="",socket.send({svc:services.system.key,cmd:command.client.addComment,param:{targetType:g,targetID:h,content:l}}))};a.onCommentUpdate=function(k){e.push(k);b();d()};a.load=d;a.setCounts=b;a.closeDrop=function(){"story"===g?modal.openSoon("story"):"report"===g?modal.openSoon("report"):"feedback"===
g&&modal.openSoon("feedback");g=void 0};a.remove=function(k){confirm("remove this comment?")&&socket.send({svc:services.system.key,cmd:command.client.removeComment,param:k});return!1};a.onCommentRemoved=function(k){e=e.filter(function(l){return l.id!==k});b();d()}})(comment||(comment={}));
(function(a){a.renderComments=function(f,d){return 0===f.length?JSX("p",{class:"uk-margin-bottom"},"No comments yet, why not add one?"):JSX("ul",{class:"uk-comment-list"},f.map(function(b){var c=b.userID===d.userID?JSX("div",{class:"right"},JSX("a",{class:d.linkColor+"-fg uk-margin-small-right","data-uk-icon":"close",href:"",onclick:"return comment.remove('"+b.id+"');",title:"remove your comment"})):JSX("span",null);return JSX("li",null,JSX("article",{class:"uk-comment uk-visible-toggle uk-transition-toggle",
tabindex:"-1"},member.renderHeader(member.getMember(b.userID),b.created,c),JSX("div",{class:"uk-comment-body"},JSX("div",{dangerouslySetInnerHTML:{__html:b.html}})),JSX("hr",null)))}))};a.renderCount=function(f,d){var b=system.cache.getProfile();return JSX("div",{class:"comment-count-container uk-margin-small-left left hidden","data-comment-type":f,"data-comment-id":d},JSX("a",{class:b.linkColor+"-fg",title:"view comments"},JSX("div",{class:"comment-count"},JSX("span",{class:"uk-icon","data-uk-icon":"comment"}),
JSX("span",{class:"text"}))))}})(comment||(comment={}));var contents;(function(a){a.onContentDisplay=function(f,d,b,c){dom.setDisplay("#modal-"+f+" .content-edit",d);dom.setDisplay("#modal-"+f+" .buttons-edit",d);var e=dom.setDisplay("#modal-"+f+" .content-view",!d);dom.setHTML(e,d?"":c);dom.setDisplay("#modal-"+f+" .buttons-view",!d);f=dom.req("#"+f+"-edit-content");dom.setValue(f,d?b:"");d&&dom.wireTextarea(f)}})(contents||(contents={}));
(function(a){function f(d,b){return b.map(function(c){return{svc:d,session:c}})}a.renderContents=function(d,b,c){c=f(b,c);c.sort(function(e,g){return e.session.created>g.session.created?-1:1});return 0===c.length?JSX("div",null,"No "+b.plural+" in this "+d.key):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("tbody",null,c.map(function(e){var g=e.svc;e=e.session;var h=system.cache.getProfile();return JSX("tr",null,JSX("td",null,JSX("a",{class:h.linkColor+"-fg",href:"/"+g.key+"/"+
e.slug},e.title)),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(e.created))))})))}})(contents||(contents={}));var dom;
(function(a){function f(e,g){var h=[];(g?g.querySelectorAll(e):document.querySelectorAll(e)).forEach(function(k){h.push(k)});return h}function d(e,g){g=f(e,g);switch(g.length){case 0:break;case 1:return g[0];default:console.warn("found ["+g.length+"] elements with selector ["+e+"], wanted zero or one")}}function b(e,g){(g=d(e,g))||console.warn("no element found for selector ["+e+"]");return g}function c(e,g){"string"===typeof e&&(e=b(e));e.innerHTML=g;return e}a.initDom=function(e,g){try{style.themeLinks(g),
style.setTheme(e)}catch(h){console.warn("error setting style",h)}try{modal.wire()}catch(h){console.warn("error wiring modals",h)}try{drop.wire()}catch(h){console.warn("error wiring drops",h)}try{tags.wire()}catch(h){console.warn("error wiring tag editors",h)}try{flash.wire()}catch(h){console.warn("error wiring tag editors",h)}};a.els=f;a.opt=d;a.req=b;a.setHTML=c;a.setDisplay=function(e,g,h){h=void 0===h?"block":h;"string"===typeof e&&(e=b(e));e.style.display=g?h:"none";return e};a.setContent=function(e,
g){"string"===typeof e&&(e=b(e));a.clear(e);Array.isArray(g)?g.forEach(function(h){return e.appendChild(h)}):e.appendChild(g);return e};a.setText=function(e,g){"string"===typeof e&&(e=b(e));e.innerText=g;return e};a.clear=function(e){return c(e,"")}})(dom||(dom={}));
(function(a){a.setValue=function(f,d){"string"===typeof f&&(f=a.req(f));f.value=d;return f};a.wireTextarea=function(f){function d(){f.style.height="auto";f.style.height=(64>f.scrollHeight?64:f.scrollHeight+6)+"px"}function b(){window.setTimeout(d,0)}f.dataset.autoresize||(f.dataset.autoresize="true",f.addEventListener("change",d,!1),f.addEventListener("cut",b,!1),f.addEventListener("paste",b,!1),f.addEventListener("drop",b,!1),f.addEventListener("keydown",b,!1),f.focus(),f.select());d()};a.setOptions=
function(f,d){"string"===typeof f&&(f=a.req(f));a.clear(f);d.forEach(function(b){var c=document.createElement("option");c.value=b;a.setText(c,b);f.appendChild(c)})};a.setSelectOption=function(f,d){"string"===typeof f&&(f=a.req(f));for(var b=0;b<f.children.length;b++){var c=f.children.item(b);c.selected=c.value===d}};a.insertAtCaret=function(f,d){if(f.selectionStart||0===f.selectionStart){var b=f.selectionStart,c=f.selectionEnd;a.setValue(f,f.value.substring(0,b)+d+f.value.substring(c,f.value.length));
f.selectionStart=b+d.length;f.selectionEnd=b+d.length}else f.value+=d}})(dom||(dom={}));
function JSX(a,f){var d=document.createElement(a);for(c in f)if(c&&f.hasOwnProperty(c)){var b=f[c];"dangerouslySetInnerHTML"===c?dom.setHTML(d,b.__html):!0===b?d.setAttribute(c,c):!1!==b&&null!==b&&void 0!==b&&d.setAttribute(c,b.toString())}var c={};for(b=2;b<arguments.length;c={$jscomp$loop$prop$child$8:c.$jscomp$loop$prop$child$8},b++)if(c.$jscomp$loop$prop$child$8=arguments[b],Array.isArray(c.$jscomp$loop$prop$child$8))c.$jscomp$loop$prop$child$8.forEach(function(e){return function(g){if(void 0===e.$jscomp$loop$prop$child$8||
null===e.$jscomp$loop$prop$child$8)throw"child array for tag ["+a+"] is "+e.$jscomp$loop$prop$child$8+"\n"+d.outerHTML;if(void 0===g||null===g)throw"child for tag ["+a+"] is "+g+"\n"+d.outerHTML;"string"===typeof g&&(g=document.createTextNode(g));d.appendChild(g)}}(c));else{if(void 0===c.$jscomp$loop$prop$child$8||null===c.$jscomp$loop$prop$child$8)throw"child for tag ["+a+"] is "+c.$jscomp$loop$prop$child$8+"\n"+d.outerHTML;c.$jscomp$loop$prop$child$8.nodeType||(c.$jscomp$loop$prop$child$8=document.createTextNode(c.$jscomp$loop$prop$child$8.toString()));
d.appendChild(c.$jscomp$loop$prop$child$8)}return d}var style;
(function(a){function f(b){d(b);switch(b){case "auto":b="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(b="dark");f(b);fetch("/profile/theme/"+b).then(function(c){return c.text()}).then(function(){});break;case "light":document.documentElement.classList.remove("uk-light");document.body.classList.remove("uk-light");document.documentElement.classList.add("uk-dark");document.body.classList.add("uk-dark");break;case "dark":document.documentElement.classList.add("uk-light");
document.body.classList.add("uk-light");document.documentElement.classList.remove("uk-dark");document.body.classList.remove("uk-dark");break;default:console.warn("invalid theme")}}function d(b){if("undefined"===typeof EmojiButton)dom.els(".picker-toggle").forEach(function(e){return dom.setDisplay(e,!1)});else{var c={position:"bottom-end",theme:b,zIndex:1021};dom.els(".textarea-emoji").forEach(function(e){var g=dom.req(".picker-toggle",e);g.addEventListener("click",function(){var h=dom.req(".uk-textarea",
e),k=new EmojiButton(c);k.on("emoji",function(l){drop.onEmojiPicked();dom.insertAtCaret(h,l)});k.togglePicker(g)},!1)})}}a.setTheme=f;a.linkColor="";a.themeLinks=function(b){a.linkColor=b+"-fg";dom.els(".theme").forEach(function(c){c.classList.add(a.linkColor)})}})(style||(style={}));var estimate;
(function(a){function f(g){a.cache.detail=g;var h=g.choices.join(", ");dom.setValue("#model-choices-input",h);dom.setContent("#session-view-section .choices",tags.renderTagsView(g.choices));story.viewActiveStory();session.setDetail(g)}function d(g){var h=c(g.id);h.push(g);h.sort(function(k){return k.idx});g.id===a.cache.activeStory&&dom.setText("#story-title",g.title);story.setStories(h)}function b(g){var h=c(g);story.setStories(h);g===a.cache.activeStory&&modal.hide("story");notify.notify("story has been deleted",
!0)}function c(g){return a.cache.stories.filter(function(h){return h.id!==g})}var e=function(){this.stories=[];this.votes=[]};e.prototype.activeVotes=function(){var g=this;return this.activeStory?this.votes.filter(function(h){return h.storyID===g.activeStory}):[]};a.cache=new e;a.onEstimateMessage=function(g,h){switch(g){case command.server.error:rituals.onError(services.estimate.key,h);break;case command.server.sessionJoined:session.onSessionJoin(h);f(h.session);story.setStories(h.stories);vote.setVotes(h.votes);
session.showWelcomeMessage(h.session.status,h.members.length);break;case command.server.sessionUpdate:f(h);break;case command.server.sessionRemove:system.onSessionRemove(services.estimate);break;case command.server.permissionsUpdate:system.setPermissions(h);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===h||void 0===h?void 0:h.id);session.setTeam(h);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===h||void 0===h?void 0:h.id);
session.setSprint(h);break;case command.server.storyUpdate:d(h);break;case command.server.storyRemove:b(h);break;case command.server.storyStatusChange:story.onStoryStatusChange(h);break;case command.server.voteUpdate:vote.onVoteUpdate(h);break;default:console.warn("unhandled command ["+g+"] for estimate")}};a.onSubmitEstimateSession=function(){var g=dom.req("#model-title-input").value,h=dom.req("#model-choices-input").value,k=dom.req("#model-team-select select").value,l=dom.req("#model-sprint-select select").value,
m=permission.readPermissions();socket.send({svc:services.estimate.key,cmd:command.client.updateSession,param:{title:g,choices:h,teamID:k,sprintID:l,permissions:m}})};a.onStoryUpdate=d;a.onStoryRemove=b})(estimate||(estimate={}));var drop;
(function(a){function f(e){if(e.target){var g=e.target;e=g.dataset.key||"";g=g.dataset.t||"";var h=events.getOpenEvent(e);h?h(g):console.warn("no drop open handler registered for ["+e+"]")}}function d(e){if(e.target){var g=e.target;g.classList.contains("uk-open")&&(e=g.dataset.t||"",(g=events.getCloseEvent(g.dataset.key||""))&&g(e))}}function b(e){c&&e.preventDefault()}a.wire=function(){dom.els(".drop").forEach(function(e){e.addEventListener("show",f);e.addEventListener("beforehide",b);e.addEventListener("hide",
d)})};var c=!1;a.onEmojiPicked=function(){c=!0;setTimeout(function(){return c=!1},200)}})(drop||(drop={}));var events;(function(a){var f,d;a.register=function(b,c,e){f||(f=new map.Map);d||(d=new map.Map);c||(c=function(){});f.set(b,c);e&&d.set(b,e)};a.getOpenEvent=function(b){return f.get(b)};a.getCloseEvent=function(b){return d.get(b)}})(events||(events={}));var flash;
(function(a){function f(){var b=!1;dom.els(".alert-top").forEach(function(c){b=!0;c.classList.add("uk-animation-fade","uk-animation-reverse")});b&&setTimeout(d,1E3)}function d(){dom.els(".alert-top").forEach(function(b){b.remove()})}a.wire=function(){setTimeout(f,4E3)}})(flash||(flash={}));var modal;
(function(a){function f(e,g){c=g;notify.modal("#modal-"+e).show();return!1}function d(e){if(e.target&&(e=e.target,0===e.id.indexOf("modal"))){e=e.id.substr(6);var g=events.getOpenEvent(e);g?g(c):console.warn("no modal open handler registered for ["+e+"]");c=void 0}}function b(e){e.target&&(e=e.target,e.classList.contains("uk-open")&&(e=e.id.substr(6),(e=events.getCloseEvent(e))&&e(c),c=void 0))}var c;a.wire=function(){dom.els(".modal").forEach(function(e){e.addEventListener("show",d);e.addEventListener("hide",
b)})};a.open=f;a.openSoon=function(e){setTimeout(function(){return f(e)},0)};a.hide=function(e){e=notify.modal("#modal-"+e);e.$el.classList.contains("uk-open")&&e.hide()}})(modal||(modal={}));var tags;
(function(a){function f(c){var e=dom.req(".value",c),g=dom.req(".editor",c);dom.setDisplay(e,!1);dom.setDisplay(g,!0);var h=a.renderInput(e.innerText);h.onblur=function(){e.innerText=h.value;dom.setDisplay(e,!0);dom.setDisplay(g,!1);b(c.parentElement)};h.onkeypress=function(k){return"Enter"===k.key?(h.blur(),!1):!0};dom.setContent(g,h);h.focus()}function d(c){c.target?b(c.target):console.warn("no event target")}function b(c){var e=c.dataset.key||"",g=events.getOpenEvent(e);g?g():console.warn("no tag open handler registered for ["+
e+"]");c=dom.els(".item",c).map(function(h){return h.innerText});dom.setValue("#model-"+e+"-input",c.join(","))}a.wire=function(){dom.els(".tag-editor").forEach(function(c){c.addEventListener("moved",d);c.addEventListener("added",d);c.addEventListener("removed",d)})};a.removeTag=function(c){c=c.parentElement;var e=c.parentElement;c.remove();b(e)};a.addTag=function(c){if(c=c.parentElement){var e=a.renderItem();c.insertBefore(e,dom.req(".add-item",c));f(e)}};a.editTag=f})(tags||(tags={}));
(function(a){a.renderInput=function(f){return JSX("input",{type:"text",class:"uk-input",value:f})};a.renderItem=function(){return JSX("span",{class:"item"},JSX("span",{class:"value",onclick:"tags.editTag(this.parentElement);"}),JSX("span",{class:"editor"}),JSX("span",{class:"close","data-uk-icon":"icon: close; ratio: 0.6;",onclick:"tags.removeTag(this);"}))};a.renderTagsView=function(f){return JSX("div",{class:"tag-view"},f.map(function(d){return JSX("span",{class:"item"},d)}),JSX("div",{class:"clear"}))}})(tags||
(tags={}));var feedback;
(function(a){function f(){if(retro.cache.activeFeedback){var c=retro.cache.feedback.filter(function(e){return e.id===retro.cache.activeFeedback}).shift();c||console.warn("cannot load active Feedback ["+retro.cache.activeFeedback+"]");return c}}function d(c){return retro.cache.feedback.filter(function(e){return e.id!==c})}function b(c,e){feedback.setFeedback(c);e===retro.cache.activeFeedback&&modal.hide("feedback")}a.setFeedback=function(c){retro.cache.feedback=c;dom.setContent("#feedback-detail",a.renderFeedbackArray(c));
comment.setCounts();modal.hide("add-feedback")};a.onSubmitFeedback=function(){var c=dom.req("#feedback-category").value,e=dom.req("#feedback-content").value;socket.send({svc:services.retro.key,cmd:command.client.addFeedback,param:{category:c,content:e}});return!1};a.onEditFeedback=function(){var c=retro.cache.activeFeedback,e=dom.req("#feedback-edit-category").value,g=dom.req("#feedback-edit-content").value;socket.send({svc:services.retro.key,cmd:command.client.updateFeedback,param:{id:c,category:e,
content:g}});return!1};a.onRemoveFeedback=function(){var c=retro.cache.activeFeedback;c&&notify.confirm("Delete this feedback?",function(){socket.send({svc:services.retro.key,cmd:command.client.removeFeedback,param:c});modal.hide("feedback")});return!1};a.getActiveFeedback=f;a.viewActiveFeedback=function(c){var e,g=system.cache.getProfile();c&&(retro.cache.activeFeedback=c);(c=f())?(g=c.userID===g.userID,dom.setText("#feedback-title",c.category+" / "+(null===(e=member.getMember(c.userID))||void 0===
e?void 0:e.name)),dom.setSelectOption("#feedback-edit-category",g?c.category:void 0),contents.onContentDisplay("feedback",g,c.content,c.html),comment.setActive("feedback",c.id),comment.setCounts()):console.warn("no active feedback")};a.onFeedbackUpdate=function(c){var e=d(c.id);e.push(c);b(e,c.id)};a.onFeedbackRemoved=function(c){var e=d(c);b(e,c);notify.notify("feedback has been deleted",!0)};a.getFeedbackCategories=function(c,e){var g=e.map(function(k){var l=c.filter(function(m){return m.category===
k}).sort(function(m,q){return m.created>q.created?-1:1});return{category:k,feedback:l}}),h=c.filter(function(k){return!e.find(function(l){return l===k.category})});0<h.length&&g.push({category:"unknown",feedback:h});return g};a.viewAddFeedback=function(c){dom.setSelectOption("#feedback-category",c);var e=dom.setValue("#feedback-content","");dom.wireTextarea(e);setTimeout(function(){return e.focus()},250)};a.viewFeedback=function(c){feedback.viewActiveFeedback(c);var e=dom.req("#feedback-edit-content");
setTimeout(function(){dom.wireTextarea(e);e.focus()},250)}})(feedback||(feedback={}));
(function(a){a.renderFeedbackArray=function(f){var d;if(0===f.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-feedback');",type:"button"},"Add Feedback"));f=a.getFeedbackCategories(f,(null===(d=retro.cache.detail)||void 0===d?void 0:d.categories)||[]);var b=system.cache.getProfile();return JSX("div",{class:"uk-grid-small uk-grid-match uk-child-width-expand@m uk-grid-divider","data-uk-grid":!0},f.map(function(c){return JSX("div",{class:"feedback-list uk-transition-toggle"},
JSX("div",{class:"feedback-category-header"},JSX("span",{class:"right"},JSX("a",{class:b.linkColor+"-fg uk-icon-button uk-transition-fade","data-uk-icon":"plus",onclick:"modal.open('add-feedback', '"+c.category+"');",title:"add feedback"})),JSX("span",{class:"feedback-category-title",onclick:"modal.open('add-feedback', '"+c.category+"');"},c.category)),JSX("div",null,c.feedback.map(function(e){var g=system.cache.getProfile();g=JSX("div",{id:"feedback-"+e.id,class:"feedback-detail section",onclick:"modal.open('feedback', '"+
e.id+"');"},JSX("div",{class:"feedback-comments right"},comment.renderCount("feedback",e.id)),JSX("div",{class:"left"},JSX("a",{class:g.linkColor+"-fg section-link"},member.renderTitle(member.getMember(e.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"feedback-content"},"loading..."));0<e.html.length&&(dom.setHTML(dom.req(".feedback-content",g),e.html).style.display="block");return JSX("div",null,g)})))}))}})(feedback||(feedback={}));var member;
(function(a){a.memberUpdateDom=function(f){if(f)switch(system.cache.currentService){case services.estimate:estimate.cache.activeStory&&vote.viewVotes();break;case services.standup:dom.setContent("#report-detail",report.renderReports(standup.cache.reports));standup.cache.activeReport&&report.viewActiveReport();break;case services.retro:dom.setContent("#feedback-detail",feedback.renderFeedbackArray(retro.cache.feedback)),retro.cache.activeFeedback&&feedback.viewActiveFeedback()}};a.activeMemberDom=
function(f){var d=a.selfCanEdit();dom.setDisplay("#modal-member .owner-form",d);dom.setDisplay("#modal-member .member-form",!d);dom.setDisplay("#modal-member .owner-actions",d);dom.setDisplay("#modal-member .member-actions",!d);dom.setSelectOption("#member-modal-role-select",f.role);dom.setText("#member-modal-name",f.name);dom.setText("#member-modal-role",f.role)}})(member||(member={}));
(function(a){function f(){var e=b.filter(a.isSelf).shift();a.updateSelf(e);e=b.filter(function(g){return!a.isSelf(g)});dom.setContent("#member-detail",a.renderMembers(e));0<e.length&&modal.hide("welcome");a.renderOnline()}function d(){if(c){var e=b.filter(function(g){return g.userID===c}).shift();e||console.warn("cannot load active member ["+c+"]");return e}console.warn("no active member")}var b=[],c;a.getMember=function(e){return b.filter(function(g){return g.userID===e}).shift()};a.getMembers=function(){return b};
a.setMembers=f;a.onMemberUpdate=function(e){a.isSelf(e)?modal.hide("self"):modal.hide("member");var g=b,h=g.filter(function(k){return k.userID===e.userID}).shift();h=(null===h||void 0===h?void 0:h.name)!==e.name;g=g.filter(function(k){return k.userID!==e.userID});g.length===b.length&&notify.notify(e.name+" has joined",!0);g.push(e);g.sort(function(k,l){return k.name>l.name?1:-1});b=g;f();a.memberUpdateDom(h)};a.onMemberRemove=function(e){var g;e===system.cache.getProfile().userID?(notify.notify("you have left this "+
(null===(g=system.cache.currentService)||void 0===g?void 0:g.key),!0),document.location.href="/"):(modal.hide("member"),g=b.filter(function(h){return h.userID!==e}),g.sort(function(h,k){return h.name>k.name?1:-1}),b=g,f())};a.viewActiveMember=function(e){e&&(c=e);(e=d())&&a.activeMemberDom(e)};a.removeMember=function(e){(e=void 0===e?c:e)||console.warn("cannot load active member ["+c+"]");"self"===e&&(e=system.cache.getProfile().userID);var g=system.cache.currentService;confirm("Are you sure you wish to leave this "+
g.key+"?")&&socket.send({svc:g.key,cmd:command.client.removeMember,param:e})};a.saveRole=function(){var e=d();if(e){var g=e.role,h=dom.req("#member-modal-role-select").value;g===h?modal.hide("member"):socket.send({svc:system.cache.currentService.key,cmd:command.client.updateMember,param:{id:e.userID,role:h}})}else console.warn("no active member")};a.applyMembers=function(e){b=e};a.loadQR=function(){var e=dom.req("#qrcode");e.src=e.dataset.src}})(member||(member={}));
(function(a){function f(d){return d?d.picture&&0<d.picture.length&&"none"!=d.picture?JSX("div",null,JSX("div",{class:"profile-image"},JSX("img",{class:"uk-border-circle",src:d.picture,alt:d.name})),JSX("div",{class:"left"},d.name),JSX("div",{class:"clear"})):JSX("div",null,JSX("div",{class:"profile-image"},JSX("span",{class:"profile-icon","data-uk-icon":"user"})),JSX("div",{class:"left"},d.name)):JSX("span",null,"{former member}")}a.renderMembers=function(d){return 0===d.length?JSX("div",null,JSX("button",
{class:"uk-button uk-button-default",onclick:"modal.open('invitation');",type:"button"},"Invite Members")):JSX("ul",{class:"uk-list uk-list-divider"},d.map(function(b){var c={id:"member-"+b.userID},e=system.cache.getProfile();b=JSX("div",{class:"section",onclick:"modal.open('member', '"+b.userID+"');"},JSX("div",{title:"user is offline",class:"right uk-article-meta online-indicator"},"offline"),JSX("div",{class:e.linkColor+"-fg section-link"},f(b)));return JSX("li",c,b)}))};a.renderTitle=f;a.renderHeader=
function(d,b,c){return JSX("header",{class:"uk-comment-header uk-position-relative"},c?c:JSX("span",null),JSX("div",{class:"uk-grid-collapse uk-flex-middle","uk-grid":!0},JSX("div",{class:"uk-width-auto"},d&&d.picture&&0<d.picture.length?JSX("div",null,JSX("div",{class:"profile-image"},JSX("img",{class:"uk-border-circle",src:d.picture,alt:d.name}))):JSX("div",null,JSX("div",{class:"profile-image"},JSX("span",{class:"profile-icon","data-uk-icon":"user"})))),JSX("div",{class:"uk-width-expand"},JSX("h4",
{class:"uk-comment-title uk-margin-remove"},null===d||void 0===d?void 0:d.name),JSX("p",{class:"uk-comment-meta uk-margin-remove-top"},date.toDateTimeString(new Date(b))))))};a.viewSelf=function(){var d=dom.setValue("#self-name-input",dom.req("#member-self .member-name").innerText);setTimeout(function(){return d.focus()},250)};a.setPicture=function(d){return d&&0<d.length&&"none"!=d?JSX("div",{class:"model-icon profile-image"},JSX("img",{class:"uk-border-circle",src:d,alt:"your picture"})):JSX("span",
{class:"model-icon h3-icon",onclick:"modal.open('self');","data-uk-icon":"icon: user;"})}})(member||(member={}));
(function(a){function f(){a.getMembers().forEach(function(b){var c=dom.opt("#member-"+b.userID+" .online-indicator");c&&(d.find(function(e){return e===b.userID})?c.classList.remove("offline"):c.classList.add("offline"))})}var d=[];a.onOnlineUpdate=function(b){b.connected?d.find(function(c){return c===b.userID})||d.push(b.userID):d=d.filter(function(c){return c!==b.userID});f()};a.applyOnline=function(b){d=b};a.renderOnline=f})(member||(member={}));
(function(a){var f;a.isSelf=function(d){var b=system.cache.getProfile().userID;return d.userID===b};a.selfCanEdit=function(){return void 0!==f&&"owner"==f.role};a.updateSelf=function(d){var b=!1;d&&(f=d,dom.setContent("#self-picture",a.setPicture(d.picture)),dom.setText("#member-self .member-name",d.name),dom.setValue("#self-name-input",d.name),dom.setText("#member-self .member-role",d.role),b="owner"==d.role);dom.setDisplay("#history-container",b);dom.setDisplay("#session-edit-section",b);dom.setDisplay("#session-view-section",
!b)};a.onSubmitSelf=function(){var d=dom.req("#self-name-input").value,b=dom.req("#self-name-choice-global").checked?"global":"local",c=dom.req("#self-picture-input").value;socket.send({svc:services.system.key,cmd:command.client.updateProfile,param:{name:d,choice:b,picture:c}})}})(member||(member={}));var command;
(function(a){a.client={ping:"ping",connect:"connect",setActive:"set-active",getActions:"get-actions",getTeams:"get-teams",getSprints:"get-sprints",updateSession:"update-session",addComment:"add-comment",updateComment:"update-comment",removeComment:"remove-comment",updateProfile:"update-profile",updateMember:"update-member",removeMember:"remove-member",addStory:"add-story",updateStory:"update-story",removeStory:"remove-story",setStoryStatus:"set-story-status",submitVote:"submit-vote",addReport:"add-report",
updateReport:"update-report",removeReport:"remove-report",addFeedback:"add-feedback",updateFeedback:"update-feedback",removeFeedback:"remove-feedback"};a.server={error:"error",pong:"pong",sessionJoined:"session-joined",sessionUpdate:"session-update",sessionRemove:"session-remove",commentUpdate:"comment-update",commentRemove:"comment-remove",permissionsUpdate:"permissions-update",teamUpdate:"team-update",sprintUpdate:"sprint-update",contentUpdate:"content-update",actions:"actions",teams:"teams",sprints:"sprints",
memberUpdate:"member-update",memberRemove:"member-remove",onlineUpdate:"online-update",storyUpdate:"story-update",storyRemove:"story-remove",storyStatusChange:"story-status-change",voteUpdate:"vote-update",reportUpdate:"report-update",reportRemove:"report-remove",feedbackUpdate:"feedback-update",feedbackRemove:"feedback-remove"}})(command||(command={}));var services;
(function(a){a.system={key:"system",title:"System",plural:"systems",icon:"close"};a.team={key:"team",title:"Team",plural:"teams",icon:"users"};a.sprint={key:"sprint",title:"Sprint",plural:"sprints",icon:"git-fork"};a.estimate={key:"estimate",title:"Estimate Session",plural:"estimates",icon:"settings"};a.standup={key:"standup",title:"Daily Standup",plural:"standups",icon:"future"};a.retro={key:"retro",title:"Retrospective",plural:"retros",icon:"history"};var f=[a.system,a.team,a.sprint,a.estimate,
a.standup,a.retro];a.fromKey=function(d){var b=f.find(function(c){return c.key===d});if(!b)throw"invalid service ["+d+"]";return b}})(services||(services={}));var permission;
(function(a){function f(b){var c=dom.opt("#model-"+b+"-select select");if(c){var e=group.findGroup(a.permissions,b),g=dom.opt("#perm-"+b+"-section");g&&(dom.req("#perm-"+b+"-checkbox").checked=0<e.length,dom.setDisplay(g,0!==c.value.length));group.findGroup(a.permissions,b)}}function d(b){var c=dom.opt("#perm-"+b+"-checkbox");if(!c||!c.checked)return[];c=dom.els(".perm-"+b+"-email").filter(function(e){return e.checked}).map(function(e){return e.value}).join(",");return[{k:b,v:c,access:"member"}]}
a.permissions=[];a.applyPermissions=function(b){b=group.groupBy(b,function(c){return c.k}).groups;a.permissions=b};a.setPerms=function(){var b=null===a.permissions||0===a.permissions.length;dom.setDisplay("#public-link-container",b);dom.setDisplay("#private-link-container",!b);a.updateView();["team","sprint"].forEach(f);auth.allProviders.forEach(a.setProviderPerms)};a.setModelPerms=f;a.readPermissions=function(){var b=[];b.push.apply(b,$jscomp.arrayFromIterable(d("team")));b.push.apply(b,$jscomp.arrayFromIterable(d("sprint")));
b.push.apply(b,$jscomp.arrayFromIterable(d("github")));b.push.apply(b,$jscomp.arrayFromIterable(d("google")));b.push.apply(b,$jscomp.arrayFromIterable(d("slack")));b.push.apply(b,$jscomp.arrayFromIterable(d("facebook")));b.push.apply(b,$jscomp.arrayFromIterable(d("amazon")));b.push.apply(b,$jscomp.arrayFromIterable(d("microsoft")));return b}})(permission||(permission={}));
(function(a){function f(d){switch(d.key){case services.team.key:return JSX("li",null,"Must be a member of this session's team");case services.sprint.key:return JSX("li",null,"Must be a member of this session's sprint");default:var b=group.flatten(d.members.map(function(c){return c.k.split(",").map(function(e){return e.trim()}).filter(function(e){return 0<e.length})}));return 0===b.length?JSX("li",null,"Must sign in with ",d.key):JSX("li",null,"Must sign in with ",d.key," using an email address from ",
b.join(" or "))}}a.renderEmails=function(d,b){var c="uk-checkbox uk-margin-small-right perm-"+d+"-email",e="permission.onChanged('email', '"+d+"', this.checked)";return JSX("ul",null,b.map(function(g){return JSX("li",null,JSX("label",null,g.matched?JSX("input",{class:c,type:"checkbox",value:g.domain,checked:"checked",onchange:e}):JSX("input",{class:c,type:"checkbox",value:g.domain,onchange:e}),"Using email address ",g.domain))}))};a.renderView=function(d){return 0===d.length?JSX("div",null,"public"):
JSX("ul",null,d.map(function(b){return f(b)}))}})(permission||(permission={}));
(function(a){function f(d,b){dom.els(".perm-"+d+"-email").forEach(function(c){c.disabled=!b;b||(c.checked=!1)})}a.setProviderPerms=function(d){var b=group.findGroup(a.permissions,d.key),c=auth.active().filter(function(h){return h.provider===d.key});if(dom.opt("#perm-"+d.key+"-section")){dom.req("#perm-"+d.key+"-checkbox").checked=0<b.length;var e=dom.req("#perm-"+d.key+"-email-container"),g=group.flatten(b.map(function(h){return h.v.split(",").filter(function(k){return 0<k.length})})).map(function(h){return{matched:!0,
domain:h}});b=c.filter(function(h){return 0===g.filter(function(k){return h.email.endsWith(k.domain)}).length}).map(function(h){h=h.email;var k=h.lastIndexOf("@");h=-1===k?h:h.substr(k);return{matched:!1,domain:h}});g.push.apply(g,$jscomp.arrayFromIterable(b));g.sort();dom.setDisplay(e,0<g.length);dom.setContent(e,0===g.length?document.createElement("span"):a.renderEmails(d.key,g))}};a.onChanged=function(d,b,c){switch(d){case "email":(d=dom.opt("#perm-"+b+"-checkbox"))&&c&&!d.checked&&(d.checked=
!0);break;case "provider":return f(b,c)}}})(permission||(permission={}));(function(a){a.updateView=function(){var f=dom.req("#session-view-section .perms");dom.clear(f);f.appendChild(a.renderView(a.permissions))}})(permission||(permission={}));var report;
(function(a){function f(){if(standup.cache.activeReport){var d=standup.cache.reports.filter(function(b){return b.id===standup.cache.activeReport}).shift();d||console.warn("cannot load active report ["+standup.cache.activeReport+"]");return d}console.warn("no active report")}a.onSubmitReport=function(){var d=dom.req("#report-date").value,b=dom.req("#report-content").value;socket.send({svc:services.standup.key,cmd:command.client.addReport,param:{d:d,content:b}});return!1};a.onEditReport=function(){var d=
dom.req("#report-edit-date").value,b=dom.req("#report-edit-content").value;socket.send({svc:services.standup.key,cmd:command.client.updateReport,param:{id:standup.cache.activeReport,d:d,content:b}});return!1};a.onRemoveReport=function(){var d=standup.cache.activeReport;d&&notify.confirm("Delete this report?",function(){socket.send({svc:services.standup.key,cmd:command.client.removeReport,param:d});modal.hide("report")});return!1};a.viewActiveReport=function(d){var b,c=system.cache.getProfile();d&&
(standup.cache.activeReport=d);(d=f())?(dom.setText("#report-title",date.toDateString(date.dateFromYMD(d.d))+" - "+(null===(b=member.getMember(d.userID))||void 0===b?void 0:b.name)),b=d.userID===c.userID,dom.setValue(dom.req("#report-edit-date"),b?d.d:""),contents.onContentDisplay("report",b,d.content,d.html),comment.setActive("report",d.id),comment.setCounts()):console.warn("no active report")};a.setReports=function(d){standup.cache.reports=d;dom.setContent("#report-detail",a.renderReports(d));comment.setCounts();
modal.hide("add-report")};a.getReportDates=function(d){return d.map(function(b){return b.d}).filter(function(b,c,e){return e.indexOf(b)===c}).sort().reverse().map(function(b){var c=d.filter(function(e){return e.d===b}).sort(function(e,g){return e.created>g.created?-1:1});return{d:b,reports:c}})};a.viewAddReport=function(){dom.setValue("#report-date",date.dateToYMD(new Date));var d=dom.setValue("#report-content","");dom.wireTextarea(d);setTimeout(function(){return d.focus()},250)};a.viewReport=function(d){report.viewActiveReport(d);
var b=dom.req("#report-edit-content");setTimeout(function(){dom.wireTextarea(b);b.focus()},250)}})(report||(report={}));
(function(a){a.renderReports=function(f){if(0===f.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-report');",type:"button"},"Add Report"));f=a.getReportDates(f);return JSX("ul",{class:"uk-list"},f.map(function(d){return JSX("li",{id:"report-date-"+d.d},JSX("h5",null,JSX("div",{class:"right uk-article-meta"},date.dow(date.dateFromYMD(d.d).getDay())),date.toDateString(date.dateFromYMD(d.d))),JSX("ul",null,d.reports.map(function(b){var c=system.cache.getProfile();
c=JSX("div",{id:"report-"+b.id,class:"report-detail section",onclick:"modal.open('report', '"+b.id+"');"},JSX("div",{class:"report-comments right"},comment.renderCount("report",b.id)),JSX("div",{class:"left"},JSX("a",{class:c.linkColor+"-fg section-link"},member.renderTitle(member.getMember(b.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"report-content"},"loading..."));0<b.html.length&&(dom.setHTML(dom.req(".report-content",c),b.html).style.display="block");return JSX("li",null,c)})))}))}})(report||
(report={}));var retro;
(function(a){function f(d){a.cache.detail=d;var b=d.categories.join(", ");dom.setValue("#model-categories-input",b);dom.setContent("#session-view-section .categories",tags.renderTagsView(d.categories));dom.setOptions("#feedback-category",d.categories);dom.setOptions("#feedback-edit-category",d.categories);feedback.setFeedback(a.cache.feedback);session.setDetail(d)}a.cache=new function(){this.feedback=[]};a.onRetroMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.retro.key,b);
break;case command.server.sessionJoined:session.onSessionJoin(b);f(b.session);feedback.setFeedback(b.feedback);session.showWelcomeMessage(b.session.status,b.members.length);break;case command.server.sessionUpdate:f(b);break;case command.server.sessionRemove:system.onSessionRemove(services.retro);break;case command.server.permissionsUpdate:system.setPermissions(b);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===b||void 0===b?void 0:b.id);session.setTeam(b);break;
case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===b||void 0===b?void 0:b.id);session.setSprint(b);break;case command.server.feedbackUpdate:feedback.onFeedbackUpdate(b);break;case command.server.feedbackRemove:feedback.onFeedbackRemoved(b);break;default:console.warn("unhandled command ["+d+"] for retro")}};a.onSubmitRetroSession=function(){var d=dom.req("#model-title-input").value,b=dom.req("#model-categories-input").value,c=dom.req("#model-team-select select").value,
e=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.retro.key,cmd:command.client.updateSession,param:{title:d,categories:b,teamID:c,sprintID:e,permissions:g}})}})(retro||(retro={}));var session;
(function(a){a.setDetail=function(f){var d,b=(null===(d=system.cache.session)||void 0===d?void 0:d.slug)||"invalid";system.cache.session=f;document.title=f.title;dom.setText("#model-title",f.title);dom.setText("#session-view-section .uk-modal-title",f.title);dom.setValue("#model-title-input",f.title);d=dom.els("#navbar .uk-navbar-item");0<d.length&&dom.setText(d[d.length-1],f.title);b!==f.slug&&window.history.replaceState(null,"",document.location.href.replace(b,f.slug));member.selfCanEdit()&&modal.hide("session")};
a.onSessionJoin=function(f){system.cache.apply(f);permission.setPerms();member.setMembers();comment.setCounts()};a.showWelcomeMessage=function(f,d){"new"===f&&1===d&&(socket.send({svc:services.system.key,cmd:command.client.setActive,param:null}),setTimeout(function(){return modal.open("welcome")},300))};a.setTeam=function(f){var d=dom.req("#team-link-container"),b=dom.req("#session-view-section .team");dom.clear(d);dom.setDisplay("#team-warning-container",void 0!==f);f?(d.appendChild(team.renderTeamLink(f)),
dom.setContent(b,team.renderTeamLink(f,!0)),dom.setText("#team-warning-name",f.title)):dom.setHTML(b,"-none-")};a.setSprint=function(f){var d=dom.req("#sprint-link-container"),b=dom.req("#session-view-section .sprint");dom.clear(d);dom.setDisplay("#sprint-warning-container",void 0!==f);f?(d.appendChild(sprint.renderSprintLink(f)),dom.setContent(b,sprint.renderSprintLink(f,!0)),dom.setText("#sprint-warning-name",f.title)):dom.setHTML(b,"-none-")};a.onModalOpen=function(f){var d=dom.setValue("#model-title-input",
dom.req("#model-title").innerText);setTimeout(function(){return d.focus()},250);team.refreshTeams();sprint.refreshSprints()}})(session||(session={}));var socket;(function(a){a.initBypass=function(){a.bypass=!0;a.connected=!0;nav.enabled=!1};a.bypassSend=function(f){a.debug&&console.debug("out",f);npn_handler?npn_handler(JSON.stringify(f,null,2)):console.warn("no bypass handler configured")}})(socket||(socket={}));
(function(a){a.debug=!0;a.appUnloading=!1;a.currentService="";a.currentID="";a.bypass=!1;a.setAppUnloading=function(){a.appUnloading=!0};a.send=function(f){a.bypass?a.bypassSend(f):a.socketSend(f)}})(socket||(socket={}));
(function(a){function f(){var n=document.location,r="ws";"https:"===n.protocol&&(r="wss");0!=p.indexOf("/")&&(p="/"+p);return r+("://"+n.host+p)}function d(){g=new WebSocket(f());g.onopen=c;g.onmessage=function(n){return m(json.parse(n.data))};g.onerror=function(n){return q("socket",n.type)};g.onclose=e}function b(n,r,t){a.currentService=n;a.currentID=r;a.connectTime=Date.now();if(!m)throw"onMessage not initialized";t?a.initBypass():d()}function c(){log.info("socket connected");a.connected=!0;h=1;
k.forEach(a.send);k=[];l(a.currentID)}function e(){function n(){a.connected=!1;var r=Date.now()-a.connectTime;2E3>r?(h*=2,a.debug&&console.debug("socket closed immediately, reconnecting in "+h+" seconds"),setTimeout(function(){b(a.currentService,a.currentID)},1E3*h)):(log.info("socket closed after ["+r+"ms]"),b(a.currentService,a.currentID))}a.appUnloading||n()}var g;a.connected=!1;var h=0,k=[],l,m,q,p="/s";a.init=function(n,r,t,u){l=n;m=r;q=t;u&&(p=u)};a.initSocket=d;a.socketConnect=b;a.socketSend=
function(n){a.connected?(a.debug&&console.debug("out",n),n=json.str(n),g.send(n)):k.push(n)}})(socket||(socket={}));var sprint;
(function(a){function f(d){a.cache.detail=d;var b=d.startDate?date.utcDate(d.startDate):void 0,c=d.endDate?date.utcDate(d.endDate):void 0;dom.setContent("#sprint-date-display",a.renderSprintDates(b,c));dom.setValue("#sprint-start-date-input",b?date.dateToYMD(b):"");dom.setValue("#sprint-end-date-input",c?date.dateToYMD(c):"");session.setDetail(d)}a.cache=new function(){};a.onSprintMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.sprint.key,b);break;case command.server.sessionJoined:session.onSessionJoin(b);
f(b.session);dom.setContent("#sprint-estimate-list",contents.renderContents(services.sprint,services.estimate,b.estimates));dom.setContent("#sprint-standup-list",contents.renderContents(services.sprint,services.standup,b.standups));dom.setContent("#sprint-retro-list",contents.renderContents(services.sprint,services.retro,b.retros));session.showWelcomeMessage(b.session.status,b.members.length);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===b||void 0===b?void 0:b.id);
session.setTeam(b);break;case command.server.sessionUpdate:f(b);break;case command.server.sessionRemove:system.onSessionRemove(services.sprint);break;case command.server.permissionsUpdate:system.setPermissions(b);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService.key,system.cache.currentID);break;default:console.warn("unhandled command ["+d+"] for sprint")}};a.onSubmitSprintSession=function(){var d,b,c=dom.req("#model-title-input").value,e=dom.req("#model-team-select select").value,
g=null===(d=dom.opt("#sprint-start-date-input"))||void 0===d?void 0:d.value;d=null===(b=dom.opt("#sprint-end-date-input"))||void 0===b?void 0:b.value;b=permission.readPermissions();socket.send({svc:services.sprint.key,cmd:command.client.updateSession,param:{title:c,startDate:g,endDate:d,teamID:e,permissions:b}})};a.refreshSprints=function(){dom.opt("#model-sprint-select")&&socket.send({svc:services.system.key,cmd:command.client.getSprints,param:null})};a.viewSprints=function(d){var b;dom.opt("#model-sprint-container")&&
(dom.setContent("#model-sprint-select",a.renderSprintSelect(d,null===(b=system.cache.session)||void 0===b?void 0:b.sprintID)),permission.setModelPerms("sprint"))}})(sprint||(sprint={}));
(function(a){a.renderSprintDates=function(f,d){function b(g,h){return JSX("span",null,g," ",JSX("span",{class:"sprint-date",onclick:"modal.open('session');"},h?date.toDateString(h):""))}var c=b("starts",f),e=b("ends",d);return f?d?JSX("span",null,c,", ",e):c:d?e:JSX("span",null,"Sprint")};a.renderSprintLink=function(f,d){var b=system.cache.getProfile();f=JSX("a",{class:b.linkColor+"-fg",href:"/sprint/"+f.slug},f.title);return d?f:JSX("span",null,f," ")};a.renderSprintSelect=function(f,d){return JSX("select",
{class:"uk-select",onchange:"permission.setModelPerms('sprint')"},JSX("option",{value:""},"- no sprint -"),f.map(function(b){return b.id===d?JSX("option",{selected:"selected",value:b.id},b.title):JSX("option",{value:b.id},b.title)}))}})(sprint||(sprint={}));var standup;
(function(a){function f(b){return a.cache.reports.filter(function(c){return c.id!==b})}function d(b,c){report.setReports(b);c===a.cache.activeReport&&modal.hide("report")}a.cache=new function(){this.reports=[]};a.onStandupMessage=function(b,c){switch(b){case command.server.error:rituals.onError(services.standup.key,c);break;case command.server.sessionJoined:session.onSessionJoin(c);b=c.session;a.cache.detail=b;session.setDetail(b);report.setReports(c.reports);session.showWelcomeMessage(c.session.status,
c.members.length);break;case command.server.sessionUpdate:a.cache.detail=c;session.setDetail(c);break;case command.server.sessionRemove:system.onSessionRemove(services.standup);break;case command.server.permissionsUpdate:system.setPermissions(c);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===c||void 0===c?void 0:c.id);session.setTeam(c);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===c||void 0===c?void 0:c.id);session.setSprint(c);
break;case command.server.reportUpdate:b=f(c.id);b.push(c);d(b,c.id);break;case command.server.reportRemove:b=f(c);d(b,c);notify.notify("report has been deleted",!0);break;default:console.warn("unhandled command ["+b+"] for standup")}};a.onSubmitStandupSession=function(){var b=dom.req("#model-title-input").value,c=dom.req("#model-team-select select").value,e=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.standup.key,cmd:command.client.updateSession,
param:{title:b,teamID:c,sprintID:e,permissions:g}})}})(standup||(standup={}));var story;
(function(a){function f(b){function c(g,h){g.id.substr(g.id.lastIndexOf("-")+1)===h?g.classList.add("active"):g.classList.remove("active")}dom.els(".story-status-body").forEach(function(g){c(g,b)});dom.els(".story-status-actions").forEach(function(g){c(g,b)});var e="";switch(b){case "new":e="Story";break;case "active":e="Voting";break;case "complete":e="Results"}dom.setText("#story-status",e);vote.viewVotes()}function d(b,c,e,g){e&&"complete"===e.status&&0<e.finalVote.length&&(c=e.finalVote);dom.setContent("#story-"+
b+" .story-status",a.renderStatus(c));g&&a.showTotalIfNeeded()}a.viewStoryStatus=f;a.requestStoryStatus=function(b){var c=a.getActiveStory();c&&socket.send({svc:services.estimate.key,cmd:command.client.setStoryStatus,param:{storyID:c.id,status:b}})};a.setStoryStatus=d;a.onStoryStatusChange=function(b){var c=void 0;estimate.cache.stories.forEach(function(e){e.id===b.storyID&&(c=e,e.finalVote=b.finalVote,e.status=b.status)});d(b.storyID,b.status,c,!0);b.storyID===estimate.cache.activeStory&&f(b.status)}})(story||
(story={}));
(function(a){function f(){if(estimate.cache.activeStory){var b=estimate.cache.stories.filter(function(c){return c.id===estimate.cache.activeStory}).shift();b||console.warn("cannot load active story ["+estimate.cache.activeStory+"]");return b}}function d(){var b=0;estimate.cache.stories.filter(function(g){return"complete"===g.status}).map(function(g){return g.finalVote}).filter(function(g){return 0<g.length}).map(function(g){return parseFloat(g)}).filter(function(g){return!isNaN(g)}).forEach(function(g){return b+=g});
var c=dom.opt("#story-total"),e=dom.req("#story-list");void 0!==c&&e.removeChild(c);0<b&&e.appendChild(a.renderTotal(b))}a.setStories=function(b){estimate.cache.stories=b;dom.setContent("#story-detail",a.renderStories(b));b.forEach(function(c){return a.setStoryStatus(c.id,c.status,c,!1)});d();comment.setCounts();modal.hide("add-story")};a.onSubmitStory=function(){var b=dom.req("#story-title-input").value;socket.send({svc:services.estimate.key,cmd:command.client.addStory,param:{title:b}});return!1};
a.beginEditStory=function(){var b=f(),c=prompt("Edit your story",b.title);c&&c!==b.title&&socket.send({svc:services.estimate.key,cmd:command.client.updateStory,param:{storyID:b.id,title:c}});return!1};a.onRemoveStory=function(){var b=estimate.cache.activeStory;b&&notify.confirm("Delete this story?",function(){socket.send({svc:services.estimate.key,cmd:command.client.removeStory,param:b});modal.hide("story")});return!1};a.getActiveStory=f;a.viewActiveStory=function(b){b&&(estimate.cache.activeStory=
b);if(b=f())dom.setText("#story-title",b.title),a.viewStoryStatus(b.status),comment.setActive("story",b.id),comment.setCounts()};a.showTotalIfNeeded=d})(story||(story={}));
(function(a){a.renderStories=function(f){return 0===f.length?JSX("div",{id:"story-list"},JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-story');",type:"button"},"Add Story")):JSX("table",{class:"uk-table uk-table-divider uk-table-small"},JSX("ul",{id:"story-list",class:"uk-list uk-list-divider"},f.map(function(d){var b=system.cache.getProfile();return JSX("li",{id:"story-"+d.id,class:"section",onclick:"modal.open('story', '"+d.id+"');"},JSX("div",{class:"right uk-article-meta story-status"},
d.status),JSX("div",{class:b.linkColor+"-fg section-link left"},d.title),JSX("div",{class:"left",style:"margin-top: 4px;"},comment.renderCount("story",d.id)))})))};a.renderStatus=function(f){switch(f){case "new":return JSX("span",null,f);case "active":return JSX("span",null,f);default:return JSX("span",{class:"vote-badge"},f)}};a.renderTotal=function(f){return JSX("li",{id:"story-total"},JSX("div",{class:"right uk-article-meta"},JSX("span",{class:"vote-badge"},f))," ","Total")};a.viewAddStory=function(){var f=
dom.setValue("#story-title-input","");setTimeout(function(){return f.focus()},250)}})(story||(story={}));var debug=!0,system;
(function(a){var f=function(){this.currentID="";this.connectTime=0};f.prototype.getProfile=function(){if(!this.profile)throw"no active profile";return this.profile};f.prototype.apply=function(d){a.cache.session=d.session;a.cache.profile=d.profile;auth.applyAuths(d.auths);permission.applyPermissions(d.permissions);member.applyMembers(d.members);member.applyOnline(d.online);comment.applyComments(d.comments);void 0!==d.team&&session.setTeam(d.team);void 0!==d.sprint&&session.setSprint(d.sprint)};a.cache=
new f;a.setPermissions=function(d){permission.applyPermissions(d);permission.setPerms()};a.setAuths=function(d){auth.applyAuths(d);permission.setPerms()};a.onSystemMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.system.key,b);break;case command.server.actions:action.viewActions(b);break;case command.server.teams:team.viewTeams(b);break;case command.server.sprints:sprint.viewSprints(b);break;case command.server.memberUpdate:member.onMemberUpdate(b);break;case command.server.memberRemove:member.onMemberRemove(b);
break;case command.server.onlineUpdate:member.onOnlineUpdate(b);break;case command.server.commentUpdate:comment.onCommentUpdate(b);break;case command.server.commentRemove:comment.onCommentRemoved(b);break;default:console.warn("unhandled system message for command ["+d+"]")}};a.onSessionRemove=function(d){document.location.reload()}})(system||(system={}));var team;
(function(a){a.cache=new function(){};a.onTeamMessage=function(f,d){switch(f){case command.server.error:rituals.onError(services.team.key,d);break;case command.server.sessionJoined:session.onSessionJoin(d);f=d.session;a.cache.detail=f;session.setDetail(f);dom.setContent("#team-sprint-list",contents.renderContents(services.team,services.sprint,d.sprints));dom.setContent("#team-estimate-list",contents.renderContents(services.team,services.estimate,d.estimates));dom.setContent("#team-standup-list",contents.renderContents(services.team,
services.standup,d.standups));dom.setContent("#team-retro-list",contents.renderContents(services.team,services.retro,d.retros));session.showWelcomeMessage(d.session.status,d.members.length);break;case command.server.sessionUpdate:a.cache.detail=d;session.setDetail(d);break;case command.server.sessionRemove:system.onSessionRemove(services.team);break;case command.server.permissionsUpdate:system.setPermissions(d);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService.key,
system.cache.currentID);break;default:console.warn("unhandled command ["+f+"] for team")}};a.onSubmitTeamSession=function(){var f=dom.req("#model-title-input").value,d=permission.readPermissions();socket.send({svc:services.team.key,cmd:command.client.updateSession,param:{title:f,permissions:d}})};a.refreshTeams=function(){dom.opt("#model-team-select")&&socket.send({svc:services.system.key,cmd:command.client.getTeams,param:null})};a.viewTeams=function(f){var d;dom.opt("#model-team-container")&&(dom.setContent("#model-team-select",
a.renderTeamSelect(f,null===(d=system.cache.session)||void 0===d?void 0:d.teamID)),permission.setModelPerms("team"))}})(team||(team={}));
(function(a){a.renderTeamLink=function(f,d){var b=system.cache.getProfile();f=JSX("a",{class:b.linkColor+"-fg",href:"/team/"+f.slug},f.title);return d?f:JSX("span",null,"in ",f)};a.renderTeamSelect=function(f,d){return JSX("select",{class:"uk-select",onchange:"permission.setModelPerms('team')"},JSX("option",{value:""},"- no team -"),f.map(function(b){return b.id===d?JSX("option",{selected:"selected",value:b.id},b.title):JSX("option",{value:b.id},b.title)}))}})(team||(team={}));var profile;
(function(a){a.setNavColor=function(f,d){dom.setValue("#nav-color",d);dom.req("#navbar").className=d+"-bg uk-navbar-container uk-navbar";document.querySelectorAll(".nav_swatch").forEach(function(b){b.classList.remove("active")});f.classList.add("active")};a.setLinkColor=function(f,d){dom.setValue("#link-color",d);dom.els(".profile-link").forEach(function(b){b.classList.forEach(function(c){-1<c.indexOf("-fg")&&b.classList.remove(c);b.classList.add(d+"-fg")})});document.querySelectorAll(".link_swatch").forEach(function(b){b.classList.remove("active")});
f.classList.add("active")};a.setPicture=function(f){dom.setValue("#self-picture-input",f);return!1}})(profile||(profile={}));var arr;(function(a){a.find=function(f,d){for(var b=f.length>>>0,c=0;c<b;){var e=f[c];if(d(c,e))return e;c++}}})(arr||(arr={}));var date;
(function(a){function f(c){return c.toLocaleDateString()}function d(c){return c.toLocaleTimeString().slice(0,8)}a.dateToYMD=function(c){var e=c.getDate(),g=c.getMonth()+1;return c.getFullYear()+"-"+(9>=g?"0"+g:g)+"-"+(9>=e?"0"+e:e)};a.dateFromYMD=function(c){c=new Date(c);return new Date(c.getTime()+6E4*c.getTimezoneOffset())};a.dow=function(c){switch(c){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat";default:return"???"}};
a.toDateString=f;a.toTimeString=d;a.toDateTimeString=function(c){return f(c)+" "+d(c)};var b=6E4*(new Date).getTimezoneOffset();a.utcDate=function(c){return new Date(Date.parse(c)+b)}})(date||(date={}));var group;
(function(a){function f(e,g){if(!e)return[];e.sort(function(h,k){h=g(h);k=g(k);return h>k?1:h<k?-1:0});return e}function d(e,g,h){if(!e)return[g];var k=!1,l=h(g),m;for(m in e)h(e[m])==l&&(k=!0,e[m]=g);k||e.push(g);return e}var b=function(e){this.members=[];this.key=e};a.Group=b;var c=function(){this.groups=[]};c.prototype.findOrInsert=function(e){var g=arr.find(this.groups,function(h,k){return k.key===e});if(g)return g;g=new b(e);this.groups.push(g);return g};a.GroupSet=c;a.groupBy=function(e,g){var h=
new c;e&&e.forEach(function(k){h.findOrInsert(g(k)).members.push(k)});return h};a.findGroup=function(e,g){e=$jscomp.makeIterator(e);for(var h=e.next();!h.done;h=e.next())if(h=h.value,h.key===g)return h.members;return[]};a.flatten=function(e){var g=[];e.forEach(function(h){return g.push.apply(g,$jscomp.arrayFromIterable(h))});return g};a.sort=f;a.update=d;a.updateAndSort=function(e,g,h){return f(d(e,g,h),h)};a.remove=function(e,g,h){return e?e.filter(function(k){return h(k)!=g}):[]}})(group||(group=
{}));var json;(function(a){a.str=function(f){return void 0===f?"null":JSON.stringify(f,null,2)};a.parse=function(f){return JSON.parse(f)}})(json||(json={}));var log;
(function(a){function f(g,h){if(0===b)console.warn("call `log.init()` before attempting to log");else{var k=Date.now()-b;k=JSX("li",{class:d(g)},JSX("div",{class:"right"},k,"ms"),h);if(!e&&(e=dom.opt("#log-list"),!e)){console.warn(g+": "+h);return}e.appendChild(k);c||(c=dom.req("#log-content"));c.scrollTo(0,c.scrollHeight)}}function d(g){switch(g){case "debug":return"grey-fg";case "info":return"";case "warn":return"yellow-fg";case "error":return"red-fg";default:return""}}var b=0,c,e;a.init=function(){b=
Date.now();f("debug","npn started")};a.info=function(g){f("info",g)};a.l=f;a.toggle=function(){var g=dom.req("#workspace-content"),h=dom.req("#log-container"),k=""!==h.style.display&&"none"!==h.style.display;k?g.classList.remove("log-visible"):g.classList.add("log-visible");dom.setDisplay(h,!k);c||(c=dom.req("#log-content"));c.scrollTo(0,c.scrollHeight)}})(log||(log={}));var map;
(function(a){var f=function(){this.storage=Object.create(null)};f.prototype.get=function(d){return this.storage[d]};f.prototype.set=function(d,b){return this.storage[d]=b};f.prototype.del=function(d){delete this.storage[d]};a.Map=f})(map||(map={}));var nav;
(function(a){function f(c){var e=$jscomp.makeIterator(d(c));c=e.next().value;e=e.next().value;if(!a.enabled)return b(c,e),"";if(str.startsWith(c,"text/html;"))return"";str.startsWith(c,"/")&&(c=c.substr(1));var g=location.pathname;str.startsWith(g,"/")&&(g=g.substr(1));g!==c&&(g=c,history.pushState(g,"","/"+g));b(c,e)}function d(c){var e="",g=c.indexOf("#");-1<g&&(e=c.substr(g+1),c=c.substr(0,g));return[c,e]}a.enabled=!0;var b=function(c,e){console.warn("default nav handler called: "+c+(0<e.length?
"#"+e:""))};a.init=function(c){b=c;window.onpopstate=function(e){if(e.state){var g=$jscomp.makeIterator(d(e.state));e=g.next().value;g=g.next().value;b(e,g)}else b("","")};f(location.pathname+(0<location.hash.length?location.hash:""))};a.navigate=f;a.pop=function(){var c=location.pathname.substr(0,location.pathname.lastIndexOf("/"));"/c"===c&&(c="");f(c)};a.hashLink=function(c,e,g){0===g.indexOf("#")&&(g=g.substr(1));var h="";g===c&&(h+="uk-active");e=JSX("li",{class:h},JSX("a",{href:"#"+c},e));e.onclick=
function(){history.replaceState(history.state,"","#"+c)};return e};a.link=function(c){var e=c.path;str.startsWith(e,"/")||(e="/"+e);c.cls=c.cls?" "+c.cls.trim():"";var g=JSX("span",null);c.icon&&(g=JSX("span",{class:"nav-icon","data-uk-icon":"icon: "+c.icon}));c.onclk?str.endsWith(c.onclk,";")||(c.onclk+=";"):c.onclk="";c.isButton||(c.cls=style.linkColor+c.cls);var h=c.path;c.hash&&0<c.hash.length&&(h+="#"+c.hash);return JSX("a",{class:c.cls,href:e,onclick:c.onclk+"nav.navigate('"+h+"', '"+c.title+
"');return false;"},g,c.title)}})(nav||(nav={}));var notify;(function(a){a.notify=function(f,d){UIkit.notification(f,{status:d?"success":"danger",pos:"top-right"})};a.confirm=function(f,d){UIkit.modal.confirm(f).then(d)};a.modal=function(f){var d=UIkit.modal(f);d||console.warn("no modal available with key ["+f+"]");return d}})(notify||(notify={}));var str;
(function(a){function f(b,c,e){e=e&&0<e?e|0:0;return b.substring(e,e+c.length)===c}function d(b,c,e){e=e&&e<b.length?e:b.length;return b.substring(e-c.length,e)===c}a.startsWith=f;a.endsWith=d;a.trimPrefix=function(b,c){return f(b,c)?b.slice(c.length):b};a.trimSuffix=function(b,c){return d(b,c)?b.substring(0,b.lastIndexOf(c)):b}})(str||(str={}));var vote;
(function(a){function f(){var d=story.getActiveStory();if(d){var b=estimate.cache.activeVotes(),c=b.filter(function(e){return e.userID===system.cache.getProfile().userID}).pop();switch(d.status){case "new":d=system.cache.getProfile().userID===d.userID;dom.setDisplay("#story-edit-section",d);dom.setDisplay("#story-view-section",!d);break;case "active":dom.setContent("#story-vote-members",a.renderVoteMembers(member.getMembers(),b));dom.setContent("#story-vote-choices",a.renderVoteChoices(estimate.cache.detail.choices,
null===c||void 0===c?void 0:c.choice));break;case "complete":dom.setContent("#story-vote-results",a.renderVoteResults(member.getMembers(),b));dom.setContent("#story-vote-summary",a.renderVoteSummary(b));break;default:console.warn("invalid story status ["+d.status+"]")}}}a.setVotes=function(d){estimate.cache.votes=d;f()};a.onVoteUpdate=function(d){var b=estimate.cache.votes;b=b.filter(function(c){return c.userID!==d.userID||c.storyID!==d.storyID});b.push(d);estimate.cache.votes=b;d.storyID===estimate.cache.activeStory&&
f()};a.viewVotes=f;a.onSubmitVote=function(d){socket.send({svc:services.estimate.key,cmd:command.client.submitVote,param:{storyID:estimate.cache.activeStory,choice:d}})};a.getVoteResults=function(d){d=d.map(function(k){k=parseFloat(k.choice);return isNaN(k)?-1:k}).filter(function(k){return-1!==k}).sort();var b=d.length,c=Math.min.apply(Math,$jscomp.arrayFromIterable(d)),e=Math.max.apply(Math,$jscomp.arrayFromIterable(d)),g=d.reduce(function(k,l){return k+l},0),h=d.reduce(function(k,l){var m=k.numMapping[l]=
(k.numMapping[l]||0)+1;m>k.greatestFreq&&(k.greatestFreq=m,k.mode=l);return k},{mode:null,greatestFreq:-Infinity,numMapping:{}}).mode;return{count:b,min:c,max:e,sum:g,mean:0===b?0:g/b,median:0===b?0:d[Math.floor(d.length/2)],mode:0===b?0:h}}})(vote||(vote={}));
(function(a){function f(b,c){return JSX("div",{class:"vote-member",title:b.name+" has "+(c?"voted":"not voted")},JSX("div",null,JSX("span",{"data-uk-icon":"icon: "+(c?"check":"minus")+"; ratio: 1.6"})),b.name)}function d(b,c){return c?JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},c))," ",b.name):JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},JSX("span",{"data-uk-icon":"icon: minus; ratio: 1.6"})))," ",b.name)}a.renderVoteMembers=
function(b,c){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},b.map(function(e){return f(e,0<c.filter(function(g){return g.userID===e.userID}).length)}))};a.renderVoteChoices=function(b,c){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center"},b.map(function(e){return JSX("div",{class:"vote-choice uk-border-circle uk-box-shadow-hover-medium"+(e===c?" active "+system.cache.getProfile().linkColor+"-border":""),onclick:"vote.onSubmitVote('"+e+"');"},e)}))};a.renderVoteResults=
function(b,c){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},b.map(function(e){var g=c.filter(function(h){return h.userID===e.userID});return d(e,0<g.length?g[0].choice:void 0)}))};a.renderVoteSummary=function(b){function c(g){return g.toString().substr(0,4)}var e=a.getVoteResults(b);return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center result-container"},JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(e.count)," / ",c(b.length))," ",JSX("div",null,
"votes counted")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(e.min),"-",c(e.max))," ",JSX("div",null,"vote range")),JSX("div",{class:"result mean-result"},JSX("div",{class:"mean uk-border-circle "+system.cache.getProfile().linkColor+"-border"},c(e.mean))," ",JSX("div",null,"average")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(e.median))," ",JSX("div",null,"median")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},
c(e.mode))," ",JSX("div",null,"mode")))}})(vote||(vote={}));
