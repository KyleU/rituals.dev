var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,e){a.raw=e;return a};$jscomp.arrayIteratorImpl=function(a){var e=0;return function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var e,d=[];!(e=a.next()).done;)d.push(e.value);return d};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,e,d){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var f=a[c];if(e.call(d,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,d){if(a==Array.prototype||a==Object.prototype)return a;a[e]=d.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<a.length;++e){var d=a[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,e){var d=$jscomp.propertyToPolyfillSymbol[e];if(null==d)return a[e];d=a[d];return void 0!==d?d:a[e]};$jscomp.polyfill=function(a,e,d,b){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,e,d,b):$jscomp.polyfillUnisolated(a,e,d,b))};
$jscomp.polyfillUnisolated=function(a,e,d,b){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];if(!(c in d))return;d=d[c]}a=a[a.length-1];b=d[a];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(a,e,d,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<c.length-1;f++){var g=c[f];if(!(g in b))return;b=b[g]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?b[c]:null;e=e(d);null!=e&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:e}):e!==d&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=
$jscomp.propertyToPolyfillSymbol[c],$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:e})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(e,d){return $jscomp.findInternal(this,e,d).v}},"es6","es3");
$jscomp.checkStringArgs=function(a,e,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(e,d){var b=$jscomp.checkStringArgs(this,e,"startsWith");e+="";var c=b.length,f=e.length;d=Math.max(0,Math.min(d|0,b.length));for(var g=0;g<f&&d<c;)if(b[d++]!=e[g++])return!1;return g>=f}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(e,d){var b=$jscomp.checkStringArgs(this,e,"endsWith");e+="";void 0===d&&(d=b.length);d=Math.max(0,Math.min(d|0,b.length));for(var c=e.length;0<c&&0<d;)if(b[--d]!=e[--c])return!1;return 0>=c}},"es6","es3");var dom;
(function(a){function e(g,h){var k=[];(h?h.querySelectorAll(g):document.querySelectorAll(g)).forEach(function(l){k.push(l)});return k}function d(g,h){h=e(g,h);switch(h.length){case 0:break;case 1:return h[0];default:console.warn("found ["+h.length+"] elements with selector ["+g+"], wanted zero or one")}}function b(g,h){(h=d(g,h))||console.warn("no element found for selector ["+g+"]");return h}function c(g,h){"string"===typeof g&&(g=b(g));g.innerHTML=h;return g}function f(g,h,k){k=void 0===k?"block":
k;"string"===typeof g&&(g=b(g));g.style.display=h?k:"none";return g}a.initDom=function(g,h){try{style.themeLinks(h),style.setTheme(g)}catch(k){console.warn("error setting style",k)}try{modal.wire()}catch(k){console.warn("error wiring modals",k)}try{drop.wire()}catch(k){console.warn("error wiring drops",k)}try{tags.wire()}catch(k){console.warn("error wiring tag editors",k)}try{flash.wire()}catch(k){console.warn("error wiring tag editors",k)}};a.els=e;a.opt=d;a.req=b;a.setHTML=c;a.setDisplay=f;a.setContent=
function(g,h){"string"===typeof g&&(g=b(g));a.clear(g);Array.isArray(h)?h.forEach(function(k){return g.appendChild(k)}):g.appendChild(h);return g};a.setText=function(g,h){"string"===typeof g&&(g=b(g));g.innerText=h;return g};a.switchElements=function(g,h){f(g,!1);f(h,!0);return!1};a.clear=function(g){return c(g,"")}})(dom||(dom={}));
(function(a){a.setValue=function(e,d){"string"===typeof e&&(e=a.req(e));e.value=d;return e};a.wireTextarea=function(e){function d(){e.style.height="auto";e.style.height=(64>e.scrollHeight?64:e.scrollHeight+6)+"px"}function b(){window.setTimeout(d,0)}e.dataset.autoresize||(e.dataset.autoresize="true",e.addEventListener("change",d,!1),e.addEventListener("cut",b,!1),e.addEventListener("paste",b,!1),e.addEventListener("drop",b,!1),e.addEventListener("keydown",b,!1),e.focus(),e.select());d()};a.setOptions=
function(e,d){"string"===typeof e&&(e=a.req(e));a.clear(e);d.forEach(function(b){var c=document.createElement("option");c.value=b;a.setText(c,b);e.appendChild(c)})};a.setSelectOption=function(e,d){"string"===typeof e&&(e=a.req(e));for(var b=0;b<e.children.length;b++){var c=e.children.item(b);c.selected=c.value===d}};a.insertAtCaret=function(e,d){if(e.selectionStart||0===e.selectionStart){var b=e.selectionStart,c=e.selectionEnd;e.value=e.value.substring(0,b)+d+e.value.substring(c,e.value.length);e.selectionStart=
b+d.length;e.selectionEnd=b+d.length}else e.value+=d}})(dom||(dom={}));
function JSX(a,e){var d=document.createElement(a);for(c in e)if(c&&e.hasOwnProperty(c)){var b=e[c];"dangerouslySetInnerHTML"===c?dom.setHTML(d,b.__html):!0===b?d.setAttribute(c,c):!1!==b&&null!==b&&void 0!==b&&d.setAttribute(c,b.toString())}var c={};for(b=2;b<arguments.length;c={$jscomp$loop$prop$child$8:c.$jscomp$loop$prop$child$8},b++)if(c.$jscomp$loop$prop$child$8=arguments[b],Array.isArray(c.$jscomp$loop$prop$child$8))c.$jscomp$loop$prop$child$8.forEach(function(f){return function(g){if(void 0===f.$jscomp$loop$prop$child$8||
null===f.$jscomp$loop$prop$child$8)throw"child array for tag ["+a+"] is "+f.$jscomp$loop$prop$child$8+"\n"+d.outerHTML;if(void 0===g||null===g)throw"child for tag ["+a+"] is "+g+"\n"+d.outerHTML;"string"===typeof g&&(g=document.createTextNode(g));d.appendChild(g)}}(c));else{if(void 0===c.$jscomp$loop$prop$child$8||null===c.$jscomp$loop$prop$child$8)throw"child for tag ["+a+"] is "+c.$jscomp$loop$prop$child$8+"\n"+d.outerHTML;c.$jscomp$loop$prop$child$8.nodeType||(c.$jscomp$loop$prop$child$8=document.createTextNode(c.$jscomp$loop$prop$child$8.toString()));
d.appendChild(c.$jscomp$loop$prop$child$8)}return d}var style;
(function(a){function e(b){d(b);switch(b){case "auto":b="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(b="dark");e(b);fetch("/profile/theme/"+b).then(function(c){return c.text()}).then(function(){});break;case "light":document.documentElement.classList.remove("uk-light");document.body.classList.remove("uk-light");document.documentElement.classList.add("uk-dark");document.body.classList.add("uk-dark");break;case "dark":document.documentElement.classList.add("uk-light");
document.body.classList.add("uk-light");document.documentElement.classList.remove("uk-dark");document.body.classList.remove("uk-dark");break;default:console.warn("invalid theme")}}function d(b){if("undefined"===typeof EmojiButton)dom.els(".picker-toggle").forEach(function(f){return dom.setDisplay(f,!1)});else{var c={position:"bottom-end",theme:b,zIndex:1021};dom.els(".textarea-emoji").forEach(function(f){var g=dom.req(".picker-toggle",f);g.addEventListener("click",function(){var h=dom.req(".uk-textarea",
f),k=new EmojiButton(c);k.on("emoji",function(l){drop.onEmojiPicked();dom.insertAtCaret(h,l)});k.togglePicker(g)},!1)})}}a.setTheme=e;a.linkColor="";a.themeLinks=function(b){a.linkColor=b+"-fg";dom.els(".theme").forEach(function(c){c.classList.add(a.linkColor)})}})(style||(style={}));var drop;
(function(a){function e(f){if(f.target){var g=f.target;f=g.dataset.key||"";g=g.dataset.t||"";var h=events.getOpenEvent(f);h?h(g):console.warn("no drop open handler registered for ["+f+"]")}}function d(f){if(f.target){var g=f.target;g.classList.contains("uk-open")&&(f=g.dataset.t||"",(g=events.getCloseEvent(g.dataset.key||""))&&g(f))}}function b(f){c&&f.preventDefault()}a.wire=function(){dom.els(".drop").forEach(function(f){f.addEventListener("show",e);f.addEventListener("beforehide",b);f.addEventListener("hide",
d)})};var c=!1;a.onEmojiPicked=function(){c=!0;setTimeout(function(){return c=!1},200)}})(drop||(drop={}));var events;(function(a){var e,d;a.register=function(b,c,f){e||(e=new map.Map);d||(d=new map.Map);c||(c=function(){});e.set(b,c);f&&d.set(b,f)};a.getOpenEvent=function(b){return e.get(b)};a.getCloseEvent=function(b){return d.get(b)}})(events||(events={}));var flash;
(function(a){function e(){var b=!1;dom.els(".alert-top").forEach(function(c){b=!0;c.classList.add("uk-animation-fade","uk-animation-reverse")});b&&setTimeout(d,1E3)}function d(){dom.els(".alert-top").forEach(function(b){b.remove()})}a.wire=function(){setTimeout(e,4E3)}})(flash||(flash={}));var modal;
(function(a){function e(f,g){c=g;notify.modal("#modal-"+f).show();return!1}function d(f){if(f.target&&(f=f.target,0===f.id.indexOf("modal"))){f=f.id.substr(6);var g=events.getOpenEvent(f);g?g(c):console.warn("no modal open handler registered for ["+f+"]");c=void 0}}function b(f){f.target&&(f=f.target,f.classList.contains("uk-open")&&(f=f.id.substr(6),(f=events.getCloseEvent(f))&&f(c),c=void 0))}var c;a.wire=function(){dom.els(".modal").forEach(function(f){f.addEventListener("show",d);f.addEventListener("hide",
b)})};a.open=e;a.openSoon=function(f){setTimeout(function(){return e(f)},0)};a.hide=function(f){f=notify.modal("#modal-"+f);f.$el.classList.contains("uk-open")&&f.hide()}})(modal||(modal={}));var tags;
(function(a){function e(c){var f=dom.req(".value",c),g=dom.req(".editor",c);dom.setDisplay(f,!1);dom.setDisplay(g,!0);var h=a.renderInput(f.innerText);h.onblur=function(){f.innerText=h.value;dom.setDisplay(f,!0);dom.setDisplay(g,!1);b(c.parentElement)};h.onkeypress=function(k){return"Enter"===k.key?(h.blur(),!1):!0};dom.setContent(g,h);h.focus()}function d(c){c.target?b(c.target):console.warn("no event target")}function b(c){var f=c.dataset.key||"",g=events.getOpenEvent(f);g?g():console.warn("no tag open handler registered for ["+
f+"]");c=dom.els(".item",c).map(function(h){return h.innerText});dom.setValue("#model-"+f+"-input",c.join(","))}a.wire=function(){dom.els(".tag-editor").forEach(function(c){c.addEventListener("moved",d);c.addEventListener("added",d);c.addEventListener("removed",d)})};a.removeTag=function(c){c=c.parentElement;var f=c.parentElement;c.remove();b(f)};a.addTag=function(c){if(c=c.parentElement){var f=a.renderItem();c.insertBefore(f,dom.req(".add-item",c));e(f)}};a.editTag=e})(tags||(tags={}));
(function(a){a.renderInput=function(e){return JSX("input",{type:"text",class:"uk-input",value:e})};a.renderItem=function(){return JSX("span",{class:"item"},JSX("span",{class:"value",onclick:"tags.editTag(this.parentElement);"}),JSX("span",{class:"editor"}),JSX("span",{class:"close","data-uk-icon":"icon: close; ratio: 0.6;",onclick:"tags.removeTag(this);"}))};a.renderTagsView=function(e){return JSX("div",{class:"tag-view"},e.map(function(d){return JSX("span",{class:"item"},d)}),JSX("div",{class:"clear"}))}})(tags||
(tags={}));var socket;(function(a){a.initBypass=function(){a.bypass=!0;a.connected=!0;nav.enabled=!1};a.bypassSend=function(e){a.debug&&console.debug("out",e);npn_handler?npn_handler(JSON.stringify(e,null,2)):console.warn("no bypass handler configured")}})(socket||(socket={}));(function(a){a.debug=!0;a.appUnloading=!1;a.currentService="";a.currentID="";a.bypass=!1;a.setAppUnloading=function(){a.appUnloading=!0};a.send=function(e){a.bypass?a.bypassSend(e):a.socketSend(e)}})(socket||(socket={}));
(function(a){function e(){var n=document.location,p="ws";"https:"===n.protocol&&(p="wss");return p+("://"+n.host+"/s")}function d(){g=new WebSocket(e());g.onopen=c;g.onmessage=function(n){return m(json.parse(n.data))};g.onerror=function(n){return q("socket",n.type)};g.onclose=f}function b(n,p,r){a.currentService=n;a.currentID=p;a.connectTime=Date.now();if(!m)throw"onMessage not initialized";r?a.initBypass():d()}function c(){log.info("socket connected");a.connected=!0;h=1;k.forEach(a.send);k=[];l(a.currentID)}
function f(){function n(){a.connected=!1;var p=Date.now()-a.connectTime;2E3>p?(h*=2,a.debug&&console.debug("socket closed immediately, reconnecting in "+h+" seconds"),setTimeout(function(){b(a.currentService,a.currentID)},1E3*h)):(log.info("socket closed after ["+p+"ms]"),b(a.currentService,a.currentID))}a.appUnloading||n()}var g;a.connected=!1;var h=0,k=[],l,m,q;a.init=function(n,p,r){l=n;m=p;q=r};a.initSocket=d;a.socketConnect=b;a.socketSend=function(n){a.debug&&console.debug("out",n);a.connected?
(n=json.str(n),g.send(n)):k.push(n)}})(socket||(socket={}));var profile;
(function(a){a.setNavColor=function(e,d){dom.setValue("#nav-color",d);dom.req("#navbar").className=d+"-bg uk-navbar-container uk-navbar";document.querySelectorAll(".nav_swatch").forEach(function(b){b.classList.remove("active")});e.classList.add("active")};a.setLinkColor=function(e,d){dom.setValue("#link-color",d);dom.els(".profile-link").forEach(function(b){b.classList.forEach(function(c){-1<c.indexOf("-fg")&&b.classList.remove(c);b.classList.add(d+"-fg")})});document.querySelectorAll(".link_swatch").forEach(function(b){b.classList.remove("active")});
e.classList.add("active")};a.setPicture=function(e){dom.setValue("#self-picture-input",e);return!1}})(profile||(profile={}));var arr;(function(a){a.find=function(e,d){for(var b=e.length>>>0,c=0;c<b;){var f=e[c];if(d(c,f))return f;c++}}})(arr||(arr={}));var date;
(function(a){function e(c){return c.toLocaleDateString()}function d(c){return c.toLocaleTimeString().slice(0,8)}a.dateToYMD=function(c){var f=c.getDate(),g=c.getMonth()+1;return c.getFullYear()+"-"+(9>=g?"0"+g:g)+"-"+(9>=f?"0"+f:f)};a.dateFromYMD=function(c){c=new Date(c);return new Date(c.getTime()+6E4*c.getTimezoneOffset())};a.dow=function(c){switch(c){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat";default:return"???"}};
a.toDateString=e;a.toTimeString=d;a.toDateTimeString=function(c){return e(c)+" "+d(c)};var b=6E4*(new Date).getTimezoneOffset();a.utcDate=function(c){return new Date(Date.parse(c)+b)}})(date||(date={}));var group;
(function(a){function e(f,g){if(!f)return[];f.sort(function(h,k){h=g(h);k=g(k);return h>k?1:h<k?-1:0});return f}function d(f,g,h){if(!f)return[g];var k=!1,l=h(g),m;for(m in f)h(f[m])==l&&(k=!0,f[m]=g);k||f.push(g);return f}var b=function(f){this.members=[];this.key=f};a.Group=b;var c=function(){this.groups=[]};c.prototype.findOrInsert=function(f){var g=arr.find(this.groups,function(h,k){return k.key===f});if(g)return g;g=new b(f);this.groups.push(g);return g};a.GroupSet=c;a.groupBy=function(f,g){var h=
new c;f&&f.forEach(function(k){h.findOrInsert(g(k)).members.push(k)});return h};a.findGroup=function(f,g){f=$jscomp.makeIterator(f);for(var h=f.next();!h.done;h=f.next())if(h=h.value,h.key===g)return h.members;return[]};a.flatten=function(f){var g=[];f.forEach(function(h){return g.push.apply(g,$jscomp.arrayFromIterable(h))});return g};a.sort=e;a.update=d;a.updateAndSort=function(f,g,h){return e(d(f,g,h),h)};a.remove=function(f,g,h){return f?f.filter(function(k){return h(k)!=g}):[]}})(group||(group=
{}));var json;(function(a){a.str=function(e){return void 0===e?"null":JSON.stringify(e,null,2)};a.parse=function(e){return JSON.parse(e)}})(json||(json={}));var log;
(function(a){function e(g,h){if(0===b)console.warn("call `log.init()` before attempting to log");else{var k=Date.now()-b;k=JSX("li",{class:d(g)},JSX("div",{class:"right"},k,"ms"),h);if(!f&&(f=dom.opt("#log-list"),!f)){console.warn(g+": "+h);return}f.appendChild(k);c||(c=dom.req("#log-content"));c.scrollTo(0,c.scrollHeight)}}function d(g){switch(g){case "debug":return"grey-fg";case "info":return"";case "warn":return"yellow-fg";case "error":return"red-fg";default:return""}}var b=0,c,f;a.init=function(){b=
Date.now();e("debug","npn started")};a.info=function(g){e("info",g)};a.l=e;a.toggle=function(){var g=dom.req("#workspace-content"),h=dom.req("#log-container"),k=""!==h.style.display&&"none"!==h.style.display;k?g.classList.remove("log-visible"):g.classList.add("log-visible");dom.setDisplay(h,!k);c||(c=dom.req("#log-content"));c.scrollTo(0,c.scrollHeight)}})(log||(log={}));var map;
(function(a){var e=function(){this.storage=Object.create(null)};e.prototype.get=function(d){return this.storage[d]};e.prototype.set=function(d,b){return this.storage[d]=b};e.prototype.del=function(d){delete this.storage[d]};a.Map=e})(map||(map={}));var nav;
(function(a){function e(c){var f=$jscomp.makeIterator(d(c));c=f.next().value;f=f.next().value;if(!a.enabled)return b(c,f),"";if(str.startsWith(c,"text/html;"))return"";str.startsWith(c,"/")&&(c=c.substr(1));var g=location.pathname;str.startsWith(g,"/")&&(g=g.substr(1));g!==c&&(g=c,history.pushState(g,"","/"+g));b(c,f)}function d(c){var f="",g=c.indexOf("#");-1<g&&(f=c.substr(g+1),c=c.substr(0,g));return[c,f]}a.enabled=!0;var b=function(c,f){console.warn("default nav handler called: "+c+(0<f.length?
"#"+f:""))};a.init=function(c){b=c;window.onpopstate=function(f){if(f.state){var g=$jscomp.makeIterator(d(f.state));f=g.next().value;g=g.next().value;b(f,g)}else b("","")};e(location.pathname+(0<location.hash.length?location.hash:""))};a.navigate=e;a.pop=function(){var c=location.pathname.substr(0,location.pathname.lastIndexOf("/"));"/c"===c&&(c="");e(c)};a.hashLink=function(c,f,g){0===g.indexOf("#")&&(g=g.substr(1));var h="";g===c&&(h+="uk-active");f=JSX("li",{class:h},JSX("a",{href:"#"+c},f));f.onclick=
function(){history.replaceState(history.state,"","#"+c)};return f};a.link=function(c){var f=c.path;str.startsWith(f,"/")||(f="/"+f);c.cls=c.cls?" "+c.cls.trim():"";var g=JSX("span",null);c.icon&&(g=JSX("span",{class:"nav-icon","data-uk-icon":"icon: "+c.icon}));c.onclk?str.endsWith(c.onclk,";")||(c.onclk+=";"):c.onclk="";c.isButton||(c.cls=style.linkColor+c.cls);var h=c.path;c.hash&&0<c.hash.length&&(h+="#"+c.hash);return JSX("a",{class:c.cls,href:f,onclick:c.onclk+"nav.navigate('"+h+"', '"+c.title+
"');return false;"},g,c.title)}})(nav||(nav={}));var notify;(function(a){a.notify=function(e,d){UIkit.notification(e,{status:d?"success":"danger",pos:"top-right"})};a.confirm=function(e,d){UIkit.modal.confirm(e).then(d)};a.modal=function(e){var d=UIkit.modal(e);d||console.warn("no modal available with key ["+e+"]");return d}})(notify||(notify={}));var str;
(function(a){function e(b,c,f){f=f&&0<f?f|0:0;return b.substring(f,f+c.length)===c}function d(b,c,f){f=f&&f<b.length?f:b.length;return b.substring(f-c.length,f)===c}a.startsWith=e;a.endsWith=d;a.trimPrefix=function(b,c){return e(b,c)?b.slice(c.length):b};a.trimSuffix=function(b,c){return d(b,c)?b.substring(0,b.lastIndexOf(c)):b}})(str||(str={}));var rituals;
(function(a){function e(c,f){console.error(c+": "+f);var g=f.lastIndexOf(":");-1<g&&(f=f.substr(g+1));notify.notify(c+" error: "+f,!1)}function d(c){debug&&console.debug("in",c);switch(c.svc){case services.system.key:system.onSystemMessage(c.cmd,c.param);break;case services.team.key:team.onTeamMessage(c.cmd,c.param);break;case services.sprint.key:sprint.onSprintMessage(c.cmd,c.param);break;case services.estimate.key:estimate.onEstimateMessage(c.cmd,c.param);break;case services.standup.key:standup.onStandupMessage(c.cmd,
c.param);break;case services.retro.key:retro.onRetroMessage(c.cmd,c.param);break;default:console.warn("unhandled message for service ["+c.svc+"]")}}function b(c){system.cache.currentID=c;socket.send({svc:socket.currentService,cmd:command.client.connect,param:system.cache.currentID})}a.onError=e;a.init=function(c,f){window.onbeforeunload=function(){socket.setAppUnloading()};log.init();socket.init(b,d,e);socket.socketConnect(c,f)}})(rituals||(rituals={}));var action;
(function(a){a.loadActions=function(){socket.send({svc:services.system.key,cmd:command.client.getActions,param:null})};a.viewActions=function(e){dom.setContent("#action-list",a.renderActions(e))}})(action||(action={}));
(function(a){a.renderActions=function(e){return 0===e.length?JSX("div",null,"No actions available"):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("thead",null,JSX("tr",null,JSX("th",null,"User"),JSX("th",null,"Act"),JSX("th",null,"Content"),JSX("th",null,"Note"),JSX("th",null,"Created"))),JSX("tbody",null,e.map(function(d){var b=JSON.stringify(d.content,null,2);return JSX("tr",null,JSX("td",null,member.renderTitle(member.getMember(d.userID))),JSX("td",null,d.act),JSX("td",null,
"null"===b?"":JSX("pre",null,b)),JSX("td",null,d.note),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(d.created))))})))}})(action||(action={}));var auth;(function(a){a.allProviders=[{key:"github",title:"GitHub"},{key:"google",title:"Google"},{key:"slack",title:"Slack"},{key:"facebook",title:"Facebook"},{key:"amazon",title:"Amazon"},{key:"microsoft",title:"Microsoft"}];var e=[];a.applyAuths=function(d){e=d};a.active=function(){return e?e:[]}})(auth||(auth={}));var comment;
(function(a){function e(k,l){k&&"modal"!==k||(k=g,l||(l=h));"root"===k&&(k="");return l?f.filter(function(m){return m.targetType===k&&m.targetID==l}):f.filter(function(m){return m.targetType===k})}function d(k,l){k&&"modal"!==k||(k=g,l||(l=h));if(k){if(g=k,h=l,l=e(k,l),"root"!==k&&(k="modal"),dom.setContent("#drop-comment-"+k+" .uk-card-body",a.renderComments(l,system.cache.getProfile())),k=dom.opt("#drop-comment-"+k+" .uk-comment-list"))k.scrollTop=k.scrollHeight}else console.warn("invalid comment type ["+
k+"]")}function b(){var k=dom.els(".comment-count-container"),l=!1,m=dom.opt("#comment-count-modal");k.forEach(function(q){var n=q.dataset.commentType,p=q.dataset.commentId;if(!n)throw"invalid comment type ["+n+"] with id ["+p+"]";p=e(n,p);c(n,p,q);g===n&&m&&(c(n,p,m),l=!0)});!l&&m&&c("modal",[],m,!0)}function c(k,l,m,q){dom.setText(dom.req(".text",m),l.length.toString());"root"!==k&&"modal"!==k&&0!==k.length&&dom.setDisplay(m,0!==l.length||!0===q)}var f=[],g,h;a.applyComments=function(k){f=k};a.setActive=
function(k,l){g=k;h=l};a.show=function(k){modal.open("comment",k)};a.add=function(k){k=dom.req("#comment-add-content-"+k);var l=k.value.trim();0===l.length?notify.notify("enter some content",!0):(k.value="",socket.send({svc:services.system.key,cmd:command.client.addComment,param:{targetType:g,targetID:h,content:l}}))};a.onCommentUpdate=function(k){f.push(k);b();d()};a.load=d;a.setCounts=b;a.closeDrop=function(){"story"===g?modal.openSoon("story"):"report"===g?modal.openSoon("report"):"feedback"===
g&&modal.openSoon("feedback");g=void 0};a.remove=function(k){confirm("remove this comment?")&&socket.send({svc:services.system.key,cmd:command.client.removeComment,param:k});return!1};a.onCommentRemoved=function(k){f=f.filter(function(l){return l.id!==k});b();d()}})(comment||(comment={}));
(function(a){a.renderComments=function(e,d){return 0===e.length?JSX("p",{class:"uk-margin-bottom"},"No comments yet, why not add one?"):JSX("ul",{class:"uk-comment-list"},e.map(function(b){var c=b.userID===d.userID?JSX("div",{class:"right"},JSX("a",{class:d.linkColor+"-fg uk-margin-small-right","data-uk-icon":"close",href:"",onclick:"return comment.remove('"+b.id+"');",title:"remove your comment"})):JSX("span",null);return JSX("li",null,JSX("article",{class:"uk-comment uk-visible-toggle uk-transition-toggle",
tabindex:"-1"},member.renderHeader(member.getMember(b.userID),b.created,c),JSX("div",{class:"uk-comment-body"},JSX("div",{dangerouslySetInnerHTML:{__html:b.html}})),JSX("hr",null)))}))};a.renderCount=function(e,d){var b=system.cache.getProfile();return JSX("div",{class:"comment-count-container uk-margin-small-left left hidden","data-comment-type":e,"data-comment-id":d},JSX("a",{class:b.linkColor+"-fg",title:"view comments"},JSX("div",{class:"comment-count"},JSX("span",{class:"uk-icon","data-uk-icon":"comment"}),
JSX("span",{class:"text"}))))}})(comment||(comment={}));var contents;(function(a){a.onContentDisplay=function(e,d,b,c){dom.setDisplay("#modal-"+e+" .content-edit",d);dom.setDisplay("#modal-"+e+" .buttons-edit",d);var f=dom.setDisplay("#modal-"+e+" .content-view",!d);dom.setHTML(f,d?"":c);dom.setDisplay("#modal-"+e+" .buttons-view",!d);e=dom.req("#"+e+"-edit-content");dom.setValue(e,d?b:"");d&&dom.wireTextarea(e)}})(contents||(contents={}));
(function(a){function e(d,b){return b.map(function(c){return{svc:d,session:c}})}a.renderContents=function(d,b,c){c=e(b,c);c.sort(function(f,g){return f.session.created>g.session.created?-1:1});return 0===c.length?JSX("div",null,"No "+b.plural+" in this "+d.key):JSX("table",{class:"uk-table uk-table-divider uk-text-left"},JSX("tbody",null,c.map(function(f){var g=f.svc;f=f.session;var h=system.cache.getProfile();return JSX("tr",null,JSX("td",null,JSX("a",{class:h.linkColor+"-fg",href:"/"+g.key+"/"+
f.slug},f.title)),JSX("td",{class:"uk-table-shrink uk-text-nowrap"},date.toDateTimeString(new Date(f.created))))})))}})(contents||(contents={}));var estimate;
(function(a){function e(g){a.cache.detail=g;var h=g.choices.join(", ");dom.setValue("#model-choices-input",h);dom.setContent("#session-view-section .choices",tags.renderTagsView(g.choices));story.viewActiveStory();session.setDetail(g)}function d(g){var h=c(g.id);h.push(g);h.sort(function(k){return k.idx});g.id===a.cache.activeStory&&dom.setText("#story-title",g.title);story.setStories(h)}function b(g){var h=c(g);story.setStories(h);g===a.cache.activeStory&&modal.hide("story");notify.notify("story has been deleted",
!0)}function c(g){return a.cache.stories.filter(function(h){return h.id!==g})}var f=function(){this.stories=[];this.votes=[]};f.prototype.activeVotes=function(){var g=this;return this.activeStory?this.votes.filter(function(h){return h.storyID===g.activeStory}):[]};a.cache=new f;a.onEstimateMessage=function(g,h){switch(g){case command.server.error:rituals.onError(services.estimate.key,h);break;case command.server.sessionJoined:session.onSessionJoin(h);e(h.session);story.setStories(h.stories);vote.setVotes(h.votes);
session.showWelcomeMessage(h.session.status,h.members.length);break;case command.server.sessionUpdate:e(h);break;case command.server.sessionRemove:system.onSessionRemove(services.estimate);break;case command.server.permissionsUpdate:system.setPermissions(h);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===h||void 0===h?void 0:h.id);session.setTeam(h);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===h||void 0===h?void 0:h.id);
session.setSprint(h);break;case command.server.storyUpdate:d(h);break;case command.server.storyRemove:b(h);break;case command.server.storyStatusChange:story.onStoryStatusChange(h);break;case command.server.voteUpdate:vote.onVoteUpdate(h);break;default:console.warn("unhandled command ["+g+"] for estimate")}};a.onSubmitEstimateSession=function(){var g=dom.req("#model-title-input").value,h=dom.req("#model-choices-input").value,k=dom.req("#model-team-select select").value,l=dom.req("#model-sprint-select select").value,
m=permission.readPermissions();socket.send({svc:services.estimate.key,cmd:command.client.updateSession,param:{title:g,choices:h,teamID:k,sprintID:l,permissions:m}})};a.onStoryUpdate=d;a.onStoryRemove=b})(estimate||(estimate={}));var feedback;
(function(a){function e(){if(retro.cache.activeFeedback){var c=retro.cache.feedback.filter(function(f){return f.id===retro.cache.activeFeedback}).shift();c||console.warn("cannot load active Feedback ["+retro.cache.activeFeedback+"]");return c}}function d(c){return retro.cache.feedback.filter(function(f){return f.id!==c})}function b(c,f){feedback.setFeedback(c);f===retro.cache.activeFeedback&&modal.hide("feedback")}a.setFeedback=function(c){retro.cache.feedback=c;dom.setContent("#feedback-detail",
a.renderFeedbackArray(c));comment.setCounts();modal.hide("add-feedback")};a.onSubmitFeedback=function(){var c=dom.req("#feedback-category").value,f=dom.req("#feedback-content").value;socket.send({svc:services.retro.key,cmd:command.client.addFeedback,param:{category:c,content:f}});return!1};a.onEditFeedback=function(){var c=retro.cache.activeFeedback,f=dom.req("#feedback-edit-category").value,g=dom.req("#feedback-edit-content").value;socket.send({svc:services.retro.key,cmd:command.client.updateFeedback,
param:{id:c,category:f,content:g}});return!1};a.onRemoveFeedback=function(){var c=retro.cache.activeFeedback;c&&notify.confirm("Delete this feedback?",function(){socket.send({svc:services.retro.key,cmd:command.client.removeFeedback,param:c});modal.hide("feedback")});return!1};a.getActiveFeedback=e;a.viewActiveFeedback=function(c){var f,g=system.cache.getProfile();c&&(retro.cache.activeFeedback=c);(c=e())?(g=c.userID===g.userID,dom.setText("#feedback-title",c.category+" / "+(null===(f=member.getMember(c.userID))||
void 0===f?void 0:f.name)),dom.setSelectOption("#feedback-edit-category",g?c.category:void 0),contents.onContentDisplay("feedback",g,c.content,c.html),comment.setActive("feedback",c.id),comment.setCounts()):console.warn("no active feedback")};a.onFeedbackUpdate=function(c){var f=d(c.id);f.push(c);b(f,c.id)};a.onFeedbackRemoved=function(c){var f=d(c);b(f,c);notify.notify("feedback has been deleted",!0)};a.getFeedbackCategories=function(c,f){var g=f.map(function(k){var l=c.filter(function(m){return m.category===
k}).sort(function(m,q){return m.created>q.created?-1:1});return{category:k,feedback:l}}),h=c.filter(function(k){return!f.find(function(l){return l===k.category})});0<h.length&&g.push({category:"unknown",feedback:h});return g};a.viewAddFeedback=function(c){dom.setSelectOption("#feedback-category",c);var f=dom.setValue("#feedback-content","");dom.wireTextarea(f);setTimeout(function(){return f.focus()},250)};a.viewFeedback=function(c){feedback.viewActiveFeedback(c);var f=dom.req("#feedback-edit-content");
setTimeout(function(){dom.wireTextarea(f);f.focus()},250)}})(feedback||(feedback={}));
(function(a){a.renderFeedbackArray=function(e){var d;if(0===e.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-feedback');",type:"button"},"Add Feedback"));e=a.getFeedbackCategories(e,(null===(d=retro.cache.detail)||void 0===d?void 0:d.categories)||[]);var b=system.cache.getProfile();return JSX("div",{class:"uk-grid-small uk-grid-match uk-child-width-expand@m uk-grid-divider","data-uk-grid":!0},e.map(function(c){return JSX("div",{class:"feedback-list uk-transition-toggle"},
JSX("div",{class:"feedback-category-header"},JSX("span",{class:"right"},JSX("a",{class:b.linkColor+"-fg uk-icon-button uk-transition-fade","data-uk-icon":"plus",onclick:"modal.open('add-feedback', '"+c.category+"');",title:"add feedback"})),JSX("span",{class:"feedback-category-title",onclick:"modal.open('add-feedback', '"+c.category+"');"},c.category)),JSX("div",null,c.feedback.map(function(f){var g=system.cache.getProfile();g=JSX("div",{id:"feedback-"+f.id,class:"feedback-detail section",onclick:"modal.open('feedback', '"+
f.id+"');"},JSX("div",{class:"feedback-comments right"},comment.renderCount("feedback",f.id)),JSX("div",{class:"left"},JSX("a",{class:g.linkColor+"-fg section-link"},member.renderTitle(member.getMember(f.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"feedback-content"},"loading..."));0<f.html.length&&(dom.setHTML(dom.req(".feedback-content",g),f.html).style.display="block");return JSX("div",null,g)})))}))}})(feedback||(feedback={}));var member;
(function(a){a.memberUpdateDom=function(e){if(e)switch(system.cache.currentService){case services.estimate:estimate.cache.activeStory&&vote.viewVotes();break;case services.standup:dom.setContent("#report-detail",report.renderReports(standup.cache.reports));standup.cache.activeReport&&report.viewActiveReport();break;case services.retro:dom.setContent("#feedback-detail",feedback.renderFeedbackArray(retro.cache.feedback)),retro.cache.activeFeedback&&feedback.viewActiveFeedback()}};a.activeMemberDom=
function(e){var d=a.selfCanEdit();dom.setDisplay("#modal-member .owner-form",d);dom.setDisplay("#modal-member .member-form",!d);dom.setDisplay("#modal-member .owner-actions",d);dom.setDisplay("#modal-member .member-actions",!d);dom.setSelectOption("#member-modal-role-select",e.role);dom.setText("#member-modal-name",e.name);dom.setText("#member-modal-role",e.role)}})(member||(member={}));
(function(a){function e(){var f=b.filter(a.isSelf).shift();a.updateSelf(f);f=b.filter(function(g){return!a.isSelf(g)});dom.setContent("#member-detail",a.renderMembers(f));0<f.length&&modal.hide("welcome");a.renderOnline()}function d(){if(c){var f=b.filter(function(g){return g.userID===c}).shift();f||console.warn("cannot load active member ["+c+"]");return f}console.warn("no active member")}var b=[],c;a.getMember=function(f){return b.filter(function(g){return g.userID===f}).shift()};a.getMembers=function(){return b};
a.setMembers=e;a.onMemberUpdate=function(f){a.isSelf(f)?modal.hide("self"):modal.hide("member");var g=b,h=g.filter(function(k){return k.userID===f.userID}).shift();h=(null===h||void 0===h?void 0:h.name)!==f.name;g=g.filter(function(k){return k.userID!==f.userID});g.length===b.length&&notify.notify(f.name+" has joined",!0);g.push(f);g.sort(function(k,l){return k.name>l.name?1:-1});b=g;e();a.memberUpdateDom(h)};a.onMemberRemove=function(f){var g;f===system.cache.getProfile().userID?(notify.notify("you have left this "+
(null===(g=system.cache.currentService)||void 0===g?void 0:g.key),!0),document.location.href="/"):(modal.hide("member"),g=b.filter(function(h){return h.userID!==f}),g.sort(function(h,k){return h.name>k.name?1:-1}),b=g,e())};a.viewActiveMember=function(f){f&&(c=f);(f=d())&&a.activeMemberDom(f)};a.removeMember=function(f){(f=void 0===f?c:f)||console.warn("cannot load active member ["+c+"]");"self"===f&&(f=system.cache.getProfile().userID);var g=system.cache.currentService;confirm("Are you sure you wish to leave this "+
g.key+"?")&&socket.send({svc:g.key,cmd:command.client.removeMember,param:f})};a.saveRole=function(){var f=d();if(f){var g=f.role,h=dom.req("#member-modal-role-select").value;g===h?modal.hide("member"):socket.send({svc:system.cache.currentService.key,cmd:command.client.updateMember,param:{id:f.userID,role:h}})}else console.warn("no active member")};a.applyMembers=function(f){b=f};a.loadQR=function(){var f=dom.req("#qrcode");f.src=f.dataset.src}})(member||(member={}));
(function(a){function e(d){return d?d.picture&&0<d.picture.length&&"none"!=d.picture?JSX("div",null,JSX("div",{class:"profile-image"},JSX("img",{class:"uk-border-circle",src:d.picture,alt:d.name})),JSX("div",{class:"left"},d.name),JSX("div",{class:"clear"})):JSX("div",null,JSX("div",{class:"profile-image"},JSX("span",{class:"profile-icon","data-uk-icon":"user"})),JSX("div",{class:"left"},d.name)):JSX("span",null,"{former member}")}a.renderMembers=function(d){return 0===d.length?JSX("div",null,JSX("button",
{class:"uk-button uk-button-default",onclick:"modal.open('invitation');",type:"button"},"Invite Members")):JSX("ul",{class:"uk-list uk-list-divider"},d.map(function(b){var c={id:"member-"+b.userID},f=system.cache.getProfile();b=JSX("div",{class:"section",onclick:"modal.open('member', '"+b.userID+"');"},JSX("div",{title:"user is offline",class:"right uk-article-meta online-indicator"},"offline"),JSX("div",{class:f.linkColor+"-fg section-link"},e(b)));return JSX("li",c,b)}))};a.renderTitle=e;a.renderHeader=
function(d,b,c){return JSX("header",{class:"uk-comment-header uk-position-relative"},c?c:JSX("span",null),JSX("div",{class:"uk-grid-collapse uk-flex-middle","uk-grid":!0},JSX("div",{class:"uk-width-auto"},d&&d.picture&&0<d.picture.length?JSX("div",null,JSX("div",{class:"profile-image"},JSX("img",{class:"uk-border-circle",src:d.picture,alt:d.name}))):JSX("div",null,JSX("div",{class:"profile-image"},JSX("span",{class:"profile-icon","data-uk-icon":"user"})))),JSX("div",{class:"uk-width-expand"},JSX("h4",
{class:"uk-comment-title uk-margin-remove"},null===d||void 0===d?void 0:d.name),JSX("p",{class:"uk-comment-meta uk-margin-remove-top"},date.toDateTimeString(new Date(b))))))};a.viewSelf=function(){var d=dom.setValue("#self-name-input",dom.req("#member-self .member-name").innerText);setTimeout(function(){return d.focus()},250)};a.setPicture=function(d){return d&&0<d.length&&"none"!=d?JSX("div",{class:"model-icon profile-image"},JSX("img",{class:"uk-border-circle",src:d,alt:"your picture"})):JSX("span",
{class:"model-icon h3-icon",onclick:"modal.open('self');","data-uk-icon":"icon: user;"})}})(member||(member={}));
(function(a){function e(){a.getMembers().forEach(function(b){var c=dom.opt("#member-"+b.userID+" .online-indicator");c&&(d.find(function(f){return f===b.userID})?c.classList.remove("offline"):c.classList.add("offline"))})}var d=[];a.onOnlineUpdate=function(b){b.connected?d.find(function(c){return c===b.userID})||d.push(b.userID):d=d.filter(function(c){return c!==b.userID});e()};a.applyOnline=function(b){d=b};a.renderOnline=e})(member||(member={}));
(function(a){var e;a.isSelf=function(d){var b=system.cache.getProfile().userID;return d.userID===b};a.selfCanEdit=function(){return void 0!==e&&"owner"==e.role};a.updateSelf=function(d){var b=!1;d&&(e=d,dom.setContent("#self-picture",a.setPicture(d.picture)),dom.setText("#member-self .member-name",d.name),dom.setValue("#self-name-input",d.name),dom.setText("#member-self .member-role",d.role),b="owner"==d.role);dom.setDisplay("#history-container",b);dom.setDisplay("#session-edit-section",b);dom.setDisplay("#session-view-section",
!b)};a.onSubmitSelf=function(){var d=dom.req("#self-name-input").value,b=dom.req("#self-name-choice-global").checked?"global":"local",c=dom.req("#self-picture-input").value;socket.send({svc:services.system.key,cmd:command.client.updateProfile,param:{name:d,choice:b,picture:c}})}})(member||(member={}));var command;
(function(a){a.client={ping:"ping",connect:"connect",setActive:"set-active",getActions:"get-actions",getTeams:"get-teams",getSprints:"get-sprints",updateSession:"update-session",addComment:"add-comment",updateComment:"update-comment",removeComment:"remove-comment",updateProfile:"update-profile",updateMember:"update-member",removeMember:"remove-member",addStory:"add-story",updateStory:"update-story",removeStory:"remove-story",setStoryStatus:"set-story-status",submitVote:"submit-vote",addReport:"add-report",
updateReport:"update-report",removeReport:"remove-report",addFeedback:"add-feedback",updateFeedback:"update-feedback",removeFeedback:"remove-feedback"};a.server={error:"error",pong:"pong",sessionJoined:"session-joined",sessionUpdate:"session-update",sessionRemove:"session-remove",commentUpdate:"comment-update",commentRemove:"comment-remove",permissionsUpdate:"permissions-update",teamUpdate:"team-update",sprintUpdate:"sprint-update",contentUpdate:"content-update",actions:"actions",teams:"teams",sprints:"sprints",
memberUpdate:"member-update",memberRemove:"member-remove",onlineUpdate:"online-update",storyUpdate:"story-update",storyRemove:"story-remove",storyStatusChange:"story-status-change",voteUpdate:"vote-update",reportUpdate:"report-update",reportRemove:"report-remove",feedbackUpdate:"feedback-update",feedbackRemove:"feedback-remove"}})(command||(command={}));var services;
(function(a){a.system={key:"system",title:"System",plural:"systems",icon:"close"};a.team={key:"team",title:"Team",plural:"teams",icon:"users"};a.sprint={key:"sprint",title:"Sprint",plural:"sprints",icon:"git-fork"};a.estimate={key:"estimate",title:"Estimate Session",plural:"estimates",icon:"settings"};a.standup={key:"standup",title:"Daily Standup",plural:"standups",icon:"future"};a.retro={key:"retro",title:"Retrospective",plural:"retros",icon:"history"};var e=[a.system,a.team,a.sprint,a.estimate,
a.standup,a.retro];a.fromKey=function(d){var b=e.find(function(c){return c.key===d});if(!b)throw"invalid service ["+d+"]";return b}})(services||(services={}));var permission;
(function(a){function e(b){var c=dom.opt("#model-"+b+"-select select");if(c){var f=group.findGroup(a.permissions,b),g=dom.opt("#perm-"+b+"-section");g&&(dom.req("#perm-"+b+"-checkbox").checked=0<f.length,dom.setDisplay(g,0!==c.value.length));group.findGroup(a.permissions,b)}}function d(b){var c=dom.opt("#perm-"+b+"-checkbox");if(!c||!c.checked)return[];c=dom.els(".perm-"+b+"-email").filter(function(f){return f.checked}).map(function(f){return f.value}).join(",");return[{k:b,v:c,access:"member"}]}
a.permissions=[];a.applyPermissions=function(b){b=group.groupBy(b,function(c){return c.k}).groups;a.permissions=b};a.setPerms=function(){var b=null===a.permissions||0===a.permissions.length;dom.setDisplay("#public-link-container",b);dom.setDisplay("#private-link-container",!b);a.updateView();["team","sprint"].forEach(e);auth.allProviders.forEach(a.setProviderPerms)};a.setModelPerms=e;a.readPermissions=function(){var b=[];b.push.apply(b,$jscomp.arrayFromIterable(d("team")));b.push.apply(b,$jscomp.arrayFromIterable(d("sprint")));
b.push.apply(b,$jscomp.arrayFromIterable(d("github")));b.push.apply(b,$jscomp.arrayFromIterable(d("google")));b.push.apply(b,$jscomp.arrayFromIterable(d("slack")));b.push.apply(b,$jscomp.arrayFromIterable(d("facebook")));b.push.apply(b,$jscomp.arrayFromIterable(d("amazon")));b.push.apply(b,$jscomp.arrayFromIterable(d("microsoft")));return b}})(permission||(permission={}));
(function(a){function e(d){switch(d.key){case services.team.key:return JSX("li",null,"Must be a member of this session's team");case services.sprint.key:return JSX("li",null,"Must be a member of this session's sprint");default:var b=group.flatten(d.members.map(function(c){return c.k.split(",").map(function(f){return f.trim()}).filter(function(f){return 0<f.length})}));return 0===b.length?JSX("li",null,"Must sign in with ",d.key):JSX("li",null,"Must sign in with ",d.key," using an email address from ",
b.join(" or "))}}a.renderEmails=function(d,b){var c="uk-checkbox uk-margin-small-right perm-"+d+"-email",f="permission.onChanged('email', '"+d+"', this.checked)";return JSX("ul",null,b.map(function(g){return JSX("li",null,JSX("label",null,g.matched?JSX("input",{class:c,type:"checkbox",value:g.domain,checked:"checked",onchange:f}):JSX("input",{class:c,type:"checkbox",value:g.domain,onchange:f}),"Using email address ",g.domain))}))};a.renderView=function(d){return 0===d.length?JSX("div",null,"public"):
JSX("ul",null,d.map(function(b){return e(b)}))}})(permission||(permission={}));
(function(a){function e(d,b){dom.els(".perm-"+d+"-email").forEach(function(c){c.disabled=!b;b||(c.checked=!1)})}a.setProviderPerms=function(d){var b=group.findGroup(a.permissions,d.key),c=auth.active().filter(function(h){return h.provider===d.key});if(dom.opt("#perm-"+d.key+"-section")){dom.req("#perm-"+d.key+"-checkbox").checked=0<b.length;var f=dom.req("#perm-"+d.key+"-email-container"),g=group.flatten(b.map(function(h){return h.v.split(",").filter(function(k){return 0<k.length})})).map(function(h){return{matched:!0,
domain:h}});b=c.filter(function(h){return 0===g.filter(function(k){return h.email.endsWith(k.domain)}).length}).map(function(h){h=h.email;var k=h.lastIndexOf("@");h=-1===k?h:h.substr(k);return{matched:!1,domain:h}});g.push.apply(g,$jscomp.arrayFromIterable(b));g.sort();dom.setDisplay(f,0<g.length);dom.setContent(f,0===g.length?document.createElement("span"):a.renderEmails(d.key,g))}};a.onChanged=function(d,b,c){switch(d){case "email":(d=dom.opt("#perm-"+b+"-checkbox"))&&c&&!d.checked&&(d.checked=
!0);break;case "provider":return e(b,c)}}})(permission||(permission={}));(function(a){a.updateView=function(){var e=dom.req("#session-view-section .perms");dom.clear(e);e.appendChild(a.renderView(a.permissions))}})(permission||(permission={}));var report;
(function(a){function e(){if(standup.cache.activeReport){var d=standup.cache.reports.filter(function(b){return b.id===standup.cache.activeReport}).shift();d||console.warn("cannot load active report ["+standup.cache.activeReport+"]");return d}console.warn("no active report")}a.onSubmitReport=function(){var d=dom.req("#report-date").value,b=dom.req("#report-content").value;socket.send({svc:services.standup.key,cmd:command.client.addReport,param:{d:d,content:b}});return!1};a.onEditReport=function(){var d=
dom.req("#report-edit-date").value,b=dom.req("#report-edit-content").value;socket.send({svc:services.standup.key,cmd:command.client.updateReport,param:{id:standup.cache.activeReport,d:d,content:b}});return!1};a.onRemoveReport=function(){var d=standup.cache.activeReport;d&&notify.confirm("Delete this report?",function(){socket.send({svc:services.standup.key,cmd:command.client.removeReport,param:d});modal.hide("report")});return!1};a.viewActiveReport=function(d){var b,c=system.cache.getProfile();d&&
(standup.cache.activeReport=d);(d=e())?(dom.setText("#report-title",date.toDateString(date.dateFromYMD(d.d))+" - "+(null===(b=member.getMember(d.userID))||void 0===b?void 0:b.name)),b=d.userID===c.userID,dom.setValue(dom.req("#report-edit-date"),b?d.d:""),contents.onContentDisplay("report",b,d.content,d.html),comment.setActive("report",d.id),comment.setCounts()):console.warn("no active report")};a.setReports=function(d){standup.cache.reports=d;dom.setContent("#report-detail",a.renderReports(d));comment.setCounts();
modal.hide("add-report")};a.getReportDates=function(d){return d.map(function(b){return b.d}).filter(function(b,c,f){return f.indexOf(b)===c}).sort().reverse().map(function(b){var c=d.filter(function(f){return f.d===b}).sort(function(f,g){return f.created>g.created?-1:1});return{d:b,reports:c}})};a.viewAddReport=function(){dom.setValue("#report-date",date.dateToYMD(new Date));var d=dom.setValue("#report-content","");dom.wireTextarea(d);setTimeout(function(){return d.focus()},250)};a.viewReport=function(d){report.viewActiveReport(d);
var b=dom.req("#report-edit-content");setTimeout(function(){dom.wireTextarea(b);b.focus()},250)}})(report||(report={}));
(function(a){a.renderReports=function(e){if(0===e.length)return JSX("div",null,JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-report');",type:"button"},"Add Report"));e=a.getReportDates(e);return JSX("ul",{class:"uk-list"},e.map(function(d){return JSX("li",{id:"report-date-"+d.d},JSX("h5",null,JSX("div",{class:"right uk-article-meta"},date.dow(date.dateFromYMD(d.d).getDay())),date.toDateString(date.dateFromYMD(d.d))),JSX("ul",null,d.reports.map(function(b){var c=system.cache.getProfile();
c=JSX("div",{id:"report-"+b.id,class:"report-detail section",onclick:"modal.open('report', '"+b.id+"');"},JSX("div",{class:"report-comments right"},comment.renderCount("report",b.id)),JSX("div",{class:"left"},JSX("a",{class:c.linkColor+"-fg section-link"},member.renderTitle(member.getMember(b.userID)))),JSX("div",{class:"clear"}),JSX("div",{class:"report-content"},"loading..."));0<b.html.length&&(dom.setHTML(dom.req(".report-content",c),b.html).style.display="block");return JSX("li",null,c)})))}))}})(report||
(report={}));var retro;
(function(a){function e(d){a.cache.detail=d;var b=d.categories.join(", ");dom.setValue("#model-categories-input",b);dom.setContent("#session-view-section .categories",tags.renderTagsView(d.categories));dom.setOptions("#feedback-category",d.categories);dom.setOptions("#feedback-edit-category",d.categories);feedback.setFeedback(a.cache.feedback);session.setDetail(d)}a.cache=new function(){this.feedback=[]};a.onRetroMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.retro.key,b);
break;case command.server.sessionJoined:session.onSessionJoin(b);e(b.session);feedback.setFeedback(b.feedback);session.showWelcomeMessage(b.session.status,b.members.length);break;case command.server.sessionUpdate:e(b);break;case command.server.sessionRemove:system.onSessionRemove(services.retro);break;case command.server.permissionsUpdate:system.setPermissions(b);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===b||void 0===b?void 0:b.id);session.setTeam(b);break;
case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===b||void 0===b?void 0:b.id);session.setSprint(b);break;case command.server.feedbackUpdate:feedback.onFeedbackUpdate(b);break;case command.server.feedbackRemove:feedback.onFeedbackRemoved(b);break;default:console.warn("unhandled command ["+d+"] for retro")}};a.onSubmitRetroSession=function(){var d=dom.req("#model-title-input").value,b=dom.req("#model-categories-input").value,c=dom.req("#model-team-select select").value,
f=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.retro.key,cmd:command.client.updateSession,param:{title:d,categories:b,teamID:c,sprintID:f,permissions:g}})}})(retro||(retro={}));var session;
(function(a){a.setDetail=function(e){var d,b=(null===(d=system.cache.session)||void 0===d?void 0:d.slug)||"invalid";system.cache.session=e;document.title=e.title;dom.setText("#model-title",e.title);dom.setText("#session-view-section .uk-modal-title",e.title);dom.setValue("#model-title-input",e.title);d=dom.els("#navbar .uk-navbar-item");0<d.length&&dom.setText(d[d.length-1],e.title);b!==e.slug&&window.history.replaceState(null,"",document.location.href.replace(b,e.slug));member.selfCanEdit()&&modal.hide("session")};
a.onSessionJoin=function(e){system.cache.apply(e);permission.setPerms();member.setMembers();comment.setCounts()};a.showWelcomeMessage=function(e,d){"new"===e&&1===d&&(socket.send({svc:services.system.key,cmd:command.client.setActive,param:null}),setTimeout(function(){return modal.open("welcome")},300))};a.setTeam=function(e){var d=dom.req("#team-link-container"),b=dom.req("#session-view-section .team");dom.clear(d);dom.setDisplay("#team-warning-container",void 0!==e);e?(d.appendChild(team.renderTeamLink(e)),
dom.setContent(b,team.renderTeamLink(e,!0)),dom.setText("#team-warning-name",e.title)):dom.setHTML(b,"-none-")};a.setSprint=function(e){var d=dom.req("#sprint-link-container"),b=dom.req("#session-view-section .sprint");dom.clear(d);dom.setDisplay("#sprint-warning-container",void 0!==e);e?(d.appendChild(sprint.renderSprintLink(e)),dom.setContent(b,sprint.renderSprintLink(e,!0)),dom.setText("#sprint-warning-name",e.title)):dom.setHTML(b,"-none-")};a.onModalOpen=function(e){var d=dom.setValue("#model-title-input",
dom.req("#model-title").innerText);setTimeout(function(){return d.focus()},250);team.refreshTeams();sprint.refreshSprints()}})(session||(session={}));var sprint;
(function(a){function e(d){a.cache.detail=d;var b=d.startDate?date.utcDate(d.startDate):void 0,c=d.endDate?date.utcDate(d.endDate):void 0;dom.setContent("#sprint-date-display",a.renderSprintDates(b,c));dom.setValue("#sprint-start-date-input",b?date.dateToYMD(b):"");dom.setValue("#sprint-end-date-input",c?date.dateToYMD(c):"");session.setDetail(d)}a.cache=new function(){};a.onSprintMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.sprint.key,b);break;case command.server.sessionJoined:session.onSessionJoin(b);
e(b.session);dom.setContent("#sprint-estimate-list",contents.renderContents(services.sprint,services.estimate,b.estimates));dom.setContent("#sprint-standup-list",contents.renderContents(services.sprint,services.standup,b.standups));dom.setContent("#sprint-retro-list",contents.renderContents(services.sprint,services.retro,b.retros));session.showWelcomeMessage(b.session.status,b.members.length);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===b||void 0===b?void 0:b.id);
session.setTeam(b);break;case command.server.sessionUpdate:e(b);break;case command.server.sessionRemove:system.onSessionRemove(services.sprint);break;case command.server.permissionsUpdate:system.setPermissions(b);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService.key,system.cache.currentID);break;default:console.warn("unhandled command ["+d+"] for sprint")}};a.onSubmitSprintSession=function(){var d,b,c=dom.req("#model-title-input").value,f=dom.req("#model-team-select select").value,
g=null===(d=dom.opt("#sprint-start-date-input"))||void 0===d?void 0:d.value;d=null===(b=dom.opt("#sprint-end-date-input"))||void 0===b?void 0:b.value;b=permission.readPermissions();socket.send({svc:services.sprint.key,cmd:command.client.updateSession,param:{title:c,startDate:g,endDate:d,teamID:f,permissions:b}})};a.refreshSprints=function(){dom.opt("#model-sprint-select")&&socket.send({svc:services.system.key,cmd:command.client.getSprints,param:null})};a.viewSprints=function(d){var b;dom.opt("#model-sprint-container")&&
(dom.setContent("#model-sprint-select",a.renderSprintSelect(d,null===(b=system.cache.session)||void 0===b?void 0:b.sprintID)),permission.setModelPerms("sprint"))}})(sprint||(sprint={}));
(function(a){a.renderSprintDates=function(e,d){function b(g,h){return JSX("span",null,g," ",JSX("span",{class:"sprint-date",onclick:"modal.open('session');"},h?date.toDateString(h):""))}var c=b("starts",e),f=b("ends",d);return e?d?JSX("span",null,c,", ",f):c:d?f:JSX("span",null,"Sprint")};a.renderSprintLink=function(e,d){var b=system.cache.getProfile();e=JSX("a",{class:b.linkColor+"-fg",href:"/sprint/"+e.slug},e.title);return d?e:JSX("span",null,e," ")};a.renderSprintSelect=function(e,d){return JSX("select",
{class:"uk-select",onchange:"permission.setModelPerms('sprint')"},JSX("option",{value:""},"- no sprint -"),e.map(function(b){return b.id===d?JSX("option",{selected:"selected",value:b.id},b.title):JSX("option",{value:b.id},b.title)}))}})(sprint||(sprint={}));var standup;
(function(a){function e(b){return a.cache.reports.filter(function(c){return c.id!==b})}function d(b,c){report.setReports(b);c===a.cache.activeReport&&modal.hide("report")}a.cache=new function(){this.reports=[]};a.onStandupMessage=function(b,c){switch(b){case command.server.error:rituals.onError(services.standup.key,c);break;case command.server.sessionJoined:session.onSessionJoin(c);b=c.session;a.cache.detail=b;session.setDetail(b);report.setReports(c.reports);session.showWelcomeMessage(c.session.status,
c.members.length);break;case command.server.sessionUpdate:a.cache.detail=c;session.setDetail(c);break;case command.server.sessionRemove:system.onSessionRemove(services.standup);break;case command.server.permissionsUpdate:system.setPermissions(c);break;case command.server.teamUpdate:a.cache.detail&&(a.cache.detail.teamID=null===c||void 0===c?void 0:c.id);session.setTeam(c);break;case command.server.sprintUpdate:a.cache.detail&&(a.cache.detail.sprintID=null===c||void 0===c?void 0:c.id);session.setSprint(c);
break;case command.server.reportUpdate:b=e(c.id);b.push(c);d(b,c.id);break;case command.server.reportRemove:b=e(c);d(b,c);notify.notify("report has been deleted",!0);break;default:console.warn("unhandled command ["+b+"] for standup")}};a.onSubmitStandupSession=function(){var b=dom.req("#model-title-input").value,c=dom.req("#model-team-select select").value,f=dom.req("#model-sprint-select select").value,g=permission.readPermissions();socket.send({svc:services.standup.key,cmd:command.client.updateSession,
param:{title:b,teamID:c,sprintID:f,permissions:g}})}})(standup||(standup={}));var story;
(function(a){function e(b){function c(g,h){g.id.substr(g.id.lastIndexOf("-")+1)===h?g.classList.add("active"):g.classList.remove("active")}dom.els(".story-status-body").forEach(function(g){c(g,b)});dom.els(".story-status-actions").forEach(function(g){c(g,b)});var f="";switch(b){case "new":f="Story";break;case "active":f="Voting";break;case "complete":f="Results"}dom.setText("#story-status",f);vote.viewVotes()}function d(b,c,f,g){f&&"complete"===f.status&&0<f.finalVote.length&&(c=f.finalVote);dom.setContent("#story-"+
b+" .story-status",a.renderStatus(c));g&&a.showTotalIfNeeded()}a.viewStoryStatus=e;a.requestStoryStatus=function(b){var c=a.getActiveStory();c&&socket.send({svc:services.estimate.key,cmd:command.client.setStoryStatus,param:{storyID:c.id,status:b}})};a.setStoryStatus=d;a.onStoryStatusChange=function(b){var c=void 0;estimate.cache.stories.forEach(function(f){f.id===b.storyID&&(c=f,f.finalVote=b.finalVote,f.status=b.status)});d(b.storyID,b.status,c,!0);b.storyID===estimate.cache.activeStory&&e(b.status)}})(story||
(story={}));
(function(a){function e(){if(estimate.cache.activeStory){var b=estimate.cache.stories.filter(function(c){return c.id===estimate.cache.activeStory}).shift();b||console.warn("cannot load active story ["+estimate.cache.activeStory+"]");return b}}function d(){var b=0;estimate.cache.stories.filter(function(g){return"complete"===g.status}).map(function(g){return g.finalVote}).filter(function(g){return 0<g.length}).map(function(g){return parseFloat(g)}).filter(function(g){return!isNaN(g)}).forEach(function(g){return b+=g});
var c=dom.opt("#story-total"),f=dom.req("#story-list");void 0!==c&&f.removeChild(c);0<b&&f.appendChild(a.renderTotal(b))}a.setStories=function(b){estimate.cache.stories=b;dom.setContent("#story-detail",a.renderStories(b));b.forEach(function(c){return a.setStoryStatus(c.id,c.status,c,!1)});d();comment.setCounts();modal.hide("add-story")};a.onSubmitStory=function(){var b=dom.req("#story-title-input").value;socket.send({svc:services.estimate.key,cmd:command.client.addStory,param:{title:b}});return!1};
a.beginEditStory=function(){var b=e(),c=prompt("Edit your story",b.title);c&&c!==b.title&&socket.send({svc:services.estimate.key,cmd:command.client.updateStory,param:{storyID:b.id,title:c}});return!1};a.onRemoveStory=function(){var b=estimate.cache.activeStory;b&&notify.confirm("Delete this story?",function(){socket.send({svc:services.estimate.key,cmd:command.client.removeStory,param:b});modal.hide("story")});return!1};a.getActiveStory=e;a.viewActiveStory=function(b){b&&(estimate.cache.activeStory=
b);if(b=e())dom.setText("#story-title",b.title),a.viewStoryStatus(b.status),comment.setActive("story",b.id),comment.setCounts()};a.showTotalIfNeeded=d})(story||(story={}));
(function(a){a.renderStories=function(e){return 0===e.length?JSX("div",{id:"story-list"},JSX("button",{class:"uk-button uk-button-default",onclick:"modal.open('add-story');",type:"button"},"Add Story")):JSX("table",{class:"uk-table uk-table-divider uk-table-small"},JSX("ul",{id:"story-list",class:"uk-list uk-list-divider"},e.map(function(d){var b=system.cache.getProfile();return JSX("li",{id:"story-"+d.id,class:"section",onclick:"modal.open('story', '"+d.id+"');"},JSX("div",{class:"right uk-article-meta story-status"},
d.status),JSX("div",{class:b.linkColor+"-fg section-link left"},d.title),JSX("div",{class:"left",style:"margin-top: 4px;"},comment.renderCount("story",d.id)))})))};a.renderStatus=function(e){switch(e){case "new":return JSX("span",null,e);case "active":return JSX("span",null,e);default:return JSX("span",{class:"vote-badge"},e)}};a.renderTotal=function(e){return JSX("li",{id:"story-total"},JSX("div",{class:"right uk-article-meta"},JSX("span",{class:"vote-badge"},e))," ","Total")};a.viewAddStory=function(){var e=
dom.setValue("#story-title-input","");setTimeout(function(){return e.focus()},250)}})(story||(story={}));var debug=!0,system;
(function(a){var e=function(){this.currentID="";this.connectTime=0};e.prototype.getProfile=function(){if(!this.profile)throw"no active profile";return this.profile};e.prototype.apply=function(d){a.cache.session=d.session;a.cache.profile=d.profile;auth.applyAuths(d.auths);permission.applyPermissions(d.permissions);member.applyMembers(d.members);member.applyOnline(d.online);comment.applyComments(d.comments);void 0!==d.team&&session.setTeam(d.team);void 0!==d.sprint&&session.setSprint(d.sprint)};a.cache=
new e;a.setPermissions=function(d){permission.applyPermissions(d);permission.setPerms()};a.setAuths=function(d){auth.applyAuths(d);permission.setPerms()};a.onSystemMessage=function(d,b){switch(d){case command.server.error:rituals.onError(services.system.key,b);break;case command.server.actions:action.viewActions(b);break;case command.server.teams:team.viewTeams(b);break;case command.server.sprints:sprint.viewSprints(b);break;case command.server.memberUpdate:member.onMemberUpdate(b);break;case command.server.memberRemove:member.onMemberRemove(b);
break;case command.server.onlineUpdate:member.onOnlineUpdate(b);break;case command.server.commentUpdate:comment.onCommentUpdate(b);break;case command.server.commentRemove:comment.onCommentRemoved(b);break;default:console.warn("unhandled system message for command ["+d+"]")}};a.onSessionRemove=function(d){document.location.reload()}})(system||(system={}));var team;
(function(a){a.cache=new function(){};a.onTeamMessage=function(e,d){switch(e){case command.server.error:rituals.onError(services.team.key,d);break;case command.server.sessionJoined:session.onSessionJoin(d);e=d.session;a.cache.detail=e;session.setDetail(e);dom.setContent("#team-sprint-list",contents.renderContents(services.team,services.sprint,d.sprints));dom.setContent("#team-estimate-list",contents.renderContents(services.team,services.estimate,d.estimates));dom.setContent("#team-standup-list",contents.renderContents(services.team,
services.standup,d.standups));dom.setContent("#team-retro-list",contents.renderContents(services.team,services.retro,d.retros));session.showWelcomeMessage(d.session.status,d.members.length);break;case command.server.sessionUpdate:a.cache.detail=d;session.setDetail(d);break;case command.server.sessionRemove:system.onSessionRemove(services.team);break;case command.server.permissionsUpdate:system.setPermissions(d);break;case command.server.contentUpdate:socket.socketConnect(system.cache.currentService.key,
system.cache.currentID);break;default:console.warn("unhandled command ["+e+"] for team")}};a.onSubmitTeamSession=function(){var e=dom.req("#model-title-input").value,d=permission.readPermissions();socket.send({svc:services.team.key,cmd:command.client.updateSession,param:{title:e,permissions:d}})};a.refreshTeams=function(){dom.opt("#model-team-select")&&socket.send({svc:services.system.key,cmd:command.client.getTeams,param:null})};a.viewTeams=function(e){var d;dom.opt("#model-team-container")&&(dom.setContent("#model-team-select",
a.renderTeamSelect(e,null===(d=system.cache.session)||void 0===d?void 0:d.teamID)),permission.setModelPerms("team"))}})(team||(team={}));
(function(a){a.renderTeamLink=function(e,d){var b=system.cache.getProfile();e=JSX("a",{class:b.linkColor+"-fg",href:"/team/"+e.slug},e.title);return d?e:JSX("span",null,"in ",e)};a.renderTeamSelect=function(e,d){return JSX("select",{class:"uk-select",onchange:"permission.setModelPerms('team')"},JSX("option",{value:""},"- no team -"),e.map(function(b){return b.id===d?JSX("option",{selected:"selected",value:b.id},b.title):JSX("option",{value:b.id},b.title)}))}})(team||(team={}));var vote;
(function(a){function e(){var d=story.getActiveStory();if(d){var b=estimate.cache.activeVotes(),c=b.filter(function(f){return f.userID===system.cache.getProfile().userID}).pop();switch(d.status){case "new":d=system.cache.getProfile().userID===d.userID;dom.setDisplay("#story-edit-section",d);dom.setDisplay("#story-view-section",!d);break;case "active":dom.setContent("#story-vote-members",a.renderVoteMembers(member.getMembers(),b));dom.setContent("#story-vote-choices",a.renderVoteChoices(estimate.cache.detail.choices,
null===c||void 0===c?void 0:c.choice));break;case "complete":dom.setContent("#story-vote-results",a.renderVoteResults(member.getMembers(),b));dom.setContent("#story-vote-summary",a.renderVoteSummary(b));break;default:console.warn("invalid story status ["+d.status+"]")}}}a.setVotes=function(d){estimate.cache.votes=d;e()};a.onVoteUpdate=function(d){var b=estimate.cache.votes;b=b.filter(function(c){return c.userID!==d.userID||c.storyID!==d.storyID});b.push(d);estimate.cache.votes=b;d.storyID===estimate.cache.activeStory&&
e()};a.viewVotes=e;a.onSubmitVote=function(d){socket.send({svc:services.estimate.key,cmd:command.client.submitVote,param:{storyID:estimate.cache.activeStory,choice:d}})};a.getVoteResults=function(d){d=d.map(function(k){k=parseFloat(k.choice);return isNaN(k)?-1:k}).filter(function(k){return-1!==k}).sort();var b=d.length,c=Math.min.apply(Math,$jscomp.arrayFromIterable(d)),f=Math.max.apply(Math,$jscomp.arrayFromIterable(d)),g=d.reduce(function(k,l){return k+l},0),h=d.reduce(function(k,l){var m=k.numMapping[l]=
(k.numMapping[l]||0)+1;m>k.greatestFreq&&(k.greatestFreq=m,k.mode=l);return k},{mode:null,greatestFreq:-Infinity,numMapping:{}}).mode;return{count:b,min:c,max:f,sum:g,mean:0===b?0:g/b,median:0===b?0:d[Math.floor(d.length/2)],mode:0===b?0:h}}})(vote||(vote={}));
(function(a){function e(b,c){return JSX("div",{class:"vote-member",title:b.name+" has "+(c?"voted":"not voted")},JSX("div",null,JSX("span",{"data-uk-icon":"icon: "+(c?"check":"minus")+"; ratio: 1.6"})),b.name)}function d(b,c){return c?JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},c))," ",b.name):JSX("div",{class:"vote-result"},JSX("div",null,JSX("span",{class:"uk-border-circle"},JSX("span",{"data-uk-icon":"icon: minus; ratio: 1.6"})))," ",b.name)}a.renderVoteMembers=
function(b,c){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},b.map(function(f){return e(f,0<c.filter(function(g){return g.userID===f.userID}).length)}))};a.renderVoteChoices=function(b,c){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center"},b.map(function(f){return JSX("div",{class:"vote-choice uk-border-circle uk-box-shadow-hover-medium"+(f===c?" active "+system.cache.getProfile().linkColor+"-border":""),onclick:"vote.onSubmitVote('"+f+"');"},f)}))};a.renderVoteResults=
function(b,c){return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-around"},b.map(function(f){var g=c.filter(function(h){return h.userID===f.userID});return d(f,0<g.length?g[0].choice:void 0)}))};a.renderVoteSummary=function(b){function c(g){return g.toString().substr(0,4)}var f=a.getVoteResults(b);return JSX("div",{class:"uk-flex uk-flex-wrap uk-flex-center result-container"},JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(f.count)," / ",c(b.length))," ",JSX("div",null,
"votes counted")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(f.min),"-",c(f.max))," ",JSX("div",null,"vote range")),JSX("div",{class:"result mean-result"},JSX("div",{class:"mean uk-border-circle "+system.cache.getProfile().linkColor+"-border"},c(f.mean))," ",JSX("div",null,"average")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},c(f.median))," ",JSX("div",null,"median")),JSX("div",{class:"result"},JSX("div",{class:"secondary uk-border-circle"},
c(f.mode))," ",JSX("div",null,"mode")))}})(vote||(vote={}));
