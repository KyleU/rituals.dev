<%: func Profile(ctx web.RequestContext, w io.Writer) (int, error) %>

<%~ "layout/basic.html" %>

<%@ body { %>
<div class="uk-section uk-section-small">
  <div class="uk-container">
    <div>
      <h1 class="uk-heading-hero">User Profile</h1>
    </div>
    <div id="profile-card" class="uk-card <%= ctx.Profile.Theme.CardClass %> uk-card-body">
      <form class="uk-form-horizontal uk-margin-large" action="<%= ctx.Route(`profile.save`) %>" method="post">
        <div class="uk-margin">
          <label class="uk-form-label" for="username">Username</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="username" name="username" type="text" value="<%= ctx.Profile.Name %>" />
          </div>
        </div>

        <div class="uk-margin">
          <label class="uk-form-label">Theme</label>
          <% for _, t := range util.AllThemes { %>
          <div class="uk-form-controls uk-form-controls-text">
            <label for="theme-<%= t.String() %>">
              <% if t == ctx.Profile.Theme { %>
              <input class="uk-radio" id="theme-<%= t.String() %>" name="theme" type="radio" onchange="if (this.checked) { selectTheme(this.value); }" value="<%= t.String() %>" checked="checked" />
              <% } else { %>
              <input class="uk-radio" id="theme-<%= t.String() %>" name="theme" type="radio" onchange="if (this.checked) { selectTheme(this.value); }" value="<%= t.String() %>" />
              <% } %>
              <%= t.String() %>
            </label>
          </div>
          <% } %>
        </div>

        <input id="navbar-color" name="navbar-color" type="hidden" value="<%= ctx.Profile.NavColor %>" />
        <div class="uk-margin">
          <label class="uk-form-label">Navbar Color</label>
          <div class="uk-form-controls">
            <div class="uk-flex uk-flex-wrap">
              <% for _, c := range util.AllColors { %>
                <%
                  navCls := ""
                  if ctx.Profile.NavColor == c {
                    navCls = "active "
                  }
                %>
                <div class="swatch nav_swatch <%= navCls %> <%= c %>-bg uk-text-center" title="<%= c %>" onclick="setNavColor(this, '<%= c %>');">
                  <div class="icon" data-uk-icon="icon: check"></div>
                </div>
              <% } %>
            </div>
          </div>
        </div>

        <input id="link-color" name="link-color" type="hidden" value="<%= ctx.Profile.LinkColor %>" />
        <div class="uk-margin">
          <label class="uk-form-label">
            <a class="<%= ctx.Profile.LinkColor %>-fg" id="link-example" href="" onclick="return false;">Link</a>
            Color
          </label>
          <div class="uk-form-controls">
            <div class="uk-flex uk-flex-wrap">
              <% for _, c := range util.AllColors { %>
                <%
                  linkCls := ""
                  if ctx.Profile.LinkColor == c {
                    linkCls = "active "
                  }
                %>
                <div class="swatch link_swatch <%= linkCls %> <%= c %>-bg uk-text-center" title="<%= c %>" onclick="setLinkColor(this, '<%= c %>');">
                  <div class="icon" data-uk-icon="icon: check"></div>
                </div>
              <% } %>
            </div>
          </div>
        </div>

        <div class="uk-margin-top">
          <button class="uk-button uk-button-default" type="submit">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function setNavColor(el, c) {
    util.setValue("#navbar-color", c);
    let nb = util.req("navbar");
    nb.className = (c + "-bg uk-navbar-container uk-navbar");
    let colors = document.querySelectorAll(".nav_swatch");
    colors.forEach(function(i) {
      i.classList.remove("active");
    })
    el.classList.add("active");
  }

  function setLinkColor(el, c) {
    util.setValue("#link-color", c);
    let l = document.getElementById("link-example");
    l.className = (c + "-fg");
    let colors = document.querySelectorAll(".link_swatch");
    colors.forEach(function(i) {
      i.classList.remove("active");
    })
    el.classList.add("active");
  }

  function selectTheme(theme) {
    let card = util.els("#profile-card");
    switch (theme) {
      case "light":
        document.documentElement.classList.remove("uk-light");
        document.body.classList.remove("uk-light");
        document.documentElement.classList.add("uk-dark");
        document.body.classList.add("uk-dark");
        card.forEach(x => {
          x.classList.add("uk-card-default");
          x.classList.remove("uk-card-secondary");
        });
        break;
      case "dark":
        document.documentElement.classList.add("uk-light");
        document.body.classList.add("uk-light");
        document.documentElement.classList.remove("uk-dark");
        document.body.classList.remove("uk-dark");
        card.forEach(x => {
          x.classList.remove("uk-card-default");
          x.classList.add("uk-card-secondary");
        });
        break;
      default:
        console.log("invalid theme");
        break;
    }
  }
</script>
<% } %>
