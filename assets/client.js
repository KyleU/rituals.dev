"use strict";(()=>{var Kt=Object.defineProperty;var ke=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var Le=(e,t,n)=>t in e?Kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||={})Qt.call(t,n)&&Le(e,n,t[n]);if(ke)for(var n of ke(t))Zt.call(t,n)&&Le(e,n,t[n]);return e};function m(e,t){let n;t?n=t.querySelectorAll(e):n=document.querySelectorAll(e);let i=[];return n.forEach(s=>{i.push(s)}),i}function u(e,t){let n=m(e,t);switch(n.length){case 0:return;case 1:return n[0];default:console.warn(`found [${n.length}] elements with selector [${e}], wanted zero or one`)}}function o(e,t){let n=u(e,t);if(!n)throw new Error(`no element found for selector [${e}]`);return n}function xe(e,t){return typeof e=="string"&&(e=o(e)),e.innerHTML=t,e}function P(e,t,n="block"){return typeof e=="string"&&(e=o(e)),e.style.display=t?n:"none",e}function r(e,t,...n){let i=document.createElement(e);for(let s in t)if(s==="for"&&(s="for"),s==="className"&&(s="class"),s&&t.hasOwnProperty(s)){let a=t[s];s==="dangerouslySetInnerHTML"?xe(i,a.__html):a===!0?i.setAttribute(s,s):a!==!1&&a!==null&&a!==void 0&&i.setAttribute(s,a.toString())}for(let s of n)if(Array.isArray(s))s.forEach(a=>{if(s==null)throw new Error(`child array for tag [${e}] is ${s}
${i.outerHTML}`);if(a==null)throw new Error(`child for tag [${e}] is ${a}
${i.outerHTML}`);typeof a=="string"&&(a=document.createTextNode(a)),i.appendChild(a)});else{if(s==null)throw new Error(`child for tag [${e}] is ${s}
${i.outerHTML}`);s.nodeType||(s=document.createTextNode(s.toString())),i.appendChild(s)}return i}function zt(e,...t){let n=document.createElement("li");n.innerText=e;for(let i of t){let s=document.createElement("pre");typeof i=="string"?s.innerText=i:s.innerText=JSON.stringify(i,null,2),n.appendChild(s)}return n}function He(e,...t){let n=u("#audit-log");n?n.appendChild(zt(e,...t)):console.log(`### Audit ###
`+e,...t)}function Ie(){for(let e of m(".menu-container .final"))e.scrollIntoView({block:"center"})}var ae="mode-light",le="mode-dark";function Ce(){for(let e of m(".mode-input"))e.onclick=()=>{switch(e.value){case"":document.body.classList.remove(ae),document.body.classList.remove(le);break;case"light":document.body.classList.add(ae),document.body.classList.remove(le);break;case"dark":document.body.classList.remove(ae),document.body.classList.add(le);break}}}function we(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function L(e,t,n){let i=document.getElementById("flash-container");i===null&&(i=document.createElement("div"),i.id="flash-container",document.body.insertAdjacentElement("afterbegin",i));let s=document.createElement("div");s.className="flash";let a=document.createElement("input");a.type="radio",a.style.display="none",a.id="hide-flash-"+e,s.appendChild(a);let l=document.createElement("label");l.htmlFor="hide-flash-"+e;let c=document.createElement("span");c.innerHTML="\xD7",l.appendChild(c),s.appendChild(l);let d=document.createElement("div");d.className="content flash-"+t,d.innerText=n,s.appendChild(d),i.appendChild(s),we(s)}function De(){let e=document.getElementById("flash-container");if(e===null)return L;let t=e.querySelectorAll(".flash");if(t.length>0)for(let n of t)we(n);return L}function Fe(){for(let e of m(".link-confirm"))e.onclick=()=>{let t=e.dataset.message;return t&&t.length===0&&(t="Are you sure?"),confirm(t)}}function Ae(e){let t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString().substring(0,19).replace("T"," ")}function j(e,t){let n=(e||"").replace(/-/gu,"/").replace(/[TZ]/gu," ")+" UTC",i=new Date(n),s=(new Date().getTime()-i.getTime())/1e3,a=Math.floor(s/86400),l=i.getFullYear(),c=i.getMonth()+1,d=i.getDate();if(isNaN(a)||a<0||a>=31)return l.toString()+"-"+(c<10?"0"+c.toString():c.toString())+"-"+(d<10?"0"+d.toString():d.toString());let p,y;return a===0?s<5?(y=1,p="just now"):s<60?(y=1,p=Math.floor(s)+" seconds ago"):s<120?(y=10,p="1 minute ago"):s<3600?(y=30,p=Math.floor(s/60)+" minutes ago"):s<7200?(y=60,p="1 hour ago"):(y=60,p=Math.floor(s/3600)+" hours ago"):a===1?(y=600,p="yesterday"):a<7?(y=600,p=a+" days ago"):(y=6e3,p=Math.ceil(a/7)+" weeks ago"),t&&(t.innerText=p,setTimeout(()=>j(e,t),y*1e3)),p}function Re(){return m(".reltime").forEach(e=>{j(e.dataset.time||"",e)}),j}function St(e,t){let n=0;return(...i)=>{n!==0&&window.clearTimeout(n),n=window.setTimeout(()=>{e(null,...i)},t)}}function Jt(e,t,n,i,s){var Q;if(!e)return;let a=e.id+"-list",l=document.createElement("datalist"),c=document.createElement("option");c.value="",c.innerText="Loading...",l.appendChild(c),l.id=a,(Q=e.parentElement)==null||Q.prepend(l),e.setAttribute("autocomplete","off"),e.setAttribute("list",a);let d={},p="";function y(h){let E=t;return E.includes("?")?E+"&t=json&"+n+"="+encodeURIComponent(h):E+"?t=json&"+n+"="+encodeURIComponent(h)}function v(h){let E=d[h];!E||!E.frag||(p=h,l.replaceChildren(E.frag.cloneNode(!0)))}function K(){let h=e.value;if(h.length===0)return;let E=y(h),ie=!h||!p;if(!ie){let w=d[p];w&&(ie=!w.data.find(O=>h===s(O)))}if(ie){if(d[h]&&d[h].url===E){v(h);return}fetch(E,{credentials:"include"}).then(w=>w.json()).then(w=>{if(!w)return;let O=Array.isArray(w)?w:[w],Te=document.createDocumentFragment(),Me=10;for(let Z=0;Z<O.length&&Me>0;Z++){let Ee=s(O[Z]),Yt=i(O[Z]);if(Ee){let se=document.createElement("option");se.value=Ee,se.innerText=Yt,Te.appendChild(se),Me--}}d[h]={url:E,data:O,frag:Te,complete:!1},v(h)})}}e.oninput=St(K,250),console.log("managing ["+e.id+"] autocomplete")}function Ue(){return Jt}function $e(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function g(e,t,n){return t||(t=18),n==null&&(n="icon"),`<svg class="${n}" style="width: ${t}px; height: ${t+"px"};"><use xlink:href="#svg-${e}"></use></svg>`}function q(e,t,n){return{__html:g(e,t,n)}}function Ne(e){e||(e="");let t=g("right",15,"expand"),n=g("down",15,"collapse");return{__html:t+n+e}}function b(e){return setTimeout(()=>{e.setSelectionRange(e.value.length,e.value.length),e.focus()},100),!0}function Xt(e,t){return e.parentElement!==t.parentElement?null:e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var z;function me(e){let t=[],n=m(".item .value",e);for(let s of n)t.push(s.innerText);let i=o("input.result",e);i.value=t.join(", ")}function en(e){var n;let t=(n=e.parentElement)==null?void 0:n.parentElement;e.remove(),t&&me(t)}function Ve(e){let t=o(".value",e),n=o(".editor",e);n.value=t.innerText;let i=()=>{var a;if(n.value===""){e.remove();return}t.innerText=n.value,P(t,!0),P(n,!1);let s=(a=e.parentElement)==null?void 0:a.parentElement;s&&me(s)};n.onblur=i,n.onkeydown=s=>{if(s.code==="Enter")return s.preventDefault(),i(),!1},P(t,!1),P(n,!0),n.focus()}function Oe(e,t){let n=document.createElement("div");n.className="item",n.draggable=!0,n.ondragstart=l=>{var c;(c=l.dataTransfer)==null||c.setDragImage(document.createElement("div"),0,0),n.classList.add("dragging"),z=n},n.ondragover=()=>{var d;let l=Xt(n,z);if(!l)return;let c=l===-1?n:n.nextSibling;(d=z.parentElement)==null||d.insertBefore(z,c),me(t)},n.ondrop=l=>{l.preventDefault()},n.ondragend=l=>{n.classList.remove("dragging"),l.preventDefault()};let i=document.createElement("div");i.innerText=e,i.className="value",i.onclick=()=>{Ve(n)},n.appendChild(i);let s=document.createElement("input");s.className="editor",n.appendChild(s);let a=document.createElement("div");return a.innerHTML=g("times",13),a.className="close",a.onclick=()=>{en(n)},n.appendChild(a),n}function tn(e,t){let n=Oe("",t);e.appendChild(n),Ve(n)}function _(e){var a;let t=o("input.result",e),n=o(".tags",e),i=t.value.split(",").map(l=>l.trim()).filter(l=>l!=="");P(t,!1),n.innerHTML="";for(let l of i)n.appendChild(Oe(l,e));(a=u(".add-item",e))==null||a.remove();let s=document.createElement("div");s.className="add-item",s.innerHTML=g("plus",22),s.onclick=()=>{tn(n,e)},e.insertBefore(s,o(".clear",e))}function Pe(){for(let e of m(".tag-editor"))_(e);return _}function nn(e){let t=document.createElement("thead"),n=document.createElement("tr"),i=!0;return e.forEach(s=>{let a=document.createElement("th");i&&(a.classList.add("shrink"),i=!1),a.innerText=s.title,n.appendChild(a)}),t.appendChild(n),t}function on(e,t){let n=document.createElement("tr"),i=[];return e.forEach(s=>{let a=document.createElement("td");i.push(a);let l=t[s.key];if(l==null){let c=document.createElement("em");c.innerText="-",a.appendChild(c)}else if(s.type==="code"){let c=document.createElement("pre");c.innerText=JSON.stringify(l,null,2),a.appendChild(c)}else a.innerText=l.toString();n.appendChild(a)}),[n,i]}function qe(e,t){let n=document.createElement("table"),i=[];n.classList.add("min-200"),n.appendChild(nn(e));let s=document.createElement("tbody");t.forEach(l=>{let[c,d]=on(e,l);s.appendChild(c),i.push(d)}),n.appendChild(s);let a=document.createElement("div");return a.classList.add("overflow"),a.classList.add("full-width"),a.appendChild(n),a}function rn(e){var c,d;let t=(c=e.dataset.key)!=null?c:"editor",n=(d=e.dataset.columns)!=null?d:"[]",i=JSON.parse(n.replace(/\\"/gu,'"')),s=o("textarea",e),a=JSON.parse(s.value);if(a==null&&(a=[]),!Array.isArray(a))throw new Error("input value for element ["+t+"] of type ["+typeof a+"] must be an array");let l=qe(i,a);m(".toggle-editor-"+t).forEach(p=>{p.innerText="Edit",p.onclick=()=>{p.innerText==="Edit"?(p.innerText="View",l.remove(),s.hidden=!1):(p.innerText="Edit",l.remove(),a=JSON.parse(s.value),a==null&&(a=[]),l=qe(i,a),e.appendChild(l),s.hidden=!0)}}),e.appendChild(l),s.hidden=!0}function _e(){m(".rich-editor").forEach(e=>{rn(e)})}var Be="--selected";function sn(e){var n,i;let t=(i=(n=e.parentElement)==null?void 0:n.parentElement)==null?void 0:i.querySelector("input");if(!t)throw new Error("no associated input found");t.value="\u2205"}function ce(e){e.onreset=()=>ce(e);let t={},n={};for(let i of e.elements){let s=i;if(s.name.length>0)if(s.name.endsWith(Be))n[s.name]=s;else{(s.type!=="radio"||s.checked)&&(t[s.name]=s.value);let a=()=>{let l=n[s.name+Be];l&&(l.checked=t[s.name]!==s.value)};s.onchange=a,s.onkeyup=a}}}function We(){for(let e of m("form.editor"))ce(e);return[sn,ce]}var an=[];function je(e,t,n){let i=e.querySelectorAll(t);if(i.length===0)throw new Error("empty query selector ["+t+"]");i.forEach(s=>n(s))}function G(e,t,n){je(e,t,i=>{i.style.backgroundColor=n})}function D(e,t,n){je(e,t,i=>{i.style.color=n})}function ln(e,t,n){let i=document.querySelector("#mockup-"+e);if(!i){console.error("can't find mockup for mode ["+e+"]");return}switch(t){case"color-foreground":D(i,".mock-main",n);break;case"color-background":G(i,".mock-main",n);break;case"color-foreground-muted":D(i,".mock-main .mock-muted",n);break;case"color-background-muted":G(i,".mock-main .mock-muted",n);break;case"color-link-foreground":D(i,".mock-main .mock-link",n);break;case"color-link-visited-foreground":D(i,".mock-main .mock-link-visited",n);break;case"color-nav-foreground":D(i,".mock-nav",n),D(i,".mock-nav .mock-link",n);break;case"color-nav-background":G(i,".mock-nav",n);break;case"color-menu-foreground":D(i,".mock-menu",n),D(i,".mock-menu .mock-link",n);break;case"color-menu-background":G(i,".mock-menu",n);break;case"color-menu-selected-foreground":D(i,".mock-menu .mock-link-selected",n);break;case"color-menu-selected-background":G(i,".mock-menu .mock-link-selected",n);break;default:console.error("invalid key ["+t+"]")}}function Ge(){for(let e of m(".color-var")){let t=e.dataset.var,n=e.dataset.mode;an.push(t),!(!t||t.length===0)&&(e.oninput=()=>{ln(n,t,e.value)})}}var Ye=!1;function Ke(e){if(e||(e="/connect"),e.indexOf("ws")===0)return e;let t=document.location,n="ws";return t.protocol==="https:"&&(n="wss"),e.indexOf("/")!==0&&(e="/"+e),n+`://${t.host}${e}`}var Y=class{constructor(t,n,i,s,a){this.debug=t,this.open=n,this.recv=i,this.err=s,this.url=Ke(a),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=()=>{Ye=!0},this.connectTime=Date.now(),this.sock=new WebSocket(Ke(this.url));let t=this;this.sock.onopen=()=>{t.connected=!0,t.pendingMessages.forEach(t.send),t.pendingMessages=[],t.debug&&console.log("WebSocket connected"),t.open()},this.sock.onmessage=n=>{let i=JSON.parse(n.data);t.debug&&console.debug("[socket]: receive",i),t.recv(i)},this.sock.onerror=n=>()=>{t.err("socket",n.type)},this.sock.onclose=()=>{if(Ye)return;t.connected=!1;let n=t.connectTime?Date.now()-t.connectTime:0;n>0&&n<2e3?(t.pauseSeconds=t.pauseSeconds*2,t.debug&&console.debug(`socket closed immediately, reconnecting in ${t.pauseSeconds} seconds`),setTimeout(()=>{t.connect()},t.pauseSeconds*1e3)):(console.debug("socket closed after ["+n+"ms]"),setTimeout(()=>{t.connect()},t.pauseSeconds*500))}}disconnect(){}send(t){if(this.debug&&console.debug("out",t),!this.sock)throw new Error("socket not initialized");if(this.connected){let n=JSON.stringify(t,null,2);this.sock.send(n)}else this.pendingMessages.push(t)}};function Qe(){return Y}function F(e,t,n){return e?`<img class="${n}" style="width: ${t+"px"}; height: ${t+"px"};" src="${e}" />`:g("profile",t,n)}function Ze(e,t,n,i){return r("tr",{id:"member-"+e,class:"member","data-id":e},r("td",null,r("a",{href:"#modal-member-"+e},r("div",{class:"left prs member-picture",dangerouslySetInnerHTML:{__html:F(i,18,"")}}),r("span",{class:"member-name member-"+e+"-name"},t))),r("td",{class:"shrink text-align-right"},r("em",{class:"member-role"},n)),r("td",{class:"shrink online-status",title:"offline",dangerouslySetInnerHTML:q("circle",18,"right")}))}function ze(e,t,n,i){return r("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,r("span",{class:"member-picture",dangerouslySetInnerHTML:{__html:F(i,18,"")}}),r("span",{class:"member-name member-"+e+"-name"},t))),r("div",{class:"modal-body"},r("em",null,"Role"),r("br",null),r("span",{class:"member-role"},n))))}function Se(e,t,n,i){let s="return confirm('Are you sure you wish to remove this user?');",a=[["owner","Owner"],["member","Member"],["observer","Observer"]];return r("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,r("span",{class:"member-picture",dangerouslySetInnerHTML:{__html:F(i,18,"")}}),r("span",{class:"member-name member-"+e+"-name"},t))),r("div",{class:"modal-body"},r("form",{action:document.location.pathname,method:"post",class:"expanded"},r("input",{type:"hidden",name:"userID",value:e}),r("em",null,"Role"),r("br",null),r("select",{class:"input-role",name:"role"},a.map(l=>l[0]===n?r("option",{selected:"selected",value:l[0]},l[1]):r("option",{value:l[0]},l[1]))),r("hr",null),r("div",{class:"right"},r("button",{class:"member-update",type:"submit",name:"action",value:"member-update"},"Save")),r("button",{type:"submit",class:"member-remove",name:"action",value:"member-remove",onClick:s},"Remove")))))}function T(){return o("#self-id").innerText}function mn(){return o("#self-role").innerText==="owner"}function cn(){let e=o("#modal-member-"+T()),t=u("form",e);t&&(t.onsubmit=()=>{let n=o('input[name="name"]',t),i=o('input[name="choice"]:checked',t),s=u('input[name="picture"]:checked',t),a={name:n.value,choice:i.value};return s&&(a.picture=s.value),f("self",a),m(".member-"+T()+"-name").forEach(l=>{l.innerText=n.value}),o("#self-picture").innerHTML=F(s?s.value:"",20,"icon"),document.location.hash="",!1})}function S(e){return e===T()?o("#self-name").innerText:o("#member-"+e+" .member-name").innerText}function M(e){if(!e)return"System";let t=S(e);return t||"Unknown User"}function Je(e){return e===T()?o("#self-role").innerText:o("#member-"+e+" .member-role").innerText}function J(){let e=[],t=T(),n={id:t,name:S(t),role:Je(t)};return e.push(n),m("#panel-members .member").forEach(i=>{if(i.dataset.id){let s=i.dataset.id;e.push({id:s,name:S(s),role:Je(s)})}}),e.sort((i,s)=>i.name.localeCompare(s.name,void 0,{sensitivity:"accent"})),e}function Xe(e){let t=u("form",e);if(!t)return;let n=i=>{let s=o('input[name="userID"]',t).value,a=o('select[name="role"]',t).value;f(i,{userID:s,role:a});let l=o("#member-"+s);return i==="member-update"?o(".member-role",l).innerText=a:i==="member-remove"&&l.remove(),document.location.hash="",!1};o(".member-update",t).onclick=()=>n("member-update"),o(".member-remove",t).onclick=()=>confirm("Are you sure you wish to remove this user?")?n("member-remove"):!1}function dn(){let e=m(".modal-member");for(let t of e)Xe(t)}function de(e){if(m(".member-"+e.userID+"-name").forEach(t=>{t.innerText=e.name}),e.userID===T())o("#self-role").innerText=e.role,o("#self-picture").innerHTML=F(e.picture?e.picture:"",20,"icon");else{let t=o("#member-"+e.userID);o(".member-role",t).innerText=e.role,o(".member-picture",t).innerHTML=F(e.picture?e.picture:"",18,"");let n=o("#modal-member-"+e.userID),i=u(".member-role",n);i&&(i.innerText=e.role);let s=u('select[name="role"]',n);s&&(s.value=e.role),o(".member-picture",n).innerHTML=F(e.picture?e.picture:"",18,"")}if(S(e.userID)!==e.name){let t=o("#panel-members table tbody"),i=[...t.children];i.sort((s,a)=>{let l=o(".member-name",s).innerText,c=o(".member-name",a).innerText;return l.localeCompare(c,void 0,{sensitivity:"accent"})}),t.replaceChildren(...i)}}function et(e){if(u("#member-"+e.userID)||e.userID===T())return de(e);let n=o("#panel-members table tbody"),i=-1;for(let c=0;c<n.children.length;c++){let d=n.children.item(c);if(o(".member-name",d).innerText.localeCompare(e.name,void 0,{sensitivity:"accent"})>0){i=c;break}}let s=Ze(e.userID,e.name,e.role,e.picture?e.picture:"");i===-1?n.appendChild(s):n.insertBefore(s,n.children[i]);let a=o("#member-modals"),l;mn()?l=Se(e.userID,e.name,e.role,e.picture?e.picture:""):l=ze(e.userID,e.name,e.role,e.picture?e.picture:""),a.appendChild(l),o(".member-picture",l).innerHTML=F(e.picture?e.picture:"",24,"icon"),Xe(l)}function tt(e){o("#member-"+e).remove()}function nt(e){if(e.userID===T())return;let t=u("#member-"+e.userID+" .online-status");if(!t)throw new Error("missing panel #member-"+e.userID);t.title=e.connected?"online":"offline";let n=e.connected?"check-circle":"circle";t.innerHTML=g(n,18,"right")}function ot(){o("#self-edit-link").onclick=()=>{b(o("#self-name-input"))},cn(),dn()}function rt(e,t){let n=r("li",null),i=Ae(new Date),s=r("span",{class:"nowrap reltime","data-time":i},"just now");j(i,s);let a=r("div",{class:"right"});return a.appendChild(s),n.appendChild(a),n.appendChild(r("div",null,e.content)),n.appendChild(r("div",null,r("em",{class:"member-"+e.userID+"-name"},t))),n}function U(e,t){let n="comment-link-"+e+"-"+t,i="#modal-"+e+"-"+t+"-comments",s=r("a",{id:n,class:"comment-link","data-key":e+"-"+t,href:i,title:"0 comments",dangerouslySetInnerHTML:q("comment-alt",18,"member-icon")});return ue(s),s}function $(e,t,n){return r("div",{id:"modal-"+e+"-"+t+"-comments",class:"modal comments",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,n," Comments")),r("div",{class:"modal-body"},r("ul",{id:"comment-list-"+e+"-"+t,class:"comment-list"}),r("form",{action:"#",method:"post",class:"expanded"},r("input",{type:"hidden",name:"action",value:"comment"}),r("input",{type:"hidden",name:"svc",value:e}),r("input",{type:"hidden",name:"modelID",value:t}),r("div",null,r("textarea",{name:"content",placeholder:"Add a comment, Markdown and HTML supported"})),r("div",{class:"mt right"},r("button",{type:"submit"},"Add Comment"))))))}function ue(e){e.onclick=()=>b(o("#modal-"+e.dataset.key+"-comments form textarea"))}function pe(e){let t=o("#comment-list-"+e.svc+"-"+e.modelID),n=M(e.userID),i=rt(e,n);t.appendChild(i);let s=t.children.length,a=o("#comment-link-"+e.svc+"-"+e.modelID);a.title=s+(s===1?" comment":" comments"),a.innerHTML.indexOf("comment-dots")===-1&&(a.innerHTML=g("comment-dots",18,"right"))}function A(e){let t=o("form",e);t.onsubmit=()=>{let n={svc:o('input[name="svc"]',t).value,modelID:o('input[name="modelID"]',t).value},i=o("textarea",t);return n.content=i.value,n.userID=T(),f("comment",n),pe(n),i.value="",!1}}function it(){for(let e of m(".comment-link"))ue(e);for(let e of m(".modal.comments"))A(e)}function X(e,t,n){if(n){let i=u(`select[name="${e}"] option[value="${n}"]`,t);if(i){let s=i.innerText;return`<a href="/${e}/${n}">${s}</a> `}return`<a href="/${e}/${n}">${n}</a> `}return""}function un(e,t,n,i){let s="";return s+=X("sprint",t,i),s+=e==="retro"?"retrospective":e,n&&(s+=" in "+X("team",t,n)),s}function ee(e){let t=o(`#${e.type}-list tbody`),n=u(".empty",t);n&&n.remove();let i=document.createElement("tr");i.id=`${e.type}-list-${e.id}`;let s=document.createElement("td"),a=document.createElement("div");a.classList.add("right"),a.appendChild(U(e.type,e.id)),a.appendChild($(e.type,e.id,e.title)),s.appendChild(a);let l=document.createElement("a");l.href=e.path;let c=document.createElement("span");c.classList.add("model-span-icon"),c.innerHTML=g(e.icon,16,"icon"),l.appendChild(c);let d=document.createElement("span");d.classList.add("model-span-title"),d.innerText=e.title,l.appendChild(d),s.appendChild(l),i.appendChild(s),t.appendChild(i),A(o(".modal",a))}function te(e){let t=o(`#${e.type}-list-${e.model.id}`);o(".model-span-icon",t).innerHTML=g(e.model.icon),o(".model-span-title",t).innerText=e.model.title}function ne(e){o(`#${e.type}-list-${e.id}`).remove();let t=o(`#${e.type}-list tbody`);if(t.children.length===0){let n=document.createElement("tr");n.classList.add("empty");let i=document.createElement("em");i.innerText="no "+e.type+"s",n.appendChild(i),t.appendChild(n)}}function x(e,t,n,i,s,a){let l=u('input[name="title"]',t);l&&(l.value=s);for(let p of m(".config-panel-team",t))p.innerHTML=X("team",t,n);for(let p of m(".config-panel-sprint",t))p.innerHTML=X("sprint",t,i);for(let p of m(".view-icon",t))p.innerHTML=g(a,24,"icon");for(let p of m(".view-title",t))p.innerText=s;for(let p of m('input[name="icon"]',t))p.checked=a===p.value;let c=u('select[name="team"]',t);c!=null&&(c.value=n||"");let d=u('select[name="sprint"]',t);d!=null&&(d.value=i||""),o("#model-title").innerText=s,o("#model-icon").innerHTML=g(a,20),o("#model-banner").innerHTML=un(e,t,n||"",i||"")}function H(e){o(`#modal-${e}-config-link`).onclick=()=>{let t=u(`#modal-${e}-config form input[name="title"]`);t&&b(t)}}function I(e){console.log("TODO: permissionsUpdate",e)}function R(e){o(".permission-config-team").style.display=e?"block":"none"}function V(e){o(".permission-config-sprint").style.display=e?"block":"none"}function C(e){let t={};for(let n of m(".perm-option",e))n.checked&&(t[n.name]=n.value);return t}function N(e,t){R(e.value!==""),t&&V(t.value!=="")}function st(){H("team");let e=u("#modal-team-config form");e&&(e.onsubmit=()=>{let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value;return f("update",k({title:t,icon:n},C(e))),document.location.hash="",!1})}function pn(e){let t=o("#modal-team-config");x("team",t,null,null,e.title,e.icon)}function at(e){switch(e.cmd){case"update":return pn(e.param);case"child-add":return ee(e.param);case"child-update":return te(e.param);case"child-remove":return ne(e.param);case"permissions":return I(e.param);default:throw new Error("invalid team command ["+e.cmd+"]")}}function lt(){H("sprint");let e=u("#modal-sprint-config form");if(e){let t=o('select[name="team"]',e);t.onchange=()=>{R(t.value!=="")},N(t),e.onsubmit=()=>{let n=o('input[name="title"]',e).value,i=o('input[name="icon"]:checked',e).value,s=o('input[name="startDate"]',e).value,a=o('input[name="endDate"]',e).value;return f("update",k({title:n,icon:i,startDate:s,endDate:a,team:t.value},C(e))),document.location.hash="",!1}}}function B(e){return`${e}`.split("T")[0]}function fn(e){let t="";return e.startDate&&(t+="starts ",t+=B(e.startDate),e.endDate&&(t+=", ")),e.endDate&&(t+="ends ",t+=B(e.endDate)),t}function gn(e){let t=o("#modal-sprint-config"),n=u("form",t);n?(o('input[name="startDate"]',n).value=B(e.startDate),o('input[name="endDate"]',n).value=B(e.endDate)):(o(".config-panel-startDate",t).innerText=B(e.startDate),o(".config-panel-endDate",t).innerText=B(e.endDate)),o("#model-summary").innerText=fn(e),x("sprint",t,e.teamID,null,e.title,e.icon)}function mt(e){switch(e.cmd){case"update":return gn(e.param);case"child-add":return ee(e.param);case"child-update":return te(e.param);case"child-remove":return ne(e.param);case"permissions":return I(e.param);default:throw new Error("invalid sprint command ["+e.cmd+"]")}}function ct(e,t){return r("tr",{class:"story-row",id:"story-row-"+e.id,"data-idx":"s.Idx"},r("td",null,r("a",{href:"#modal-story-"+e.id},r("div",{class:"story-title"},e.title))),r("td",{class:"story-author nowrap"},r("a",{href:"#modal-member-"+e.userID},r("em",{class:"member-"+e.userID+"-name"},t))),r("td",{class:"story-status"},e.status),r("td",{class:"story-final-vote"},e.finalVote===""?"-":e.finalVote),r("td",null,U("story",e.id),$("story",e.id,e.title)))}function oe(e,t){return r("div",{class:"member","data-member":e},r("div",{class:"choice",dangerouslySetInnerHTML:q("minus",18,"")}),r("div",{class:"name member-"+e+"-name"},t))}function dt(e){return r("div",{class:"vote-option","data-choice":e},r("label",null,r("input",{type:"radio",name:"vote",value:"{%s c %}"}),r("div",{class:"vote-choice"},e)))}function hn(e,t){t.onclick=()=>{b(o("#modal-story-"+e+'-edit form input[name="title"]'))}}function vn(e,t){t.onsubmit=()=>(f("child-status",{storyID:e,status:"new"}),!1)}function ut(e,t){t.onsubmit=()=>(f("child-status",{storyID:e,status:"active"}),!1)}function yn(e,t){t.onsubmit=()=>(f("child-status",{storyID:e,status:"complete"}),!1)}function bn(e,t){m(".vote-option",t).forEach(n=>{n.onclick=()=>(o('input[name="vote"]',n).checked=!0,f("vote",{storyID:e,vote:n.dataset.choice}),m("#modal-story-"+e+" .story-members .member").forEach(i=>{i.dataset.member===T()&&(o(".choice",i).innerHTML=g("check",18,""))}),!1)})}function fe(e,t){t.onsubmit=()=>(confirm("Are you sure you want to delete this story?")&&(f("child-remove",{storyID:e}),document.location.hash=""),!1)}function ge(e){let t=e.dataset.id;if(!t){console.warn("no id in dataset",e);return}m(".vote-submit-button",e).forEach(n=>{n.style.display="none"}),m(".link-edit",e).forEach(n=>hn(t,n)),m(".status-new-form-delete",e).forEach(n=>fe(t,n)),m(".status-new-form-next",e).forEach(n=>ut(t,n)),m(".status-active-form-prev",e).forEach(n=>vn(t,n)),m(".status-active-form-next",e).forEach(n=>yn(t,n)),m(".story-vote-options",e).forEach(n=>bn(t,n)),m(".status-complete-form-prev",e).forEach(n=>ut(t,n))}function pt(e,t,n){return n?r("div",{class:"vote-result"},r("form",{class:"final-vote-form",action:"",method:"post"},r("input",{type:"hidden",name:"storyID",value:e}),r("input",{type:"hidden",name:"action",value:"vote"}),r("input",{type:"hidden",name:"typ",value:"user"}),r("input",{type:"hidden",name:"value",value:n.choice}),r("button",{type:"submit",class:"number button-link"},n.choice)),r("div",{class:"member-"+t.id+"-name"},t.name)):r("div",{class:"vote-result"},r("div",{class:"number",title:"user did not vote"},"-"),r("div",{class:"member-"+t.id+"-name"},t.name))}function ft(e){m("#modal-story-"+e.storyID+" .story-members .member").forEach(t=>{t.dataset.member===e.userID&&(o(".choice",t).innerHTML=g("check",18,""))})}function Tn(e){e.onsubmit=()=>{let t=o('input[name="storyID"]',e).value,n=o('input[name="typ"]',e).value,i=o('input[name="value"]',e).value,s=o("#modal-story-"+t);return o(".final-vote .value",s).innerText=i,f("vote",{storyID:t,typ:n,value:i}),!1}}function gt(e,t,n,i){let s=J().map(d=>{let p=t.find(y=>y.userID===d.id);return pt(e,d,p)}),a=o("#modal-story-"+e);o(" .vote-results",a).replaceChildren(...s);let l=o(".final-vote",a);o(".value",l).innerText=i,o(".value",l).style.display="inline-block",o(".message",l).style.display="none",o(".description",l).style.display="block";let c=o(".vote-calculations",a);o(".calc-counted .value",c).innerText=n.count+"/"+n.floats.length,o(".calc-range .value",c).innerText=n.min+"-"+n.max,o(".calc-mean .value",c).innerText=n.mean.toString(10),o('.calc-mean input[name="value"]',c).value=n.mean.toString(10),o(".calc-median .value",c).innerText=n.median.toString(10),o('.calc-median input[name="value"]',c).value=n.median.toString(10),o(".calc-mode .value",c).innerText=n.modeString===""?"0":n.modeString,o('.calc-mode input[name="value"]',c).value=n.modeString===""?"0":n.modeString,m(".final-vote-form",a).forEach(d=>{Tn(d)})}function ht(e){let t=o(".story-delete-button",e);t.onclick=()=>(confirm("Are you sure you want to delete this story?")&&(f("child-remove",{storyID:t.dataset.id}),document.location.hash=""),!1),e.onsubmit=()=>{let n=o('input[name="storyID"]',e).value,i=o('input[name="title"]',e).value;return f("child-update",{storyID:n,title:i}),document.location.hash="",!1}}function vt(){m(".add-story-link").forEach(n=>{n.onclick=()=>b(o("#story-add-title"))});let e=o("#modal-story--add"),t=o("form",e);t.onsubmit=()=>{let n=o('input[name="title"]',t),i=n.value;return n.value="",f("child-add",{title:i}),document.location.hash="",!1};for(let n of m(".modal-story-edit"))ht(o("form",n));m("#story-modals .modal-story").forEach(ge)}function he(e){let t=o("#story-row-"+e.id);o(".story-status",t).innerText=e.status,o(".story-title",t).innerText=e.title,o(".story-final-vote",t).innerText=e.finalVote===""?"-":e.finalVote;let n=o("#modal-story-"+e.id+"-edit");o('form input[name="title"]',n).innerText=e.title;let i=o("#modal-story-"+e.id),s=o(".final-vote",i);o(".value",s).innerText=e.finalVote===""?"-":e.finalVote,o("#story-row-"+e.id+" .story-final-vote").innerText=e.finalVote===""?"-":e.finalVote,e.finalVote===""?(o(".message",s).style.display="block",o(".description",s).style.display="none"):(o(".message",s).style.display="none",o(".description",s).style.display="block"),m('input[name="storyID"]',i).forEach(a=>{a.value=e.id}),o("h2.billboard",i).innerText=e.title}function yt(e){let t=o("#panel-detail table tbody"),n=-1;for(let v=0;v<t.children.length;v++){let K=t.children.item(v),Q=o(".story-title",K).innerText,h=K.dataset.index;if(h){if(parseInt(h,10)>=e.idx){n=v;break}else if(Q.localeCompare(e.title,void 0,{sensitivity:"accent"})>=0){n=v;break}}}let i=ct(e,M(e.userID));n===-1?t.appendChild(i):t.insertBefore(i,t.children[n]),A(o(".modal",i));let a=o(".modal-story-edit-new").cloneNode(!0);a.id="modal-story-"+e.id+"-edit",a.classList.remove("modal-story-edit-new"),m('input[name="storyID"]',a).forEach(v=>{v.value=e.id}),o('input[name="title"]',a).value=e.title,o(".story-delete-button",a).dataset.id=e.id,ht(o("form",a)),m(".edit-form-delete",a).forEach(v=>fe(e.id,v)),o("#story-modals").appendChild(a);let c=o("#modal-story-new").cloneNode(!0);c.id="modal-story-"+e.id,c.dataset.id=e.id,c.dataset.status=e.status,c.classList.add("modal-story");let d=o(".link-edit",c);d.href="#modal-story-"+e.id+"-edit",d.dataset.id=e.id;let p=J().map(v=>oe(v.id,v.name));o(".story-members",c).replaceChildren(...p);let y=Mt().map(v=>dt(v));o(".story-vote-options",c).replaceChildren(...y),o("#story-modals").appendChild(c),ge(c),he(e),(document.location.hash==="modal-story--add"||document.location.hash==="")&&(document.location.hash="modal-story-"+e.id)}function bt(e){let t=o("#story-row-"+e.story.id);o(".story-status",t).innerText=e.story.status;let n=o("#modal-story-"+e.story.id);o(".status-new",n).style.display=e.story.status==="new"?"block":"none",o(".status-active",n).style.display=e.story.status==="active"?"block":"none",o(".status-complete",n).style.display=e.story.status==="complete"?"block":"none",e.story.status==="complete"&&e.votes!==void 0&&e.results!==void 0&&gt(e.story.id,e.votes,e.results,e.story.finalVote)}function Tt(e){let t=o("#story-row-"+e),n=o(".story-title",t).innerText;L(e+"-removed","success",`story [${n}] has been removed`),t.remove(),o("#modal-story-"+e).remove()}function Et(){H("estimate");let e=u("#modal-estimate-config form");if(e){let t=o('select[name="team"]',e);t.onchange=()=>{R(t.value!=="")};let n=o('select[name="sprint"]',e);n.onchange=()=>{V(n.value!=="")},N(t,n),e.onsubmit=()=>{let i=o('input[name="title"]',e).value,s=o('input[name="icon"]:checked',e).value,a=o('input[name="choices"]',e).value;return f("update",k({title:i,icon:s,choices:a,team:t.value,sprint:n.value},C(e))),document.location.hash="",!1}}vt()}function Mt(){return o('#modal-estimate-config input[name="choices"]').value.split(",").map(t=>t.trim())}function Mn(e){m(".modal-story").forEach(t=>{o(".story-members",t).appendChild(oe(e.userID,e.name))})}function En(e){let t=o("#modal-estimate-config"),n=u("form",t);if(n){let i=o('input[name="choices"]',n);i.value=e.choices.join(","),i.parentElement&&_(i.parentElement)}else o(".config-panel-choices",t).innerText=e.choices.join(", ");x("estimate",t,e.teamID,e.sprintID,e.title,e.icon)}function ve(e){switch(e.cmd){case"member-add":return Mn(e.param);case"update":return En(e.param);case"child-add":return yt(e.param);case"child-update":return he(e.param);case"child-status":return bt(e.param);case"child-remove":return Tt(e.param);case"vote":return ft(e.param);case"permissions":return I(e.param);default:throw new Error("invalid estimate command ["+e.cmd+"]")}}function kt(e){return r("li",{id:"report-group-"+e},r("input",{id:"accordion-"+e,type:"checkbox",hidden:!0,checked:"checked"}),r("label",{for:"accordion-"+e,dangerouslySetInnerHTML:Ne(e)}),r("div",{class:"bd"},r("div",null,r("div",null))))}function Lt(e){return r("div",{class:"report",id:"report-"+e.id},r("div",null,r("div",{class:"right"},U("report",e.id)),$("report",e.id,e.id),r("a",{href:"#modal-report-"+e.id,"data-id":e.id,class:"clean"},r("h4",{class:"username member-"+e.userID+"-name"},M(e.userID)),r("div",{class:"pt"},e.html))))}function xt(e){return r("div",{id:"modal-report-"+e.id,class:"modal modal-report-view",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,e.day,": ",r("span",{class:"member-"+e.userID+"-name"},M(e.userID)))),r("div",{class:"modal-body",dangerouslySetInnerHTML:e.html})))}function Ht(e){return r("div",{id:"modal-report-"+e.id,class:"modal modal-report-edit",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,e.day,": ",r("span",{class:"member-"+e.userID+"-name"},M(e.userID)))),r("div",{class:"modal-body"},r("form",{action:"#",method:"post"},r("input",{type:"hidden",name:"reportID",value:e.id}),r("div",{class:"mb expanded"},r("label",{for:"input-day-"+e.id},r("em",{class:"title"},"Day")),r("div",null,r("input",{type:"date",id:"input-day-"+e.id,name:"day",value:e.day}))),r("div",{class:"mb expanded"},r("label",{for:"input-content-"+e.id},r("em",{class:"title"},"Content")),r("div",null,r("textarea",{id:"input-content-"+e.id,name:"content"},e.content))),r("div",{class:"right"},r("button",{class:"report-edit-save",type:"submit",name:"action",value:"child-update"},"Save Changes")),r("button",{class:"report-edit-delete",type:"submit",name:"action",value:"child-remove",onclick:"return confirm('Are you sure you want to delete this report?');"},"Delete")))))}function It(e){let t=o("form",e),n=o('input[name="reportID"]',t).value;o(".report-edit-delete",t).onclick=()=>(confirm("Are you sure you want to delete this report?")&&(f("child-remove",{reportID:n}),document.location.hash=""),!1),t.onsubmit=()=>{let i=o('input[name="day"]',t).value,a=o('textarea[name="content"]',t).value;return f("child-update",{reportID:n,day:i,content:a}),document.location.hash="",!1}}function Ct(){m(".add-report-link").forEach(n=>{n.onclick=()=>b(o("#report-add-content"))}),m(".modal-report-edit-link").forEach(n=>{n.onclick=()=>b(o("#input-content-"+n.dataset.id))});let e=o("#modal-report--add"),t=o("form",e);t.onsubmit=()=>{let n=o('input[name="day"]',t).value,i=o('textarea[name="content"]',t),s=i.value;return i.value="",f("child-add",{day:n,content:s}),document.location.hash="",!1},m(".modal-report-edit").forEach(It)}function ye(e){e.day.length>10&&(e.day=e.day.substring(0,10));let t=u("#report-group-"+e.day+" .bd");if(!t){let a=kt(e.day);o("#report-groups").appendChild(a),t=o(".bd",a)}let n=-1,i=M(e.userID);for(let a=0;a<t.children.length;a++){let l=t.children.item(a);if(o(".username",l).innerText.localeCompare(i,void 0,{sensitivity:"accent"})>=0){n=a;break}}let s=Lt(e);if(n===-1?t.appendChild(s):t.insertBefore(s,t.children[n]),T()===e.userID){let a=Ht(e);It(a),o("#report-modals").appendChild(a)}else o("#report-modals").appendChild(xt(e));A(o(".modal",s))}function wt(e){e.day.length>10&&(e.day=e.day.substring(0,10));let t=u("#report-"+e.id);if(!t)return ye(e);let n=o(".pt",t);e.html?n.innerHTML=e.html:n.innerText=e.content}function Dt(e){var n;let t=o("#report-"+e);if(t.parentElement){let i=t.parentElement;t.remove(),i.children.length===0&&((n=i.parentElement)==null||n.remove())}L(e+"-removed","success","report has been removed"),o("#modal-report-"+e).remove()}function Ft(){H("standup");let e=u("#modal-standup-config form");if(e){let t=o('select[name="team"]',e);t.onchange=()=>{R(t.value!=="")};let n=o('select[name="sprint"]',e);n.onchange=()=>{V(n.value!=="")},N(t,n),e.onsubmit=()=>{let i=o('input[name="title"]',e).value,s=o('input[name="icon"]:checked',e).value;return f("update",k({title:i,icon:s,team:t.value,sprint:n.value},C(e))),document.location.hash="",!1}}Ct()}function kn(e){let t=o("#modal-standup-config");x("standup",t,e.teamID,e.sprintID,e.title,e.icon)}function At(e){switch(e.cmd){case"update":return kn(e.param);case"child-add":return ye(e.param);case"child-update":return wt(e.param);case"child-remove":return Dt(e.param);case"permissions":return I(e.param);default:throw new Error("invalid standup command ["+e.cmd+"]")}}function Rt(e){return r("div",{id:"category-"+e,"data-category":e,class:"category"},r("div",{class:"right"},r("a",{class:"add-feedback-link","data-category":e,href:"#modal-feedback--add-"+e},r("button",null,"New"))),r("h4",null,r("a",{href:"#modal-feedback--add-"+e},e)),r("div",{class:"clear"}),r("div",{class:"feedback-list"}),r("div",{id:"modal-feedback--add-"+e,class:"modal modal-feedback-add","data-category":e,style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,"New Feedback")),r("div",{class:"modal-body"},r("form",{action:"#",method:"post"},r("input",{type:"hidden",name:"action",value:"child-add"}),r("input",{type:"hidden",name:"action",value:"child-add"}),r("div",{class:"mb expanded"},r("label",{for:"category-"+e+"-select"},r("em",{class:"title"},"Category")),r("div",null,r("select",{name:"category",id:"category-"+e+"-select"},r("option",{selected:"selected",value:"TODO"},"TODO")))),r("div",{class:"mb expanded"},r("label",{for:"feedback-add-content-"+e},r("em",{class:"title"},"Content")),r("div",null,r("textarea",{rows:"8",id:"feedback-add-content-"+e,name:"content",placeholder:"HTML and Markdown supported"}))),r("button",{type:"submit"},"Add Feedback"))))))}function Ut(e){return r("div",{id:"feedback-"+e.id,class:"feedback mt clear"},r("div",{class:"right"},U("feedback",e.id)),$("feedback",e.id,e.id),r("a",{href:"#modal-feedback-"+e.id,class:"clean modal-feedback-edit-link","data-id":e.id},r("div",{class:"username member-"+e.userID+"-name"},M(e.userID)),r("div",{class:"pt feedback-content"},e.html)))}function $t(e){return r("div",{id:"modal-feedback-"+e.id,class:"modal modal-feedback-view",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,e.category+" :: "+M(e.userID))),r("div",{class:"modal-body",dangerouslySetInnerHTML:e.html})))}var Ln="return confirm('Are you sure you want to delete this feedback?');";function xn(e){return m(".category").map(t=>t.dataset.category).map(t=>t===e?r("option",{value:t,selected:"selected"},t):r("option",{value:t},t))}function Nt(e){return r("div",{id:"modal-feedback-"+e.id,class:"modal modal-feedback-edit",style:"display: none;"},r("a",{class:"backdrop",href:"#"}),r("div",{class:"modal-content"},r("div",{class:"modal-header"},r("a",{href:"#",class:"modal-close"},"\xD7"),r("h2",null,e.category+" :: "+M(e.userID))),r("div",{class:"modal-body"},r("form",{action:"#",method:"post"},r("input",{type:"hidden",name:"feedbackID",value:e.id}),r("div",{class:"mb expanded"},r("label",{for:"input-category-"+e.id},r("em",{class:"title"},"Category")),r("div",null,r("select",{id:"input-category-"+e.id,name:"category"},xn(e.category)))),r("div",{class:"mb expanded"},r("label",{for:"input-content-"+e.id},r("em",{class:"title"},"Content")),r("div",null,r("textarea",{id:"input-content-"+e.id,name:"content"},e.content))),r("div",{class:"right"},r("button",{class:"feedback-edit-save",type:"submit",name:"action",value:"child-update"},"Save Changes")),r("button",{class:"feedback-edit-delete",type:"submit",name:"action",value:"child-remove",onclick:Ln},"Delete")))))}function Hn(e){let t=o("form",e);t.onsubmit=()=>{let n=o('select[name="category"]',t).value,i=o('textarea[name="content"]',t),s=i.value;return i.value="",f("child-add",{category:n,content:s}),document.location.hash="",!1}}function Vt(e){let t=o("form",e),n=o('input[name="feedbackID"]',t).value;o(".feedback-edit-delete",t).onclick=()=>(confirm("Are you sure you want to delete this feedback?")&&(f("child-remove",{feedbackID:n}),document.location.hash=""),!1),t.onsubmit=()=>{let i=o('select[name="category"]',t).value,a=o('textarea[name="content"]',t).value;return f("child-update",{feedbackID:n,category:i,content:a}),document.location.hash="",!1}}function Ot(){m(".add-feedback-link").forEach(e=>{e.onclick=()=>b(o("#feedback-add-content-"+e.dataset.category))}),m(".modal-feedback-edit-link").forEach(e=>{e.onclick=()=>b(o("#input-content-"+e.dataset.id))});for(let e of m(".modal-feedback-add"))Hn(e);m(".modal-feedback-edit").forEach(Vt)}function be(e){let t=u("#category-"+e.category+" .feedback-list");if(!t){let s=Rt(e.category);o("#category-list").appendChild(s),t=o(".feedback-list",s)}let n=-1;for(let s=0;s<t.children.length;s++){let a=t.children.item(s),l=o(".feedback-content",a).innerText,c=a.dataset.index;if(c){if(parseInt(c,10)>=e.idx){n=s;break}else if(l.localeCompare(e.content,void 0,{sensitivity:"accent"})>=0){n=s;break}}}let i=Ut(e);if(n===-1?t.appendChild(i):t.insertBefore(i,t.children[n]),T()===e.userID){let s=Nt(e);Vt(s),o("#feedback-modals").appendChild(s)}else o("#feedback-modals").appendChild($t(e));A(o(".modal",i))}function Pt(e){let t=u("#feedback-"+e.id);if(!t)return be(e);let n=o(".pt",t);e.html?n.innerHTML=e.html:n.innerText=e.content}function qt(e){o("#feedback-"+e).remove(),L(e+"-removed","success","feedback has been removed"),o("#modal-feedback-"+e).remove()}function _t(){H("retro");let e=u("#modal-retro-config form");if(e){let t=o('select[name="team"]',e);t.onchange=()=>{R(t.value!=="")};let n=o('select[name="sprint"]',e);n.onchange=()=>{V(n.value!=="")},N(t,n),e.onsubmit=()=>{let i=o('input[name="title"]',e).value,s=o('input[name="icon"]:checked',e).value,a=o('input[name="categories"]',e).value;return f("update",k({title:i,icon:s,categories:a,team:t.value,sprint:n.value},C(e))),document.location.hash="",!1}}Ot()}function In(e){let t=o("#modal-retro-config"),n=u("form",t);if(n){let i=o('input[name="categories"]',n);i.value=e.categories.join(","),i.parentElement&&_(i.parentElement)}else o(".config-panel-categories",t).innerText=e.categories.join(", ");x("retro",t,e.teamID,e.sprintID,e.title,e.icon)}function Bt(e){switch(e.cmd){case"update":return In(e.param);case"child-add":return be(e.param);case"child-update":return Pt(e.param);case"child-remove":return qt(e.param);case"permissions":return I(e.param);default:throw new Error("invalid retro command ["+e.cmd+"]")}}function Cn(e){L("adhoc-message",e.level,e.message)}function wn(e,t){switch(e){case"team":return at(t);case"sprint":return mt(t);case"estimate":return ve(t);case"standup":return At(t);case"retro":return Bt(t);default:throw new Error("invalid service ["+e+"]")}}function Wt(e,t){switch(t.cmd){case"reset":document.location.href="/";return;case"message":return Cn(t.param);case"comment":return pe(t.param);case"online-update":return nt(t.param);case"member-add":return e==="estimate"&&ve(t),et(t.param);case"member-update":return de(t.param);case"member-remove":return tt(t.param);default:return wn(e,t)}}var jt,W,re;function Dn(){console.log("[socket]: open")}function Fn(e){let t=document.getElementById("socket-list");if(t){let n=document.createElement("pre");n.innerText=JSON.stringify(e,null,2),t.append(n)}Wt(W,e)}function An(e){console.log(`[socket error]: ${e}`)}function Rn(e,t){switch(W=e,re=t,it(),ot(),W){case"team":st();break;case"sprint":lt();break;case"estimate":Et();break;case"standup":Ft();break;case"retro":_t();break}jt=new Y(!0,Dn,Fn,An,"/"+W+"/"+re+"/connect"),console.log("loaded ["+W+"] workspace ["+re+"]")}function f(e,t){jt.send({channel:W+":"+re,cmd:e,param:t})}function Gt(){window.initWorkspace=Rn}function Un(){let[e,t]=We();window.rituals={relativeTime:Re(),autocomplete:Ue(),setSiblingToNull:e,initForm:t,flash:De(),tags:Pe(),Socket:Qe()},Ie(),Ce(),Fe(),$e(),Ge(),_e(),window.audit=He,window.JSX=r,Gt()}document.addEventListener("DOMContentLoaded",Un);})();
//# sourceMappingURL=client.js.map
