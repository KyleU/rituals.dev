(()=>{function c(e,t){let n;t?n=t.querySelectorAll(e):n=document.querySelectorAll(e);let s=[];return n.forEach(r=>{s.push(r)}),s}function g(e,t){let n=c(e,t);switch(n.length){case 0:return;case 1:return n[0];default:console.warn(`found [${n.length}] elements with selector [${e}], wanted zero or one`)}}function o(e,t){let n=g(e,t);if(!n)throw`no element found for selector [${e}]`;return n}function de(e,t){return typeof e=="string"&&(e=o(e)),e.innerHTML=t,e}function U(e,t,n="block"){return typeof e=="string"&&(e=o(e)),e.style.display=t?n:"none",e}function i(e,t,...n){let s=document.createElement(e);for(let r in t)if(r==="for"&&(r="for"),r==="className"&&(r="class"),r&&t.hasOwnProperty(r)){let a=t[r];r==="dangerouslySetInnerHTML"?de(s,a.__html):a===!0?s.setAttribute(r,r):a!==!1&&a!==null&&a!==void 0&&s.setAttribute(r,a.toString())}for(let r of n)if(Array.isArray(r))r.forEach(a=>{if(r==null)throw`child array for tag [${e}] is ${r}
${s.outerHTML}`;if(a==null)throw`child for tag [${e}] is ${a}
${s.outerHTML}`;typeof a=="string"&&(a=document.createTextNode(a)),s.appendChild(a)});else{if(r==null)throw`child for tag [${e}] is ${r}
${s.outerHTML}`;r.nodeType||(r=document.createTextNode(r.toString())),s.appendChild(r)}return s}function ue(){for(let e of Array.from(document.querySelectorAll(".menu-container .final")))e.scrollIntoView({block:"nearest"})}var J="mode-light",X="mode-dark";function pe(){for(let e of Array.from(document.getElementsByClassName("mode-input"))){let t=e;t.onclick=function(){switch(t.value){case"":document.body.classList.remove(J),document.body.classList.remove(X);break;case"light":document.body.classList.add(J),document.body.classList.remove(X);break;case"dark":document.body.classList.remove(J),document.body.classList.add(X);break}}}}function k(e,t,n){let s=document.getElementById("flash-container");s===null&&(s=document.createElement("div"),s.id="flash-container",document.body.insertAdjacentElement("afterbegin",s));let r=document.createElement("div");r.className="flash";let a=document.createElement("input");a.type="radio",a.style.display="none",a.id="hide-flash-"+e,r.appendChild(a);let l=document.createElement("label");l.htmlFor="hide-flash-"+e;let m=document.createElement("span");m.innerHTML="\xD7",l.appendChild(m),r.appendChild(l);let u=document.createElement("div");u.className="content flash-"+t,u.innerText=n,r.appendChild(u),s.appendChild(r),ge(r)}function fe(){let e=document.getElementById("flash-container");if(e===null)return k;let t=e.querySelectorAll(".flash");if(t.length>0)for(let n of t)ge(n);return k}function ge(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function he(){for(let e of Array.from(document.getElementsByClassName("link-confirm"))){let t=e;t.onclick=function(){let n=t.dataset.message;return n&&n.length===0&&(n="Are you sure?"),confirm(n)}}}function ve(){return c(".reltime").forEach(e=>{P(e.dataset.time||"",e)}),P}function be(e){let t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString().substring(0,19).replace("T"," ")}function P(e,t){let n=(e||"").replace(/-/g,"/").replace(/[TZ]/g," ")+" UTC",s=new Date(n),r=(new Date().getTime()-s.getTime())/1e3,a=Math.floor(r/86400),l=s.getFullYear(),m=s.getMonth()+1,u=s.getDate();if(isNaN(a)||a<0||a>=31)return l.toString()+"-"+(m<10?"0"+m.toString():m.toString())+"-"+(u<10?"0"+u.toString():u.toString());let f,b;return a==0?r<5?(b=1,f="just now"):r<60?(b=1,f=Math.floor(r)+" seconds ago"):r<120?(b=10,f="1 minute ago"):r<3600?(b=30,f=Math.floor(r/60)+" minutes ago"):r<7200?(b=60,f="1 hour ago"):(b=60,f=Math.floor(r/3600)+" hours ago"):a==1?(b=600,f="yesterday"):a<7?(b=600,f=a+" days ago"):(b=6e3,f=Math.ceil(a/7)+" weeks ago"),t&&(t.innerText=f,setTimeout(()=>P(e,t),b*1e3)),f}function ye(){return xt}function xt(e,t,n,s,r){if(!e)return;let a=e.id+"-list",l=document.createElement("datalist"),m=document.createElement("option");m.value="",m.innerText="Loading...",l.appendChild(m),l.id=a,e.parentElement?.prepend(l),e.setAttribute("autocomplete","off"),e.setAttribute("list",a);let u={},f="";function b(h){let M=t;return M.includes("?")?M+"&t=json&"+n+"="+encodeURIComponent(h):M+"?t=json&"+n+"="+encodeURIComponent(h)}function ae(h){let M=u[h];!M||!M.frag||(f=h,l.replaceChildren(M.frag.cloneNode(!0)))}function Et(){let h=e.value;if(h.length===0)return;let M=b(h),z=!h||!f;if(!z){let H=u[f];H&&(z=!H.data.find(R=>h===r(R)))}if(!!z){if(u[h]&&u[h].url===M){ae(h);return}fetch(M,{credentials:"include"}).then(H=>H.json()).then(H=>{if(!H)return;let R=Array.isArray(H)?H:[H],le=document.createDocumentFragment(),ce=10;for(let W=0;W<R.length&&ce>0;W++){let me=r(R[W]),Lt=s(R[W]);if(me){let S=document.createElement("option");S.value=me,S.innerText=Lt,le.appendChild(S),ce--}}u[h]={url:M,data:R,frag:le,complete:!1},ae(h)})}}e.oninput=Ht(Et,250),console.log("managing ["+e.id+"] autocomplete")}function Ht(e,t){let n=0;return function(...s){n!==0&&window.clearTimeout(n),n=window.setTimeout(function(){e(null,...s)},t)}}function Te(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function v(e,t,n){return t||(t=18),n==null&&(n="icon"),`<svg class="${n}" style="width: ${t}px; height: ${t+"px"};"><use xlink:href="#svg-${e}"></use></svg>`}function j(e,t,n){return{__html:v(e,t,n)}}function Me(e){e||(e="");let t=v("right",15,"expand"),n=v("down",15,"collapse");return{__html:t+n+e}}function p(e){return setTimeout(()=>{e.setSelectionRange(e.value.length,e.value.length),e.focus()},100),!0}function $(e){let t=o("input.result",e),n=o(".tags",e),s=t.value.split(",").map(a=>a.trim()).filter(a=>a!=="");U(t,!1),n.innerHTML="";for(let a of s)n.appendChild(Ee(a,e));g(".add-item",e)?.remove();let r=document.createElement("div");r.className="add-item",r.innerHTML=v("plus",22),r.onclick=function(){wt(n,e)},e.insertBefore(r,o(".clear",e))}function ke(){for(let e of c(".tag-editor"))$(e);return $}function It(e,t){return e.parentElement!==t.parentElement?null:e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var _;function Ee(e,t){let n=document.createElement("div");n.className="item",n.draggable=!0,n.ondragstart=function(l){l.dataTransfer?.setDragImage(document.createElement("div"),0,0),n.classList.add("dragging"),_=n},n.ondragover=function(){let l=It(n,_);if(!l)return;let m=l===-1?n:n.nextSibling;_.parentElement?.insertBefore(_,m),ee(t)},n.ondrop=function(l){l.preventDefault()},n.ondragend=function(l){n.classList.remove("dragging"),l.preventDefault()};let s=document.createElement("div");s.innerText=e,s.className="value",s.onclick=function(){Le(n)},n.appendChild(s);let r=document.createElement("input");r.className="editor",n.appendChild(r);let a=document.createElement("div");return a.innerHTML=v("times",13),a.className="close",a.onclick=function(){Ct(n)},n.appendChild(a),n}function Ct(e){let t=e.parentElement?.parentElement;e.remove(),t&&ee(t)}function wt(e,t){let n=Ee("",t);e.appendChild(n),Le(n)}function Le(e){let t=o(".value",e),n=o(".editor",e);n.value=t.innerText;let s=function(){if(n.value===""){e.remove();return}t.innerText=n.value,U(t,!0),U(n,!1);let r=e.parentElement?.parentElement;r&&ee(r)};n.onblur=s,n.onkeydown=function(r){if(r.code==="Enter")return r.preventDefault(),s(),!1},U(t,!1),U(n,!0),n.focus()}function ee(e){let t=[],n=c(".item .value",e);for(let r of n)t.push(r.innerText);let s=o("input.result",e);s.value=t.join(", ")}var xe="--selected";function Dt(e){let t=e.parentElement?.parentElement?.querySelector("input");if(!t)throw"no associated input found";t.value="\u2205"}function te(e){e.onreset=()=>te(e);let t={},n={};for(let s of e.elements){let r=s;if(r.name.length>0)if(r.name.endsWith(xe))n[r.name]=r;else{(r.type!=="radio"||r.checked)&&(t[r.name]=r.value);let a=()=>{let l=n[r.name+xe];l&&(l.checked=t[r.name]!==r.value)};r.onchange=a,r.onkeyup=a}}}function He(){for(let e of Array.from(document.querySelectorAll("form.editor")))te(e);return[Dt,te]}var Ft=[];function Ie(){let e=document.querySelectorAll(".color-var");if(e.length>0)for(let t of Array.from(e)){let n=t,s=n.dataset.var,r=n.dataset.mode;Ft.push(s),!(!s||s.length===0)&&(n.oninput=function(){At(r,s,n.value)})}}function At(e,t,n){let s=document.querySelector("#mockup-"+e);if(!s){console.error("can't find mockup for mode ["+e+"]");return}switch(t){case"color-foreground":I(s,".mock-main",n);break;case"color-background":B(s,".mock-main",n);break;case"color-foreground-muted":I(s,".mock-main .mock-muted",n);break;case"color-background-muted":B(s,".mock-main .mock-muted",n);break;case"color-link-foreground":I(s,".mock-main .mock-link",n);break;case"color-link-visited-foreground":I(s,".mock-main .mock-link-visited",n);break;case"color-nav-foreground":I(s,".mock-nav",n),I(s,".mock-nav .mock-link",n);break;case"color-nav-background":B(s,".mock-nav",n);break;case"color-menu-foreground":I(s,".mock-menu",n),I(s,".mock-menu .mock-link",n);break;case"color-menu-background":B(s,".mock-menu",n);break;case"color-menu-selected-foreground":I(s,".mock-menu .mock-link-selected",n);break;case"color-menu-selected-background":B(s,".mock-menu .mock-link-selected",n);break;default:console.error("invalid key ["+t+"]")}}function Ce(e,t,n){let s=e.querySelectorAll(t);if(s.length==0)throw"empty query selector ["+t+"]";s.forEach(r=>n(r))}function B(e,t,n){Ce(e,t,s=>s.style.backgroundColor=n)}function I(e,t,n){Ce(e,t,s=>s.style.color=n)}function we(){return V}var De=!1,V=class{constructor(t,n,s,r,a){this.debug=t,this.open=n,this.recv=s,this.err=r,this.url=Fe(a),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=function(){De=!0},this.connectTime=Date.now(),this.sock=new WebSocket(Fe(this.url));let t=this;this.sock.onopen=()=>{t.connected=!0,t.pendingMessages.forEach(t.send),t.pendingMessages=[],t.debug&&console.log("WebSocket connected"),t.open()},this.sock.onmessage=n=>{let s=JSON.parse(n.data);t.debug&&console.debug("[socket]: receive",s),t.recv(s)},this.sock.onerror=n=>()=>{t.err("socket",n.type)},this.sock.onclose=()=>{if(De)return;t.connected=!1;let n=t.connectTime?Date.now()-t.connectTime:0;0<n&&n<2e3?(t.pauseSeconds=t.pauseSeconds*2,t.debug&&console.debug(`socket closed immediately, reconnecting in ${t.pauseSeconds} seconds`),setTimeout(()=>{t.connect()},t.pauseSeconds*1e3)):(console.debug("socket closed after ["+n+"ms]"),setTimeout(()=>{t.connect()},t.pauseSeconds*500))}}disconnect(){}send(t){if(this.debug&&console.debug("out",t),!this.sock)throw"not initialized";if(this.connected){let n=JSON.stringify(t,null,2);this.sock.send(n)}else this.pendingMessages.push(t)}};function Fe(e){if(e||(e="/connect"),e.indexOf("ws")==0)return e;let t=document.location,n="ws";return t.protocol==="https:"&&(n="wss"),e.indexOf("/")!=0&&(e="/"+e),n+`://${t.host}${e}`}function Ae(e,t,n,s){return i("tr",{id:"member-"+e,class:"member","data-id":e},i("td",null,i("a",{href:"#modal-member-"+e},i("div",{class:"left prs",dangerouslySetInnerHTML:j("profile",18,"")}),i("span",{class:"member-name"},t))),i("td",{class:"shrink text-align-right"},i("em",{class:"member-status"},n)),i("td",{class:"shrink online-status",title:"offline",dangerouslySetInnerHTML:j("circle",18,"right")}))}function Re(e,t,n,s){let r=[["owner","Owner"],["member","Member"],["observer","Observer"]];return i("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,t)),i("div",{class:"modal-body"},i("form",{action:document.location.pathname,method:"post",class:"expanded"},i("input",{type:"hidden",name:"userID",value:e}),i("em",null,"Role"),i("br",null),i("select",{class:"input-role",name:"role"},r.map(a=>a[0]==n?i("option",{selected:"selected",value:a[0]},a[1]):i("option",{value:a[0]},a[1]))),i("hr",null),i("div",{class:"right"},i("button",{class:"member-update",type:"submit",name:"action",value:"member-update"},"Save")),i("button",{type:"submit",class:"member-remove",name:"action",value:"member-remove",onClick:"return confirm('Are you sure you wish to remove this user?');"},"Remove")))))}var N,A;function y(e){if(!e)return"System";let t=A[e];return t||"Unknown User"}function O(){return N}function Ue(){Rt(),Ut(),ne()}function Rt(){let e=o("#modal-self"),t=o("form",e);t.onsubmit=function(){let n=o('input[name="name"]',t),s=o('input[name="choice"]:checked',t),r=g('input[name="picture"]:checked',t),a={name:n.value,choice:s.value};return r&&(a.picture=r.value),d("self",a),o("#self-name").innerText=n.value,o("#self-picture").innerHTML=ie(r?r.value:"",20,"icon"),document.location.hash="",!1}}function Ut(){let e=c(".modal-member");for(let t of e)$e(t)}function $e(e){let t=o("form",e),n=function(s){let r=o('input[name="userID"]',t).value,a=o('select[name="role"]',t).value;d(s,{userID:r,role:a});let l=o("#member-"+r);return s==="member-update"?o(".member-role",l).innerText=a:s==="member-remove"&&(l.remove(),ne()),document.location.hash="",!1};o(".member-update",t).onclick=()=>n("member-update"),o(".member-remove",t).onclick=()=>confirm("Are you sure you wish to remove this user?")?n("member-remove"):!1}function ne(){A={},N=o("#self-id").innerText,A[N]=o("#self-name").innerText;let e=o("#panel-members"),t=c(".member",e);for(let n of t){let s=n.dataset.id;s&&(A[s]=o(".member-name",n).innerText)}}function Ne(e){if(g("#member-"+e.userID)||e.userID===N)return oe(e);let n=o("#panel-members table tbody"),s=-1;for(let m=0;m<n.children.length;m++){let u=n.children.item(m);if(o(".member-name",u).innerText.localeCompare(e.name,void 0,{sensitivity:"accent"})>0){s=m;break}}let r=Ae(e.userID,e.name,e.role,e.picture?e.picture:"");s==-1?n.appendChild(r):n.insertBefore(r,n.children[s]);let a=o("#member-modals"),l=Re(e.userID,e.name,e.role,e.picture?e.picture:"");a.appendChild(l),$e(l),A[e.userID]=e.name}function oe(e){if(e.userID===N)o("#self-name").innerText=e.name,o("#self-role").innerText=e.role,o("#self-picture").innerHTML=ie(e.picture?e.picture:"",20,"icon");else{let t=o("#member-"+e.userID);o(".member-name",t).innerText=e.name,o(".member-role",t).innerText=e.role,o(".member-picture").innerHTML=ie(e.picture?e.picture:"",18,"");let n=o("#modal-member-"+e.userID);o('select[name="role"]',n).value=e.role}if(A[e.userID]!==e.name){A[e.userID]=e.name;let t=o("#panel-members table tbody"),n=t.children,s=[];for(let r in n)n[r].nodeType==1&&s.push(n[r]);s.sort((r,a)=>{let l=o(".member-name",r).innerText,m=o(".member-name",a).innerText;return l.localeCompare(m,void 0,{sensitivity:"accent"})}),t.replaceChildren(...s)}}function Oe(e){o("#member-"+e).remove(),ne()}function qe(e){if(e.userID===N)return;let t=g("#member-"+e.userID+" .online-status");if(!t)throw"missing panel #member-"+e.userID;t.title=e.connected?"online":"offline";let n=e.connected?"check-circle":"circle";t.innerHTML=v(n,18,"right")}function ie(e,t,n){return e===""?v("profile",t,n):`<img class="${n}" style="width: ${t}px; height: ${t}px;" src="${e}" />`}function Pe(e,t){let n=i("li",null),s=be(new Date),r=i("span",{class:"nowrap reltime","data-time":s},"just now");P(s,r);let a=i("div",{class:"right"});return a.appendChild(r),n.appendChild(a),n.appendChild(i("div",null,e.content)),n.appendChild(i("div",null,i("em",null,t))),n}function D(e,t){let n="comment-link-"+e+"-"+t,s="#modal-"+e+"-"+t+"-comments",r=i("a",{id:n,class:"comment-link","data-key":e+"-"+t,href:s,title:"0 comments",dangerouslySetInnerHTML:j("comment-alt",18,"")});return re(r),r}function F(e,t,n){return i("div",{id:"modal-"+e+"-"+t+"-comments",class:"modal comments",style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,n," Comments")),i("div",{class:"modal-body"},i("ul",{id:"comment-list-"+e+"-"+t,class:"comment-list"}),i("form",{action:"#",method:"post",class:"expanded"},i("input",{type:"hidden",name:"action",value:"comment"}),i("input",{type:"hidden",name:"svc",value:e}),i("input",{type:"hidden",name:"modelID",value:t}),i("div",null,i("textarea",{name:"content",placeholder:"Add a comment, Markdown and HTML supported"})),i("div",{class:"mt right"},i("button",{type:"submit"},"Add Comment"))))))}function je(){for(let e of c(".comment-link"))re(e);for(let e of c(".modal.comments"))C(e)}function re(e){e.onclick=()=>p(o("#modal-"+e.dataset.key+"-comments form textarea"))}function C(e){let t=o("form",e);t.onsubmit=function(){let n={svc:o('input[name="svc"]',t).value,modelID:o('input[name="modelID"]',t).value},s=o("textarea",t);return n.content=s.value,n.userID=O(),d("comment",n),se(n),s.value="",!1}}function se(e){let t=o("#comment-list-"+e.svc+"-"+e.modelID),n=y(e.userID),s=Pe(e,n);t.appendChild(s);let r=t.children.length,a=o("#comment-link-"+e.svc+"-"+e.modelID);a.title=r+(r==1?" comment":" comments"),a.innerHTML.indexOf("comment-dots")==-1&&(a.innerHTML=v("comment-dots",18,"right"))}function $t(e,t,n,s){let r="";if(s){let a=g(`select[name="sprint"] option[value="${s}"]`,t);if(a){let l=a.innerText;r+=`<a href="/sprint/${s}">${l}</a> `}}if(r+=e==="retro"?"retrospective":e,n){let a=g(`select[name="team"] option[value="${n}"]`,t);if(a){let l=a.innerText;r+=` in <a href="/team/${n}">${l}</a>`}}return r}function G(e){let t=o(`#${e.type}-list tbody`),n=g(".empty",t);n&&n.remove();let s=document.createElement("tr");s.id=`${e.type}-list-${e.id}`;let r=document.createElement("td"),a=document.createElement("div");a.classList.add("right"),a.appendChild(D(e.type,e.id)),a.appendChild(F(e.type,e.id,e.id)),r.appendChild(a);let l=document.createElement("a");l.href=e.path;let m=document.createElement("span");m.classList.add("model-span-icon"),m.innerHTML=v(e.icon,16,"icon"),l.appendChild(m);let u=document.createElement("span");u.classList.add("model-span-title"),u.innerText=e.title,l.appendChild(u),r.appendChild(l),s.appendChild(r),t.appendChild(s),C(o(".modal",a))}function Y(e){let t=o(`#${e.type}-list-${e.model.id}`);o(".model-span-icon",t).innerHTML=v(e.model.icon),o(".model-span-title",t).innerText=e.model.title}function K(e){o(`#${e.type}-list-${e.id}`).remove();let t=o(`#${e.type}-list tbody`);if(t.children.length===0){let n=document.createElement("tr");n.classList.add("empty");let s=document.createElement("em");s.innerText="no "+e.type+"s",n.appendChild(s),t.appendChild(n)}}function E(e,t,n,s,r,a){o('input[name="title"]',t).value=r;for(let u of c('input[name="icon"]',t))u.checked=a===u.value;let l=g('select[name="team"]',t);l!=null&&(l.value=n||"");let m=g('select[name="sprint"]',t);m!=null&&(m.value=s||""),o("#model-title").innerText=r,o("#model-icon").innerHTML=v(a,20),o("#model-banner").innerHTML=$t(e,t,n||"",s||"")}function L(e){console.log("permissionsUpdate",e)}function T(e){o(".permission-config-team").style.display=e?"block":"none"}function w(e){o(".permission-config-sprint").style.display=e?"block":"none"}function x(e){let t={};for(let n of c(".perm-option",e))n.checked&&(t[n.name]=n.value);return t}function Be(){o("#modal-team-config-link").onclick=function(){p(o('#modal-team-config form input[name="title"]'))};let e=o("#modal-team-config form");e.onsubmit=function(){let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value;return d("update",{title:t,icon:n,...x(e)}),document.location.hash="",!1}}function We(e){switch(e.cmd){case"update":return Nt(e.param);case"child-add":return G(e.param);case"child-update":return Y(e.param);case"child-remove":return K(e.param);case"permissions":return L(e.param);default:throw"invalid team command ["+e.cmd+"]"}}function Nt(e){let t=o("#modal-team-config form");E("team",t,null,null,e.title,e.icon)}function _e(){o("#modal-sprint-config-link").onclick=function(){p(o('#modal-sprint-config form input[name="title"]'))};let e=o("#modal-sprint-config form"),t=o('select[name="team"]',e);t.onchange=function(){T(t.value!=="")},T(t.value!==""),e.onsubmit=function(){let n=o('input[name="title"]',e).value,s=o('input[name="icon"]:checked',e).value,r=o('input[name="startDate"]',e).value,a=o('input[name="endDate"]',e).value;return d("update",{title:n,icon:s,startDate:r,endDate:a,team:t.value,...x(e)}),document.location.hash="",!1}}function Ve(e){switch(e.cmd){case"update":return Ot(e.param);case"child-add":return G(e.param);case"child-update":return Y(e.param);case"child-remove":return K(e.param);case"permissions":return L(e.param);default:throw"invalid sprint command ["+e.cmd+"]"}}function Ot(e){let t=o("#modal-sprint-config form");o('input[name="startDate"]',t).value=Q(e.startDate),o('input[name="endDate"]',t).value=Q(e.endDate),o("#model-summary").innerText=qt(e),E("sprint",t,e.teamID,null,e.title,e.icon)}function qt(e){let t="";return e.startDate&&(t+="starts ",t+=Q(e.startDate),e.endDate&&(t+=", ")),e.endDate&&(t+="ends ",t+=Q(e.endDate)),t}function Q(e){return`${e}`.split("T")[0]}function Ge(e){return i("tr",{class:"story-row",id:"story-row-{%s s.ID.String() %}","data-idx":"s.Idx"},i("td",null,i("a",{href:"#modal-story-"+e.id,class:"story-title"},i("div",null,e.title))),i("td",null,e.status),i("td",null,e.finalVote?e.finalVote:"-"),i("td",null,D("story",e.id),F("story",e.id,e.title)))}function Ye(e){let t=e.dataset.id;if(!t){console.warn("no id in dataset",e);return}c(".vote-submit-button",e).forEach(n=>n.style.display="none"),c(".link-edit",e).forEach(n=>Pt(t,n)),c(".status-new-form-delete",e).forEach(n=>_t(t,n)),c(".status-new-form-next",e).forEach(n=>Ke(t,n)),c(".status-active-form-prev",e).forEach(n=>jt(t,n)),c(".status-active-form-next",e).forEach(n=>Bt(t,n)),c(".story-vote-options",e).forEach(n=>Wt(t,n)),c(".status-complete-form-prev",e).forEach(n=>Ke(t,n))}function Pt(e,t){t.onclick=function(){p(o("#modal-story-"+e+'-edit form input[name="title"]'))}}function jt(e,t){t.onsubmit=function(){return d("child-status",{storyID:e,status:"new"}),console.log("new"),!1}}function Ke(e,t){t.onsubmit=function(){return d("child-status",{storyID:e,status:"active"}),console.log("active"),!1}}function Bt(e,t){t.onsubmit=function(){return d("child-status",{storyID:e,status:"complete"}),console.log("complete"),!1}}function Wt(e,t){c(".vote-option",t).forEach(n=>{n.onclick=function(){return o('input[name="vote"]',n).checked=!0,d("vote",{storyID:e,vote:n.dataset.choice}),!1}})}function _t(e,t){t.onsubmit=function(){return confirm("Are you sure you want to delete this story?")&&(d("child-remove",{storyID:e}),document.location.hash=""),!1}}function Qe(){c(".add-story-link").forEach(n=>n.onclick=function(){return p(o("#story-add-title"))});let e=o("#modal-story--add"),t=o("form",e);t.onsubmit=function(){let n=o('input[name="title"]',t),s=n.value;return n.value="",d("child-add",{title:s}),document.location.hash="",!1},c("#story-modals .modal-story").forEach(Ye)}function Ze(e){let t=o("#panel-detail table tbody"),n=-1;for(let l=0;l<t.children.length;l++){let m=t.children.item(l),u=o(".story-title",m).innerText,f=m.dataset.index;if(f){if(parseInt(f,10)>=e.idx){n=l;break}else if(u.localeCompare(e.title,void 0,{sensitivity:"accent"})>=0){n=l;break}}}let s=Ge(e);n==-1?t.appendChild(s):t.insertBefore(s,t.children[n]),C(o(".modal",s));let a=o("#modal-story-new").cloneNode(!0);a.id="modal-story-"+e.id,a.dataset.id=e.id,a.dataset.status=e.status,a.classList.add("modal-story"),o("#story-modals").appendChild(a),(document.location.hash==="modal-story--add"||document.location.hash==="")&&(document.location.hash="modal-story-"+e.id)}function ze(e){let t=o("#modal-story-"+e.id);o(".status-new",t).style.display=e.status==="new"?"block":"none",o(".status-active",t).style.display=e.status==="active"?"block":"none",o(".status-complete",t).style.display=e.status==="complete"?"block":"none"}function Se(e){let t=o("#story-row-"+e),n=o(".story-title",t).innerText;k(e+"-removed","success",`story [${n}] has been removed`),t.remove(),o("#modal-story-"+e).remove()}function Je(){o("#modal-estimate-config-link").onclick=function(){p(o('#modal-estimate-config form input[name="title"]'))};let e=o("#modal-estimate-config form"),t=o('select[name="team"]',e);t.onchange=function(){T(t.value!=="")};let n=o('select[name="sprint"]',e);n.onchange=function(){w(n.value!=="")},T(t.value!==""),w(n.value!==""),e.onsubmit=function(){let s=o('input[name="title"]',e).value,r=o('input[name="icon"]:checked',e).value,a=o('input[name="choices"]',e).value;return d("update",{title:s,icon:r,choices:a,team:t.value,sprint:n.value,...x(e)}),document.location.hash="",!1},Qe()}function Xe(e){switch(e.cmd){case"update":return Vt(e.param);case"child-add":return Ze(e.param);case"child-status":return ze(e.param);case"child-remove":return Se(e.param);case"permissions":return L(e.param);default:throw"invalid estimate command ["+e.cmd+"]"}}function Vt(e){let t=o("#modal-estimate-config form"),n=o('input[name="choices"]',t);n.value=e.choices,n.parentElement&&$(n.parentElement),E("estimate",t,e.teamID,e.sprintID,e.title,e.icon)}function et(e){return i("li",{id:"report-group-"+e},i("input",{id:"accordion-"+e,type:"checkbox",hidden:!0,checked:"checked"}),i("label",{for:"accordion-"+e,dangerouslySetInnerHTML:Me(e)}),i("div",{class:"bd"}))}function tt(e){return i("div",{class:"report",id:"report-"+e.id},i("div",null,i("div",{class:"right"},D("report",e.id)),F("report",e.id,e.id),i("a",{href:"#modal-report-"+e.id,"data-id":e.id,class:"clean"},i("h4",{class:"username"},y(e.userID)),i("div",{class:"pt"},e.html))))}function nt(e){return i("div",{id:"modal-report-"+e.id,class:"modal modal-report-view",style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,e.day+": "+y(e.userID))),i("div",{class:"modal-body",dangerouslySetInnerHTML:e.html})))}function ot(e){return i("div",{id:"modal-report-"+e.id,class:"modal modal-report-edit",style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,e.day+": "+y(e.userID))),i("div",{class:"modal-body"},i("form",{action:"#",method:"post"},i("input",{type:"hidden",name:"reportID",value:e.id}),i("div",{class:"mb expanded"},i("label",{for:"input-day-"+e.id},i("em",{class:"title"},"Day")),i("div",null,i("input",{type:"date",id:"input-day-"+e.id,name:"day",value:e.day}))),i("div",{class:"mb expanded"},i("label",{for:"input-content-"+e.id},i("em",{class:"title"},"Content")),i("div",null,i("textarea",{id:"input-content-"+e.id,name:"content"},e.content))),i("div",{class:"right"},i("button",{class:"report-edit-save",type:"submit",name:"action",value:"child-update"},"Save Changes")),i("button",{class:"report-edit-delete",type:"submit",name:"action",value:"child-remove",onclick:"return confirm('Are you sure you want to delete this report?');"},"Delete")))))}function it(){c(".add-report-link").forEach(n=>n.onclick=function(){return p(o("#report-add-content"))}),c(".modal-report-edit-link").forEach(n=>n.onclick=function(){return p(o("#input-content-"+n.dataset.id))});let e=o("#modal-report--add"),t=o("form",e);t.onsubmit=function(){let n=o('input[name="day"]',t).value,s=o('textarea[name="content"]',t),r=s.value;return s.value="",d("child-add",{day:n,content:r}),document.location.hash="",!1},c(".modal-report-edit").forEach(rt)}function rt(e){let t=o("form",e),n=o('input[name="reportID"]',t).value;o(".report-edit-delete",t).onclick=function(){return confirm("Are you sure you want to delete this report?")&&(d("child-remove",{reportID:n}),document.location.hash=""),!1},t.onsubmit=function(){let s=o('input[name="day"]',t).value,a=o('textarea[name="content"]',t).value;return d("child-update",{reportID:n,day:s,content:a}),document.location.hash="",!1}}function st(e){e.day.length>10&&(e.day=e.day.substring(0,10));let t=g("#report-group-"+e.day+" .bd");if(!t){let a=et(e.day);o("#report-groups").appendChild(a),t=o(".bd",a)}let n=-1,s=y(e.userID);for(let a=0;a<t.children.length;a++){let l=t.children.item(a);if(o(".username",l).innerText.localeCompare(s,void 0,{sensitivity:"accent"})>=0){n=a;break}}let r=tt(e);if(n==-1?t.appendChild(r):t.insertBefore(r,t.children[n]),O()===e.userID){let a=ot(e);rt(a),o("#report-modals").appendChild(a)}else o("#report-modals").appendChild(nt(e));C(o(".modal",r))}function at(e){o("#report-"+e).remove(),k(e+"-removed","success","report has been removed"),o("#modal-report-"+e).remove()}function lt(){o("#modal-standup-config-link").onclick=function(){p(o('#modal-standup-config form input[name="title"]'))};let e=o("#modal-standup-config form"),t=o('select[name="team"]',e);t.onchange=function(){T(t.value!=="")};let n=o('select[name="sprint"]',e);n.onchange=function(){w(n.value!=="")},T(t.value!==""),w(n.value!==""),e.onsubmit=function(){let s=o('input[name="title"]',e).value,r=o('input[name="icon"]:checked',e).value;return d("update",{title:s,icon:r,team:t.value,sprint:n.value,...x(e)}),document.location.hash="",!1},it()}function ct(e){switch(e.cmd){case"update":return Gt(e.param);case"child-add":return st(e.param);case"child-update":return console.log("TODO: child-update");case"child-remove":return at(e.param);case"permissions":return L(e.param);default:throw"invalid standup command ["+e.cmd+"]"}}function Gt(e){let t=o("#modal-standup-config form");E("standup",t,e.teamID,e.sprintID,e.title,e.icon)}function mt(e){return i("div",{id:"category-"+e,"data-category":e,class:"category"},i("div",{class:"right"},i("a",{class:"add-feedback-link","data-category":e,href:"#modal-feedback--add-"+e},i("button",null,"New"))),i("h4",null,i("a",{href:"#modal-feedback--add-"+e},e)),i("div",{class:"clear"}),i("div",{class:"feedback-list"}),i("div",{id:"modal-feedback--add-"+e,class:"modal modal-feedback-add","data-category":e,style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,"New Feedback")),i("div",{class:"modal-body"},i("form",{action:"#",method:"post"},i("input",{type:"hidden",name:"action",value:"child-add"}),i("input",{type:"hidden",name:"action",value:"child-add"}),i("div",{class:"mb expanded"},i("label",{for:"category-"+e+"-select"},i("em",{class:"title"},"Category")),i("div",null,i("select",{name:"category",id:"category-"+e+"-select"},i("option",{selected:"selected",value:"TODO"},"TODO")))),i("div",{class:"mb expanded"},i("label",{for:"feedback-add-content-"+e},i("em",{class:"title"},"Content")),i("div",null,i("textarea",{rows:"8",id:"feedback-add-content-"+e,name:"content",placeholder:"HTML and Markdown supported"}))),i("button",{type:"submit"},"Add Feedback"))))))}function dt(e){return i("div",{id:"feedback-"+e.id,class:"feedback mt clear"},i("div",{class:"right"},D("feedback",e.id)),F("feedback",e.id,e.id),i("a",{href:"#modal-feedback-"+e.id,class:"clean modal-feedback-edit-link","data-id":e.id},i("div",null,y(e.userID)),i("div",{class:"pt feedback-content"},e.html)))}function ut(e){return i("div",{id:"modal-feedback-"+e.id,class:"modal modal-feedback-view",style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,e.category+" :: "+y(e.userID))),i("div",{class:"modal-body",dangerouslySetInnerHTML:e.html})))}var Yt="return confirm('Are you sure you want to delete this feedback?');";function pt(e){return i("div",{id:"modal-feedback-"+e.id,class:"modal modal-feedback-edit",style:"display: none;"},i("a",{class:"backdrop",href:"#"}),i("div",{class:"modal-content"},i("div",{class:"modal-header"},i("a",{href:"#",class:"modal-close"},"\xD7"),i("h2",null,e.category+" :: "+y(e.userID))),i("div",{class:"modal-body"},i("form",{action:"#",method:"post"},i("input",{type:"hidden",name:"feedbackID",value:e.id}),i("div",{class:"mb expanded"},i("label",{for:"input-category-"+e.id},i("em",{class:"title"},"Category")),i("div",null,i("select",{id:"input-category-"+e.id,name:"category"},Kt(e.category)))),i("div",{class:"mb expanded"},i("label",{for:"input-content-"+e.id},i("em",{class:"title"},"Content")),i("div",null,i("textarea",{id:"input-content-"+e.id,name:"content"},e.content))),i("div",{class:"right"},i("button",{class:"feedback-edit-save",type:"submit",name:"action",value:"child-update"},"Save Changes")),i("button",{class:"feedback-edit-delete",type:"submit",name:"action",value:"child-remove",onclick:Yt},"Delete")))))}function Kt(e){return c(".category").map(t=>t.dataset.category).map(t=>t===e?i("option",{value:t,selected:"selected"},t):i("option",{value:t},t))}function ft(){c(".add-feedback-link").forEach(e=>e.onclick=function(){return p(o("#feedback-add-content-"+e.dataset.category))}),c(".modal-feedback-edit-link").forEach(e=>e.onclick=function(){return p(o("#input-content-"+e.dataset.id))});for(let e of c(".modal-feedback-add"))Qt(e);c(".modal-feedback-edit").forEach(gt)}function Qt(e){let t=o("form",e);t.onsubmit=function(){let n=o('select[name="category"]',t).value,s=o('textarea[name="content"]',t),r=s.value;return s.value="",d("child-add",{category:n,content:r}),document.location.hash="",!1}}function gt(e){let t=o("form",e),n=o('input[name="feedbackID"]',t).value;o(".feedback-edit-delete",t).onclick=function(){return confirm("Are you sure you want to delete this feedback?")&&(d("child-remove",{feedbackID:n}),document.location.hash=""),!1},t.onsubmit=function(){let s=o('select[name="category"]',t).value,a=o('textarea[name="content"]',t).value;return d("child-update",{feedbackID:n,category:s,content:a}),document.location.hash="",!1}}function ht(e){let t=g("#category-"+e.category+" .feedback-list");if(!t){let r=mt(e.category);o("#category-list").appendChild(r),t=o(".feedback-list",r)}let n=-1;for(let r=0;r<t.children.length;r++){let a=t.children.item(r),l=o(".feedback-content",a).innerText,m=a.dataset.index;if(m){if(parseInt(m,10)>=e.idx){n=r;break}else if(l.localeCompare(e.content,void 0,{sensitivity:"accent"})>=0){n=r;break}}}let s=dt(e);if(n==-1?t.appendChild(s):t.insertBefore(s,t.children[n]),O()===e.userID){let r=pt(e);gt(r),o("#feedback-modals").appendChild(r)}else o("#feedback-modals").appendChild(ut(e));C(o(".modal",s))}function vt(e){o("#feedback-"+e).remove(),k(e+"-removed","success","feedback has been removed"),o("#modal-feedback-"+e).remove()}function bt(){o("#modal-retro-config-link").onclick=function(){p(o('#modal-retro-config form input[name="title"]'))};let e=o("#modal-retro-config form"),t=o('select[name="team"]',e);t.onchange=function(){T(t.value!=="")};let n=o('select[name="sprint"]',e);n.onchange=function(){w(n.value!=="")},T(t.value!==""),w(n.value!==""),e.onsubmit=function(){let s=o('input[name="title"]',e).value,r=o('input[name="icon"]:checked',e).value,a=o('input[name="categories"]',e).value;return d("update",{title:s,icon:r,categories:a,team:t.value,sprint:n.value,...x(e)}),document.location.hash="",!1},ft()}function yt(e){switch(e.cmd){case"update":return Zt(e.param);case"child-add":return ht(e.param);case"child-update":return console.log("TODO: child-update");case"child-remove":return vt(e.param);case"permissions":return L(e.param);default:throw"invalid retro command ["+e.cmd+"]"}}function Zt(e){let t=o("#modal-retro-config form"),n=o('input[name="categories"]',t);n.value=e.categories.join(","),n.parentElement&&$(n.parentElement);let s=o("#category-list");for(let r of c(" .category",s));E("retro",t,e.teamID,e.sprintID,e.title,e.icon)}function Tt(e,t){switch(t.cmd){case"message":return zt(t.param);case"comment":return se(t.param);case"online-update":return qe(t.param);case"member-add":return Ne(t.param);case"member-update":return oe(t.param);case"member-remove":return Oe(t.param)}switch(e){case"team":return We(t);case"sprint":return Ve(t);case"estimate":return Xe(t);case"standup":return ct(t);case"retro":return yt(t);default:throw"invalid service ["+e+"]"}}function zt(e){k("adhoc-message",e.level,e.message)}var Mt,q,Z;function St(){console.log("[socket]: open")}function Jt(e){let t=document.getElementById("socket-list");if(t){let n=document.createElement("pre");n.innerText=JSON.stringify(e,null,2),t.append(n)}Tt(q,e)}function Xt(e){console.log("[socket error]: "+e)}function en(e,t){switch(q=e,Z=t,je(),Ue(),q){case"team":Be();break;case"sprint":_e();break;case"estimate":Je();break;case"standup":lt();break;case"retro":bt();break}Mt=new V(!0,St,Jt,Xt,"/"+q+"/"+Z+"/connect"),console.log("loaded ["+q+"] workspace ["+Z+"]")}function d(e,t){Mt.send({channel:q+":"+Z,cmd:e,param:t})}function kt(){window.initWorkspace=en}function tn(){let[e,t]=He();window.rituals={relativeTime:ve(),autocomplete:ye(),setSiblingToNull:e,initForm:t,flash:fe(),tags:ke(),Socket:we()},ue(),pe(),he(),Te(),Ie(),window.JSX=i,kt()}document.addEventListener("DOMContentLoaded",tn);})();
//# sourceMappingURL=client.js.map
