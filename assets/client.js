(()=>{function c(e,t){let n;t?n=t.querySelectorAll(e):n=document.querySelectorAll(e);let i=[];return n.forEach(s=>{i.push(s)}),i}function m(e,t){let n=c(e,t);switch(n.length){case 0:return;case 1:return n[0];default:console.warn(`found [${n.length}] elements with selector [${e}], wanted zero or one`)}}function r(e,t){let n=m(e,t);if(!n)throw new Error(`no element found for selector [${e}]`);return n}function pe(e,t){return typeof e=="string"&&(e=r(e)),e.innerHTML=t,e}function O(e,t,n="block"){return typeof e=="string"&&(e=r(e)),e.style.display=t?n:"none",e}function o(e,t,...n){let i=document.createElement(e);for(let s in t)if(s==="for"&&(s="for"),s==="className"&&(s="class"),s&&t.hasOwnProperty(s)){let a=t[s];s==="dangerouslySetInnerHTML"?pe(i,a.__html):a===!0?i.setAttribute(s,s):a!==!1&&a!==null&&a!==void 0&&i.setAttribute(s,a.toString())}for(let s of n)if(Array.isArray(s))s.forEach(a=>{if(s==null)throw new Error(`child array for tag [${e}] is ${s}
${i.outerHTML}`);if(a==null)throw new Error(`child for tag [${e}] is ${a}
${i.outerHTML}`);typeof a=="string"&&(a=document.createTextNode(a)),i.appendChild(a)});else{if(s==null)throw new Error(`child for tag [${e}] is ${s}
${i.outerHTML}`);s.nodeType||(s=document.createTextNode(s.toString())),i.appendChild(s)}return i}function fe(){for(let e of c(".menu-container .final"))e.scrollIntoView({block:"nearest"})}var te="mode-light",ne="mode-dark";function ge(){for(let e of c(".mode-input"))e.onclick=()=>{switch(e.value){case"":document.body.classList.remove(te),document.body.classList.remove(ne);break;case"light":document.body.classList.add(te),document.body.classList.remove(ne);break;case"dark":document.body.classList.remove(te),document.body.classList.add(ne);break}}}function he(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function E(e,t,n){let i=document.getElementById("flash-container");i===null&&(i=document.createElement("div"),i.id="flash-container",document.body.insertAdjacentElement("afterbegin",i));let s=document.createElement("div");s.className="flash";let a=document.createElement("input");a.type="radio",a.style.display="none",a.id="hide-flash-"+e,s.appendChild(a);let l=document.createElement("label");l.htmlFor="hide-flash-"+e;let d=document.createElement("span");d.innerHTML="\xD7",l.appendChild(d),s.appendChild(l);let f=document.createElement("div");f.className="content flash-"+t,f.innerText=n,s.appendChild(f),i.appendChild(s),he(s)}function ve(){let e=document.getElementById("flash-container");if(e===null)return E;let t=e.querySelectorAll(".flash");if(t.length>0)for(let n of t)he(n);return E}function be(){for(let e of c(".link-confirm"))e.onclick=()=>{let t=e.dataset.message;return t&&t.length===0&&(t="Are you sure?"),confirm(t)}}function Te(e){let t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString().substring(0,19).replace("T"," ")}function W(e,t){let n=(e||"").replace(/-/gu,"/").replace(/[TZ]/gu," ")+" UTC",i=new Date(n),s=(new Date().getTime()-i.getTime())/1e3,a=Math.floor(s/86400),l=i.getFullYear(),d=i.getMonth()+1,f=i.getDate();if(isNaN(a)||a<0||a>=31)return l.toString()+"-"+(d<10?"0"+d.toString():d.toString())+"-"+(f<10?"0"+f.toString():f.toString());let p,b;return a===0?s<5?(b=1,p="just now"):s<60?(b=1,p=Math.floor(s)+" seconds ago"):s<120?(b=10,p="1 minute ago"):s<3600?(b=30,p=Math.floor(s/60)+" minutes ago"):s<7200?(b=60,p="1 hour ago"):(b=60,p=Math.floor(s/3600)+" hours ago"):a===1?(b=600,p="yesterday"):a<7?(b=600,p=a+" days ago"):(b=6e3,p=Math.ceil(a/7)+" weeks ago"),t&&(t.innerText=p,setTimeout(()=>W(e,t),b*1e3)),p}function ye(){return c(".reltime").forEach(e=>{W(e.dataset.time||"",e)}),W}function wt(e,t){let n=0;return(...i)=>{n!==0&&window.clearTimeout(n),n=window.setTimeout(()=>{e(null,...i)},t)}}function Ct(e,t,n,i,s){if(!e)return;let a=e.id+"-list",l=document.createElement("datalist"),d=document.createElement("option");d.value="",d.innerText="Loading...",l.appendChild(d),l.id=a,e.parentElement?.prepend(l),e.setAttribute("autocomplete","off"),e.setAttribute("list",a);let f={},p="";function b(h){let M=t;return M.includes("?")?M+"&t=json&"+n+"="+encodeURIComponent(h):M+"?t=json&"+n+"="+encodeURIComponent(h)}function ce(h){let M=f[h];!M||!M.frag||(p=h,l.replaceChildren(M.frag.cloneNode(!0)))}function Ht(){let h=e.value;if(h.length===0)return;let M=b(h),X=!h||!p;if(!X){let I=f[p];I&&(X=!I.data.find(N=>h===s(N)))}if(!!X){if(f[h]&&f[h].url===M){ce(h);return}fetch(M,{credentials:"include"}).then(I=>I.json()).then(I=>{if(!I)return;let N=Array.isArray(I)?I:[I],me=document.createDocumentFragment(),de=10;for(let V=0;V<N.length&&de>0;V++){let ue=s(N[V]),It=i(N[V]);if(ue){let ee=document.createElement("option");ee.value=ue,ee.innerText=It,me.appendChild(ee),de--}}f[h]={url:M,data:N,frag:me,complete:!1},ce(h)})}}e.oninput=wt(Ht,250),console.log("managing ["+e.id+"] autocomplete")}function Me(){return Ct}function Ee(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function g(e,t,n){return t||(t=18),n==null&&(n="icon"),`<svg class="${n}" style="width: ${t}px; height: ${t+"px"};"><use xlink:href="#svg-${e}"></use></svg>`}function G(e,t,n){return{__html:g(e,t,n)}}function ke(e){e||(e="");let t=g("right",15,"expand"),n=g("down",15,"collapse");return{__html:t+n+e}}function v(e){return setTimeout(()=>{e.setSelectionRange(e.value.length,e.value.length),e.focus()},100),!0}function Dt(e,t){return e.parentElement!==t.parentElement?null:e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var Y;function oe(e){let t=[],n=c(".item .value",e);for(let s of n)t.push(s.innerText);let i=r("input.result",e);i.value=t.join(", ")}function Ft(e){let t=e.parentElement?.parentElement;e.remove(),t&&oe(t)}function Le(e){let t=r(".value",e),n=r(".editor",e);n.value=t.innerText;let i=()=>{if(n.value===""){e.remove();return}t.innerText=n.value,O(t,!0),O(n,!1);let s=e.parentElement?.parentElement;s&&oe(s)};n.onblur=i,n.onkeydown=s=>{if(s.code==="Enter")return s.preventDefault(),i(),!1},O(t,!1),O(n,!0),n.focus()}function xe(e,t){let n=document.createElement("div");n.className="item",n.draggable=!0,n.ondragstart=l=>{l.dataTransfer?.setDragImage(document.createElement("div"),0,0),n.classList.add("dragging"),Y=n},n.ondragover=()=>{let l=Dt(n,Y);if(!l)return;let d=l===-1?n:n.nextSibling;Y.parentElement?.insertBefore(Y,d),oe(t)},n.ondrop=l=>{l.preventDefault()},n.ondragend=l=>{n.classList.remove("dragging"),l.preventDefault()};let i=document.createElement("div");i.innerText=e,i.className="value",i.onclick=()=>{Le(n)},n.appendChild(i);let s=document.createElement("input");s.className="editor",n.appendChild(s);let a=document.createElement("div");return a.innerHTML=g("times",13),a.className="close",a.onclick=()=>{Ft(n)},n.appendChild(a),n}function At(e,t){let n=xe("",t);e.appendChild(n),Le(n)}function P(e){let t=r("input.result",e),n=r(".tags",e),i=t.value.split(",").map(a=>a.trim()).filter(a=>a!=="");O(t,!1),n.innerHTML="";for(let a of i)n.appendChild(xe(a,e));m(".add-item",e)?.remove();let s=document.createElement("div");s.className="add-item",s.innerHTML=g("plus",22),s.onclick=()=>{At(n,e)},e.insertBefore(s,r(".clear",e))}function He(){for(let e of c(".tag-editor"))P(e);return P}var Ie="--selected";function Rt(e){let t=e.parentElement?.parentElement?.querySelector("input");if(!t)throw new Error("no associated input found");t.value="\u2205"}function re(e){e.onreset=()=>re(e);let t={},n={};for(let i of e.elements){let s=i;if(s.name.length>0)if(s.name.endsWith(Ie))n[s.name]=s;else{(s.type!=="radio"||s.checked)&&(t[s.name]=s.value);let a=()=>{let l=n[s.name+Ie];l&&(l.checked=t[s.name]!==s.value)};s.onchange=a,s.onkeyup=a}}}function we(){for(let e of c("form.editor"))re(e);return[Rt,re]}var $t=[];function Ce(e,t,n){let i=e.querySelectorAll(t);if(i.length===0)throw new Error("empty query selector ["+t+"]");i.forEach(s=>n(s))}function B(e,t,n){Ce(e,t,i=>{i.style.backgroundColor=n})}function w(e,t,n){Ce(e,t,i=>{i.style.color=n})}function Ut(e,t,n){let i=document.querySelector("#mockup-"+e);if(!i){console.error("can't find mockup for mode ["+e+"]");return}switch(t){case"color-foreground":w(i,".mock-main",n);break;case"color-background":B(i,".mock-main",n);break;case"color-foreground-muted":w(i,".mock-main .mock-muted",n);break;case"color-background-muted":B(i,".mock-main .mock-muted",n);break;case"color-link-foreground":w(i,".mock-main .mock-link",n);break;case"color-link-visited-foreground":w(i,".mock-main .mock-link-visited",n);break;case"color-nav-foreground":w(i,".mock-nav",n),w(i,".mock-nav .mock-link",n);break;case"color-nav-background":B(i,".mock-nav",n);break;case"color-menu-foreground":w(i,".mock-menu",n),w(i,".mock-menu .mock-link",n);break;case"color-menu-background":B(i,".mock-menu",n);break;case"color-menu-selected-foreground":w(i,".mock-menu .mock-link-selected",n);break;case"color-menu-selected-background":B(i,".mock-menu .mock-link-selected",n);break;default:console.error("invalid key ["+t+"]")}}function De(){for(let e of c(".color-var")){let t=e.dataset.var,n=e.dataset.mode;$t.push(t),!(!t||t.length===0)&&(e.oninput=()=>{Ut(n,t,e.value)})}}var Fe=!1;function Ae(e){if(e||(e="/connect"),e.indexOf("ws")===0)return e;let t=document.location,n="ws";return t.protocol==="https:"&&(n="wss"),e.indexOf("/")!==0&&(e="/"+e),n+`://${t.host}${e}`}var K=class{constructor(t,n,i,s,a){this.debug=t,this.open=n,this.recv=i,this.err=s,this.url=Ae(a),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=()=>{Fe=!0},this.connectTime=Date.now(),this.sock=new WebSocket(Ae(this.url));let t=this;this.sock.onopen=()=>{t.connected=!0,t.pendingMessages.forEach(t.send),t.pendingMessages=[],t.debug&&console.log("WebSocket connected"),t.open()},this.sock.onmessage=n=>{let i=JSON.parse(n.data);t.debug&&console.debug("[socket]: receive",i),t.recv(i)},this.sock.onerror=n=>()=>{t.err("socket",n.type)},this.sock.onclose=()=>{if(Fe)return;t.connected=!1;let n=t.connectTime?Date.now()-t.connectTime:0;n>0&&n<2e3?(t.pauseSeconds=t.pauseSeconds*2,t.debug&&console.debug(`socket closed immediately, reconnecting in ${t.pauseSeconds} seconds`),setTimeout(()=>{t.connect()},t.pauseSeconds*1e3)):(console.debug("socket closed after ["+n+"ms]"),setTimeout(()=>{t.connect()},t.pauseSeconds*500))}}disconnect(){}send(t){if(this.debug&&console.debug("out",t),!this.sock)throw new Error("socket not initialized");if(this.connected){let n=JSON.stringify(t,null,2);this.sock.send(n)}else this.pendingMessages.push(t)}};function Re(){return K}function C(e,t,n){return e?`<img class="${n}" style="width: ${t+"px"}; height: ${t+"px"};" src="${e}" />`:g("profile",t,n)}function $e(e,t,n,i){return o("tr",{id:"member-"+e,class:"member","data-id":e},o("td",null,o("a",{href:"#modal-member-"+e},o("div",{class:"left prs member-picture",dangerouslySetInnerHTML:{__html:C(i,18,"")}}),o("span",{class:"member-name"},t))),o("td",{class:"shrink text-align-right"},o("em",{class:"member-status"},n)),o("td",{class:"shrink online-status",title:"offline",dangerouslySetInnerHTML:G("circle",18,"right")}))}function Ue(e,t,n,i){return o("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,o("span",{class:"member-picture",dangerouslySetInnerHTML:{__html:C(i,18,"")}}),o("span",{class:"member-name"},t))),o("div",{class:"modal-body"},o("em",null,"Role"),o("br",null),o("span",{class:"member-role"},n))))}function Ne(e,t,n,i){let s="return confirm('Are you sure you wish to remove this user?');",a=[["owner","Owner"],["member","Member"],["observer","Observer"]];return o("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,o("span",{className:"member-picture",dangerouslySetInnerHTML:{__html:C(i,18,"")}}),o("span",{className:"member-name"},t))),o("div",{class:"modal-body"},o("form",{action:document.location.pathname,method:"post",class:"expanded"},o("input",{type:"hidden",name:"userID",value:e}),o("em",null,"Role"),o("br",null),o("select",{class:"input-role",name:"role"},a.map(l=>l[0]===n?o("option",{selected:"selected",value:l[0]},l[1]):o("option",{value:l[0]},l[1]))),o("hr",null),o("div",{class:"right"},o("button",{class:"member-update",type:"submit",name:"action",value:"member-update"},"Save")),o("button",{type:"submit",class:"member-remove",name:"action",value:"member-remove",onClick:s},"Remove")))))}var $,U;function T(e){if(!e)return"System";let t=U[e];return t||"Unknown User"}function q(){return $}function Nt(){return r("#self-role").innerText==="owner"||r("#owner-id").innerText===$}function Ot(){let e=r("#modal-self"),t=m("form",e);t&&(t.onsubmit=()=>{let n=r('input[name="name"]',t),i=r('input[name="choice"]:checked',t),s=m('input[name="picture"]:checked',t),a={name:n.value,choice:i.value};return s&&(a.picture=s.value),u("self",a),r("#self-name").innerText=n.value,r("#self-picture").innerHTML=C(s?s.value:"",20,"icon"),document.location.hash="",!1})}function ie(){U={},$=r("#self-id").innerText,U[$]=r("#self-name").innerText;let e=r("#panel-members"),t=c(".member",e);for(let n of t){let i=n.dataset.id;i&&(U[i]=r(".member-name",n).innerText)}}function Oe(e){let t=m("form",e);if(!t)return;let n=i=>{let s=r('input[name="userID"]',t).value,a=r('select[name="role"]',t).value;u(i,{userID:s,role:a});let l=r("#member-"+s);return i==="member-update"?r(".member-role",l).innerText=a:i==="member-remove"&&(l.remove(),ie()),document.location.hash="",!1};r(".member-update",t).onclick=()=>n("member-update"),r(".member-remove",t).onclick=()=>confirm("Are you sure you wish to remove this user?")?n("member-remove"):!1}function Pt(){let e=c(".modal-member");for(let t of e)Oe(t)}function se(e){if(e.userID===$)r("#self-name").innerText=e.name,r("#self-role").innerText=e.role,r("#self-picture").innerHTML=C(e.picture?e.picture:"",20,"icon");else{let t=r("#member-"+e.userID);r(".member-name",t).innerText=e.name,r(".member-role",t).innerText=e.role,r(".member-picture",t).innerHTML=C(e.picture?e.picture:"",18,"");let n=r("#modal-member-"+e.userID);r(".member-name",n).innerText=e.name;let i=m(".member-role",n);i&&(i.innerText=e.role);let s=m('select[name="role"]',n);s&&(s.value=e.role),r(".member-picture",n).innerHTML=C(e.picture?e.picture:"",18,"")}if(U[e.userID]!==e.name){U[e.userID]=e.name;let t=r("#panel-members table tbody"),i=[...t.children];i.sort((s,a)=>{let l=r(".member-name",s).innerText,d=r(".member-name",a).innerText;return l.localeCompare(d,void 0,{sensitivity:"accent"})}),t.replaceChildren(...i)}}function Pe(e){if(m("#member-"+e.userID)||e.userID===$)return se(e);let n=r("#panel-members table tbody"),i=-1;for(let d=0;d<n.children.length;d++){let f=n.children.item(d);if(r(".member-name",f).innerText.localeCompare(e.name,void 0,{sensitivity:"accent"})>0){i=d;break}}let s=$e(e.userID,e.name,e.role,e.picture?e.picture:"");i===-1?n.appendChild(s):n.insertBefore(s,n.children[i]);let a=r("#member-modals"),l;Nt()?l=Ne(e.userID,e.name,e.role,e.picture?e.picture:""):l=Ue(e.userID,e.name,e.role,e.picture?e.picture:""),a.appendChild(l),r(".member-picture",l).innerHTML=C(e.picture?e.picture:"",24,"icon"),Oe(l),U[e.userID]=e.name}function qe(e){r("#member-"+e).remove(),ie()}function je(e){if(e.userID===$)return;let t=m("#member-"+e.userID+" .online-status");if(!t)throw new Error("missing panel #member-"+e.userID);t.title=e.connected?"online":"offline";let n=e.connected?"check-circle":"circle";t.innerHTML=g(n,18,"right")}function _e(){Ot(),Pt(),ie()}function We(e,t){let n=o("li",null),i=Te(new Date),s=o("span",{class:"nowrap reltime","data-time":i},"just now");W(i,s);let a=o("div",{class:"right"});return a.appendChild(s),n.appendChild(a),n.appendChild(o("div",null,e.content)),n.appendChild(o("div",null,o("em",null,t))),n}function A(e,t){let n="comment-link-"+e+"-"+t,i="#modal-"+e+"-"+t+"-comments",s=o("a",{id:n,class:"comment-link","data-key":e+"-"+t,href:i,title:"0 comments",dangerouslySetInnerHTML:G("comment-alt",18,"member-icon")});return ae(s),s}function R(e,t,n){return o("div",{id:"modal-"+e+"-"+t+"-comments",class:"modal comments",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,n," Comments")),o("div",{class:"modal-body"},o("ul",{id:"comment-list-"+e+"-"+t,class:"comment-list"}),o("form",{action:"#",method:"post",class:"expanded"},o("input",{type:"hidden",name:"action",value:"comment"}),o("input",{type:"hidden",name:"svc",value:e}),o("input",{type:"hidden",name:"modelID",value:t}),o("div",null,o("textarea",{name:"content",placeholder:"Add a comment, Markdown and HTML supported"})),o("div",{class:"mt right"},o("button",{type:"submit"},"Add Comment"))))))}function ae(e){e.onclick=()=>v(r("#modal-"+e.dataset.key+"-comments form textarea"))}function le(e){let t=r("#comment-list-"+e.svc+"-"+e.modelID),n=T(e.userID),i=We(e,n);t.appendChild(i);let s=t.children.length,a=r("#comment-link-"+e.svc+"-"+e.modelID);a.title=s+(s===1?" comment":" comments"),a.innerHTML.indexOf("comment-dots")===-1&&(a.innerHTML=g("comment-dots",18,"right"))}function D(e){let t=r("form",e);t.onsubmit=()=>{let n={svc:r('input[name="svc"]',t).value,modelID:r('input[name="modelID"]',t).value},i=r("textarea",t);return n.content=i.value,n.userID=q(),u("comment",n),le(n),i.value="",!1}}function Be(){for(let e of c(".comment-link"))ae(e);for(let e of c(".modal.comments"))D(e)}function Q(e,t,n){if(n){let i=m(`select[name="${e}"] option[value="${n}"]`,t);if(i){let s=i.innerText;return`<a href="/${e}/${n}">${s}</a> `}return`<a href="/${e}/${n}">${n}</a> `}return""}function qt(e,t,n,i){let s="";return s+=Q("sprint",t,i),s+=e==="retro"?"retrospective":e,n&&(s+=" in "+Q("team",t,n)),s}function Z(e){let t=r(`#${e.type}-list tbody`),n=m(".empty",t);n&&n.remove();let i=document.createElement("tr");i.id=`${e.type}-list-${e.id}`;let s=document.createElement("td"),a=document.createElement("div");a.classList.add("right"),a.appendChild(A(e.type,e.id)),a.appendChild(R(e.type,e.id,e.id)),s.appendChild(a);let l=document.createElement("a");l.href=e.path;let d=document.createElement("span");d.classList.add("model-span-icon"),d.innerHTML=g(e.icon,16,"icon"),l.appendChild(d);let f=document.createElement("span");f.classList.add("model-span-title"),f.innerText=e.title,l.appendChild(f),s.appendChild(l),i.appendChild(s),t.appendChild(i),D(r(".modal",a))}function z(e){let t=r(`#${e.type}-list-${e.model.id}`);r(".model-span-icon",t).innerHTML=g(e.model.icon),r(".model-span-title",t).innerText=e.model.title}function S(e){r(`#${e.type}-list-${e.id}`).remove();let t=r(`#${e.type}-list tbody`);if(t.children.length===0){let n=document.createElement("tr");n.classList.add("empty");let i=document.createElement("em");i.innerText="no "+e.type+"s",n.appendChild(i),t.appendChild(n)}}function k(e,t,n,i,s,a){let l=m('input[name="title"]',t);l&&(l.value=s);for(let p of c(".config-panel-team",t))p.innerHTML=Q("team",t,n);for(let p of c(".config-panel-sprint",t))p.innerHTML=Q("sprint",t,i);for(let p of c(".view-icon",t))p.innerHTML=g(a,24,"icon");for(let p of c(".view-title",t))p.innerText=s;for(let p of c('input[name="icon"]',t))p.checked=a===p.value;let d=m('select[name="team"]',t);d!=null&&(d.value=n||"");let f=m('select[name="sprint"]',t);f!=null&&(f.value=i||""),r("#model-title").innerText=s,r("#model-icon").innerHTML=g(a,20),r("#model-banner").innerHTML=qt(e,t,n||"",i||"")}function L(e){r(`#modal-${e}-config-link`).onclick=()=>{let t=m(`#modal-${e}-config form input[name="title"]`);t&&v(t)}}function x(e){console.log("permissionsUpdate",e)}function y(e){r(".permission-config-team").style.display=e?"block":"none"}function F(e){r(".permission-config-sprint").style.display=e?"block":"none"}function H(e){let t={};for(let n of c(".perm-option",e))n.checked&&(t[n.name]=n.value);return t}function Ve(){L("team");let e=m("#modal-team-config form");e&&(e.onsubmit=()=>{let t=r('input[name="title"]',e).value,n=r('input[name="icon"]:checked',e).value;return u("update",{title:t,icon:n,...H(e)}),document.location.hash="",!1})}function jt(e){r("#owner-id").innerText=e.owner;let t=r("#modal-team-config");k("team",t,null,null,e.title,e.icon)}function Ge(e){switch(e.cmd){case"update":return jt(e.param);case"child-add":return Z(e.param);case"child-update":return z(e.param);case"child-remove":return S(e.param);case"permissions":return x(e.param);default:throw new Error("invalid team command ["+e.cmd+"]")}}function Ye(){L("sprint");let e=m("#modal-sprint-config form");if(e){let t=r('select[name="team"]',e);t.onchange=()=>{y(t.value!=="")},y(t.value!==""),e.onsubmit=()=>{let n=r('input[name="title"]',e).value,i=r('input[name="icon"]:checked',e).value,s=r('input[name="startDate"]',e).value,a=r('input[name="endDate"]',e).value;return u("update",{title:n,icon:i,startDate:s,endDate:a,team:t.value,...H(e)}),document.location.hash="",!1}}}function j(e){return`${e}`.split("T")[0]}function _t(e){let t="";return e.startDate&&(t+="starts ",t+=j(e.startDate),e.endDate&&(t+=", ")),e.endDate&&(t+="ends ",t+=j(e.endDate)),t}function Wt(e){r("#owner-id").innerText=e.owner;let t=r("#modal-sprint-config"),n=m("form",t);n?(r('input[name="startDate"]',n).value=j(e.startDate),r('input[name="endDate"]',n).value=j(e.endDate)):(r(".config-panel-startDate",t).innerText=j(e.startDate),r(".config-panel-endDate",t).innerText=j(e.endDate)),r("#model-summary").innerText=_t(e),k("sprint",t,e.teamID,null,e.title,e.icon)}function Ke(e){switch(e.cmd){case"update":return Wt(e.param);case"child-add":return Z(e.param);case"child-update":return z(e.param);case"child-remove":return S(e.param);case"permissions":return x(e.param);default:throw new Error("invalid sprint command ["+e.cmd+"]")}}function Qe(e){return o("tr",{class:"story-row",id:"story-row-{%s s.ID.String() %}","data-idx":"s.Idx"},o("td",null,o("a",{href:"#modal-story-"+e.id,class:"story-title"},o("div",null,e.title))),o("td",null,e.status),o("td",null,e.finalVote?e.finalVote:"-"),o("td",null,A("story",e.id),R("story",e.id,e.title)))}function Bt(e,t){t.onclick=()=>{v(r("#modal-story-"+e+'-edit form input[name="title"]'))}}function Vt(e,t){t.onsubmit=()=>(u("child-status",{storyID:e,status:"new"}),console.log("new"),!1)}function Ze(e,t){t.onsubmit=()=>(u("child-status",{storyID:e,status:"active"}),console.log("active"),!1)}function Gt(e,t){t.onsubmit=()=>(u("child-status",{storyID:e,status:"complete"}),console.log("complete"),!1)}function Yt(e,t){c(".vote-option",t).forEach(n=>{n.onclick=()=>(r('input[name="vote"]',n).checked=!0,u("vote",{storyID:e,vote:n.dataset.choice}),!1)})}function Kt(e,t){t.onsubmit=()=>(confirm("Are you sure you want to delete this story?")&&(u("child-remove",{storyID:e}),document.location.hash=""),!1)}function ze(e){let t=e.dataset.id;if(!t){console.warn("no id in dataset",e);return}c(".vote-submit-button",e).forEach(n=>{n.style.display="none"}),c(".link-edit",e).forEach(n=>Bt(t,n)),c(".status-new-form-delete",e).forEach(n=>Kt(t,n)),c(".status-new-form-next",e).forEach(n=>Ze(t,n)),c(".status-active-form-prev",e).forEach(n=>Vt(t,n)),c(".status-active-form-next",e).forEach(n=>Gt(t,n)),c(".story-vote-options",e).forEach(n=>Yt(t,n)),c(".status-complete-form-prev",e).forEach(n=>Ze(t,n))}function Se(){c(".add-story-link").forEach(n=>{n.onclick=()=>v(r("#story-add-title"))});let e=r("#modal-story--add"),t=r("form",e);t.onsubmit=()=>{let n=r('input[name="title"]',t),i=n.value;return n.value="",u("child-add",{title:i}),document.location.hash="",!1},c("#story-modals .modal-story").forEach(ze)}function Je(e){let t=r("#panel-detail table tbody"),n=-1;for(let l=0;l<t.children.length;l++){let d=t.children.item(l),f=r(".story-title",d).innerText,p=d.dataset.index;if(p){if(parseInt(p,10)>=e.idx){n=l;break}else if(f.localeCompare(e.title,void 0,{sensitivity:"accent"})>=0){n=l;break}}}let i=Qe(e);n===-1?t.appendChild(i):t.insertBefore(i,t.children[n]),D(r(".modal",i));let a=r("#modal-story-new").cloneNode(!0);a.id="modal-story-"+e.id,a.dataset.id=e.id,a.dataset.status=e.status,a.classList.add("modal-story"),r("#story-modals").appendChild(a),(document.location.hash==="modal-story--add"||document.location.hash==="")&&(document.location.hash="modal-story-"+e.id)}function Xe(e){let t=r("#modal-story-"+e.id);r(".status-new",t).style.display=e.status==="new"?"block":"none",r(".status-active",t).style.display=e.status==="active"?"block":"none",r(".status-complete",t).style.display=e.status==="complete"?"block":"none"}function et(e){let t=r("#story-row-"+e),n=r(".story-title",t).innerText;E(e+"-removed","success",`story [${n}] has been removed`),t.remove(),r("#modal-story-"+e).remove()}function tt(){L("estimate");let e=m("#modal-estimate-config form");if(e){let t=r('select[name="team"]',e);t.onchange=()=>{y(t.value!=="")};let n=r('select[name="sprint"]',e);n.onchange=()=>{F(n.value!=="")},y(t.value!==""),F(n.value!==""),e.onsubmit=()=>{let i=r('input[name="title"]',e).value,s=r('input[name="icon"]:checked',e).value,a=r('input[name="choices"]',e).value;return u("update",{title:i,icon:s,choices:a,team:t.value,sprint:n.value,...H(e)}),document.location.hash="",!1}}Se()}function Qt(e){r("#owner-id").innerText=e.owner;let t=r("#modal-estimate-config"),n=m("form",t);if(n){let i=r('input[name="choices"]',n);i.value=e.choices.join(","),i.parentElement&&P(i.parentElement)}else r(".config-panel-choices",t).innerText=e.choices.join(", ");k("estimate",t,e.teamID,e.sprintID,e.title,e.icon)}function nt(e){switch(e.cmd){case"update":return Qt(e.param);case"child-add":return Je(e.param);case"child-status":return Xe(e.param);case"child-remove":return et(e.param);case"permissions":return x(e.param);default:throw new Error("invalid estimate command ["+e.cmd+"]")}}function ot(e){return o("li",{id:"report-group-"+e},o("input",{id:"accordion-"+e,type:"checkbox",hidden:!0,checked:"checked"}),o("label",{for:"accordion-"+e,dangerouslySetInnerHTML:ke(e)}),o("div",{class:"bd"}))}function rt(e){return o("div",{class:"report",id:"report-"+e.id},o("div",null,o("div",{class:"right"},A("report",e.id)),R("report",e.id,e.id),o("a",{href:"#modal-report-"+e.id,"data-id":e.id,class:"clean"},o("h4",{class:"username"},T(e.userID)),o("div",{class:"pt"},e.html))))}function it(e){return o("div",{id:"modal-report-"+e.id,class:"modal modal-report-view",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,e.day+": "+T(e.userID))),o("div",{class:"modal-body",dangerouslySetInnerHTML:e.html})))}function st(e){return o("div",{id:"modal-report-"+e.id,class:"modal modal-report-edit",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,e.day+": "+T(e.userID))),o("div",{class:"modal-body"},o("form",{action:"#",method:"post"},o("input",{type:"hidden",name:"reportID",value:e.id}),o("div",{class:"mb expanded"},o("label",{for:"input-day-"+e.id},o("em",{class:"title"},"Day")),o("div",null,o("input",{type:"date",id:"input-day-"+e.id,name:"day",value:e.day}))),o("div",{class:"mb expanded"},o("label",{for:"input-content-"+e.id},o("em",{class:"title"},"Content")),o("div",null,o("textarea",{id:"input-content-"+e.id,name:"content"},e.content))),o("div",{class:"right"},o("button",{class:"report-edit-save",type:"submit",name:"action",value:"child-update"},"Save Changes")),o("button",{class:"report-edit-delete",type:"submit",name:"action",value:"child-remove",onclick:"return confirm('Are you sure you want to delete this report?');"},"Delete")))))}function at(e){let t=r("form",e),n=r('input[name="reportID"]',t).value;r(".report-edit-delete",t).onclick=()=>(confirm("Are you sure you want to delete this report?")&&(u("child-remove",{reportID:n}),document.location.hash=""),!1),t.onsubmit=()=>{let i=r('input[name="day"]',t).value,a=r('textarea[name="content"]',t).value;return u("child-update",{reportID:n,day:i,content:a}),document.location.hash="",!1}}function lt(){c(".add-report-link").forEach(n=>{n.onclick=()=>v(r("#report-add-content"))}),c(".modal-report-edit-link").forEach(n=>{n.onclick=()=>v(r("#input-content-"+n.dataset.id))});let e=r("#modal-report--add"),t=r("form",e);t.onsubmit=()=>{let n=r('input[name="day"]',t).value,i=r('textarea[name="content"]',t),s=i.value;return i.value="",u("child-add",{day:n,content:s}),document.location.hash="",!1},c(".modal-report-edit").forEach(at)}function ct(e){e.day.length>10&&(e.day=e.day.substring(0,10));let t=m("#report-group-"+e.day+" .bd");if(!t){let a=ot(e.day);r("#report-groups").appendChild(a),t=r(".bd",a)}let n=-1,i=T(e.userID);for(let a=0;a<t.children.length;a++){let l=t.children.item(a);if(r(".username",l).innerText.localeCompare(i,void 0,{sensitivity:"accent"})>=0){n=a;break}}let s=rt(e);if(n===-1?t.appendChild(s):t.insertBefore(s,t.children[n]),q()===e.userID){let a=st(e);at(a),r("#report-modals").appendChild(a)}else r("#report-modals").appendChild(it(e));D(r(".modal",s))}function mt(e){r("#report-"+e).remove(),E(e+"-removed","success","report has been removed"),r("#modal-report-"+e).remove()}function dt(){L("standup");let e=m("#modal-standup-config form");if(e){let t=r('select[name="team"]',e);t.onchange=()=>{y(t.value!=="")};let n=r('select[name="sprint"]',e);n.onchange=()=>{F(n.value!=="")},y(t.value!==""),F(n.value!==""),e.onsubmit=()=>{let i=r('input[name="title"]',e).value,s=r('input[name="icon"]:checked',e).value;return u("update",{title:i,icon:s,team:t.value,sprint:n.value,...H(e)}),document.location.hash="",!1}}lt()}function Zt(e){r("#owner-id").innerText=e.owner;let t=r("#modal-standup-config");k("standup",t,e.teamID,e.sprintID,e.title,e.icon)}function ut(e){switch(e.cmd){case"update":return Zt(e.param);case"child-add":return ct(e.param);case"child-update":return console.log("TODO: child-update");case"child-remove":return mt(e.param);case"permissions":return x(e.param);default:throw new Error("invalid standup command ["+e.cmd+"]")}}function pt(e){return o("div",{id:"category-"+e,"data-category":e,class:"category"},o("div",{class:"right"},o("a",{class:"add-feedback-link","data-category":e,href:"#modal-feedback--add-"+e},o("button",null,"New"))),o("h4",null,o("a",{href:"#modal-feedback--add-"+e},e)),o("div",{class:"clear"}),o("div",{class:"feedback-list"}),o("div",{id:"modal-feedback--add-"+e,class:"modal modal-feedback-add","data-category":e,style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,"New Feedback")),o("div",{class:"modal-body"},o("form",{action:"#",method:"post"},o("input",{type:"hidden",name:"action",value:"child-add"}),o("input",{type:"hidden",name:"action",value:"child-add"}),o("div",{class:"mb expanded"},o("label",{for:"category-"+e+"-select"},o("em",{class:"title"},"Category")),o("div",null,o("select",{name:"category",id:"category-"+e+"-select"},o("option",{selected:"selected",value:"TODO"},"TODO")))),o("div",{class:"mb expanded"},o("label",{for:"feedback-add-content-"+e},o("em",{class:"title"},"Content")),o("div",null,o("textarea",{rows:"8",id:"feedback-add-content-"+e,name:"content",placeholder:"HTML and Markdown supported"}))),o("button",{type:"submit"},"Add Feedback"))))))}function ft(e){return o("div",{id:"feedback-"+e.id,class:"feedback mt clear"},o("div",{class:"right"},A("feedback",e.id)),R("feedback",e.id,e.id),o("a",{href:"#modal-feedback-"+e.id,class:"clean modal-feedback-edit-link","data-id":e.id},o("div",null,T(e.userID)),o("div",{class:"pt feedback-content"},e.html)))}function gt(e){return o("div",{id:"modal-feedback-"+e.id,class:"modal modal-feedback-view",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,e.category+" :: "+T(e.userID))),o("div",{class:"modal-body",dangerouslySetInnerHTML:e.html})))}var zt="return confirm('Are you sure you want to delete this feedback?');";function St(e){return c(".category").map(t=>t.dataset.category).map(t=>t===e?o("option",{value:t,selected:"selected"},t):o("option",{value:t},t))}function ht(e){return o("div",{id:"modal-feedback-"+e.id,class:"modal modal-feedback-edit",style:"display: none;"},o("a",{class:"backdrop",href:"#"}),o("div",{class:"modal-content"},o("div",{class:"modal-header"},o("a",{href:"#",class:"modal-close"},"\xD7"),o("h2",null,e.category+" :: "+T(e.userID))),o("div",{class:"modal-body"},o("form",{action:"#",method:"post"},o("input",{type:"hidden",name:"feedbackID",value:e.id}),o("div",{class:"mb expanded"},o("label",{for:"input-category-"+e.id},o("em",{class:"title"},"Category")),o("div",null,o("select",{id:"input-category-"+e.id,name:"category"},St(e.category)))),o("div",{class:"mb expanded"},o("label",{for:"input-content-"+e.id},o("em",{class:"title"},"Content")),o("div",null,o("textarea",{id:"input-content-"+e.id,name:"content"},e.content))),o("div",{class:"right"},o("button",{class:"feedback-edit-save",type:"submit",name:"action",value:"child-update"},"Save Changes")),o("button",{class:"feedback-edit-delete",type:"submit",name:"action",value:"child-remove",onclick:zt},"Delete")))))}function Jt(e){let t=r("form",e);t.onsubmit=()=>{let n=r('select[name="category"]',t).value,i=r('textarea[name="content"]',t),s=i.value;return i.value="",u("child-add",{category:n,content:s}),document.location.hash="",!1}}function vt(e){let t=r("form",e),n=r('input[name="feedbackID"]',t).value;r(".feedback-edit-delete",t).onclick=()=>(confirm("Are you sure you want to delete this feedback?")&&(u("child-remove",{feedbackID:n}),document.location.hash=""),!1),t.onsubmit=()=>{let i=r('select[name="category"]',t).value,a=r('textarea[name="content"]',t).value;return u("child-update",{feedbackID:n,category:i,content:a}),document.location.hash="",!1}}function bt(){c(".add-feedback-link").forEach(e=>{e.onclick=()=>v(r("#feedback-add-content-"+e.dataset.category))}),c(".modal-feedback-edit-link").forEach(e=>{e.onclick=()=>v(r("#input-content-"+e.dataset.id))});for(let e of c(".modal-feedback-add"))Jt(e);c(".modal-feedback-edit").forEach(vt)}function Tt(e){let t=m("#category-"+e.category+" .feedback-list");if(!t){let s=pt(e.category);r("#category-list").appendChild(s),t=r(".feedback-list",s)}let n=-1;for(let s=0;s<t.children.length;s++){let a=t.children.item(s),l=r(".feedback-content",a).innerText,d=a.dataset.index;if(d){if(parseInt(d,10)>=e.idx){n=s;break}else if(l.localeCompare(e.content,void 0,{sensitivity:"accent"})>=0){n=s;break}}}let i=ft(e);if(n===-1?t.appendChild(i):t.insertBefore(i,t.children[n]),q()===e.userID){let s=ht(e);vt(s),r("#feedback-modals").appendChild(s)}else r("#feedback-modals").appendChild(gt(e));D(r(".modal",i))}function yt(e){r("#feedback-"+e).remove(),E(e+"-removed","success","feedback has been removed"),r("#modal-feedback-"+e).remove()}function Mt(){L("retro");let e=m("#modal-retro-config form");if(e){let t=r('select[name="team"]',e);t.onchange=()=>{y(t.value!=="")};let n=r('select[name="sprint"]',e);n.onchange=()=>{F(n.value!=="")},y(t.value!==""),F(n.value!==""),e.onsubmit=()=>{let i=r('input[name="title"]',e).value,s=r('input[name="icon"]:checked',e).value,a=r('input[name="categories"]',e).value;return u("update",{title:i,icon:s,categories:a,team:t.value,sprint:n.value,...H(e)}),document.location.hash="",!1}}bt()}function Xt(e){r("#owner-id").innerText=e.owner;let t=r("#modal-retro-config"),n=m("form",t);if(n){let i=r('input[name="categories"]',n);i.value=e.categories.join(","),i.parentElement&&P(i.parentElement)}else r(".config-panel-categories",t).innerText=e.categories.join(", ");k("retro",t,e.teamID,e.sprintID,e.title,e.icon)}function Et(e){switch(e.cmd){case"update":return Xt(e.param);case"child-add":return Tt(e.param);case"child-update":return console.log("TODO: child-update");case"child-remove":return yt(e.param);case"permissions":return x(e.param);default:throw new Error("invalid retro command ["+e.cmd+"]")}}function en(e){E("adhoc-message",e.level,e.message)}function kt(e,t){switch(t.cmd){case"reset":document.location.href="/";return;case"message":return en(t.param);case"comment":return le(t.param);case"online-update":return je(t.param);case"member-add":return Pe(t.param);case"member-update":return se(t.param);case"member-remove":return qe(t.param)}switch(e){case"team":return Ge(t);case"sprint":return Ke(t);case"estimate":return nt(t);case"standup":return ut(t);case"retro":return Et(t);default:throw new Error("invalid service ["+e+"]")}}var Lt,_,J;function tn(){console.log("[socket]: open")}function nn(e){let t=document.getElementById("socket-list");if(t){let n=document.createElement("pre");n.innerText=JSON.stringify(e,null,2),t.append(n)}kt(_,e)}function on(e){console.log(`[socket error]: ${e}`)}function rn(e,t){switch(_=e,J=t,Be(),_e(),_){case"team":Ve();break;case"sprint":Ye();break;case"estimate":tt();break;case"standup":dt();break;case"retro":Mt();break}Lt=new K(!0,tn,nn,on,"/"+_+"/"+J+"/connect"),console.log("loaded ["+_+"] workspace ["+J+"]")}function u(e,t){Lt.send({channel:_+":"+J,cmd:e,param:t})}function xt(){window.initWorkspace=rn}function sn(){let[e,t]=we();window.rituals={relativeTime:ye(),autocomplete:Me(),setSiblingToNull:e,initForm:t,flash:ve(),tags:He(),Socket:Re()},fe(),ge(),be(),Ee(),De(),window.JSX=o,xt()}document.addEventListener("DOMContentLoaded",sn);})();
//# sourceMappingURL=client.js.map
