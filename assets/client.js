(()=>{function l(e,t){let n;t?n=t.querySelectorAll(e):n=document.querySelectorAll(e);let r=[];return n.forEach(i=>{r.push(i)}),r}function g(e,t){let n=l(e,t);switch(n.length){case 0:return;case 1:return n[0];default:console.warn(`found [${n.length}] elements with selector [${e}], wanted zero or one`)}}function o(e,t){let n=g(e,t);if(!n)throw`no element found for selector [${e}]`;return n}function oe(e,t){return typeof e=="string"&&(e=o(e)),e.innerHTML=t,e}function D(e,t,n="block"){return typeof e=="string"&&(e=o(e)),e.style.display=t?n:"none",e}function s(e,t,...n){let r=document.createElement(e);for(let i in t)if(i==="for"&&(i="for"),i==="className"&&(i="class"),i&&t.hasOwnProperty(i)){let a=t[i];i==="dangerouslySetInnerHTML"?oe(r,a.__html):a===!0?r.setAttribute(i,i):a!==!1&&a!==null&&a!==void 0&&r.setAttribute(i,a.toString())}for(let i of n)if(Array.isArray(i))i.forEach(a=>{if(i==null)throw`child array for tag [${e}] is ${i}
${r.outerHTML}`;if(a==null)throw`child for tag [${e}] is ${a}
${r.outerHTML}`;typeof a=="string"&&(a=document.createTextNode(a)),r.appendChild(a)});else{if(i==null)throw`child for tag [${e}] is ${i}
${r.outerHTML}`;i.nodeType||(i=document.createTextNode(i.toString())),r.appendChild(i)}return r}function re(){for(let e of Array.from(document.querySelectorAll(".menu-container .final")))e.scrollIntoView({block:"nearest"})}var K="mode-light",Q="mode-dark";function ie(){for(let e of Array.from(document.getElementsByClassName("mode-input"))){let t=e;t.onclick=function(){switch(t.value){case"":document.body.classList.remove(K),document.body.classList.remove(Q);break;case"light":document.body.classList.add(K),document.body.classList.remove(Q);break;case"dark":document.body.classList.remove(K),document.body.classList.add(Q);break}}}}function b(e,t,n){let r=document.getElementById("flash-container");r===null&&(r=document.createElement("div"),r.id="flash-container",document.body.insertAdjacentElement("afterbegin",r));let i=document.createElement("div");i.className="flash";let a=document.createElement("input");a.type="radio",a.style.display="none",a.id="hide-flash-"+e,i.appendChild(a);let c=document.createElement("label");c.htmlFor="hide-flash-"+e;let d=document.createElement("span");d.innerHTML="\xD7",c.appendChild(d),i.appendChild(c);let p=document.createElement("div");p.className="content flash-"+t,p.innerText=n,i.appendChild(p),r.appendChild(i),ae(i)}function se(){let e=document.getElementById("flash-container");if(e===null)return b;let t=e.querySelectorAll(".flash");if(t.length>0)for(let n of t)ae(n);return b}function ae(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function ce(){for(let e of Array.from(document.getElementsByClassName("link-confirm"))){let t=e;t.onclick=function(){let n=t.dataset.message;return n&&n.length===0&&(n="Are you sure?"),confirm(n)}}}function le(){return l(".reltime").forEach(e=>{N(e.dataset.time||"",e)}),N}function me(e){let t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString().substring(0,19).replace("T"," ")}function N(e,t){let n=(e||"").replace(/-/g,"/").replace(/[TZ]/g," ")+" UTC",r=new Date(n),i=(new Date().getTime()-r.getTime())/1e3,a=Math.floor(i/86400),c=r.getFullYear(),d=r.getMonth()+1,p=r.getDate();if(isNaN(a)||a<0||a>=31)return c.toString()+"-"+(d<10?"0"+d.toString():d.toString())+"-"+(p<10?"0"+p.toString():p.toString());let u,h;return a==0?i<5?(h=1,u="just now"):i<60?(h=1,u=Math.floor(i)+" seconds ago"):i<120?(h=10,u="1 minute ago"):i<3600?(h=30,u=Math.floor(i/60)+" minutes ago"):i<7200?(h=60,u="1 hour ago"):(h=60,u=Math.floor(i/3600)+" hours ago"):a==1?(h=600,u="yesterday"):a<7?(h=600,u=a+" days ago"):(h=6e3,u=Math.ceil(a/7)+" weeks ago"),t&&(t.innerText=u,setTimeout(()=>N(e,t),h*1e3)),u}function de(){return ut}function ut(e,t,n,r,i){if(!e)return;let a=e.id+"-list",c=document.createElement("datalist"),d=document.createElement("option");d.value="",d.innerText="Loading...",c.appendChild(d),c.id=a,e.parentElement?.prepend(c),e.setAttribute("autocomplete","off"),e.setAttribute("list",a);let p={},u="";function h(v){let y=t;return y.includes("?")?y+"&t=json&"+n+"="+encodeURIComponent(v):y+"?t=json&"+n+"="+encodeURIComponent(v)}function G(v){let y=p[v];!y||!y.frag||(u=v,c.replaceChildren(y.frag.cloneNode(!0)))}function mt(){let v=e.value;if(v.length===0)return;let y=h(v),P=!v||!u;if(!P){let M=p[u];M&&(P=!M.data.find(C=>v===i(C)))}if(!!P){if(p[v]&&p[v].url===y){G(v);return}fetch(y,{credentials:"include"}).then(M=>M.json()).then(M=>{if(!M)return;let C=Array.isArray(M)?M:[M],ee=document.createDocumentFragment(),te=10;for(let q=0;q<C.length&&te>0;q++){let ne=i(C[q]),dt=r(C[q]);if(ne){let Y=document.createElement("option");Y.value=ne,Y.innerText=dt,ee.appendChild(Y),te--}}p[v]={url:y,data:C,frag:ee,complete:!1},G(v)})}}e.oninput=pt(mt,250),console.log("managing ["+e.id+"] autocomplete")}function pt(e,t){let n=0;return function(...r){n!==0&&window.clearTimeout(n),n=window.setTimeout(function(){e(null,...r)},t)}}function ue(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function x(e,t,n){return t||(t=18),n?`<svg class="${n}" style="width: ${t}px; height: ${t+"px"};"><use xlink:href="#svg-${e}"></use></svg>`:`<svg class="icon" style="width: ${t}px; height: ${t+"px"};"><use xlink:href="#svg-${e}"></use></svg>`}function $(e,t,n){return{__html:x(e,t,n)}}function pe(e){e||(e="");let t=x("right",15,"expand"),n=x("down",15,"collapse");return{__html:t+n+e}}function f(e){return setTimeout(()=>{e.setSelectionRange(e.value.length,e.value.length),e.focus()},100),!0}function A(e){let t=o("input.result",e),n=o(".tags",e),r=t.value.split(",").map(a=>a.trim()).filter(a=>a!=="");D(t,!1),n.innerHTML="";for(let a of r)n.appendChild(ge(a,e));g(".add-item",e)?.remove();let i=document.createElement("div");i.className="add-item",i.innerHTML=x("plus",22),i.onclick=function(){ht(n,e)},e.insertBefore(i,o(".clear",e))}function fe(){for(let e of l(".tag-editor"))A(e);return A}function ft(e,t){return e.parentElement!==t.parentElement?null:e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var O;function ge(e,t){let n=document.createElement("div");n.className="item",n.draggable=!0,n.ondragstart=function(c){c.dataTransfer?.setDragImage(document.createElement("div"),0,0),n.classList.add("dragging"),O=n},n.ondragover=function(){let c=ft(n,O);if(!c)return;let d=c===-1?n:n.nextSibling;O.parentElement?.insertBefore(O,d),Z(t)},n.ondrop=function(c){c.preventDefault()},n.ondragend=function(c){n.classList.remove("dragging"),c.preventDefault()};let r=document.createElement("div");r.innerText=e,r.className="value",r.onclick=function(){he(n)},n.appendChild(r);let i=document.createElement("input");i.className="editor",n.appendChild(i);let a=document.createElement("div");return a.innerHTML=x("times",13),a.className="close",a.onclick=function(){gt(n)},n.appendChild(a),n}function gt(e){let t=e.parentElement?.parentElement;e.remove(),t&&Z(t)}function ht(e,t){let n=ge("",t);e.appendChild(n),he(n)}function he(e){let t=o(".value",e),n=o(".editor",e);n.value=t.innerText;let r=function(){if(n.value===""){e.remove();return}t.innerText=n.value,D(t,!0),D(n,!1);let i=e.parentElement?.parentElement;i&&Z(i)};n.onblur=r,n.onkeydown=function(i){if(i.code==="Enter")return i.preventDefault(),r(),!1},D(t,!1),D(n,!0),n.focus()}function Z(e){let t=[],n=l(".item .value",e);for(let i of n)t.push(i.innerText);let r=o("input.result",e);r.value=t.join(", ")}var ve="--selected";function vt(e){let t=e.parentElement?.parentElement?.querySelector("input");if(!t)throw"no associated input found";t.value="\u2205"}function z(e){e.onreset=()=>z(e);let t={},n={};for(let r of e.elements){let i=r;if(i.name.length>0)if(i.name.endsWith(ve))n[i.name]=i;else{(i.type!=="radio"||i.checked)&&(t[i.name]=i.value);let a=()=>{let c=n[i.name+ve];c&&(c.checked=t[i.name]!==i.value)};i.onchange=a,i.onkeyup=a}}}function be(){for(let e of Array.from(document.querySelectorAll("form.editor")))z(e);return[vt,z]}var bt=[];function ye(){let e=document.querySelectorAll(".color-var");if(e.length>0)for(let t of Array.from(e)){let n=t,r=n.dataset.var,i=n.dataset.mode;bt.push(r),!(!r||r.length===0)&&(n.oninput=function(){yt(i,r,n.value)})}}function yt(e,t,n){let r=document.querySelector("#mockup-"+e);if(!r){console.error("can't find mockup for mode ["+e+"]");return}switch(t){case"color-foreground":k(r,".mock-main",n);break;case"color-background":U(r,".mock-main",n);break;case"color-foreground-muted":k(r,".mock-main .mock-muted",n);break;case"color-background-muted":U(r,".mock-main .mock-muted",n);break;case"color-link-foreground":k(r,".mock-main .mock-link",n);break;case"color-link-visited-foreground":k(r,".mock-main .mock-link-visited",n);break;case"color-nav-foreground":k(r,".mock-nav",n),k(r,".mock-nav .mock-link",n);break;case"color-nav-background":U(r,".mock-nav",n);break;case"color-menu-foreground":k(r,".mock-menu",n),k(r,".mock-menu .mock-link",n);break;case"color-menu-background":U(r,".mock-menu",n);break;case"color-menu-selected-foreground":k(r,".mock-menu .mock-link-selected",n);break;case"color-menu-selected-background":U(r,".mock-menu .mock-link-selected",n);break;default:console.error("invalid key ["+t+"]")}}function Te(e,t,n){let r=e.querySelectorAll(t);if(r.length==0)throw"empty query selector ["+t+"]";r.forEach(i=>n(i))}function U(e,t,n){Te(e,t,r=>r.style.backgroundColor=n)}function k(e,t,n){Te(e,t,r=>r.style.color=n)}function Me(){return j}var ke=!1,j=class{constructor(t,n,r,i,a){this.debug=t,this.open=n,this.recv=r,this.err=i,this.url=Ee(a),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=function(){ke=!0},this.connectTime=Date.now(),this.sock=new WebSocket(Ee(this.url));let t=this;this.sock.onopen=()=>{t.connected=!0,t.pendingMessages.forEach(t.send),t.pendingMessages=[],t.debug&&console.log("WebSocket connected"),t.open()},this.sock.onmessage=n=>{let r=JSON.parse(n.data);t.debug&&console.debug("[socket]: receive",r),t.recv(r)},this.sock.onerror=n=>()=>{t.err("socket",n.type)},this.sock.onclose=()=>{if(ke)return;t.connected=!1;let n=t.connectTime?Date.now()-t.connectTime:0;0<n&&n<2e3?(t.pauseSeconds=t.pauseSeconds*2,t.debug&&console.debug(`socket closed immediately, reconnecting in ${t.pauseSeconds} seconds`),setTimeout(()=>{t.connect()},t.pauseSeconds*1e3)):(console.debug("socket closed after ["+n+"ms]"),setTimeout(()=>{t.connect()},t.pauseSeconds*500))}}disconnect(){}send(t){if(this.debug&&console.debug("out",t),!this.sock)throw"not initialized";if(this.connected){let n=JSON.stringify(t,null,2);this.sock.send(n)}else this.pendingMessages.push(t)}};function Ee(e){if(e||(e="/connect"),e.indexOf("ws")==0)return e;let t=document.location,n="ws";return t.protocol==="https:"&&(n="wss"),e.indexOf("/")!=0&&(e="/"+e),n+`://${t.host}${e}`}function xe(e,t,n){return s("tr",{id:"member-"+e,class:"member","data-id":e},s("td",null,s("a",{href:"#modal-member-"+e},s("div",{class:"left",style:"padding-right: var(--padding-small);",dangerouslySetInnerHTML:$("profile")}),s("span",{class:"member-name"},t))),s("td",{class:"shrink",style:"text-align: right"},s("em",{class:"member-status"},n)),s("td",{class:"shrink online-status",title:"offline",dangerouslySetInnerHTML:$("circle",18,"right")}))}function Le(e,t,n){let r=[["owner","Owner"],["member","Member"],["observer","Observer"]];return s("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},s("a",{class:"backdrop",href:"#"}),s("div",{class:"modal-content"},s("div",{class:"modal-header"},s("a",{href:"#",class:"modal-close"},"\xD7"),s("h2",null,t)),s("div",{class:"modal-body"},s("form",{action:document.location.pathname,method:"post",class:"expanded"},s("input",{type:"hidden",name:"userID",value:e}),s("em",null,"Role"),s("br",null),s("select",{class:"input-role",name:"role"},r.map(i=>i[0]==n?s("option",{selected:"selected",value:i[0]},i[1]):s("option",{value:i[0]},i[1]))),s("hr",null),s("div",{class:"right"},s("button",{class:"member-update",type:"submit",name:"action",value:"member-update"},"Save")),s("button",{type:"submit",class:"member-remove",name:"action",value:"member-remove",onClick:"return confirm('Are you sure you wish to remove this user?');"},"Remove")))))}var F,w;function L(e){if(!e)return"System";let t=w[e];return t||"Unknown User"}function He(){return F}function Ie(){Tt(),Mt(),S()}function Tt(){let e=o("#modal-self"),t=o("form",e);t.onsubmit=function(){let n=o('input[name="name"]',t),r=o('input[name="choice"]:checked',t);return m("self",{name:n.value,choice:r.value}),o("#self-name").innerText=n.value,document.location.hash="",!1}}function Mt(){let e=l(".modal-member");for(let t of e)we(t)}function we(e){let t=o("form",e),n=function(r){let i=o('input[name="userID"]',t).value,a=o('select[name="role"]',t).value;m(r,{userID:i,role:a});let c=o("#member-"+i);return r==="member-update"?o(".member-role",c).innerText=a:r==="member-remove"&&(c.remove(),S()),document.location.hash="",!1};o(".member-update",t).onclick=()=>n("member-update"),o(".member-remove",t).onclick=()=>confirm("Are you sure you wish to remove this user?")?n("member-remove"):!1}function S(){w={},F=o("#self-id").innerText,w[F]=o("#self-name").innerText;let e=o("#panel-members"),t=l(".member",e);for(let n of t){let r=n.dataset.id;r&&(w[r]=o(".member-name",n).innerText)}}function Ce(e,t,n){if(g("#member-"+e)||e===F)return J(e,t,n);let i=o("#panel-members table tbody"),a=-1;for(let u=0;u<i.children.length;u++){let h=i.children.item(u);if(o(".member-name",h).innerText.localeCompare(t,void 0,{sensitivity:"accent"})>0){a=u;break}}let c=xe(e,t,n);a==-1?i.appendChild(c):i.insertBefore(c,i.children[a]);let d=o("#member-modals"),p=Le(e,t,n);d.appendChild(p),we(p),w[e]=t}function J(e,t,n){if(e===F)o("#self-name").innerText=t,o("#self-role").innerText=n;else{let r=o("#member-"+e);o(".member-name",r).innerText=t,o(".member-role",r).innerText=n;let i=o("#modal-member-"+e);o('select[name="role"]',i).value=n}if(w[e]!==t){w[e]=t;let r=o("#panel-members table tbody"),i=r.children,a=[];for(let c in i)i[c].nodeType==1&&a.push(i[c]);a.sort((c,d)=>{let p=o(".member-name",c).innerText,u=o(".member-name",d).innerText;return p.localeCompare(u,void 0,{sensitivity:"accent"})}),r.replaceChildren(...a)}}function De(e){o("#member-"+e).remove(),S()}function Ae(e,t){if(e===F)return;let n=g("#member-"+e+" .online-status");if(!n)throw"missing panel #member-"+e;n.title=t?"online":"offline";let r=t?"check-circle":"circle";n.innerHTML='<svg style="width: 18px; height: 18px;" class="right"><use xlink:href="#svg-'+r+'"></use></svg>'}function Fe(e,t){let n=s("li",null),r=me(new Date),i=s("span",{class:"nowrap reltime","data-time":r},"just now");N(r,i);let a=s("div",{class:"right"});return a.appendChild(i),n.appendChild(a),n.appendChild(s("div",null,e.content)),n.appendChild(s("div",null,s("em",null,t))),n}function H(e,t){let n="comment-link-"+e+"-"+t,r="#modal-"+e+"-"+t+"-comments";return s("a",{id:n,href:r,title:"0 comment",dangerouslySetInnerHTML:$("comment-alt")})}function I(e,t,n){return s("div",{id:"modal-"+e+"-"+t+"-comments",class:"modal comments",style:"display: none;"},s("a",{class:"backdrop",href:"#"}),s("div",{class:"modal-content"},s("div",{class:"modal-header"},s("a",{href:"#",class:"modal-close"},"\xD7"),s("h2",null,n," Comments")),s("div",{class:"modal-body"},s("ul",{id:"comment-list-"+e+"-"+t,class:"comment-list"}),s("form",{action:"#",method:"post",class:"expanded"},s("input",{type:"hidden",name:"action",value:"comment"}),s("input",{type:"hidden",name:"svc",value:e}),s("input",{type:"hidden",name:"modelID",value:t}),s("div",null,s("textarea",{name:"content",placeholder:"Add a comment, Markdown and HTML supported"})),s("div",{class:"mt right"},s("button",{type:"submit"},"Add Comment"))))))}function Re(){let e=l(".modal.comments");for(let t of e)E(t)}function E(e){let t=o("form",e);t.onsubmit=function(){let n={svc:o('input[name="svc"]',t).value,modelID:o('input[name="modelID"]',t).value},r=o("textarea",t);return n.content=r.value,n.userID=He(),m("comment",n),X(n),!1}}function X(e){let t=o("#comment-list-"+e.svc+"-"+e.modelID),n=L(e.userID),r=Fe(e,n);t.appendChild(r);let i=t.childNodes.length-1,a=o("#comment-link-"+e.svc+"-"+e.modelID);a.title=i+(i==1?" comment":" comments"),a.innerHTML.indexOf("comment-dots")==-1&&(a.innerHTML='<svg style="width: 18px; height: 18px;" class="right"><use xlink:href="#svg-comment-dots"></use></svg>')}function kt(e,t,n,r){let i="";if(r){let a=g(`select[name="sprint"] option[value="${r}"]`,t);if(a){let c=a.innerText;i+=`<a href="/sprint/${r}">${c}</a> `}}if(i+=e==="retro"?"retrospective":e,n){let a=g(`select[name="team"] option[value="${n}"]`,t);if(a){let c=a.innerText;i+=` in <a href="/team/${n}">${c}</a>`}}return i}function B(e){let t=o(`#${e.type}-list tbody`),n=g(".empty",t);n&&n.remove();let r=document.createElement("tr");r.id=`${e.type}-list-${e.id}`;let i=document.createElement("td"),a=document.createElement("div");a.classList.add("right"),a.appendChild(H(e.type,e.id)),a.appendChild(I(e.type,e.id,e.id)),i.appendChild(a);let c=document.createElement("a");c.href=e.path,c.innerText=e.title,i.appendChild(c),r.appendChild(i),t.appendChild(r),E(o(".modal",a))}function W(e){o(`#${e.type}-list-${e.id}`).remove();let t=o(`#${e.type}-list tbody`);if(t.children.length===0){let n=document.createElement("tr");n.classList.add("empty");let r=document.createElement("em");r.innerText="no "+e.type+"s",n.appendChild(r),t.appendChild(n)}}function T(e,t,n,r,i,a){o('input[name="title"]',t).value=i;for(let p of l('input[name="icon"]',t))p.checked=a===p.value;let c=g('select[name="team"]',t);c!=null&&(c.value=n||"");let d=g('select[name="sprint"]',t);d!=null&&(d.value=r||""),o("#model-title").innerText=i,o("#model-icon").innerHTML=x(a,20),o("#model-banner").innerHTML=kt(e,t,n||"",r||""),b(e,"success",e+" updated")}function Ne(){o("#modal-team-config-link").onclick=function(){f(o('#modal-team-config form input[name="title"]'))};let e=o("#modal-team-config form");e.onsubmit=function(){let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value;return m("update",{title:t,icon:n}),document.location.hash="",!1}}function $e(e){switch(e.cmd){case"update":return Et(e.param);case"child-add":return B(e.param);case"child-remove":return W(e.param);default:throw"invalid team command ["+e.cmd+"]"}}function Et(e){let t=o("#modal-team-config form");T("team",t,null,null,e.title,e.icon)}function Ue(){o("#modal-sprint-config-link").onclick=function(){f(o('#modal-sprint-config form input[name="title"]'))};let e=o("#modal-sprint-config form");e.onsubmit=function(){let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value,r=o('input[name="startDate"]',e).value,i=o('input[name="endDate"]',e).value,a=o('select[name="team"]',e).value;return m("update",{title:t,icon:n,startDate:r,endDate:i,team:a}),document.location.hash="",!1}}function qe(e){switch(e.cmd){case"update":return xt(e.param);case"child-add":return B(e.param);case"child-remove":return W(e.param);default:throw"invalid sprint command ["+e.cmd+"]"}}function xt(e){let t=o("#modal-sprint-config form");o('input[name="startDate"]',t).value=_(e.startDate),o('input[name="endDate"]',t).value=_(e.endDate),o("#model-summary").innerText=Lt(e),T("sprint",t,e.teamID,null,e.title,e.icon)}function Lt(e){let t="";return e.startDate&&(t+="starts ",t+=_(e.startDate),e.endDate&&(t+=", ")),e.endDate&&(t+="ends ",t+=_(e.endDate)),t}function _(e){return`${e}`.split("T")[0]}function Oe(e){return s("tr",{class:"story-row",id:"story-row-{%s s.ID.String() %}","data-idx":"s.Idx"},s("td",null,s("a",{href:"#modal-story-"+e.id,class:"story-title"},s("div",null,e.title))),s("td",null,e.status),s("td",null,e.finalVote?e.finalVote:"-"),s("td",null,H("story",e.id),I("story",e.id,e.title)))}function je(e){let t=e.dataset.id;if(!t){console.warn("no id in dataset",e);return}l(".vote-submit-button",e).forEach(n=>n.style.display="none"),l(".link-edit",e).forEach(n=>Ht(t,n)),l(".status-new-form-delete",e).forEach(n=>Dt(t,n)),l(".status-new-form-next",e).forEach(n=>Be(t,n)),l(".status-active-form-prev",e).forEach(n=>It(t,n)),l(".status-active-form-next",e).forEach(n=>wt(t,n)),l(".story-vote-options",e).forEach(n=>Ct(t,n)),l(".status-complete-form-prev",e).forEach(n=>Be(t,n))}function Ht(e,t){t.onclick=function(){f(o("#modal-story-"+e+'-edit form input[name="title"]'))}}function It(e,t){t.onsubmit=function(){return m("child-status",{storyID:e,status:"new"}),console.log("new"),!1}}function Be(e,t){t.onsubmit=function(){return m("child-status",{storyID:e,status:"active"}),console.log("active"),!1}}function wt(e,t){t.onsubmit=function(){return m("child-status",{storyID:e,status:"complete"}),console.log("complete"),!1}}function Ct(e,t){l(".vote-option",t).forEach(n=>{n.onclick=function(r){return o('input[name="vote"]',n).checked=!0,m("vote",{storyID:e,vote:n.dataset.choice}),!1}})}function Dt(e,t){t.onsubmit=function(){return confirm("Are you sure you want to delete this story?")&&(m("child-remove",{storyID:e}),document.location.hash=""),!1}}function We(){l(".add-story-link").forEach(n=>n.onclick=function(){return f(o("#story-add-title"))});let e=o("#modal-story--add"),t=o("form",e);t.onsubmit=function(){let n=o('input[name="title"]',t),r=n.value;return n.value="",m("child-add",{title:r}),document.location.hash="",!1},l("#story-modals .modal-story").forEach(je)}function _e(e){let t=o("#panel-detail table tbody"),n=-1;for(let c=0;c<t.children.length;c++){let d=t.children.item(c),p=o(".story-title",d).innerText,u=d.dataset.index;if(u){if(parseInt(u,10)>=e.idx){n=c;break}else if(p.localeCompare(e.title,void 0,{sensitivity:"accent"})>=0){n=c;break}}}let r=Oe(e);n==-1?t.appendChild(r):t.insertBefore(r,t.children[n]),E(o(".modal",r));let a=o("#modal-story-new").cloneNode(!0);a.id="modal-story-"+e.id,a.dataset.id=e.id,a.dataset.status=e.status,a.classList.add("modal-story"),o("#story-modals").appendChild(a),(document.location.hash==="modal-story--add"||document.location.hash==="")&&(document.location.hash="modal-story-"+e.id)}function Ve(e){let t=o("#modal-story-"+e.id);o(".status-new",t).style.display=e.status==="new"?"block":"none",o(".status-active",t).style.display=e.status==="active"?"block":"none",o(".status-complete",t).style.display=e.status==="complete"?"block":"none"}function Ge(e){let t=o("#story-row-"+e),n=o(".story-title",t).innerText;b(e+"-removed","success",`story [${n}] has been removed`),t.remove(),o("#modal-story-"+e).remove()}function Pe(){o("#modal-estimate-config-link").onclick=function(){f(o('#modal-estimate-config form input[name="title"]'))};let e=o("#modal-estimate-config form");e.onsubmit=function(){let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value,r=o('input[name="choices"]',e).value,i=o('select[name="team"]',e).value,a=o('select[name="sprint"]',e).value;return m("update",{title:t,icon:n,choices:r,team:i,sprint:a}),document.location.hash="",!1},We()}function Ye(e){switch(e.cmd){case"update":return At(e.param);case"child-add":return _e(e.param);case"child-status":return Ve(e.param);case"child-remove":return Ge(e.param);default:throw"invalid estimate command ["+e.cmd+"]"}}function At(e){let t=o("#modal-estimate-config form"),n=o('input[name="choices"]',t);n.value=e.choices,n.parentElement&&A(n.parentElement),T("estimate",t,e.teamID,e.sprintID,e.title,e.icon)}function Ke(e){return s("li",{id:"report-group-"+e},s("input",{id:"accordion-"+e,type:"checkbox",hidden:!0,checked:"checked"}),s("label",{for:"accordion-"+e,dangerouslySetInnerHTML:pe(e)}),s("div",{class:"bd"}))}function Qe(e){return s("div",{class:"report",id:"report-"+e.id},s("div",null,s("div",{class:"right"},H("report",e.id)),I("report",e.id,e.id),s("a",{href:"#modal-report-"+e.id,"data-id":e.id,class:"clean"},s("h4",{class:"username"},L(e.userID)),s("div",{class:"pt"},e.html))))}function Ze(){l(".add-report-link").forEach(n=>n.onclick=function(){return f(o("#report-add-content"))}),l(".modal-report-edit-link").forEach(n=>n.onclick=function(){return f(o("#input-content-"+n.dataset.id))});let e=o("#modal-report--add"),t=o("form",e);t.onsubmit=function(){let n=o('input[name="day"]',t).value,r=o('textarea[name="content"]',t),i=r.value;return r.value="",m("child-add",{day:n,content:i}),document.location.hash="",!1},l(".report-modal-edit").forEach(Ft)}function Ft(e){let t=o("form",e),n=o('input[name="reportID"]',t).value;o(".report-edit-delete",t).onclick=function(){return confirm("Are you sure you want to delete this report?")&&(m("child-remove",{reportID:n}),document.location.hash=""),!1},t.onsubmit=function(){let r=o('input[name="day"]',t).value,a=o('textarea[name="content"]',t).value;return m("child-update",{reportID:n,day:r,content:a}),document.location.hash="",!1}}function ze(e){e.day.length>10&&(e.day=e.day.substring(0,10));let t=g("#report-group-"+e.day+" .bd");if(!t){let a=Ke(e.day);o("#report-groups").appendChild(a),t=o(".bd",a)}let n=-1,r=L(e.userID);for(let a=0;a<t.children.length;a++){let c=t.children.item(a);if(o(".username",c).innerText.localeCompare(r,void 0,{sensitivity:"accent"})>=0){n=a;break}}let i=Qe(e);n==-1?t.appendChild(i):t.insertBefore(i,t.children[n]),E(o(".modal",i))}function Se(e){o("#report-"+e).remove(),b(e+"-removed","success","report has been removed"),o("#modal-report-"+e).remove()}function Je(){o("#modal-standup-config-link").onclick=function(){f(o('#modal-standup-config form input[name="title"]'))};let e=o("#modal-standup-config form");e.onsubmit=function(){let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value,r=o('select[name="team"]',e).value,i=o('select[name="sprint"]',e).value;return m("update",{title:t,icon:n,team:r,sprint:i}),document.location.hash="",!1},Ze()}function Xe(e){switch(e.cmd){case"update":return Rt(e.param);case"child-add":return ze(e.param);case"child-remove":return Se(e.param);default:throw"invalid standup command ["+e.cmd+"]"}}function Rt(e){let t=o("#modal-standup-config form");T("standup",t,e.teamID,e.sprintID,e.title,e.icon)}function et(e){return s("div",{id:"category-"+e,"data-category":e,class:"category"},s("div",{class:"right"},s("a",{class:"add-feedback-link","data-category":e,href:"#modal-feedback--add-"+e},s("button",null,"New"))),s("h4",null,s("a",{href:"#modal-feedback--add-"+e},e)),s("div",{class:"clear"}),s("div",{class:"feedback-list"}),s("div",{id:"modal-feedback--add-"+e,class:"modal modal-feedback-add","data-category":e,style:"display: none;"},s("a",{class:"backdrop",href:"#"}),s("div",{class:"modal-content"},s("div",{class:"modal-header"},s("a",{href:"#",class:"modal-close"},"\xD7"),s("h2",null,"New Feedback")),s("div",{class:"modal-body"},s("form",{action:"#",method:"post"},s("input",{type:"hidden",name:"action",value:"child-add"}),s("input",{type:"hidden",name:"action",value:"child-add"}),s("div",{class:"mb expanded"},s("label",{for:"category-"+e+"-select"},s("em",{class:"title"},"Category")),s("div",null,s("select",{name:"category",id:"category-"+e+"-select"},s("option",{selected:"selected",value:"TODO"},"TODO")))),s("div",{class:"mb expanded"},s("label",{for:"feedback-add-content-"+e},s("em",{class:"title"},"Content")),s("div",null,s("textarea",{rows:"8",id:"feedback-add-content-"+e,name:"content",placeholder:"HTML and Markdown supported"}))),s("button",{type:"submit"},"Add Feedback"))))))}function tt(e){return s("div",{id:"feedback-"+e.id,class:"feedback mt clear"},s("div",{class:"right"},H("feedback",e.id)),I("feedback",e.id,e.id),s("a",{href:"#modal-feedback-"+e.id,class:"clean modal-feedback-edit-link","data-id":e.id},s("div",null,L(e.userID)),s("div",{class:"pt feedback-content"},e.html)))}function nt(){l(".add-feedback-link").forEach(e=>e.onclick=function(){return f(o("#feedback-add-content-"+e.dataset.category))}),l(".modal-feedback-edit-link").forEach(e=>e.onclick=function(){return f(o("#input-content-"+e.dataset.id))});for(let e of l(".modal-feedback-add"))Nt(e);l(".modal-feedback-edit").forEach($t)}function Nt(e){let t=o("form",e);t.onsubmit=function(){let n=o('select[name="category"]',t).value,r=o('textarea[name="content"]',t),i=r.value;return r.value="",m("child-add",{category:n,content:i}),document.location.hash="",!1}}function $t(e){let t=o("form",e),n=o('input[name="feedbackID"]',t).value;o(".feedback-edit-delete",t).onclick=function(){return confirm("Are you sure you want to delete this feedback?")&&(m("child-remove",{feedbackID:n}),document.location.hash=""),!1},t.onsubmit=function(){let r=o('select[name="category"]',t).value,a=o('textarea[name="content"]',t).value;return m("child-update",{feedbackID:n,category:r,content:a}),document.location.hash="",!1}}function ot(e){let t=g("#category-"+e.category+" .feedback-list");if(!t){let i=et(e.category);o("#category-list").appendChild(i),t=o(".feedback-list",i)}let n=-1;for(let i=0;i<t.children.length;i++){let a=t.children.item(i),c=o(".feedback-content",a).innerText,d=a.dataset.index;if(d){if(parseInt(d,10)>=e.idx){n=i;break}else if(c.localeCompare(e.content,void 0,{sensitivity:"accent"})>=0){n=i;break}}}let r=tt(e);n==-1?t.appendChild(r):t.insertBefore(r,t.children[n]),E(o(".modal",r))}function rt(e){o("#feedback-"+e).remove(),b(e+"-removed","success","feedback has been removed"),o("#modal-feedback-"+e).remove()}function it(){o("#modal-retro-config-link").onclick=function(){f(o('#modal-retro-config form input[name="title"]'))};let e=o("#modal-retro-config form");e.onsubmit=function(){let t=o('input[name="title"]',e).value,n=o('input[name="icon"]:checked',e).value,r=o('input[name="categories"]',e).value,i=o('select[name="team"]',e).value,a=o('select[name="sprint"]',e).value;return m("update",{title:t,icon:n,categories:r,team:i,sprint:a}),document.location.hash="",!1},nt()}function st(e){switch(e.cmd){case"update":return Ut(e.param);case"child-add":return ot(e.param);case"child-update":return console.log("child-update!!!");case"child-remove":return rt(e.param);default:throw"invalid retro command ["+e.cmd+"]"}}function Ut(e){let t=o("#modal-retro-config form"),n=o('input[name="categories"]',t);n.value=e.categories.join(","),n.parentElement&&A(n.parentElement);let r=o("#category-list");for(let i of l(" .category",r));T("retro",t,e.teamID,e.sprintID,e.title,e.icon)}function at(e,t){switch(t.cmd){case"error":return qt(t.param.message);case"comment":return X(t.param);case"online-update":let n=t.param;return Ae(n.userID,n.connected);case"member-add":let r=t.param;return Ce(r.userID,r.name,r.role);case"member-update":let i=t.param;return J(i.userID,i.name,i.role);case"member-remove":return De(t.param)}switch(e){case"team":return $e(t);case"sprint":return qe(t);case"estimate":return Ye(t);case"standup":return Xe(t);case"retro":return st(t);default:throw"invalid service ["+e+"]"}}function qt(e){b("error","error",e)}var ct,R,V;function Ot(){console.log("[socket]: open")}function jt(e){let t=document.getElementById("socket-list");if(t){let n=document.createElement("pre");n.innerText=JSON.stringify(e,null,2),t.append(n)}at(R,e)}function Bt(e){console.log("[socket error]: "+e)}function Wt(e,t){switch(R=e,V=t,Re(),Ie(),R){case"team":Ne();break;case"sprint":Ue();break;case"estimate":Pe();break;case"standup":Je();break;case"retro":it();break}ct=new j(!0,Ot,jt,Bt,"/"+R+"/"+V+"/connect"),console.log("loaded ["+R+"] workspace ["+V+"]")}function m(e,t){ct.send({channel:R+":"+V,cmd:e,param:t})}function lt(){window.initWorkspace=Wt}function _t(){let[e,t]=be();window.rituals={relativeTime:le(),autocomplete:de(),setSiblingToNull:e,initForm:t,flash:se(),tags:fe(),Socket:Me()},re(),ie(),ce(),ue(),ye(),window.JSX=s,lt()}document.addEventListener("DOMContentLoaded",_t);})();
//# sourceMappingURL=client.js.map
