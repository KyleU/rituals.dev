(()=>{function f(e,n){let t;n?t=n.querySelectorAll(e):t=document.querySelectorAll(e);let o=[];return t.forEach(r=>{o.push(r)}),o}function L(e,n){let t=f(e,n);switch(t.length){case 0:return;case 1:return t[0];default:console.warn(`found [${t.length}] elements with selector [${e}], wanted zero or one`)}}function a(e,n){let t=L(e,n);return t||console.warn(`no element found for selector [${e}]`),t}function O(e,n){return typeof e=="string"&&(e=a(e)),e.innerHTML=n,e}function h(e,n,t="block"){return typeof e=="string"&&(e=a(e)),e.style.display=n?t:"none",e}function q(e,n){let t=document.createElement(e);for(let o in n)if(o&&n.hasOwnProperty(o)){let r=n[o];o==="dangerouslySetInnerHTML"?O(t,r.__html):r===!0?t.setAttribute(o,o):r!==!1&&r!==null&&r!==void 0&&t.setAttribute(o,r.toString())}for(let o=2;o<arguments.length;o++){let r=arguments[o];if(Array.isArray(r))r.forEach(i=>{if(r==null)throw`child array for tag [${e}] is ${r}
${t.outerHTML}`;if(i==null)throw`child for tag [${e}] is ${i}
${t.outerHTML}`;typeof i=="string"&&(i=document.createTextNode(i)),t.appendChild(i)});else{if(r==null)throw`child for tag [${e}] is ${r}
${t.outerHTML}`;r.nodeType||(r=document.createTextNode(r.toString())),t.appendChild(r)}}return t}function F(){for(let e of Array.from(document.querySelectorAll(".menu-container .final")))e.scrollIntoView({block:"nearest"})}var x="mode-light",w="mode-dark";function J(){for(let e of Array.from(document.getElementsByClassName("mode-input"))){let n=e;n.onclick=function(){switch(n.value){case"":document.body.classList.remove(x),document.body.classList.remove(w);break;case"light":document.body.classList.add(x),document.body.classList.remove(w);break;case"dark":document.body.classList.remove(x),document.body.classList.add(w);break}}}}function ue(e,n,t){let o=document.getElementById("flash-container");o===null&&(o=document.createElement("div"),o.id="flash-container",document.body.insertAdjacentElement("afterbegin",o));let r=document.createElement("div");r.className="flash";let i=document.createElement("input");i.type="radio",i.style.display="none",i.id="hide-flash-"+e,r.appendChild(i);let s=document.createElement("label");s.htmlFor="hide-flash-"+e;let d=document.createElement("span");d.innerHTML="\xD7",s.appendChild(d),r.appendChild(s);let l=document.createElement("div");l.className="content flash-"+n,l.innerText=t,r.appendChild(l),o.appendChild(r),W(r)}function U(){window.rituals.flash=ue;let e=document.getElementById("flash-container");if(e===null)return;let n=e.querySelectorAll(".flash");if(n.length>0)for(let t of n)W(t)}function W(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function j(){for(let e of Array.from(document.getElementsByClassName("link-confirm"))){let n=e;n.onclick=function(){let t=n.dataset.message;return t&&t.length===0&&(t="Are you sure?"),confirm(t)}}}function B(){window.rituals.relativeTime=R,f(".reltime").forEach(e=>{let n=e.dataset.time||"";e.innerText=R(n)})}function R(e){let n=new Date((e||"").replace(/-/g,"/").replace(/[TZ]/g," ")+" UTC"),t=(new Date().getTime()-n.getTime())/1e3,o=Math.floor(t/86400),r=n.getFullYear(),i=n.getMonth()+1,s=n.getDate();return isNaN(o)||o<0||o>=31?(console.log("### big",o),r.toString()+"-"+(i<10?"0"+i.toString():i.toString())+"-"+(s<10?"0"+s.toString():s.toString())):o==0&&(t<60&&"just now"||t<120&&"1 minute ago"||t<3600&&Math.floor(t/60)+" minutes ago"||t<7200&&"1 hour ago"||t<86400&&Math.floor(t/3600)+" hours ago")||o==1&&"Yesterday"||o<7&&o+" days ago"||o<31&&Math.ceil(o/7)+" weeks ago"||""}function X(){window.rituals.autocomplete=fe}function fe(e,n,t,o,r){if(!e)return;let i=e.id+"-list",s=document.createElement("datalist"),d=document.createElement("option");d.value="",d.innerText="Loading...",s.appendChild(d),s.id=i,e.parentElement?.prepend(s),e.setAttribute("autocomplete","off"),e.setAttribute("list",i);let l={},v="";function le(c){let m=n;return m.includes("?")?m+"&t=json&"+t+"="+encodeURIComponent(c):m+"?t=json&"+t+"="+encodeURIComponent(c)}function A(c){let m=l[c];!m||!m.frag||(v=c,s.replaceChildren(m.frag.cloneNode(!0)))}function me(){let c=e.value;if(c.length===0)return;let m=le(c),b=!c||!v;if(!b){let u=l[v];u&&(b=!u.data.find(g=>c===r(g)))}if(!!b){if(l[c]&&l[c].url===m){A(c);return}fetch(m).then(u=>u.json()).then(u=>{if(!u)return;let g=Array.isArray(u)?u:[u],N=document.createDocumentFragment(),D=10;for(let y=0;y<g.length&&D>0;y++){let $=r(g[y]),de=o(g[y]);if($){let M=document.createElement("option");M.value=$,M.innerText=de,N.appendChild(M),D--}}l[c]={url:m,data:g,frag:N,complete:!1},A(c)})}}e.oninput=pe(me,250),console.log("managing ["+e.id+"] autocomplete")}function pe(e,n){let t=0;return function(...o){t!==0&&window.clearTimeout(t),t=window.setTimeout(function(){e.apply(null,o)},n)}}function _(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function H(e,n){return`<svg class="icon" style="width: ${n}px; height: ${n}px;"><use xlink:href="#svg-${e}"></use></svg>`}function G(e){let n=a("input.result",e),t=a(".tags",e),o=n.value.split(",").map(i=>i.trim()).filter(i=>i!=="");h(n,!1),t.innerHTML="";for(let i of o)t.appendChild(Y(i,e));L(".add-item",e)?.remove();let r=document.createElement("div");r.className="add-item",r.innerHTML=H("plus",22),r.onclick=function(){ke(t,e)},e.insertBefore(r,a(".clear",e))}function P(){window.rituals.tags=G;for(let e of f(".tag-editor"))G(e)}function ge(e,n){return e.parentElement!==n.parentElement?null:e===n?0:e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var T;function Y(e,n){let t=document.createElement("div");t.className="item",t.draggable=!0,t.ondragstart=function(s){s.dataTransfer.setDragImage(document.createElement("div"),0,0),t.classList.add("dragging"),T=t},t.ondragover=function(s){let d=ge(t,T);if(!d)return;let l=d===-1?t:t.nextSibling;T.parentElement.insertBefore(T,l),I(n)},t.ondrop=function(s){s.preventDefault()},t.ondragend=function(s){t.classList.remove("dragging"),s.preventDefault()};let o=document.createElement("div");o.innerText=e,o.className="value",o.onclick=function(){z(t)},t.appendChild(o);let r=document.createElement("input");r.className="editor",t.appendChild(r);let i=document.createElement("div");return i.innerHTML=H("times",13),i.className="close",i.onclick=function(){he(t)},t.appendChild(i),t}function he(e){let n=e.parentElement.parentElement;e.remove(),I(n)}function ke(e,n){let t=Y("",n);e.appendChild(t),z(t)}function z(e){let n=a(".value",e),t=a(".editor",e);t.value=n.innerText;let o=function(){if(t.value===""){e.remove();return}n.innerText=t.value,h(n,!0),h(t,!1);let r=e.parentElement.parentElement;I(r)};t.onblur=o,t.onkeydown=function(r){if(r.code==="Enter")return r.preventDefault(),o(),!1},h(n,!1),h(t,!0),t.focus()}function I(e){let n=[],t=f(".item .value",e);for(let r of t)n.push(r.innerText);let o=a("input.result",e);o.value=n.join(", ")}var K="--selected";function ye(e){let n=e.parentElement.parentElement.querySelector("input");if(!n)throw"no associated input found";n.value="\u2205"}function S(e){e.onreset=()=>S(e);let n={},t={};for(let o of e.elements){let r=o;if(r.name.length>0)if(r.name.endsWith(K))t[r.name]=r;else{(r.type!=="radio"||r.checked)&&(n[r.name]=r.value);let i=()=>{let s=t[r.name+K];s&&(s.checked=n[r.name]!==r.value)};r.onchange=i,r.onkeyup=i}}}function Q(){window.rituals.setSiblingToNull=ye,window.rituals.initForm=S;for(let e of Array.from(document.querySelectorAll("form.editor")))S(e)}var Te=[];function V(){let e=document.querySelectorAll(".color-var");if(e.length>0)for(let n of Array.from(e)){let t=n,o=t.dataset.var,r=t.dataset.mode;Te.push(o),!(!o||o.length===0)&&(t.oninput=function(){Ee(r,o,t.value)})}}function Ee(e,n,t){let o=document.querySelector("#mockup-"+e);if(!o){console.error("can't find mockup for mode ["+e+"]");return}switch(n){case"color-foreground":p(o,".mock-main",t);break;case"color-background":k(o,".mock-main",t);break;case"color-foreground-muted":p(o,".mock-main .mock-muted",t);break;case"color-background-muted":k(o,".mock-main .mock-muted",t);break;case"color-link-foreground":p(o,".mock-main .mock-link",t);break;case"color-link-visited-foreground":p(o,".mock-main .mock-link-visited",t);break;case"color-nav-foreground":p(o,".mock-nav",t),p(o,".mock-nav .mock-link",t);break;case"color-nav-background":k(o,".mock-nav",t);break;case"color-menu-foreground":p(o,".mock-menu",t),p(o,".mock-menu .mock-link",t);break;case"color-menu-background":k(o,".mock-menu",t);break;case"color-menu-selected-foreground":p(o,".mock-menu .mock-link-selected",t);break;case"color-menu-selected-background":k(o,".mock-menu .mock-link-selected",t);break;default:console.error("invalid key ["+n+"]")}}function Z(e,n,t){let o=e.querySelectorAll(n);if(o.length==0)throw"empty query selector ["+n+"]";o.forEach(r=>{t(r)})}function k(e,n,t){Z(e,n,o=>o.style.backgroundColor=t)}function p(e,n,t){Z(e,n,o=>o.style.color=t)}function ee(){window.rituals.Socket=E}var te=!1,E=class{constructor(n,t,o,r,i){this.debug=n,this.open=t,this.recv=o,this.err=r,this.url=ne(i),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=function(){te=!0},this.connectTime=Date.now(),this.sock=new WebSocket(ne(this.url));let n=this;this.sock.onopen=()=>{n.connected=!0,n.pendingMessages.forEach(n.send),n.pendingMessages=[],n.debug&&console.log("WebSocket connected"),n.open()},this.sock.onmessage=t=>{let o=JSON.parse(t.data);n.debug&&console.debug("[socket]: receive",o),n.recv(o)},this.sock.onerror=t=>()=>{n.err("socket",t.type)},this.sock.onclose=()=>{if(te)return;n.connected=!1;let t=n.connectTime?Date.now()-n.connectTime:0;0<t&&t<2e3?(n.pauseSeconds=n.pauseSeconds*2,n.debug&&console.debug(`socket closed immediately, reconnecting in ${n.pauseSeconds} seconds`),setTimeout(()=>{n.connect()},n.pauseSeconds*1e3)):(console.debug("socket closed after ["+t+"ms]"),setTimeout(()=>{n.connect()},n.pauseSeconds*500))}}disconnect(){}send(n){if(this.debug&&console.debug("out",n),!this.sock)throw"not initialized";if(this.connected){let t=JSON.stringify(n,null,2);this.sock.send(t)}else this.pendingMessages.push(n)}};function ne(e){if(e||(e="/connect"),e.indexOf("ws")==0)return e;let n=document.location,t="ws";return n.protocol==="https:"&&(t="wss"),e.indexOf("/")!=0&&(e="/"+e),t+`://${n.host}${e}`}function oe(e){switch(e.cmd){case"comment":return ve(e.param)}}function ve(e){console.log("!")}function re(){let e=f(".modal.comments");for(let n of e){let t=a("form",n);t.onsubmit=function(){let o=f("input",t),r={};for(let s of o)switch(s.name){case"svc":r.svc=s.value;break;case"modelID":r.modelID=s.value;break}let i=a("textarea",t);return r.content=i.value,ie("comment",r),!1}}}var se,ce,C;function be(){console.log("[socket]: open")}function Me(e){let n=document.getElementById("socket-list");if(n){let t=document.createElement("pre");t.innerText=JSON.stringify(e,null,2),n.append(t)}oe(e)}function Le(e){console.log("[socket error]: "+e)}function xe(e,n){ce=e,C=n,re(),se=new E(!0,be,Me,Le,"/"+e+"/"+C+"/connect"),console.log("loaded ["+e+"] workspace")}function ie(e,n){se.send({channel:ce+":"+C,cmd:e,param:n})}function ae(){window.rituals.initWorkspace=xe}function we(){window.rituals={},window.JSX=q,F(),J(),U(),j(),B(),X(),_(),P(),Q(),V(),ee(),ae()}document.addEventListener("DOMContentLoaded",we);})();
//# sourceMappingURL=client.js.map
