(()=>{function p(e,t){let n;t?n=t.querySelectorAll(e):n=document.querySelectorAll(e);let r=[];return n.forEach(o=>{r.push(o)}),r}function k(e,t){let n=p(e,t);switch(n.length){case 0:return;case 1:return n[0];default:console.warn(`found [${n.length}] elements with selector [${e}], wanted zero or one`)}}function s(e,t){let n=k(e,t);return n||console.warn(`no element found for selector [${e}]`),n}function Y(e,t){return typeof e=="string"&&(e=s(e)),e.innerHTML=t,e}function y(e,t,n="block"){return typeof e=="string"&&(e=s(e)),e.style.display=t?n:"none",e}function c(e,t,...n){let r=document.createElement(e);for(let o in t)if(o&&t.hasOwnProperty(o)){let i=t[o];o==="dangerouslySetInnerHTML"?Y(r,i.__html):i===!0?r.setAttribute(o,o):i!==!1&&i!==null&&i!==void 0&&r.setAttribute(o,i.toString())}for(let o of n)if(Array.isArray(o))o.forEach(i=>{if(o==null)throw`child array for tag [${e}] is ${o}
${r.outerHTML}`;if(i==null)throw`child for tag [${e}] is ${i}
${r.outerHTML}`;typeof i=="string"&&(i=document.createTextNode(i)),r.appendChild(i)});else{if(o==null)throw`child for tag [${e}] is ${o}
${r.outerHTML}`;o.nodeType||(o=document.createTextNode(o.toString())),r.appendChild(o)}return r}function z(){for(let e of Array.from(document.querySelectorAll(".menu-container .final")))e.scrollIntoView({block:"nearest"})}var $="mode-light",O="mode-dark";function K(){for(let e of Array.from(document.getElementsByClassName("mode-input"))){let t=e;t.onclick=function(){switch(t.value){case"":document.body.classList.remove($),document.body.classList.remove(O);break;case"light":document.body.classList.add($),document.body.classList.remove(O);break;case"dark":document.body.classList.remove($),document.body.classList.add(O);break}}}}function C(e,t,n){let r=document.getElementById("flash-container");r===null&&(r=document.createElement("div"),r.id="flash-container",document.body.insertAdjacentElement("afterbegin",r));let o=document.createElement("div");o.className="flash";let i=document.createElement("input");i.type="radio",i.style.display="none",i.id="hide-flash-"+e,o.appendChild(i);let a=document.createElement("label");a.htmlFor="hide-flash-"+e;let d=document.createElement("span");d.innerHTML="\xD7",a.appendChild(d),o.appendChild(a);let l=document.createElement("div");l.className="content flash-"+t,l.innerText=n,o.appendChild(l),r.appendChild(o),V(o)}function Q(){let e=document.getElementById("flash-container");if(e===null)return C;let t=e.querySelectorAll(".flash");if(t.length>0)for(let n of t)V(n);return C}function V(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function Z(){for(let e of Array.from(document.getElementsByClassName("link-confirm"))){let t=e;t.onclick=function(){let n=t.dataset.message;return n&&n.length===0&&(n="Are you sure?"),confirm(n)}}}function J(){return p(".reltime").forEach(e=>{M(e.dataset.time||"",e)}),M}function X(e){let t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString().substring(0,19).replace("T"," ")}function M(e,t){let n=(e||"").replace(/-/g,"/").replace(/[TZ]/g," ")+" UTC",r=new Date(n),o=(new Date().getTime()-r.getTime())/1e3,i=Math.floor(o/86400),a=r.getFullYear(),d=r.getMonth()+1,l=r.getDate();if(isNaN(i)||i<0||i>=31)return a.toString()+"-"+(d<10?"0"+d.toString():d.toString())+"-"+(l<10?"0"+l.toString():l.toString());let m="",f=0;return i==0?o<5?(f=1,m="just now"):o<60?(f=1,m=Math.floor(o)+" seconds ago"):o<120?(f=10,m="1 minute ago"):o<3600?(f=30,m=Math.floor(o/60)+" minutes ago"):o<7200?(f=60,m="1 hour ago"):(f=60,m=Math.floor(o/3600)+" hours ago"):i==1?(f=600,m="yesterday"):i<7?(f=600,m=i+" days ago"):(f=6e3,m=Math.ceil(i/7)+" weeks ago"),t&&(t.innerText=m,setTimeout(()=>M(e,t),f*1e3)),m}function ee(){return Fe}function Fe(e,t,n,r,o){if(!e)return;let i=e.id+"-list",a=document.createElement("datalist"),d=document.createElement("option");d.value="",d.innerText="Loading...",a.appendChild(d),a.id=i,e.parentElement?.prepend(a),e.setAttribute("autocomplete","off"),e.setAttribute("list",i);let l={},m="";function f(u){let g=t;return g.includes("?")?g+"&t=json&"+n+"="+encodeURIComponent(u):g+"?t=json&"+n+"="+encodeURIComponent(u)}function D(u){let g=l[u];!g||!g.frag||(m=u,a.replaceChildren(g.frag.cloneNode(!0)))}function De(){let u=e.value;if(u.length===0)return;let g=f(u),U=!u||!m;if(!U){let h=l[m];h&&(U=!h.data.find(T=>u===o(T)))}if(!!U){if(l[u]&&l[u].url===g){D(u);return}fetch(g).then(h=>h.json()).then(h=>{if(!h)return;let T=Array.isArray(h)?h:[h],_=document.createDocumentFragment(),G=10;for(let w=0;w<T.length&&G>0;w++){let P=o(T[w]),Ue=r(T[w]);if(P){let F=document.createElement("option");F.value=P,F.innerText=Ue,_.appendChild(F),G--}}l[u]={url:g,data:T,frag:_,complete:!1},D(u)})}}e.oninput=$e(De,250),console.log("managing ["+e.id+"] autocomplete")}function $e(e,t){let n=0;return function(...r){n!==0&&window.clearTimeout(n),n=window.setTimeout(function(){e(null,...r)},t)}}function te(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function q(e,t){return`<svg class="icon" style="width: ${t}px; height: ${t}px;"><use xlink:href="#svg-${e}"></use></svg>`}function ne(e){let t=s("input.result",e),n=s(".tags",e),r=t.value.split(",").map(i=>i.trim()).filter(i=>i!=="");y(t,!1),n.innerHTML="";for(let i of r)n.appendChild(re(i,e));k(".add-item",e)?.remove();let o=document.createElement("div");o.className="add-item",o.innerHTML=q("plus",22),o.onclick=function(){Re(n,e)},e.insertBefore(o,s(".clear",e))}function oe(){for(let e of p(".tag-editor"))ne(e);return ne}function Oe(e,t){return e.parentElement!==t.parentElement?null:e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var I;function re(e,t){let n=document.createElement("div");n.className="item",n.draggable=!0,n.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0),n.classList.add("dragging"),I=n},n.ondragover=function(){let a=Oe(n,I);if(!a)return;let d=a===-1?n:n.nextSibling;I.parentElement.insertBefore(I,d),R(t)},n.ondrop=function(a){a.preventDefault()},n.ondragend=function(a){n.classList.remove("dragging"),a.preventDefault()};let r=document.createElement("div");r.innerText=e,r.className="value",r.onclick=function(){ie(n)},n.appendChild(r);let o=document.createElement("input");o.className="editor",n.appendChild(o);let i=document.createElement("div");return i.innerHTML=q("times",13),i.className="close",i.onclick=function(){qe(n)},n.appendChild(i),n}function qe(e){let t=e.parentElement.parentElement;e.remove(),R(t)}function Re(e,t){let n=re("",t);e.appendChild(n),ie(n)}function ie(e){let t=s(".value",e),n=s(".editor",e);n.value=t.innerText;let r=function(){if(n.value===""){e.remove();return}t.innerText=n.value,y(t,!0),y(n,!1);let o=e.parentElement.parentElement;R(o)};n.onblur=r,n.onkeydown=function(o){if(o.code==="Enter")return o.preventDefault(),r(),!1},y(t,!1),y(n,!0),n.focus()}function R(e){let t=[],n=p(".item .value",e);for(let o of n)t.push(o.innerText);let r=s("input.result",e);r.value=t.join(", ")}var se="--selected";function We(e){let t=e.parentElement.parentElement.querySelector("input");if(!t)throw"no associated input found";t.value="\u2205"}function W(e){e.onreset=()=>W(e);let t={},n={};for(let r of e.elements){let o=r;if(o.name.length>0)if(o.name.endsWith(se))n[o.name]=o;else{(o.type!=="radio"||o.checked)&&(t[o.name]=o.value);let i=()=>{let a=n[o.name+se];a&&(a.checked=t[o.name]!==o.value)};o.onchange=i,o.onkeyup=i}}}function ae(){for(let e of Array.from(document.querySelectorAll("form.editor")))W(e);return[We,W]}var je=[];function ce(){let e=document.querySelectorAll(".color-var");if(e.length>0)for(let t of Array.from(e)){let n=t,r=n.dataset.var,o=n.dataset.mode;je.push(r),!(!r||r.length===0)&&(n.oninput=function(){Be(o,r,n.value)})}}function Be(e,t,n){let r=document.querySelector("#mockup-"+e);if(!r){console.error("can't find mockup for mode ["+e+"]");return}switch(t){case"color-foreground":b(r,".mock-main",n);break;case"color-background":x(r,".mock-main",n);break;case"color-foreground-muted":b(r,".mock-main .mock-muted",n);break;case"color-background-muted":x(r,".mock-main .mock-muted",n);break;case"color-link-foreground":b(r,".mock-main .mock-link",n);break;case"color-link-visited-foreground":b(r,".mock-main .mock-link-visited",n);break;case"color-nav-foreground":b(r,".mock-nav",n),b(r,".mock-nav .mock-link",n);break;case"color-nav-background":x(r,".mock-nav",n);break;case"color-menu-foreground":b(r,".mock-menu",n),b(r,".mock-menu .mock-link",n);break;case"color-menu-background":x(r,".mock-menu",n);break;case"color-menu-selected-foreground":b(r,".mock-menu .mock-link-selected",n);break;case"color-menu-selected-background":x(r,".mock-menu .mock-link-selected",n);break;default:console.error("invalid key ["+t+"]")}}function me(e,t,n){let r=e.querySelectorAll(t);if(r.length==0)throw"empty query selector ["+t+"]";r.forEach(o=>{n(o)})}function x(e,t,n){me(e,t,r=>r.style.backgroundColor=n)}function b(e,t,n){me(e,t,r=>r.style.color=n)}function le(){return A}var de=!1,A=class{constructor(t,n,r,o,i){this.debug=t,this.open=n,this.recv=r,this.err=o,this.url=ue(i),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=function(){de=!0},this.connectTime=Date.now(),this.sock=new WebSocket(ue(this.url));let t=this;this.sock.onopen=()=>{t.connected=!0,t.pendingMessages.forEach(t.send),t.pendingMessages=[],t.debug&&console.log("WebSocket connected"),t.open()},this.sock.onmessage=n=>{let r=JSON.parse(n.data);t.debug&&console.debug("[socket]: receive",r),t.recv(r)},this.sock.onerror=n=>()=>{t.err("socket",n.type)},this.sock.onclose=()=>{if(de)return;t.connected=!1;let n=t.connectTime?Date.now()-t.connectTime:0;0<n&&n<2e3?(t.pauseSeconds=t.pauseSeconds*2,t.debug&&console.debug(`socket closed immediately, reconnecting in ${t.pauseSeconds} seconds`),setTimeout(()=>{t.connect()},t.pauseSeconds*1e3)):(console.debug("socket closed after ["+n+"ms]"),setTimeout(()=>{t.connect()},t.pauseSeconds*500))}}disconnect(){}send(t){if(this.debug&&console.debug("out",t),!this.sock)throw"not initialized";if(this.connected){let n=JSON.stringify(t,null,2);this.sock.send(n)}else this.pendingMessages.push(t)}};function ue(e){if(e||(e="/connect"),e.indexOf("ws")==0)return e;let t=document.location,n="ws";return t.protocol==="https:"&&(n="wss"),e.indexOf("/")!=0&&(e="/"+e),n+`://${t.host}${e}`}function fe(e,t){return{__html:`<svg class="${t||""}" style="width: 18px; height: 18px;"><use href="#svg-${e}"></use></svg>`}}function pe(e,t){let n=c("li",null),r=X(new Date),o=c("span",{class:"nowrap reltime","data-time":r},"just now");M(r,o);let i=c("div",{class:"right"});return i.appendChild(o),n.appendChild(i),n.appendChild(c("div",null,e.content)),n.appendChild(c("div",null,c("em",null,t))),n}function ge(e,t,n){return c("tr",{id:"member-"+e,class:"member","data-id":e},c("td",null,c("a",{href:"#modal-member-"+e},c("div",{class:"left",style:"padding-right: var(--padding-small);",dangerouslySetInnerHTML:fe("profile")}),c("span",{class:"member-name"},t))),c("td",{class:"shrink",style:"text-align: right"},c("em",{class:"member-status"},n)),c("td",{class:"shrink online-status",title:"offline",dangerouslySetInnerHTML:fe("circle","right")}))}function he(e,t,n){let r=[["owner","Owner"],["member","Member"],["observer","Observer"]];return c("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},c("a",{class:"backdrop",href:"#"}),c("div",{class:"modal-content"},c("div",{class:"modal-header"},c("a",{href:"#",class:"modal-close"},"\xD7"),c("h2",null,t)),c("div",{class:"modal-body"},c("form",{action:document.location.pathname,method:"post",class:"expanded"},c("input",{type:"hidden",name:"userID",value:e}),c("em",null,"Role"),c("br",null),c("select",{class:"input-role",name:"role"},r.map(o=>o[0]==n?c("option",{selected:"selected",value:o[0]},o[1]):c("option",{value:o[0]},o[1]))),c("hr",null),c("div",{class:"right"},c("button",{class:"member-update",type:"submit",name:"action",value:"member-update"},"Save")),c("button",{type:"submit",class:"member-remove",name:"action",value:"member-remove",onClick:"return confirm('Are you sure you wish to remove this user?');"},"Remove")))))}var L,v;function be(e){let t=v[e];return t||"Unknown User"}function ve(){return L}function Te(){_e(),Ge(),j()}function _e(){let e=s("#modal-self"),t=s("form",e);t.onsubmit=function(){let n=s('input[name="name"]',t),r=s('input[name="choice"]:checked',t);return H("self",{name:n.value,choice:r.value}),s("#self-name").innerText=n.value,document.location.hash="",!1}}function Ge(){let e=p(".modal-member");for(let t of e)ke(t)}function ke(e){let t=s("form",e),n=function(r){let o=s('input[name="userID"]',t).value,i=s('select[name="role"]',t).value;H(r,{userID:o,role:i});let a=s("#member-"+o);return r==="member-update"?s(".member-role",a).innerText=i:r==="member-remove"&&(a.remove(),j()),document.location.hash="",!1};s(".member-update",t).onclick=()=>n("member-update"),s(".member-remove",t).onclick=()=>confirm("Are you sure you wish to remove this user?")?n("member-remove"):!1}function j(){v={},L=s("#self-id").innerText,v[L]=s("#self-name").innerText;let e=s("#panel-members"),t=p(".member",e);for(let n of t){let r=n.dataset.id;v[r]=s(".member-name",n).innerText}}function ye(e,t,n){if(k("#member-"+e)||e===L)return B(e,t,n);let o=s("#panel-members table tbody"),i=-1;for(let m=0;m<o.children.length;m++){let f=o.children.item(m);if(s(".member-name",f).innerText.localeCompare(t,void 0,{sensitivity:"accent"})>0){i=m;break}}let a=ge(e,t,n);i==-1?o.appendChild(a):o.insertBefore(a,o.children[i]);let d=s("#member-modals"),l=he(e,t,n);d.appendChild(l),ke(l),v[e]=t}function B(e,t,n){if(e===L)s("#self-name").innerText=t,s("#self-role").innerText=n;else{let r=s("#member-"+e);s(".member-name",r).innerText=t,s(".member-role",r).innerText=n;let o=s("#modal-member-"+e);s('select[name="role"]',o).value=n}if(v[e]!==t){v[e]=t;let r=s("#panel-members table tbody"),o=r.children,i=[];for(let a in o)o[a].nodeType==1&&i.push(o[a]);i.sort((a,d)=>{let l=s(".member-name",a).innerText,m=s(".member-name",d).innerText;return l.localeCompare(m,void 0,{sensitivity:"accent"})}),r.replaceChildren(...i)}}function Ee(e){s("#member-"+e).remove(),j()}function Me(e,t){let n=k("#member-"+e+" .online-status");if(!n)throw"missing panel #member-"+e;n.title=t?"online":"offline";let r=t?"check-circle":"circle";n.innerHTML='<svg style="width: 18px; height: 18px;" class="right"><use xlink:href="#svg-'+r+'"></use></svg>'}function xe(){let e=p(".modal.comments");for(let t of e){let n=s("form",t);n.onsubmit=function(){let r=p("input",n),o={};for(let a of r)switch(a.name){case"svc":o.svc=a.value;break;case"modelID":o.modelID=a.value;break}let i=s("textarea",n);return o.content=i.value,o.userID=ve(),H("comment",o),S(o),!1}}}function S(e){let t=s("#comment-list-"+e.svc+"-"+e.modelID),n=be(e.userID),r=pe(e,n);t.appendChild(r);let o=t.childNodes.length-1,i=s("#comment-link-"+e.svc+"-"+e.modelID);i.title=o+(o==1?" comment":" comments"),i.innerHTML.indexOf("comment-dots")==-1&&(i.innerHTML='<svg style="width: 18px; height: 18px;" class="right"><use xlink:href="#svg-comment-dots"></use></svg>')}function Le(e,t){switch(t.cmd){case"error":return Pe(t.param.message);case"comment":return S(t.param);case"online-update":return Me(t.param.userID,t.param.connected);case"member-add":return ye(t.param.userID,t.param.name,t.param.role);case"member-update":return B(t.param.userID,t.param.name,t.param.role);case"member-remove":return Ee(t.param)}switch(e){case"estimate":switch(t.cmd){case"fooo":return S(t.param)}}}function Pe(e){C("error","error",e)}function He(){let e=s("#modal-story--add");console.log("estimate!")}function we(){console.log("team!")}function Ce(){console.log("sprint!")}function Ie(){console.log("standup!")}function Ae(){console.log("retro!")}var Se,E,N;function Ye(){console.log("[socket]: open")}function ze(e){let t=document.getElementById("socket-list");if(t){let n=document.createElement("pre");n.innerText=JSON.stringify(e,null,2),t.append(n)}Le(E,e)}function Ke(e){console.log("[socket error]: "+e)}function Qe(e,t){switch(E=e,N=t,xe(),Te(),E){case"team":we();break;case"sprint":Ce();break;case"estimate":He();break;case"standup":Ie();break;case"retro":Ae();break}Se=new A(!0,Ye,ze,Ke,"/"+E+"/"+N+"/connect"),console.log("loaded ["+E+"] workspace ["+N+"]")}function H(e,t){Se.send({channel:E+":"+N,cmd:e,param:t})}function Ne(){window.initWorkspace=Qe}function Ve(){let[e,t]=ae();window.rituals={relativeTime:J(),autocomplete:ee(),setSiblingToNull:e,initForm:t,flash:Q(),tags:oe(),Socket:le()},z(),K(),Z(),te(),ce(),window.JSX=c,Ne()}document.addEventListener("DOMContentLoaded",Ve);})();
//# sourceMappingURL=client.js.map
