(()=>{function p(e,t){let n;t?n=t.querySelectorAll(e):n=document.querySelectorAll(e);let r=[];return n.forEach(o=>{r.push(o)}),r}function k(e,t){let n=p(e,t);switch(n.length){case 0:return;case 1:return n[0];default:console.warn(`found [${n.length}] elements with selector [${e}], wanted zero or one`)}}function s(e,t){let n=k(e,t);return n||console.warn(`no element found for selector [${e}]`),n}function G(e,t){return typeof e=="string"&&(e=s(e)),e.innerHTML=t,e}function y(e,t,n="block"){return typeof e=="string"&&(e=s(e)),e.style.display=t?n:"none",e}function a(e,t,...n){let r=document.createElement(e);for(let o in t)if(o&&t.hasOwnProperty(o)){let i=t[o];o==="dangerouslySetInnerHTML"?G(r,i.__html):i===!0?r.setAttribute(o,o):i!==!1&&i!==null&&i!==void 0&&r.setAttribute(o,i.toString())}for(let o of n)if(Array.isArray(o))o.forEach(i=>{if(o==null)throw`child array for tag [${e}] is ${o}
${r.outerHTML}`;if(i==null)throw`child for tag [${e}] is ${i}
${r.outerHTML}`;typeof i=="string"&&(i=document.createTextNode(i)),r.appendChild(i)});else{if(o==null)throw`child for tag [${e}] is ${o}
${r.outerHTML}`;o.nodeType||(o=document.createTextNode(o.toString())),r.appendChild(o)}return r}function P(){for(let e of Array.from(document.querySelectorAll(".menu-container .final")))e.scrollIntoView({block:"nearest"})}var F="mode-light",$="mode-dark";function Y(){for(let e of Array.from(document.getElementsByClassName("mode-input"))){let t=e;t.onclick=function(){switch(t.value){case"":document.body.classList.remove(F),document.body.classList.remove($);break;case"light":document.body.classList.add(F),document.body.classList.remove($);break;case"dark":document.body.classList.remove(F),document.body.classList.add($);break}}}}function z(e,t,n){let r=document.getElementById("flash-container");r===null&&(r=document.createElement("div"),r.id="flash-container",document.body.insertAdjacentElement("afterbegin",r));let o=document.createElement("div");o.className="flash";let i=document.createElement("input");i.type="radio",i.style.display="none",i.id="hide-flash-"+e,o.appendChild(i);let c=document.createElement("label");c.htmlFor="hide-flash-"+e;let d=document.createElement("span");d.innerHTML="\xD7",c.appendChild(d),o.appendChild(c);let l=document.createElement("div");l.className="content flash-"+t,l.innerText=n,o.appendChild(l),r.appendChild(o),Q(o)}function K(){let e=document.getElementById("flash-container");if(e===null)return z;let t=e.querySelectorAll(".flash");if(t.length>0)for(let n of t)Q(n);return z}function Q(e){setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},5e3)}function V(){for(let e of Array.from(document.getElementsByClassName("link-confirm"))){let t=e;t.onclick=function(){let n=t.dataset.message;return n&&n.length===0&&(n="Are you sure?"),confirm(n)}}}function Z(){return p(".reltime").forEach(e=>{M(e.dataset.time||"",e)}),M}function J(e){let t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return new Date(t).toISOString().substring(0,19).replace("T"," ")}function M(e,t){let n=(e||"").replace(/-/g,"/").replace(/[TZ]/g," ")+" UTC",r=new Date(n),o=(new Date().getTime()-r.getTime())/1e3,i=Math.floor(o/86400),c=r.getFullYear(),d=r.getMonth()+1,l=r.getDate();if(isNaN(i)||i<0||i>=31)return c.toString()+"-"+(d<10?"0"+d.toString():d.toString())+"-"+(l<10?"0"+l.toString():l.toString());let m="",f=0;return i==0?o<5?(f=1,m="just now"):o<60?(f=1,m=Math.floor(o)+" seconds ago"):o<120?(f=10,m="1 minute ago"):o<3600?(f=30,m=Math.floor(o/60)+" minutes ago"):o<7200?(f=60,m="1 hour ago"):(f=60,m=Math.floor(o/3600)+" hours ago"):i==1?(f=600,m="yesterday"):i<7?(f=600,m=i+" days ago"):(f=6e3,m=Math.ceil(i/7)+" weeks ago"),t&&(t.innerText=m,setTimeout(()=>M(e,t),f*1e3)),m}function X(){return De}function De(e,t,n,r,o){if(!e)return;let i=e.id+"-list",c=document.createElement("datalist"),d=document.createElement("option");d.value="",d.innerText="Loading...",c.appendChild(d),c.id=i,e.parentElement?.prepend(c),e.setAttribute("autocomplete","off"),e.setAttribute("list",i);let l={},m="";function f(u){let g=t;return g.includes("?")?g+"&t=json&"+n+"="+encodeURIComponent(u):g+"?t=json&"+n+"="+encodeURIComponent(u)}function N(u){let g=l[u];!g||!g.frag||(m=u,c.replaceChildren(g.frag.cloneNode(!0)))}function Se(){let u=e.value;if(u.length===0)return;let g=f(u),D=!u||!m;if(!D){let h=l[m];h&&(D=!h.data.find(v=>u===o(v)))}if(!!D){if(l[u]&&l[u].url===g){N(u);return}fetch(g).then(h=>h.json()).then(h=>{if(!h)return;let v=Array.isArray(h)?h:[h],B=document.createDocumentFragment(),R=10;for(let w=0;w<v.length&&R>0;w++){let _=o(v[w]),Ne=r(v[w]);if(_){let U=document.createElement("option");U.value=_,U.innerText=Ne,B.appendChild(U),R--}}l[u]={url:g,data:v,frag:B,complete:!1},N(u)})}}e.oninput=Ue(Se,250),console.log("managing ["+e.id+"] autocomplete")}function Ue(e,t){let n=0;return function(...r){n!==0&&window.clearTimeout(n),n=window.setTimeout(function(){e(null,...r)},t)}}function ee(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.location.hash.startsWith("#modal-")&&(document.location.hash="")})}function O(e,t){return`<svg class="icon" style="width: ${t}px; height: ${t}px;"><use xlink:href="#svg-${e}"></use></svg>`}function te(e){let t=s("input.result",e),n=s(".tags",e),r=t.value.split(",").map(i=>i.trim()).filter(i=>i!=="");y(t,!1),n.innerHTML="";for(let i of r)n.appendChild(oe(i,e));k(".add-item",e)?.remove();let o=document.createElement("div");o.className="add-item",o.innerHTML=O("plus",22),o.onclick=function(){Oe(n,e)},e.insertBefore(o,s(".clear",e))}function ne(){for(let e of p(".tag-editor"))te(e);return te}function Fe(e,t){return e.parentElement!==t.parentElement?null:e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}var C;function oe(e,t){let n=document.createElement("div");n.className="item",n.draggable=!0,n.ondragstart=function(c){c.dataTransfer.setDragImage(document.createElement("div"),0,0),n.classList.add("dragging"),C=n},n.ondragover=function(){let c=Fe(n,C);if(!c)return;let d=c===-1?n:n.nextSibling;C.parentElement.insertBefore(C,d),q(t)},n.ondrop=function(c){c.preventDefault()},n.ondragend=function(c){n.classList.remove("dragging"),c.preventDefault()};let r=document.createElement("div");r.innerText=e,r.className="value",r.onclick=function(){re(n)},n.appendChild(r);let o=document.createElement("input");o.className="editor",n.appendChild(o);let i=document.createElement("div");return i.innerHTML=O("times",13),i.className="close",i.onclick=function(){$e(n)},n.appendChild(i),n}function $e(e){let t=e.parentElement.parentElement;e.remove(),q(t)}function Oe(e,t){let n=oe("",t);e.appendChild(n),re(n)}function re(e){let t=s(".value",e),n=s(".editor",e);n.value=t.innerText;let r=function(){if(n.value===""){e.remove();return}t.innerText=n.value,y(t,!0),y(n,!1);let o=e.parentElement.parentElement;q(o)};n.onblur=r,n.onkeydown=function(o){if(o.code==="Enter")return o.preventDefault(),r(),!1},y(t,!1),y(n,!0),n.focus()}function q(e){let t=[],n=p(".item .value",e);for(let o of n)t.push(o.innerText);let r=s("input.result",e);r.value=t.join(", ")}var ie="--selected";function qe(e){let t=e.parentElement.parentElement.querySelector("input");if(!t)throw"no associated input found";t.value="\u2205"}function W(e){e.onreset=()=>W(e);let t={},n={};for(let r of e.elements){let o=r;if(o.name.length>0)if(o.name.endsWith(ie))n[o.name]=o;else{(o.type!=="radio"||o.checked)&&(t[o.name]=o.value);let i=()=>{let c=n[o.name+ie];c&&(c.checked=t[o.name]!==o.value)};o.onchange=i,o.onkeyup=i}}}function se(){for(let e of Array.from(document.querySelectorAll("form.editor")))W(e);return[qe,W]}var We=[];function ce(){let e=document.querySelectorAll(".color-var");if(e.length>0)for(let t of Array.from(e)){let n=t,r=n.dataset.var,o=n.dataset.mode;We.push(r),!(!r||r.length===0)&&(n.oninput=function(){je(o,r,n.value)})}}function je(e,t,n){let r=document.querySelector("#mockup-"+e);if(!r){console.error("can't find mockup for mode ["+e+"]");return}switch(t){case"color-foreground":b(r,".mock-main",n);break;case"color-background":x(r,".mock-main",n);break;case"color-foreground-muted":b(r,".mock-main .mock-muted",n);break;case"color-background-muted":x(r,".mock-main .mock-muted",n);break;case"color-link-foreground":b(r,".mock-main .mock-link",n);break;case"color-link-visited-foreground":b(r,".mock-main .mock-link-visited",n);break;case"color-nav-foreground":b(r,".mock-nav",n),b(r,".mock-nav .mock-link",n);break;case"color-nav-background":x(r,".mock-nav",n);break;case"color-menu-foreground":b(r,".mock-menu",n),b(r,".mock-menu .mock-link",n);break;case"color-menu-background":x(r,".mock-menu",n);break;case"color-menu-selected-foreground":b(r,".mock-menu .mock-link-selected",n);break;case"color-menu-selected-background":x(r,".mock-menu .mock-link-selected",n);break;default:console.error("invalid key ["+t+"]")}}function ae(e,t,n){let r=e.querySelectorAll(t);if(r.length==0)throw"empty query selector ["+t+"]";r.forEach(o=>{n(o)})}function x(e,t,n){ae(e,t,r=>r.style.backgroundColor=n)}function b(e,t,n){ae(e,t,r=>r.style.color=n)}function me(){return I}var le=!1,I=class{constructor(t,n,r,o,i){this.debug=t,this.open=n,this.recv=r,this.err=o,this.url=de(i),this.connected=!1,this.pauseSeconds=1,this.pendingMessages=[],this.connect()}connect(){window.onbeforeunload=function(){le=!0},this.connectTime=Date.now(),this.sock=new WebSocket(de(this.url));let t=this;this.sock.onopen=()=>{t.connected=!0,t.pendingMessages.forEach(t.send),t.pendingMessages=[],t.debug&&console.log("WebSocket connected"),t.open()},this.sock.onmessage=n=>{let r=JSON.parse(n.data);t.debug&&console.debug("[socket]: receive",r),t.recv(r)},this.sock.onerror=n=>()=>{t.err("socket",n.type)},this.sock.onclose=()=>{if(le)return;t.connected=!1;let n=t.connectTime?Date.now()-t.connectTime:0;0<n&&n<2e3?(t.pauseSeconds=t.pauseSeconds*2,t.debug&&console.debug(`socket closed immediately, reconnecting in ${t.pauseSeconds} seconds`),setTimeout(()=>{t.connect()},t.pauseSeconds*1e3)):(console.debug("socket closed after ["+n+"ms]"),setTimeout(()=>{t.connect()},t.pauseSeconds*500))}}disconnect(){}send(t){if(this.debug&&console.debug("out",t),!this.sock)throw"not initialized";if(this.connected){let n=JSON.stringify(t,null,2);this.sock.send(n)}else this.pendingMessages.push(t)}};function de(e){if(e||(e="/connect"),e.indexOf("ws")==0)return e;let t=document.location,n="ws";return t.protocol==="https:"&&(n="wss"),e.indexOf("/")!=0&&(e="/"+e),n+`://${t.host}${e}`}function ue(e,t){return{__html:`<svg class="${t||""}" style="width: 18px; height: 18px;"><use href="#svg-${e}"></use></svg>`}}function fe(e,t){let n=a("li",null),r=J(new Date),o=a("span",{class:"nowrap reltime","data-time":r},"just now");M(r,o);let i=a("div",{class:"right"});return i.appendChild(o),n.appendChild(i),n.appendChild(a("div",null,e.content)),n.appendChild(a("div",null,a("em",null,t))),n}function pe(e,t,n){return a("tr",{id:"member-"+e,class:"member","data-id":e},a("td",null,a("a",{href:"#modal-member-"+e},a("div",{class:"left",style:"padding-right: var(--padding-small);",dangerouslySetInnerHTML:ue("profile")}),a("span",{class:"member-name"},t))),a("td",{class:"shrink",style:"text-align: right"},a("em",{class:"member-status"},n)),a("td",{class:"shrink online-status",title:"offline",dangerouslySetInnerHTML:ue("circle","right")}))}function ge(e,t,n){let r=[["owner","Owner"],["member","Member"],["observer","Observer"]];return a("div",{id:"modal-member-"+e,"data-id":e,class:"modal modal-member",style:"display: none;"},a("a",{class:"backdrop",href:"#"}),a("div",{class:"modal-content"},a("div",{class:"modal-header"},a("a",{href:"#",class:"modal-close"},"\xD7"),a("h2",null,t)),a("div",{class:"modal-body"},a("form",{action:document.location.pathname,method:"post",class:"expanded"},a("input",{type:"hidden",name:"userID",value:e}),a("em",null,"Role"),a("br",null),a("select",{class:"input-role",name:"role"},r.map(o=>o[0]==n?a("option",{selected:"selected",value:o[0]},o[1]):a("option",{value:o[0]},o[1]))),a("hr",null),a("div",{class:"right"},a("button",{class:"member-update",type:"submit",name:"action",value:"member-update"},"Save")),a("button",{type:"submit",class:"member-remove",name:"action",value:"member-remove",onClick:"return confirm('Are you sure you wish to remove this user?');"},"Remove")))))}var L,T;function he(e){let t=T[e];return t||"Unknown User"}function be(){return L}function Te(){Be(),Re(),_e()}function Be(){let e=s("#modal-self"),t=s("form",e);t.onsubmit=function(){let n=s('input[name="name"]',t),r=s('input[name="choice"]:checked',t);return H("self",{name:n.value,choice:r.value}),s("#self-name").innerText=n.value,document.location.hash="",!1}}function Re(){let e=p(".modal-member");for(let t of e)ve(t)}function ve(e){let t=s("form",e),n=function(r){let o=s('input[name="userID"]',t).value,i=s('select[name="role"]',t).value;H(r,{userID:o,role:i});let c=s("#member-"+o);return r==="member-update"?s(".member-role",c).innerText=i:r==="member-remove"&&c.remove(),document.location.hash="",!1};s(".member-update",t).onclick=()=>n("member-update"),s(".member-remove",t).onclick=()=>confirm("Are you sure you wish to remove this user?")?n("member-remove"):!1}function _e(){T={},L=s("#self-id").innerText,T[L]=s("#self-name").innerText;let e=s("#panel-members"),t=p(".member",e);for(let n of t){let r=n.dataset.id;T[r]=s(".member-name",n).innerText}}function ke(e,t,n){if(k("#member-"+e)||e===L)return j(e,t,n);let o=s("#panel-members table tbody"),i=-1;for(let m=0;m<o.children.length;m++){let f=o.children.item(m);if(s(".member-name",f).innerText.localeCompare(t,void 0,{sensitivity:"accent"})>0){i=m;break}}let c=pe(e,t,n);i==-1?o.appendChild(c):o.insertBefore(c,o.children[i]);let d=s("#member-modals"),l=ge(e,t,n);d.appendChild(l),ve(l),T[e]=t}function j(e,t,n){if(e===L)s("#self-name").innerText=t,s("#self-role").innerText=n;else{let r=s("#member-"+e);s(".member-name",r).innerText=t,s(".member-role",r).innerText=n;let o=s("#modal-member-"+e);s('select[name="role"]',o).value=n}if(T[e]!==t){T[e]=t;let r=s("#panel-members table tbody"),o=r.children,i=[];for(let c in o)o[c].nodeType==1&&i.push(o[c]);i.sort((c,d)=>{let l=s(".member-name",c).innerText,m=s(".member-name",d).innerText;return l.localeCompare(m,void 0,{sensitivity:"accent"})}),r.replaceChildren(...i)}}function ye(e,t){let n=k("#member-"+e+" .online-status");if(!n)throw"missing panel #member-"+e;n.title=t?"online":"offline";let r=t?"check-circle":"circle";n.innerHTML='<svg style="width: 18px; height: 18px;" class="right"><use xlink:href="#svg-'+r+'"></use></svg>'}function Ee(){let e=p(".modal.comments");for(let t of e){let n=s("form",t);n.onsubmit=function(){let r=p("input",n),o={};for(let c of r)switch(c.name){case"svc":o.svc=c.value;break;case"modelID":o.modelID=c.value;break}let i=s("textarea",n);return o.content=i.value,o.userID=be(),H("comment",o),A(o),!1}}}function A(e){let t=s("#comment-list-"+e.svc+"-"+e.modelID),n=he(e.userID),r=fe(e,n);t.appendChild(r);let o=t.childNodes.length-1,i=s("#comment-link-"+e.svc+"-"+e.modelID);i.title=o+(o==1?" comment":" comments"),i.innerHTML.indexOf("comment-dots")==-1&&(i.innerHTML='<svg style="width: 18px; height: 18px;" class="right"><use xlink:href="#svg-comment-dots"></use></svg>')}function Me(e,t){switch(t.cmd){case"comment":return A(t.param);case"online-update":return ye(t.param.userID,t.param.connected);case"member-add":return ke(t.param.userID,t.param.name,t.param.role);case"member-update":return j(t.param.userID,t.param.name,t.param.role)}switch(e){case"estimate":switch(t.cmd){case"fooo":return A(t.param)}}}function xe(){let e=s("#modal-story--add");console.log("estimate!")}function Le(){console.log("team!")}function He(){console.log("sprint!")}function we(){console.log("standup!")}function Ce(){console.log("retro!")}var Ie,E,S;function Ge(){console.log("[socket]: open")}function Pe(e){let t=document.getElementById("socket-list");if(t){let n=document.createElement("pre");n.innerText=JSON.stringify(e,null,2),t.append(n)}Me(E,e)}function Ye(e){console.log("[socket error]: "+e)}function ze(e,t){switch(E=e,S=t,Ee(),Te(),E){case"team":Le();break;case"sprint":He();break;case"estimate":xe();break;case"standup":we();break;case"retro":Ce();break}Ie=new I(!0,Ge,Pe,Ye,"/"+E+"/"+S+"/connect"),console.log("loaded ["+E+"] workspace ["+S+"]")}function H(e,t){Ie.send({channel:E+":"+S,cmd:e,param:t})}function Ae(){window.initWorkspace=ze}function Ke(){let[e,t]=se();window.rituals={relativeTime:Z(),autocomplete:X(),setSiblingToNull:e,initForm:t,flash:K(),tags:ne(),Socket:me()},P(),Y(),V(),ee(),ce(),window.JSX=a,Ae()}document.addEventListener("DOMContentLoaded",Ke);})();
//# sourceMappingURL=client.js.map
